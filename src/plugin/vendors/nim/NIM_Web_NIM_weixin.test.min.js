module.exports=function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={i:n,l:!1,exports:{}};e[n].call(s.exports,s,s.exports,t);s.l=!0;return s.exports}var r={};t.m=e;t.c=r;t.d=function(e,r,n){if(!t.o(e,r))Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})};t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})};t.n=function(e){var r=e&&e.__esModule?function n(){return e["default"]}:function s(){return e};t.d(r,"a",r);return r};t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};t.p="";return t(t.s="./src/entry/nim.js")}({"./external/socketio/socket.io.js":function(module,exports,__webpack_require__){(function(global,module){function getGlobal(){if("undefined"!=typeof window)return window;if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;else return{}}var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var root=getGlobal();var io=!1?void 0:module.exports;if("undefined"==typeof root.location)root.location=null;if(!root.io)root.io=io;else if(module)module.exports=io=root.io;!function(){!function(e,t){var r=e;r.version="0.9.11";r.protocol=1;r.transports=[];r.j=[];r.sockets={};r.connect=function(e,n){var s=r.util.parseUri(e);var i;var o;if(t&&t.location){s.protocol=s.protocol||t.location.protocol.slice(0,-1);s.host=s.host||(t.document?t.document.domain:t.location.hostname);s.port=s.port||t.location.port}i=r.util.uniqueUri(s);var a={host:s.host,secure:"https"===s.protocol,port:s.port||("https"===s.protocol?443:80),query:s.query||""};r.util.merge(a,n);if(a["force new connection"]||!r.sockets[i])o=new r.Socket(a);if(!a["force new connection"]&&o)r.sockets[i]=o;o=o||r.sockets[i];return o.of(s.path.length>1?s.path:"")}}(!0?module.exports:void 0,root);!function(e,t){var r=e.util={};var n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];r.parseUri=function(e){var t=n.exec(e||""),r={},i=14;for(;i--;)r[s[i]]=t[i]||"";return r};r.uniqueUri=function(e){var r=e.protocol,n=e.host,s=e.port;if("document"in t&&t.document){n=n||document.domain;s=s||("https"==r&&"https:"!==document.location.protocol?443:document.location.port)}else{n=n||"localhost";if(!s&&"https"==r)s=443}return(r||"http")+"://"+n+":"+(s||80)};r.query=function(e,t){var n=r.chunkQuery(e||""),s=[];r.merge(n,r.chunkQuery(t||""));for(var i in n)if(n.hasOwnProperty(i))s.push(i+"="+n[i]);return s.length?"?"+s.join("&"):""};r.chunkQuery=function(e){var t={},r=e.split("&"),n=0,s=r.length,i;for(;n<s;++n){i=r[n].split("=");if(i[0])t[i[0]]=i[1]}return t};var i=!1;r.load=function(e){if("undefined"!=typeof document&&document&&"complete"===document.readyState||i)return e();r.on(t,"load",e,!1)};r.on=function(e,t,r,n){if(e.attachEvent)e.attachEvent("on"+t,r);else if(e.addEventListener)e.addEventListener(t,r,n)};r.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!r.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||r.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(root[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null};if("undefined"!=typeof root)r.load(function(){i=!0});r.defer=function(e){if(!r.ua.webkit||"undefined"!=typeof importScripts)return e();r.load(function(){setTimeout(e,100)})};r.merge=function o(e,t,n,s){var i=s||[];var o="undefined"==typeof n?2:n;var a;for(a in t)if(t.hasOwnProperty(a)&&r.indexOf(i,a)<0)if("object"!=typeof e[a]||!o){e[a]=t[a];i.push(t[a])}else r.merge(e[a],t[a],o-1,i);return e};r.mixin=function(e,t){r.merge(e.prototype,t.prototype)};r.inherit=function(e,t){function r(){}r.prototype=t.prototype;e.prototype=new r};r.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};r.intersect=function(e,t){var n=[],s=e.length>t.length?e:t,i=e.length>t.length?t:e;for(var o=0,a=i.length;o<a;o++)if(~r.indexOf(s,i[o]))n.push(i[o]);return n};r.indexOf=function(e,t,r){for(var n=e.length,r=r<0?r+n<0?0:r+n:r||0;r<n&&e[r]!==t;r++);return n<=r?-1:r};r.toArray=function(e){var t=[];for(var r=0,n=e.length;r<n;r++)t.push(e[r]);return t};r.ua={};r.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}();r.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);r.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,root);!function(e,t){function r(){}e.EventEmitter=r;r.prototype.on=function(e,r){if(!this.$events)this.$events={};if(!this.$events[e])this.$events[e]=r;else if(t.util.isArray(this.$events[e]))this.$events[e].push(r);else this.$events[e]=[this.$events[e],r];return this};r.prototype.addListener=r.prototype.on;r.prototype.once=function(e,t){function r(){n.removeListener(e,r);t.apply(this,arguments)}var n=this;r.listener=t;this.on(e,r);return this};r.prototype.removeListener=function(e,r){if(this.$events&&this.$events[e]){var n=this.$events[e];if(t.util.isArray(n)){var s=-1;for(var i=0,o=n.length;i<o;i++)if(n[i]===r||n[i].listener&&n[i].listener===r){s=i;break}if(s<0)return this;n.splice(s,1);if(!n.length)delete this.$events[e]}else if(n===r||n.listener&&n.listener===r)delete this.$events[e]}return this};r.prototype.removeAllListeners=function(e){if(void 0===e){this.$events={};return this}if(this.$events&&this.$events[e])this.$events[e]=null;return this};r.prototype.listeners=function(e){if(!this.$events)this.$events={};if(!this.$events[e])this.$events[e]=[];if(!t.util.isArray(this.$events[e]))this.$events[e]=[this.$events[e]];return this.$events[e]};r.prototype.emit=function(e){if(!this.$events)return!1;var r=this.$events[e];if(!r)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof r)r.apply(this,n);else if(t.util.isArray(r)){var s=r.slice();for(var i=0,o=s.length;i<o;i++)s[i].apply(this,n)}else return!1;return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);!function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,s,i,o=gap,a,c=t[e];if(c instanceof Date)c=date(e);if("function"==typeof rep)c=rep.call(t,e,c);switch(typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";gap+=indent;a=[];if("[object Array]"===Object.prototype.toString.apply(c)){i=c.length;for(r=0;r<i;r+=1)a[r]=str(r,c)||"null";s=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+o+"]":"["+a.join(",")+"]";gap=o;return s}if(rep&&"object"==typeof rep){i=rep.length;for(r=0;r<i;r+=1)if("string"==typeof rep[r]){n=rep[r];s=str(n,c);if(s)a.push(quote(n)+(gap?": ":":")+s)}}else for(n in c)if(Object.prototype.hasOwnProperty.call(c,n)){s=str(n,c);if(s)a.push(quote(n)+(gap?": ":":")+s)}s=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+o+"}":"{"+a.join(",")+"}";gap=o;return s}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,r){var n;gap="";indent="";if("number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else if("string"==typeof r)indent=r;rep=t;if(t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("socket.io:: replacer cannot JSON.stringify");return str("",{"":e})};JSON.parse=function(text,reviver){function walk(e,t){var r,n,s=e[t];if(s&&"object"==typeof s)for(r in s)if(Object.prototype.hasOwnProperty.call(s,r)){n=walk(s,r);if(void 0!==n)s[r]=n;else delete s[r]}return reviver.call(e,t,s)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return"function"==typeof reviver?walk({"":j},""):j}throw new SyntaxError("socket.io:: reviver cannot JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0);!function(e,t){var r=e.parser={};var n=r.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"];var s=r.reasons=["transport not supported","client not handshaken","unauthorized"];var i=r.advice=["reconnect"];var o=t.JSON,a=t.util.indexOf;r.encodePacket=function(e){var t=a(n,e.type),r=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var m=e.reason?a(s,e.reason):"",d=e.advice?a(i,e.advice):"";if(""!==m||""!==d)l=m+(""!==d?"+"+d:"");break;case"message":if(""!==e.data)l=e.data;break;case"event":var f={name:e.name};if(e.args&&e.args.length)f.args=e.args;l=o.stringify(f);break;case"json":l=o.stringify(e.data);break;case"connect":if(e.qs)l=e.qs;break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var p=[t,r+("data"==u?"+":""),c];
if(null!==l&&void 0!==l)p.push(l);return p.join(":")};r.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var r=0,n=e.length;r<n;r++){var s=e[r];t+="�"+s.length+"�"+e[r]}return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;r.decodePacket=function(e){var t=e.match(c);if(!t)return{};var r=t[2]||"",e=t[5]||"",a={type:n[t[1]],endpoint:t[4]||""};if(r){a.id=r;if(t[3])a.ack="data";else a.ack=!0}switch(a.type){case"error":var t=e.split("+");a.reason=s[t[0]]||"";a.advice=i[t[1]]||"";break;case"message":a.data=e||"";break;case"event":try{var u=o.parse(e);a.name=u.name;a.args=u.args}catch(l){}a.args=a.args||[];break;case"json":try{a.data=o.parse(e)}catch(l){}break;case"connect":a.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){a.ackId=t[1];a.args=[];if(t[3])try{a.args=t[3]?o.parse(t[3]):[]}catch(l){}}break;case"disconnect":case"heartbeat":}return a};r.decodePayload=function(e){var t=function(e,t){var r=0;for(var n=e;n<t.length;n++)if("�"==t.charAt(n))return r;else r++;return r};if("�"==e.charAt(0)){var n=[];for(var s=1,i="";s<e.length;s++)if("�"==e.charAt(s)){var o=e.substr(s+1).substr(0,i);if("�"!=e.charAt(s+1+Number(i))&&s+1+Number(i)!=e.length){var a=Number(i);l=t(s+a+1,e);o=e.substr(s+1).substr(0,a+l);s+=l}n.push(r.decodePacket(o));s+=Number(i)+1;i=""}else i+=e.charAt(s);return n}else return[r.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);!function(e,t){function r(e,t){this.socket=e;this.sessid=t}e.Transport=r;t.util.mixin(r,t.EventEmitter);r.prototype.heartbeats=function(){return!0};r.prototype.onData=function(e){if(this!==this.socket.transport)return this;this.clearCloseTimeout();if(this.socket.connected||this.socket.connecting||this.socket.reconnecting)this.setCloseTimeout();if(""!==e){var r=t.parser.decodePayload(e);if(r&&r.length)for(var n=0,s=r.length;n<s;n++)this.onPacket(r[n])}return this};r.prototype.onPacket=function(e){this.socket.setHeartbeatTimeout();if("heartbeat"==e.type)return this.onHeartbeat();if("connect"==e.type&&""==e.endpoint)this.onConnect();if("error"==e.type&&"reconnect"==e.advice)this.isOpen=!1;this.socket.onPacket(e);return this};r.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}};r.prototype.onDisconnect=function(){if(this.isOpen)this.close();this.clearTimeouts();if(!this.socket)return this;if(this.socket.transport===this)this.socket.onDisconnect();else this.socket.setBuffer(!1);return this};r.prototype.onConnect=function(){this.socket.onConnect();return this};r.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null}};r.prototype.clearTimeouts=function(){this.clearCloseTimeout();if(this.reopenTimeout)clearTimeout(this.reopenTimeout)};r.prototype.packet=function(e){this.send(t.parser.encodePacket(e))};r.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})};r.prototype.onOpen=function(){this.isOpen=!0;this.clearCloseTimeout();this.socket.onOpen()};r.prototype.onClose=function(){var e=this;this.isOpen=!1;if(this.socket.transport===this)this.socket.onClose();else this.socket.setBuffer(!1);this.onDisconnect();if(this.onDisconnectDone instanceof Function)this.onDisconnectDone(null);if(this.onConnectionOver instanceof Function)this.onConnectionOver(null)};r.prototype.onDisconnectDone=function(){};r.prototype.onConnectionOver=function(){};r.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid};r.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);!function(e,t,r){function n(e){this.options={port:80,secure:!1,document:"document"in r?document:!1,resource:"socket.io",transports:e.transports||t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1};t.util.merge(this.options,e);this.connected=!1;this.open=!1;this.connecting=!1;this.reconnecting=!1;this.namespaces={};this.buffer=[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var n=this;t.util.on(r,"beforeunload",function(){n.disconnectSync()},!1)}if(this.options["auto connect"])this.connect()}function s(){}e.Socket=n;t.util.mixin(n,t.EventEmitter);n.prototype.of=function(e){if(!this.namespaces[e]){this.namespaces[e]=new t.SocketNamespace(this,e);if(""!==e)this.namespaces[e].packet({type:"connect"})}return this.namespaces[e]};n.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)if(this.namespaces.hasOwnProperty(t)){e=this.of(t);e.$emit.apply(e,arguments)}};n.prototype.handshake=function(e){function r(t){if(t instanceof Error){n.connecting=!1;n.onError(t.message)}else{console.log("SocketIO handshake success "+t);e.apply(null,t.split(":"))}}var n=this,i=this.options;var o=["http"+(i.secure?"s":"")+":/",i.host+":"+i.port,i.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS&&"undefined"!=typeof document&&document&&document.getElementsByTagName){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=o+"&jsonp="+t.j.length;c.onreadystatechange=function(){if("loaded"==this.readyState&&c.parentNode){c.parentNode.removeChild(c);n.connecting=!1;!n.reconnecting&&n.onError("Server down or port not open");n.publish("handshake_failed")}};a.parentNode.insertBefore(c,a);t.j.push(function(e){r(e);c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",o,!0);u.timeout=1e4;if(this.isXDomain())u.withCredentials=!0;u.onreadystatechange=function(){if(4==u.readyState){u.onreadystatechange=s;if(200==u.status)r(u.responseText);else if(403==u.status){n.connecting=!1;n.onError(u.responseText);n.publish("handshake_failed")}else{n.connecting=!1;!n.reconnecting&&n.onError(u.responseText);n.publish("handshake_failed")}}};u.ontimeout=function(e){n.connecting=!1;!n.reconnecting&&n.onError(u.responseText);n.publish("handshake_failed")};u.send(null)}};n.prototype.connect=function(e){if(this.connecting)return this;var r=this;r.connecting=!0;this.handshake(function(n,s,i,o){r.sessionid=n;r.closeTimeout=1e3*i;r.heartbeatTimeout=1e3*s;if(!r.transports)r.transports=r.origTransports=o?t.util.intersect(o.split(","),r.options.transports):r.options.transports;console.log("SocketIO transports: "+r.transports+" opt:"+r.options.transports);r.setHeartbeatTimeout();r.once("connect",function(){clearTimeout(r.connectTimeoutTimer);r.connectTimeoutTimer=null;e&&"function"==typeof e&&e()});r.doConnect()});return this};n.prototype.doConnect=function(){var e=this;if(e.transport)e.transport.clearTimeouts();e.transport=e.getTransport(e.transports);if(!e.transport)return e.publish("connect_failed");e.transport.ready(e,function(){e.connecting=!0;e.publish("connecting",e.transport.name);e.transport.open();if(e.options["connect timeout"]){if(e.connectTimeoutTimer)clearTimeout(e.connectTimeoutTimer);e.connectTimeoutTimer=setTimeout(e.tryNextTransport.bind(e),e.options["connect timeout"])}})};n.prototype.getTransport=function(e){var r=e||this.transports,n;for(var s=0,i;i=r[s];s++){console.log("SocketIO check "+i+" "+t.Transport[i].check(this)+" , cors "+t.Transport[i].xdomainCheck(this));if(t.Transport[i]&&t.Transport[i].check(this)&&(!this.isXDomain()||t.Transport[i].xdomainCheck(this))){var o=new t.Transport[i](this,this.sessionid);return o}}return null};n.prototype.tryNextTransport=function(){console.log("SocketIO try next transport");var e=this;if(!e.connected){e.connecting=!1;if(e.options["try multiple transports"]){var t=e.transports;for(;t.length>0&&t.splice(0,1)[0]!=e.transport.name;);if(t.length)e.doConnect();else e.publish("connect_failed")}}};n.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport&&e.transport.onClose()},this.heartbeatTimeout)}};n.prototype.packet=function(e){if(this.connected&&!this.doBuffer)this.transport.packet(e);else this.buffer.push(e);return this};n.prototype.setBuffer=function(e){this.doBuffer=e;if(!e&&this.connected&&this.buffer.length)if(!this.options["manualFlush"])this.flushBuffer()};n.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};n.prototype.disconnect=function(){if(this.connected||this.connecting){if(this.open)this.of("").packet({type:"disconnect"});this.onDisconnect("booted")}return this};n.prototype.disconnectSync=function(){var e=t.util.request();var r=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",r,!1);e.send(null);this.onDisconnect("booted")};n.prototype.isXDomain=function(){var e=r.location.port||("https:"==r.location.protocol?443:80);return this.options.host!==r.location.hostname||this.options.port!=e};n.prototype.onConnect=function(){if(!this.connected){this.connected=!0;this.connecting=!1;if(!this.doBuffer)this.setBuffer(!1);this.emit("connect")}};n.prototype.onOpen=function(){this.open=!0};n.prototype.onClose=function(){this.open=!1;clearTimeout(this.heartbeatTimeoutTimer)};n.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)};n.prototype.onError=function(e){if(e&&e.advice)if("reconnect"===e.advice&&(this.connected||this.connecting)){this.disconnect();if(this.options.reconnect)this.reconnect()}this.publish("error",e&&e.reason?e.reason:e)};n.prototype.onDisconnect=function(e){var t=this.connected,r=this.connecting;this.connected=!1;this.connecting=!1;
this.open=!1;if(t||r){this.transport.close();this.transport.clearTimeouts();if(t){this.publish("disconnect",e);if("booted"!=e&&this.options.reconnect&&!this.reconnecting)this.reconnect()}if(r){if(this.connectTimeoutTimer)clearTimeout(this.connectTimeoutTimer);this.tryNextTransport()}}};n.prototype.reconnect=function(){function e(){if(r.connected){for(var e in r.namespaces)if(r.namespaces.hasOwnProperty(e)&&""!==e)r.namespaces[e].packet({type:"connect"});r.publish("reconnect",r.transport.name,r.reconnectionAttempts)}clearTimeout(r.reconnectionTimer);r.removeListener("connect_failed",t);r.removeListener("connect",t);r.reconnecting=!1;delete r.reconnectionAttempts;delete r.reconnectionDelay;delete r.reconnectionTimer;delete r.redoTransports;r.options["try multiple transports"]=s}function t(){if(r.reconnecting){if(r.connected)return e();if(r.connecting&&r.reconnecting)return r.reconnectionTimer=setTimeout(t,1e3);if(r.reconnectionAttempts++>=n)if(!r.redoTransports){r.on("connect_failed",t);r.options["try multiple transports"]=!0;r.transports=r.origTransports;r.transport=r.getTransport();r.redoTransports=!0;r.connect()}else{r.publish("reconnect_failed");e()}else{if(r.reconnectionDelay<i)r.reconnectionDelay*=2;r.connect();r.publish("reconnecting",r.reconnectionDelay,r.reconnectionAttempts);r.reconnectionTimer=setTimeout(t,r.reconnectionDelay)}}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var r=this,n=this.options["max reconnection attempts"],s=this.options["try multiple transports"],i=this.options["reconnection limit"];this.options["try multiple transports"]=!1;this.reconnectionTimer=setTimeout(t,this.reconnectionDelay);this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,root);!function(e,t){function r(e,t){this.socket=e;this.name=t||"";this.flags={};this.json=new n(this,"json");this.ackPackets=0;this.acks={}}function n(e,t){this.namespace=e;this.name=t}e.SocketNamespace=r;t.util.mixin(r,t.EventEmitter);r.prototype.$emit=t.EventEmitter.prototype.emit;r.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};r.prototype.packet=function(e){e.endpoint=this.name;this.socket.packet(e);this.flags={};return this};r.prototype.send=function(e,t){var r={type:this.flags.json?"json":"message",data:e};if("function"==typeof t){r.id=++this.ackPackets;r.ack=!0;this.acks[r.id]=t}return this.packet(r)};r.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),r=t[t.length-1],n={type:"event",name:e};if("function"==typeof r){n.id=++this.ackPackets;n.ack="data";this.acks[n.id]=r;t=t.slice(0,t.length-1)}n.args=t;return this.packet(n)};r.prototype.disconnect=function(){if(""===this.name)this.socket.disconnect();else{this.packet({type:"disconnect"});this.$emit("disconnect")}return this};r.prototype.onPacket=function(e){function r(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":if(""===this.name)this.socket.onDisconnect(e.reason||"booted");else this.$emit("disconnect",e.reason);break;case"message":case"json":var s=["message",e.data];if("data"==e.ack)s.push(r);else if(e.ack)this.packet({type:"ack",ackId:e.id});this.$emit.apply(this,s);break;case"event":var s=[e.name].concat(e.args);if("data"==e.ack)s.push(r);this.$emit.apply(this,s);break;case"ack":if(this.acks[e.ackId]){this.acks[e.ackId].apply(this,e.args);delete this.acks[e.ackId]}break;case"error":console.error("SocketIO on packet error: ",e);if(e.advice)this.socket.onError(e);else if("unauthorized"===e.reason)this.$emit("connect_failed",e.reason);else this.$emit("error",e.reason)}};n.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};n.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);!function(e,t,r){function n(e){t.Transport.apply(this,arguments)}e.websocket=n;t.util.inherit(n,t.Transport);n.prototype.name="websocket";n.prototype.open=function(){var e=t.util.query(this.socket.options.query),n=this,s;if(!s)s=r.MozWebSocket||r.WebSocket;this.websocket=new s(this.prepareUrl()+e);this.websocket.onopen=function(){n.onOpen();n.socket.setBuffer(!1)};this.websocket.onmessage=function(e){n.onData(e.data)};this.websocket.onclose=function(){n.socket.setBuffer(!0);n.onClose()};this.websocket.onerror=function(e){n.onError(e)};return this};if(t.util.ua.iDevice)n.prototype.send=function(e){var t=this;setTimeout(function(){t.websocket.send(e)},0);return this};else n.prototype.send=function(e){this.websocket.send(e);return this};n.prototype.payload=function(e){for(var t=0,r=e.length;t<r;t++)this.packet(e[t]);return this};n.prototype.close=function(){this.websocket.close();return this};n.prototype.onError=function(e){this.socket.onError(e)};n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};n.check=function(){return"WebSocket"in r&&!("__addTask"in WebSocket)||"MozWebSocket"in r};n.xdomainCheck=function(){return!0};t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,root);!function(e,t,r){function n(e){if(e){t.Transport.apply(this,arguments);this.sendBuffer=[]}}function s(){}e.XHR=n;t.util.inherit(n,t.Transport);n.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};n.prototype.payload=function(e){var r=[];for(var n=0,s=e.length;n<s;n++)r.push(t.parser.encodePacket(e[n]));this.send(t.parser.encodePayload(r))};n.prototype.send=function(e){this.post(e);return this};n.prototype.post=function(e){function t(){if(4==this.readyState){this.onreadystatechange=s;i.posting=!1;if(200==this.status)i.socket.setBuffer(!1);else i.onClose()}}function n(){this.onload=s;i.socket.setBuffer(!1)}var i=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");if(r.XDomainRequest&&this.sendXHR instanceof XDomainRequest)this.sendXHR.onload=this.sendXHR.onerror=n;else this.sendXHR.onreadystatechange=t;this.sendXHR.send(e)};n.prototype.close=function(){this.onClose();return this};n.prototype.request=function(e){var r=t.util.request(this.socket.isXDomain()),n=t.util.query(this.socket.options.query,"t="+ +new Date);r.open(e||"GET",this.prepareUrl()+n,!0);if("POST"==e)try{if(r.setRequestHeader)r.setRequestHeader("Content-type","text/plain;charset=UTF-8");else r.contentType="text/plain"}catch(s){}return r};n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};n.check=function(e,n){try{var s=t.util.request(n),i=r.XDomainRequest&&s instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",a=r.location&&o!=r.location.protocol;if(s&&(!i||!a))return!0}catch(c){}return!1};n.xdomainCheck=function(e){return n.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,root);!function(e,t,r){function n(){t.Transport.XHR.apply(this,arguments)}function s(){}e["xhr-polling"]=n;t.util.inherit(n,t.Transport.XHR);t.util.merge(n,t.Transport.XHR);n.prototype.name="xhr-polling";n.prototype.heartbeats=function(){return!1};n.prototype.open=function(){var e=this;t.Transport.XHR.prototype.open.call(e);return!1};n.prototype.get=function(){function e(){if(4==this.readyState){this.onreadystatechange=s;if(200==this.status){i.onData(this.responseText);i.get()}else i.onClose()}}function t(){this.onload=s;this.onerror=s;i.retryCounter=1;i.onData(this.responseText);i.get()}function n(){i.retryCounter++;if(!i.retryCounter||i.retryCounter>3)i.onClose();else i.get()}if(this.isOpen){var i=this;this.xhr=this.request();if(r.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=t;this.xhr.onerror=n}else this.xhr.onreadystatechange=e;this.xhr.send(null)}};n.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=s;try{this.xhr.abort()}catch(e){}this.xhr=null}};n.prototype.ready=function(e,r){var n=this;t.util.defer(function(){r.call(n)})};t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,root);if(!0)!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return io}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}()}).call(this,__webpack_require__("./node_modules/webpack/buildin/global.js"),__webpack_require__("./node_modules/webpack/buildin/module.js")(module))},"./node_modules/babel-runtime/core-js/array/from.js":function(e,t,r){e.exports={"default":r("./node_modules/core-js/library/fn/array/from.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/object/assign.js":function(e,t,r){e.exports={"default":r("./node_modules/core-js/library/fn/object/assign.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/object/define-property.js":function(e,t,r){e.exports={"default":r("./node_modules/core-js/library/fn/object/define-property.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/symbol.js":function(e,t,r){e.exports={"default":r("./node_modules/core-js/library/fn/symbol/index.js"),__esModule:!0}},"./node_modules/babel-runtime/core-js/symbol/iterator.js":function(e,t,r){e.exports={"default":r("./node_modules/core-js/library/fn/symbol/iterator.js"),__esModule:!0}},"./node_modules/babel-runtime/helpers/classCallCheck.js":function(e,t,r){"use strict";t.__esModule=!0;t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"./node_modules/babel-runtime/helpers/createClass.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var s=r("./node_modules/babel-runtime/core-js/object/define-property.js");
var i=n(s);t["default"]=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;if("value"in n)n.writable=!0;(0,i["default"])(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}()},"./node_modules/babel-runtime/helpers/defineProperty.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var s=r("./node_modules/babel-runtime/core-js/object/define-property.js");var i=n(s);t["default"]=function(e,t,r){if(t in e)(0,i["default"])(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0});else e[t]=r;return e}},"./node_modules/babel-runtime/helpers/extends.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var s=r("./node_modules/babel-runtime/core-js/object/assign.js");var i=n(s);t["default"]=i["default"]||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n))e[n]=r[n]}return e}},"./node_modules/babel-runtime/helpers/toConsumableArray.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var s=r("./node_modules/babel-runtime/core-js/array/from.js");var i=n(s);t["default"]=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return(0,i["default"])(e)}},"./node_modules/babel-runtime/helpers/typeof.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var s=r("./node_modules/babel-runtime/core-js/symbol/iterator.js");var i=n(s);var o=r("./node_modules/babel-runtime/core-js/symbol.js");var a=n(o);var c="function"==typeof a["default"]&&"symbol"==typeof i["default"]?function(e){return typeof e}:function(e){return e&&"function"==typeof a["default"]&&e.constructor===a["default"]&&e!==a["default"].prototype?"symbol":typeof e};t["default"]="function"==typeof a["default"]&&"symbol"===c(i["default"])?function(e){return"undefined"==typeof e?"undefined":c(e)}:function(e){return e&&"function"==typeof a["default"]&&e.constructor===a["default"]&&e!==a["default"].prototype?"symbol":"undefined"==typeof e?"undefined":c(e)}},"./node_modules/backo2/index.js":function(e,t){function r(e){e=e||{};this.ms=e.min||100;this.max=e.max||1e4;this.factor=e.factor||2;this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0;this.attempts=0}e.exports=r;r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random();var r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)};r.prototype.reset=function(){this.attempts=0};r.prototype.setMin=function(e){this.ms=e};r.prototype.setMax=function(e){this.max=e};r.prototype.setJitter=function(e){this.jitter=e}},"./node_modules/core-js/library/fn/array/from.js":function(e,t,r){r("./node_modules/core-js/library/modules/es6.string.iterator.js");r("./node_modules/core-js/library/modules/es6.array.from.js");e.exports=r("./node_modules/core-js/library/modules/_core.js").Array.from},"./node_modules/core-js/library/fn/object/assign.js":function(e,t,r){r("./node_modules/core-js/library/modules/es6.object.assign.js");e.exports=r("./node_modules/core-js/library/modules/_core.js").Object.assign},"./node_modules/core-js/library/fn/object/define-property.js":function(e,t,r){r("./node_modules/core-js/library/modules/es6.object.define-property.js");var n=r("./node_modules/core-js/library/modules/_core.js").Object;e.exports=function s(e,t,r){return n.defineProperty(e,t,r)}},"./node_modules/core-js/library/fn/symbol/index.js":function(e,t,r){r("./node_modules/core-js/library/modules/es6.symbol.js");r("./node_modules/core-js/library/modules/es6.object.to-string.js");r("./node_modules/core-js/library/modules/es7.symbol.async-iterator.js");r("./node_modules/core-js/library/modules/es7.symbol.observable.js");e.exports=r("./node_modules/core-js/library/modules/_core.js").Symbol},"./node_modules/core-js/library/fn/symbol/iterator.js":function(e,t,r){r("./node_modules/core-js/library/modules/es6.string.iterator.js");r("./node_modules/core-js/library/modules/web.dom.iterable.js");e.exports=r("./node_modules/core-js/library/modules/_wks-ext.js").f("iterator")},"./node_modules/core-js/library/modules/_a-function.js":function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},"./node_modules/core-js/library/modules/_add-to-unscopables.js":function(e,t){e.exports=function(){}},"./node_modules/core-js/library/modules/_an-object.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},"./node_modules/core-js/library/modules/_array-includes.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_to-iobject.js");var s=r("./node_modules/core-js/library/modules/_to-length.js");var i=r("./node_modules/core-js/library/modules/_to-absolute-index.js");e.exports=function(e){return function(t,r,o){var a=n(t);var c=s(a.length);var u=i(o,c);var l;if(e&&r!=r)for(;c>u;){l=a[u++];if(l!=l)return!0}else for(;c>u;u++)if(e||u in a)if(a[u]===r)return e||u||0;return!e&&-1}}},"./node_modules/core-js/library/modules/_classof.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_cof.js");var s=r("./node_modules/core-js/library/modules/_wks.js")("toStringTag");var i="Arguments"==n(function(){return arguments}());var o=function(e,t){try{return e[t]}catch(r){}};e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=o(t=Object(e),s))?r:i?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},"./node_modules/core-js/library/modules/_cof.js":function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},"./node_modules/core-js/library/modules/_core.js":function(e,t){var r=e.exports={version:"2.5.5"};if("number"==typeof __e)__e=r},"./node_modules/core-js/library/modules/_create-property.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_object-dp.js");var s=r("./node_modules/core-js/library/modules/_property-desc.js");e.exports=function(e,t,r){if(t in e)n.f(e,t,s(0,r));else e[t]=r}},"./node_modules/core-js/library/modules/_ctx.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_a-function.js");e.exports=function(e,t,r){n(e);if(void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,s){return e.call(t,r,n,s)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js/library/modules/_defined.js":function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},"./node_modules/core-js/library/modules/_descriptors.js":function(e,t,r){e.exports=!r("./node_modules/core-js/library/modules/_fails.js")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},"./node_modules/core-js/library/modules/_dom-create.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_is-object.js");var s=r("./node_modules/core-js/library/modules/_global.js").document;var i=n(s)&&n(s.createElement);e.exports=function(e){return i?s.createElement(e):{}}},"./node_modules/core-js/library/modules/_enum-bug-keys.js":function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},"./node_modules/core-js/library/modules/_enum-keys.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-keys.js");var s=r("./node_modules/core-js/library/modules/_object-gops.js");var i=r("./node_modules/core-js/library/modules/_object-pie.js");e.exports=function(e){var t=n(e);var r=s.f;if(r){var o=r(e);var a=i.f;var c=0;var u;for(;o.length>c;)if(a.call(e,u=o[c++]))t.push(u)}return t}},"./node_modules/core-js/library/modules/_export.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_global.js");var s=r("./node_modules/core-js/library/modules/_core.js");var i=r("./node_modules/core-js/library/modules/_ctx.js");var o=r("./node_modules/core-js/library/modules/_hide.js");var a=r("./node_modules/core-js/library/modules/_has.js");var c="prototype";var u=function(e,t,r){var l=e&u.F;var m=e&u.G;var d=e&u.S;var f=e&u.P;var p=e&u.B;var g=e&u.W;var v=m?s:s[t]||(s[t]={});var y=v[c];var h=m?n:d?n[t]:(n[t]||{})[c];var b,T,M;if(m)r=t;for(b in r){T=!l&&h&&void 0!==h[b];if(!T||!a(v,b)){M=T?h[b]:r[b];v[b]=m&&"function"!=typeof h[b]?r[b]:p&&T?i(M,n):g&&h[b]==M?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};t[c]=e[c];return t}(M):f&&"function"==typeof M?i(Function.call,M):M;if(f){(v.virtual||(v.virtual={}))[b]=M;if(e&u.R&&y&&!y[b])o(y,b,M)}}else;}};u.F=1;u.G=2;u.S=4;u.P=8;u.B=16;u.W=32;u.U=64;u.R=128;e.exports=u},"./node_modules/core-js/library/modules/_fails.js":function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},"./node_modules/core-js/library/modules/_global.js":function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();if("number"==typeof __g)__g=r},"./node_modules/core-js/library/modules/_has.js":function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},"./node_modules/core-js/library/modules/_hide.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-dp.js");var s=r("./node_modules/core-js/library/modules/_property-desc.js");e.exports=r("./node_modules/core-js/library/modules/_descriptors.js")?function(e,t,r){return n.f(e,t,s(1,r))}:function(e,t,r){e[t]=r;return e}},"./node_modules/core-js/library/modules/_html.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_global.js").document;
e.exports=n&&n.documentElement},"./node_modules/core-js/library/modules/_ie8-dom-define.js":function(e,t,r){e.exports=!r("./node_modules/core-js/library/modules/_descriptors.js")&&!r("./node_modules/core-js/library/modules/_fails.js")(function(){return 7!=Object.defineProperty(r("./node_modules/core-js/library/modules/_dom-create.js")("div"),"a",{get:function(){return 7}}).a})},"./node_modules/core-js/library/modules/_iobject.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_cof.js");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},"./node_modules/core-js/library/modules/_is-array-iter.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_iterators.js");var s=r("./node_modules/core-js/library/modules/_wks.js")("iterator");var i=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||i[s]===e)}},"./node_modules/core-js/library/modules/_is-array.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_cof.js");e.exports=Array.isArray||function s(e){return"Array"==n(e)}},"./node_modules/core-js/library/modules/_is-object.js":function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js/library/modules/_iter-call.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_an-object.js");e.exports=function(e,t,r,s){try{return s?t(n(r)[0],r[1]):t(r)}catch(i){var o=e["return"];if(void 0!==o)n(o.call(e));throw i}}},"./node_modules/core-js/library/modules/_iter-create.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_object-create.js");var s=r("./node_modules/core-js/library/modules/_property-desc.js");var i=r("./node_modules/core-js/library/modules/_set-to-string-tag.js");var o={};r("./node_modules/core-js/library/modules/_hide.js")(o,r("./node_modules/core-js/library/modules/_wks.js")("iterator"),function(){return this});e.exports=function(e,t,r){e.prototype=n(o,{next:s(1,r)});i(e,t+" Iterator")}},"./node_modules/core-js/library/modules/_iter-define.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_library.js");var s=r("./node_modules/core-js/library/modules/_export.js");var i=r("./node_modules/core-js/library/modules/_redefine.js");var o=r("./node_modules/core-js/library/modules/_hide.js");var a=r("./node_modules/core-js/library/modules/_iterators.js");var c=r("./node_modules/core-js/library/modules/_iter-create.js");var u=r("./node_modules/core-js/library/modules/_set-to-string-tag.js");var l=r("./node_modules/core-js/library/modules/_object-gpo.js");var m=r("./node_modules/core-js/library/modules/_wks.js")("iterator");var d=!([].keys&&"next"in[].keys());var f="@@iterator";var p="keys";var g="values";var v=function(){return this};e.exports=function(e,t,r,y,h,b,T){c(r,t,y);var M=function(e){if(!d&&e in _)return _[e];switch(e){case p:return function t(){return new r(this,e)};case g:return function n(){return new r(this,e)}}return function s(){return new r(this,e)}};var S=t+" Iterator";var j=h==g;var k=!1;var _=e.prototype;var I=_[m]||_[f]||h&&_[h];var x=I||M(h);var P=h?!j?x:M("entries"):void 0;var C="Array"==t?_.entries||I:I;var w,O,A;if(C){A=l(C.call(new e));if(A!==Object.prototype&&A.next){u(A,S,!0);if(!n&&"function"!=typeof A[m])o(A,m,v)}}if(j&&I&&I.name!==g){k=!0;x=function E(){return I.call(this)}}if((!n||T)&&(d||k||!_[m]))o(_,m,x);a[t]=x;a[S]=v;if(h){w={values:j?x:M(g),keys:b?x:M(p),entries:P};if(T){for(O in w)if(!(O in _))i(_,O,w[O])}else s(s.P+s.F*(d||k),t,w)}return w}},"./node_modules/core-js/library/modules/_iter-detect.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_wks.js")("iterator");var s=!1;try{var i=[7][n]();i["return"]=function(){s=!0};Array.from(i,function(){throw 2})}catch(o){}e.exports=function(e,t){if(!t&&!s)return!1;var r=!1;try{var i=[7];var o=i[n]();o.next=function(){return{done:r=!0}};i[n]=function(){return o};e(i)}catch(a){}return r}},"./node_modules/core-js/library/modules/_iter-step.js":function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},"./node_modules/core-js/library/modules/_iterators.js":function(e,t){e.exports={}},"./node_modules/core-js/library/modules/_library.js":function(e,t){e.exports=!0},"./node_modules/core-js/library/modules/_meta.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_uid.js")("meta");var s=r("./node_modules/core-js/library/modules/_is-object.js");var i=r("./node_modules/core-js/library/modules/_has.js");var o=r("./node_modules/core-js/library/modules/_object-dp.js").f;var a=0;var c=Object.isExtensible||function(){return!0};var u=!r("./node_modules/core-js/library/modules/_fails.js")(function(){return c(Object.preventExtensions({}))});var l=function(e){o(e,n,{value:{i:"O"+ ++a,w:{}}})};var m=function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,n)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[n].i};var d=function(e,t){if(!i(e,n)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[n].w};var f=function(e){if(u&&p.NEED&&c(e)&&!i(e,n))l(e);return e};var p=e.exports={KEY:n,NEED:!1,fastKey:m,getWeak:d,onFreeze:f}},"./node_modules/core-js/library/modules/_object-assign.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_object-keys.js");var s=r("./node_modules/core-js/library/modules/_object-gops.js");var i=r("./node_modules/core-js/library/modules/_object-pie.js");var o=r("./node_modules/core-js/library/modules/_to-object.js");var a=r("./node_modules/core-js/library/modules/_iobject.js");var c=Object.assign;e.exports=!c||r("./node_modules/core-js/library/modules/_fails.js")(function(){var e={};var t={};var r=Symbol();var n="abcdefghijklmnopqrst";e[r]=7;n.split("").forEach(function(e){t[e]=e});return 7!=c({},e)[r]||Object.keys(c({},t)).join("")!=n})?function u(e,t){var r=o(e);var c=arguments.length;var u=1;var l=s.f;var m=i.f;for(;c>u;){var d=a(arguments[u++]);var f=l?n(d).concat(l(d)):n(d);var p=f.length;var g=0;var v;for(;p>g;)if(m.call(d,v=f[g++]))r[v]=d[v]}return r}:c},"./node_modules/core-js/library/modules/_object-create.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_an-object.js");var s=r("./node_modules/core-js/library/modules/_object-dps.js");var i=r("./node_modules/core-js/library/modules/_enum-bug-keys.js");var o=r("./node_modules/core-js/library/modules/_shared-key.js")("IE_PROTO");var a=function(){};var c="prototype";var u=function(){var e=r("./node_modules/core-js/library/modules/_dom-create.js")("iframe");var t=i.length;var n="<";var s=">";var o;e.style.display="none";r("./node_modules/core-js/library/modules/_html.js").appendChild(e);e.src="javascript:";o=e.contentWindow.document;o.open();o.write(n+"script"+s+"document.F=Object"+n+"/script"+s);o.close();u=o.F;for(;t--;)delete u[c][i[t]];return u()};e.exports=Object.create||function l(e,t){var r;if(null!==e){a[c]=n(e);r=new a;a[c]=null;r[o]=e}else r=u();return void 0===t?r:s(r,t)}},"./node_modules/core-js/library/modules/_object-dp.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_an-object.js");var s=r("./node_modules/core-js/library/modules/_ie8-dom-define.js");var i=r("./node_modules/core-js/library/modules/_to-primitive.js");var o=Object.defineProperty;t.f=r("./node_modules/core-js/library/modules/_descriptors.js")?Object.defineProperty:function a(e,t,r){n(e);t=i(t,!0);n(r);if(s)try{return o(e,t,r)}catch(a){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");if("value"in r)e[t]=r.value;return e}},"./node_modules/core-js/library/modules/_object-dps.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-dp.js");var s=r("./node_modules/core-js/library/modules/_an-object.js");var i=r("./node_modules/core-js/library/modules/_object-keys.js");e.exports=r("./node_modules/core-js/library/modules/_descriptors.js")?Object.defineProperties:function o(e,t){s(e);var r=i(t);var o=r.length;var a=0;var c;for(;o>a;)n.f(e,c=r[a++],t[c]);return e}},"./node_modules/core-js/library/modules/_object-gopd.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-pie.js");var s=r("./node_modules/core-js/library/modules/_property-desc.js");var i=r("./node_modules/core-js/library/modules/_to-iobject.js");var o=r("./node_modules/core-js/library/modules/_to-primitive.js");var a=r("./node_modules/core-js/library/modules/_has.js");var c=r("./node_modules/core-js/library/modules/_ie8-dom-define.js");var u=Object.getOwnPropertyDescriptor;t.f=r("./node_modules/core-js/library/modules/_descriptors.js")?u:function l(e,t){e=i(e);t=o(t,!0);if(c)try{return u(e,t)}catch(r){}if(a(e,t))return s(!n.f.call(e,t),e[t])}},"./node_modules/core-js/library/modules/_object-gopn-ext.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_to-iobject.js");var s=r("./node_modules/core-js/library/modules/_object-gopn.js").f;var i={}.toString;var o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var a=function(e){try{return s(e)}catch(t){return o.slice()}};e.exports.f=function c(e){return o&&"[object Window]"==i.call(e)?a(e):s(n(e))}},"./node_modules/core-js/library/modules/_object-gopn.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-keys-internal.js");var s=r("./node_modules/core-js/library/modules/_enum-bug-keys.js").concat("length","prototype");t.f=Object.getOwnPropertyNames||function i(e){return n(e,s)}},"./node_modules/core-js/library/modules/_object-gops.js":function(e,t){t.f=Object.getOwnPropertySymbols},"./node_modules/core-js/library/modules/_object-gpo.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_has.js");var s=r("./node_modules/core-js/library/modules/_to-object.js");var i=r("./node_modules/core-js/library/modules/_shared-key.js")("IE_PROTO");var o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){e=s(e);if(n(e,i))return e[i];if("function"==typeof e.constructor&&e instanceof e.constructor)return e.constructor.prototype;else return e instanceof Object?o:null;
}},"./node_modules/core-js/library/modules/_object-keys-internal.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_has.js");var s=r("./node_modules/core-js/library/modules/_to-iobject.js");var i=r("./node_modules/core-js/library/modules/_array-includes.js")(!1);var o=r("./node_modules/core-js/library/modules/_shared-key.js")("IE_PROTO");e.exports=function(e,t){var r=s(e);var a=0;var c=[];var u;for(u in r)if(u!=o)n(r,u)&&c.push(u);for(;t.length>a;)if(n(r,u=t[a++]))~i(c,u)||c.push(u);return c}},"./node_modules/core-js/library/modules/_object-keys.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-keys-internal.js");var s=r("./node_modules/core-js/library/modules/_enum-bug-keys.js");e.exports=Object.keys||function i(e){return n(e,s)}},"./node_modules/core-js/library/modules/_object-pie.js":function(e,t){t.f={}.propertyIsEnumerable},"./node_modules/core-js/library/modules/_property-desc.js":function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js/library/modules/_redefine.js":function(e,t,r){e.exports=r("./node_modules/core-js/library/modules/_hide.js")},"./node_modules/core-js/library/modules/_set-to-string-tag.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_object-dp.js").f;var s=r("./node_modules/core-js/library/modules/_has.js");var i=r("./node_modules/core-js/library/modules/_wks.js")("toStringTag");e.exports=function(e,t,r){if(e&&!s(e=r?e:e.prototype,i))n(e,i,{configurable:!0,value:t})}},"./node_modules/core-js/library/modules/_shared-key.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_shared.js")("keys");var s=r("./node_modules/core-js/library/modules/_uid.js");e.exports=function(e){return n[e]||(n[e]=s(e))}},"./node_modules/core-js/library/modules/_shared.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_global.js");var s="__core-js_shared__";var i=n[s]||(n[s]={});e.exports=function(e){return i[e]||(i[e]={})}},"./node_modules/core-js/library/modules/_string-at.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_to-integer.js");var s=r("./node_modules/core-js/library/modules/_defined.js");e.exports=function(e){return function(t,r){var i=String(s(t));var o=n(r);var a=i.length;var c,u;if(o<0||o>=a)return e?"":void 0;c=i.charCodeAt(o);return c<55296||c>56319||o+1===a||(u=i.charCodeAt(o+1))<56320||u>57343?e?i.charAt(o):c:e?i.slice(o,o+2):(c-55296<<10)+(u-56320)+65536}}},"./node_modules/core-js/library/modules/_to-absolute-index.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_to-integer.js");var s=Math.max;var i=Math.min;e.exports=function(e,t){e=n(e);return e<0?s(e+t,0):i(e,t)}},"./node_modules/core-js/library/modules/_to-integer.js":function(e,t){var r=Math.ceil;var n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},"./node_modules/core-js/library/modules/_to-iobject.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_iobject.js");var s=r("./node_modules/core-js/library/modules/_defined.js");e.exports=function(e){return n(s(e))}},"./node_modules/core-js/library/modules/_to-length.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_to-integer.js");var s=Math.min;e.exports=function(e){return e>0?s(n(e),9007199254740991):0}},"./node_modules/core-js/library/modules/_to-object.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_defined.js");e.exports=function(e){return Object(n(e))}},"./node_modules/core-js/library/modules/_to-primitive.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_is-object.js");e.exports=function(e,t){if(!n(e))return e;var r,s;if(t&&"function"==typeof(r=e.toString)&&!n(s=r.call(e)))return s;if("function"==typeof(r=e.valueOf)&&!n(s=r.call(e)))return s;if(!t&&"function"==typeof(r=e.toString)&&!n(s=r.call(e)))return s;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/library/modules/_uid.js":function(e,t){var r=0;var n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},"./node_modules/core-js/library/modules/_wks-define.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_global.js");var s=r("./node_modules/core-js/library/modules/_core.js");var i=r("./node_modules/core-js/library/modules/_library.js");var o=r("./node_modules/core-js/library/modules/_wks-ext.js");var a=r("./node_modules/core-js/library/modules/_object-dp.js").f;e.exports=function(e){var t=s.Symbol||(s.Symbol=i?{}:n.Symbol||{});if("_"!=e.charAt(0)&&!(e in t))a(t,e,{value:o.f(e)})}},"./node_modules/core-js/library/modules/_wks-ext.js":function(e,t,r){t.f=r("./node_modules/core-js/library/modules/_wks.js")},"./node_modules/core-js/library/modules/_wks.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_shared.js")("wks");var s=r("./node_modules/core-js/library/modules/_uid.js");var i=r("./node_modules/core-js/library/modules/_global.js").Symbol;var o="function"==typeof i;var a=e.exports=function(e){return n[e]||(n[e]=o&&i[e]||(o?i:s)("Symbol."+e))};a.store=n},"./node_modules/core-js/library/modules/core.get-iterator-method.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_classof.js");var s=r("./node_modules/core-js/library/modules/_wks.js")("iterator");var i=r("./node_modules/core-js/library/modules/_iterators.js");e.exports=r("./node_modules/core-js/library/modules/_core.js").getIteratorMethod=function(e){if(void 0!=e)return e[s]||e["@@iterator"]||i[n(e)]}},"./node_modules/core-js/library/modules/es6.array.from.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_ctx.js");var s=r("./node_modules/core-js/library/modules/_export.js");var i=r("./node_modules/core-js/library/modules/_to-object.js");var o=r("./node_modules/core-js/library/modules/_iter-call.js");var a=r("./node_modules/core-js/library/modules/_is-array-iter.js");var c=r("./node_modules/core-js/library/modules/_to-length.js");var u=r("./node_modules/core-js/library/modules/_create-property.js");var l=r("./node_modules/core-js/library/modules/core.get-iterator-method.js");s(s.S+s.F*!r("./node_modules/core-js/library/modules/_iter-detect.js")(function(e){Array.from(e)}),"Array",{from:function m(e){var t=i(e);var r="function"==typeof this?this:Array;var s=arguments.length;var m=s>1?arguments[1]:void 0;var d=void 0!==m;var f=0;var p=l(t);var g,v,y,h;if(d)m=n(m,s>2?arguments[2]:void 0,2);if(void 0!=p&&(r!=Array||!a(p)))for(h=p.call(t),v=new r;!(y=h.next()).done;f++)u(v,f,d?o(h,m,[y.value,f],!0):y.value);else{g=c(t.length);for(v=new r(g);g>f;f++)u(v,f,d?m(t[f],f):t[f])}v.length=f;return v}})},"./node_modules/core-js/library/modules/es6.array.iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_add-to-unscopables.js");var s=r("./node_modules/core-js/library/modules/_iter-step.js");var i=r("./node_modules/core-js/library/modules/_iterators.js");var o=r("./node_modules/core-js/library/modules/_to-iobject.js");e.exports=r("./node_modules/core-js/library/modules/_iter-define.js")(Array,"Array",function(e,t){this._t=o(e);this._i=0;this._k=t},function(){var e=this._t;var t=this._k;var r=this._i++;if(!e||r>=e.length){this._t=void 0;return s(1)}if("keys"==t)return s(0,r);if("values"==t)return s(0,e[r]);else return s(0,[r,e[r]])},"values");i.Arguments=i.Array;n("keys");n("values");n("entries")},"./node_modules/core-js/library/modules/es6.object.assign.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_export.js");n(n.S+n.F,"Object",{assign:r("./node_modules/core-js/library/modules/_object-assign.js")})},"./node_modules/core-js/library/modules/es6.object.define-property.js":function(e,t,r){var n=r("./node_modules/core-js/library/modules/_export.js");n(n.S+n.F*!r("./node_modules/core-js/library/modules/_descriptors.js"),"Object",{defineProperty:r("./node_modules/core-js/library/modules/_object-dp.js").f})},"./node_modules/core-js/library/modules/es6.object.to-string.js":function(e,t){},"./node_modules/core-js/library/modules/es6.string.iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_string-at.js")(!0);r("./node_modules/core-js/library/modules/_iter-define.js")(String,"String",function(e){this._t=String(e);this._i=0},function(){var e=this._t;var t=this._i;var r;if(t>=e.length)return{value:void 0,done:!0};r=n(e,t);this._i+=r.length;return{value:r,done:!1}})},"./node_modules/core-js/library/modules/es6.symbol.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/library/modules/_global.js");var s=r("./node_modules/core-js/library/modules/_has.js");var i=r("./node_modules/core-js/library/modules/_descriptors.js");var o=r("./node_modules/core-js/library/modules/_export.js");var a=r("./node_modules/core-js/library/modules/_redefine.js");var c=r("./node_modules/core-js/library/modules/_meta.js").KEY;var u=r("./node_modules/core-js/library/modules/_fails.js");var l=r("./node_modules/core-js/library/modules/_shared.js");var m=r("./node_modules/core-js/library/modules/_set-to-string-tag.js");var d=r("./node_modules/core-js/library/modules/_uid.js");var f=r("./node_modules/core-js/library/modules/_wks.js");var p=r("./node_modules/core-js/library/modules/_wks-ext.js");var g=r("./node_modules/core-js/library/modules/_wks-define.js");var v=r("./node_modules/core-js/library/modules/_enum-keys.js");var y=r("./node_modules/core-js/library/modules/_is-array.js");var h=r("./node_modules/core-js/library/modules/_an-object.js");var b=r("./node_modules/core-js/library/modules/_is-object.js");var T=r("./node_modules/core-js/library/modules/_to-iobject.js");var M=r("./node_modules/core-js/library/modules/_to-primitive.js");var S=r("./node_modules/core-js/library/modules/_property-desc.js");var j=r("./node_modules/core-js/library/modules/_object-create.js");var k=r("./node_modules/core-js/library/modules/_object-gopn-ext.js");var _=r("./node_modules/core-js/library/modules/_object-gopd.js");
var I=r("./node_modules/core-js/library/modules/_object-dp.js");var x=r("./node_modules/core-js/library/modules/_object-keys.js");var P=_.f;var C=I.f;var w=k.f;var O=n.Symbol;var A=n.JSON;var E=A&&A.stringify;var R="prototype";var U=f("_hidden");var N=f("toPrimitive");var F={}.propertyIsEnumerable;var D=l("symbol-registry");var L=l("symbols");var B=l("op-symbols");var q=Object[R];var H="function"==typeof O;var z=n.QObject;var W=!z||!z[R]||!z[R].findChild;var J=i&&u(function(){return 7!=j(C({},"a",{get:function(){return C(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=P(q,t);if(n)delete q[t];C(e,t,r);if(n&&e!==q)C(q,t,n)}:C;var V=function(e){var t=L[e]=j(O[R]);t._k=e;return t};var X=H&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O};var $=function ie(e,t,r){if(e===q)$(B,t,r);h(e);t=M(t,!0);h(r);if(s(L,t)){if(!r.enumerable){if(!s(e,U))C(e,U,S(1,{}));e[U][t]=!0}else{if(s(e,U)&&e[U][t])e[U][t]=!1;r=j(r,{enumerable:S(0,!1)})}return J(e,t,r)}return C(e,t,r)};var G=function oe(e,t){h(e);var r=v(t=T(t));var n=0;var s=r.length;var i;for(;s>n;)$(e,i=r[n++],t[i]);return e};var K=function ae(e,t){return void 0===t?j(e):G(j(e),t)};var Q=function ce(e){var t=F.call(this,e=M(e,!0));if(this===q&&s(L,e)&&!s(B,e))return!1;else return t||!s(this,e)||!s(L,e)||s(this,U)&&this[U][e]?t:!0};var Y=function ue(e,t){e=T(e);t=M(t,!0);if(e!==q||!s(L,t)||s(B,t)){var r=P(e,t);if(r&&s(L,t)&&(!s(e,U)||!e[U][t]))r.enumerable=!0;return r}};var Z=function le(e){var t=w(T(e));var r=[];var n=0;var i;for(;t.length>n;)if(!s(L,i=t[n++])&&i!=U&&i!=c)r.push(i);return r};var ee=function me(e){var t=e===q;var r=w(t?B:T(e));var n=[];var i=0;var o;for(;r.length>i;)if(s(L,o=r[i++])&&(t?s(q,o):!0))n.push(L[o]);return n};if(!H){O=function de(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0);var t=function(r){if(this===q)t.call(B,r);if(s(this,U)&&s(this[U],e))this[U][e]=!1;J(this,e,S(1,r))};if(i&&W)J(q,e,{configurable:!0,set:t});return V(e)};a(O[R],"toString",function fe(){return this._k});_.f=Y;I.f=$;r("./node_modules/core-js/library/modules/_object-gopn.js").f=k.f=Z;r("./node_modules/core-js/library/modules/_object-pie.js").f=Q;r("./node_modules/core-js/library/modules/_object-gops.js").f=ee;if(i&&!r("./node_modules/core-js/library/modules/_library.js"))a(q,"propertyIsEnumerable",Q,!0);p.f=function(e){return V(f(e))}}o(o.G+o.W+o.F*!H,{Symbol:O});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=x(f.store),se=0;ne.length>se;)g(ne[se++]);o(o.S+o.F*!H,"Symbol",{"for":function(e){return s(D,e+="")?D[e]:D[e]=O(e)},keyFor:function pe(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in D)if(D[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}});o(o.S+o.F*!H,"Object",{create:K,defineProperty:$,defineProperties:G,getOwnPropertyDescriptor:Y,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});A&&o(o.S+o.F*(!H||u(function(){var e=O();return"[null]"!=E([e])||"{}"!=E({a:e})||"{}"!=E(Object(e))})),"JSON",{stringify:function ge(e){var t=[e];var r=1;var n,s;for(;arguments.length>r;)t.push(arguments[r++]);s=n=t[1];if((b(n)||void 0!==e)&&!X(e)){if(!y(n))n=function(e,t){if("function"==typeof s)t=s.call(this,e,t);if(!X(t))return t};t[1]=n;return E.apply(A,t)}}});O[R][N]||r("./node_modules/core-js/library/modules/_hide.js")(O[R],N,O[R].valueOf);m(O,"Symbol");m(Math,"Math",!0);m(n.JSON,"JSON",!0)},"./node_modules/core-js/library/modules/es7.symbol.async-iterator.js":function(e,t,r){r("./node_modules/core-js/library/modules/_wks-define.js")("asyncIterator")},"./node_modules/core-js/library/modules/es7.symbol.observable.js":function(e,t,r){r("./node_modules/core-js/library/modules/_wks-define.js")("observable")},"./node_modules/core-js/library/modules/web.dom.iterable.js":function(e,t,r){r("./node_modules/core-js/library/modules/es6.array.iterator.js");var n=r("./node_modules/core-js/library/modules/_global.js");var s=r("./node_modules/core-js/library/modules/_hide.js");var i=r("./node_modules/core-js/library/modules/_iterators.js");var o=r("./node_modules/core-js/library/modules/_wks.js")("toStringTag");var a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(",");for(var c=0;c<a.length;c++){var u=a[c];var l=n[u];var m=l&&l.prototype;if(m&&!m[o])s(m,o,u);i[u]=i.Array}},"./node_modules/deep-access/index.js":function(e,t){function r(e,t){var r=t.split(".");for(;r.length;){var n=r.shift();var s=!1;if("?"==n[n.length-1]){n=n.slice(0,-1);s=!0}e=e[n];if(!e&&s)return e}return e}e.exports=r},"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";function n(){}function s(e,t,r){this.fn=e;this.context=t;this.once=r||!1}function i(){this._events=new n;this._eventsCount=0}var o=Object.prototype.hasOwnProperty,a="~";if(Object.create){n.prototype=Object.create(null);if(!(new n).__proto__)a=!1}i.prototype.eventNames=function c(){var e=[],t,r;if(0===this._eventsCount)return e;for(r in t=this._events)if(o.call(t,r))e.push(a?r.slice(1):r);if(Object.getOwnPropertySymbols)return e.concat(Object.getOwnPropertySymbols(t));else return e};i.prototype.listeners=function u(e,t){var r=a?a+e:e,n=this._events[r];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,o=new Array(i);s<i;s++)o[s]=n[s].fn;return o};i.prototype.emit=function l(e,t,r,n,s,i){var o=a?a+e:e;if(!this._events[o])return!1;var c=this._events[o],u=arguments.length,l,m;if(c.fn){if(c.once)this.removeListener(e,c.fn,void 0,!0);switch(u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,n),!0;case 5:return c.fn.call(c.context,t,r,n,s),!0;case 6:return c.fn.call(c.context,t,r,n,s,i),!0}for(m=1,l=new Array(u-1);m<u;m++)l[m-1]=arguments[m];c.fn.apply(c.context,l)}else{var d=c.length,f;for(m=0;m<d;m++){if(c[m].once)this.removeListener(e,c[m].fn,void 0,!0);switch(u){case 1:c[m].fn.call(c[m].context);break;case 2:c[m].fn.call(c[m].context,t);break;case 3:c[m].fn.call(c[m].context,t,r);break;case 4:c[m].fn.call(c[m].context,t,r,n);break;default:if(!l)for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c[m].fn.apply(c[m].context,l)}}}return!0};i.prototype.on=function m(e,t,r){var n=new s(t,r||this),i=a?a+e:e;if(!this._events[i])this._events[i]=n,this._eventsCount++;else if(!this._events[i].fn)this._events[i].push(n);else this._events[i]=[this._events[i],n];return this};i.prototype.once=function d(e,t,r){var n=new s(t,r||this,(!0)),i=a?a+e:e;if(!this._events[i])this._events[i]=n,this._eventsCount++;else if(!this._events[i].fn)this._events[i].push(n);else this._events[i]=[this._events[i],n];return this};i.prototype.removeListener=function f(e,t,r,s){var i=a?a+e:e;if(!this._events[i])return this;if(!t){if(0===--this._eventsCount)this._events=new n;else delete this._events[i];return this}var o=this._events[i];if(o.fn){if(o.fn===t&&(!s||o.once)&&(!r||o.context===r))if(0===--this._eventsCount)this._events=new n;else delete this._events[i]}else{for(var c=0,u=[],l=o.length;c<l;c++)if(o[c].fn!==t||s&&!o[c].once||r&&o[c].context!==r)u.push(o[c]);if(u.length)this._events[i]=1===u.length?u[0]:u;else if(0===--this._eventsCount)this._events=new n;else delete this._events[i]}return this};i.prototype.removeAllListeners=function p(e){var t;if(e){t=a?a+e:e;if(this._events[t])if(0===--this._eventsCount)this._events=new n;else delete this._events[t]}else{this._events=new n;this._eventsCount=0}return this};i.prototype.off=i.prototype.removeListener;i.prototype.addListener=i.prototype.on;i.prototype.setMaxListeners=function g(){return this};i.prefixed=a;i.EventEmitter=i;if(!0)e.exports=i},"./node_modules/for-each/index.js":function(e,t,r){function n(e,t,r){if(!a(t))throw new TypeError("iterator must be a function");if(arguments.length<3)r=this;if("[object Array]"===c.call(e))s(e,t,r);else if("string"==typeof e)i(e,t,r);else o(e,t,r)}function s(e,t,r){for(var n=0,s=e.length;n<s;n++)if(u.call(e,n))t.call(r,e[n],n,e)}function i(e,t,r){for(var n=0,s=e.length;n<s;n++)t.call(r,e.charAt(n),n,e)}function o(e,t,r){for(var n in e)if(u.call(e,n))t.call(r,e[n],n,e)}var a=r("./node_modules/is-function/index.js");e.exports=n;var c=Object.prototype.toString;var u=Object.prototype.hasOwnProperty},"./node_modules/global/window.js":function(e,t,r){(function(t){var r;if("undefined"!=typeof window)r=window;else if("undefined"!=typeof t)r=t;else if("undefined"!=typeof self)r=self;else r={};e.exports=r}).call(this,r("./node_modules/webpack/buildin/global.js"))},"./node_modules/is-function/index.js":function(e,t){function r(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}e.exports=r;var n=Object.prototype.toString},"./node_modules/javascript-natural-sort/naturalSort.js":function(e,t){e.exports=function r(e,t){"use strict";var n=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,s=/(^[ ]*|[ ]*$)/g,i=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,o=/^0x[0-9a-f]+$/i,a=/^0/,c=function(e){return r.insensitive&&(""+e).toLowerCase()||""+e},u=c(e).replace(s,"")||"",l=c(t).replace(s,"")||"",m=u.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),d=l.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=parseInt(u.match(o),16)||1!==m.length&&u.match(i)&&Date.parse(u),p=parseInt(l.match(o),16)||f&&l.match(i)&&Date.parse(l)||null,g,v;
if(p)if(f<p)return-1;else if(f>p)return 1;for(var y=0,h=Math.max(m.length,d.length);y<h;y++){g=!(m[y]||"").match(a)&&parseFloat(m[y])||m[y]||0;v=!(d[y]||"").match(a)&&parseFloat(d[y])||d[y]||0;if(isNaN(g)!==isNaN(v))return isNaN(g)?1:-1;else if(typeof g!=typeof v){g+="";v+=""}if(g<v)return-1;if(g>v)return 1}return 0}},"./node_modules/object-assign/index.js":function(e,t,r){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function s(){try{if(!Object.assign)return!1;var e=new String("abc");e[5]="de";if("5"===Object.getOwnPropertyNames(e)[0])return!1;var t={};for(var r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==n.join(""))return!1;var s={};"abcdefghijklmnopqrst".split("").forEach(function(e){s[e]=e});if("abcdefghijklmnopqrst"!==Object.keys(Object.assign({},s)).join(""))return!1;else return!0}catch(i){return!1}}var i=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty;var a=Object.prototype.propertyIsEnumerable;e.exports=s()?Object.assign:function(e,t){var r;var s=n(e);var c;for(var u=1;u<arguments.length;u++){r=Object(arguments[u]);for(var l in r)if(o.call(r,l))s[l]=r[l];if(i){c=i(r);for(var m=0;m<c.length;m++)if(a.call(r,c[m]))s[c[m]]=r[c[m]]}}return s}},"./node_modules/parse-headers/parse-headers.js":function(e,t,r){var n=r("./node_modules/trim/index.js"),s=r("./node_modules/for-each/index.js"),i=function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports=function(e){if(!e)return{};var t={};s(n(e).split("\n"),function(e){var r=e.indexOf(":"),s=n(e.slice(0,r)).toLowerCase(),o=n(e.slice(r+1));if("undefined"==typeof t[s])t[s]=o;else if(i(t[s]))t[s].push(o);else t[s]=[t[s],o]});return t}},"./node_modules/trim/index.js":function(e,t){function r(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=r;t.left=function(e){return e.replace(/^\s*/,"")};t.right=function(e){return e.replace(/\s*$/,"")}},"./node_modules/webpack/buildin/global.js":function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(1,eval)("this")}catch(n){if("object"==typeof window)r=window}e.exports=r},"./node_modules/webpack/buildin/module.js":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){e.deprecate=function(){};e.paths=[];if(!e.children)e.children=[];Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}});Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}});e.webpackPolyfill=1}return e}},"./node_modules/wolfy87-eventemitter/EventEmitter.js":function(e,t,r){var n;!function(t){"use strict";function s(){}function i(e,t){var r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}function o(e){return function t(){return this[e].apply(this,arguments)}}function a(e){if("function"==typeof e||e instanceof RegExp)return!0;else if(e&&"object"==typeof e)return a(e.listener);else return!1}var c=s.prototype;var u=t.EventEmitter;c.getListeners=function l(e){var t=this._getEvents();var r;var n;if(e instanceof RegExp){r={};for(n in t)if(t.hasOwnProperty(n)&&e.test(n))r[n]=t[n]}else r=t[e]||(t[e]=[]);return r};c.flattenListeners=function m(e){var t=[];var r;for(r=0;r<e.length;r+=1)t.push(e[r].listener);return t};c.getListenersAsObject=function d(e){var t=this.getListeners(e);var r;if(t instanceof Array){r={};r[e]=t}return r||t};c.addListener=function f(e,t){if(!a(t))throw new TypeError("listener must be a function");var r=this.getListenersAsObject(e);var n="object"==typeof t;var s;for(s in r)if(r.hasOwnProperty(s)&&i(r[s],t)===-1)r[s].push(n?t:{listener:t,once:!1});return this};c.on=o("addListener");c.addOnceListener=function p(e,t){return this.addListener(e,{listener:t,once:!0})};c.once=o("addOnceListener");c.defineEvent=function g(e){this.getListeners(e);return this};c.defineEvents=function v(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this};c.removeListener=function y(e,t){var r=this.getListenersAsObject(e);var n;var s;for(s in r)if(r.hasOwnProperty(s)){n=i(r[s],t);if(n!==-1)r[s].splice(n,1)}return this};c.off=o("removeListener");c.addListeners=function h(e,t){return this.manipulateListeners(!1,e,t)};c.removeListeners=function b(e,t){return this.manipulateListeners(!0,e,t)};c.manipulateListeners=function T(e,t,r){var n;var s;var i=e?this.removeListener:this.addListener;var o=e?this.removeListeners:this.addListeners;if("object"==typeof t&&!(t instanceof RegExp)){for(n in t)if(t.hasOwnProperty(n)&&(s=t[n]))if("function"==typeof s)i.call(this,n,s);else o.call(this,n,s)}else{n=r.length;for(;n--;)i.call(this,t,r[n])}return this};c.removeEvent=function M(e){var t=typeof e;var r=this._getEvents();var n;if("string"===t)delete r[e];else if(e instanceof RegExp){for(n in r)if(r.hasOwnProperty(n)&&e.test(n))delete r[n]}else delete this._events;return this};c.removeAllListeners=o("removeEvent");c.emitEvent=function S(e,t){var r=this.getListenersAsObject(e);var n;var s;var i;var o;var a;for(o in r)if(r.hasOwnProperty(o)){n=r[o].slice(0);for(i=0;i<n.length;i++){s=n[i];if(s.once===!0)this.removeListener(e,s.listener);a=s.listener.apply(this,t||[]);if(a===this._getOnceReturnValue())this.removeListener(e,s.listener)}}return this};c.trigger=o("emitEvent");c.emit=function j(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)};c.setOnceReturnValue=function k(e){this._onceReturnValue=e;return this};c._getOnceReturnValue=function _(){if(this.hasOwnProperty("_onceReturnValue"))return this._onceReturnValue;else return!0};c._getEvents=function I(){return this._events||(this._events={})};s.noConflict=function x(){t.EventEmitter=u;return s};if(!0)!(n=function(){return s}.call(t,r,t,e),void 0!==n&&(e.exports=n));else;}(this||{})},"./node_modules/x2js/x2js.js":function(e,t,r){var n,s,i;!function(r,o){"use strict";if(!0)!(s=[],n=o,i="function"==typeof n?n.apply(t,s):n,void 0!==i&&(e.exports=i));else;}(this,function(e){"use strict";return function t(r){function n(){r.arrayAccessForm=r.arrayAccessForm||"none";r.emptyNodeForm=r.emptyNodeForm||"text";r.jsAttributeFilter=r.jsAttributeFilter;r.jsAttributeConverter=r.jsAttributeConverter;r.attributeConverters=r.attributeConverters||[];r.datetimeAccessFormPaths=r.datetimeAccessFormPaths||[];r.arrayAccessFormPaths=r.arrayAccessFormPaths||[];if(void 0===r.enableToStringFunc)r.enableToStringFunc=!0;if(void 0===r.skipEmptyTextNodesForObj)r.skipEmptyTextNodesForObj=!0;if(void 0===r.stripWhitespaces)r.stripWhitespaces=!0;if(void 0===r.useDoubleQuotes)r.useDoubleQuotes=!0;if(void 0===r.ignoreRoot)r.ignoreRoot=!1;if(void 0===r.escapeMode)r.escapeMode=!0;if(void 0===r.attributePrefix)r.attributePrefix="_";if(void 0===r.selfClosingElements)r.selfClosingElements=!0;if(void 0===r.keepCData)r.keepCData=!1;if(void 0===r.jsDateUTC)r.jsDateUTC=!1}function s(){function e(e){var t=String(e);if(1===t.length)t="0"+t;return t}if("function"!=typeof String.prototype.trim)String.prototype.trim=function t(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")};if("function"!=typeof Date.prototype.toISOString)Date.prototype.toISOString=function r(){var t=1e3;return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/t).toFixed(3)).slice(2,5)+"Z"}}function i(e){var t=e.localName;if(null==t)t=e.baseName;if(null==t||""===t)t=e.nodeName;return t}function o(e){return e.prefix}function a(e){if("string"==typeof e)return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;");else return e}function c(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")}function u(e,t,n){switch(r.arrayAccessForm){case"property":if(!(e[t]instanceof Array))e[t+"_asArray"]=[e[t]];else e[t+"_asArray"]=e[t]}if(!(e[t]instanceof Array)&&r.arrayAccessFormPaths.length>0){var s=!1;for(var i=0;i<r.arrayAccessFormPaths.length;i++){var o=r.arrayAccessFormPaths[i];if("string"==typeof o){if(o===n){s=!0;break}}else if(o instanceof RegExp){if(o.test(n)){s=!0;break}}else if("function"==typeof o)if(o(t,n)){s=!0;break}}if(s)e[t]=[e[t]]}}function l(e){var t=60;var r=e.split(/[-T:+Z]/g);var n=new Date(r[0],r[1]-1,r[2]);var s=r[5].split(".");n.setHours(r[3],r[4],s[0]);if(s.length>1)n.setMilliseconds(s[1]);if(r[6]&&r[7]){var i=r[6]*t+Number(r[7]);var o=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";i=0+("-"===o?-1*i:i);n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else if(e.indexOf("Z",e.length-1)!==-1)n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return n}function m(e,t,n){if(r.datetimeAccessFormPaths.length>0){var s=n.split(".#")[0];for(var i=0;i<r.datetimeAccessFormPaths.length;i++){var o=r.datetimeAccessFormPaths[i];if("string"==typeof o){if(o===s)return l(e)}else if(o instanceof RegExp){if(o.test(s))return l(e)}else if("function"==typeof o)if(o(s))return l(e)}}return e}function d(e){var t={};var n=e.childNodes;for(var s=0;s<n.length;s++){var o=n.item(s);if(o.nodeType===P.ELEMENT_NODE){var a=i(o);if(r.ignoreRoot)t=p(o,a);else t[a]=p(o,a)}}return t}function f(e,t){var n={};n.__cnt=0;var s=e.childNodes;for(var a=0;a<s.length;a++){var l=s.item(a);var d=i(l);if(l.nodeType!==P.COMMENT_NODE){n.__cnt++;if(null==n[d]){n[d]=p(l,t+"."+d);u(n,d,t+"."+d)}else{if(!(n[d]instanceof Array)){n[d]=[n[d]];u(n,d,t+"."+d)}n[d][n[d].length]=p(l,t+"."+d)}}else;}for(var f=0;f<e.attributes.length;f++){var g=e.attributes.item(f);n.__cnt++;var v=g.value;for(var y=0;y<r.attributeConverters.length;y++){var h=r.attributeConverters[y];if(h.test.call(null,g.name,g.value))v=h.convert.call(null,g.name,g.value)}n[r.attributePrefix+g.name]=v}var b=o(e);if(b){n.__cnt++;n.__prefix=b}if(n["#text"]){n.__text=n["#text"];if(n.__text instanceof Array)n.__text=n.__text.join("\n");if(r.escapeMode)n.__text=c(n.__text);
if(r.stripWhitespaces)n.__text=n.__text.trim();delete n["#text"];if("property"===r.arrayAccessForm)delete n["#text_asArray"];n.__text=m(n.__text,"#text",t+".#text")}if(n.hasOwnProperty("#cdata-section")){n.__cdata=n["#cdata-section"];delete n["#cdata-section"];if("property"===r.arrayAccessForm)delete n["#cdata-section_asArray"]}if(1===n.__cnt&&n.__text)n=n.__text;else if(0===n.__cnt&&"text"===r.emptyNodeForm)n="";else if(n.__cnt>1&&void 0!==n.__text&&r.skipEmptyTextNodesForObj)if(r.stripWhitespaces&&""===n.__text||""===n.__text.trim())delete n.__text;delete n.__cnt;if(!r.keepCData&&!n.hasOwnProperty("__text")&&n.hasOwnProperty("__cdata"))return n.__cdata?n.__cdata:"";if(r.enableToStringFunc&&(n.__text||n.__cdata))n.toString=function T(){return(this.__text?this.__text:"")+(this.__cdata?this.__cdata:"")};return n}function p(e,t){if(e.nodeType===P.DOCUMENT_NODE)return d(e);else if(e.nodeType===P.ELEMENT_NODE)return f(e,t);else if(e.nodeType===P.TEXT_NODE||e.nodeType===P.CDATA_SECTION_NODE)return e.nodeValue;else return null}function g(e,t,n,s){var i="<"+(e&&e.__prefix?e.__prefix+":":"")+t;if(n)for(var o=0;o<n.length;o++){var c=n[o];var u=e[c];if(r.escapeMode)u=a(u);i+=" "+c.substr(r.attributePrefix.length)+"=";if(r.useDoubleQuotes)i+='"'+u+'"';else i+="'"+u+"'"}if(!s)i+=">";else i+=" />";return i}function v(e,t){return"</"+(e&&e.__prefix?e.__prefix+":":"")+t+">"}function y(e,t){return e.indexOf(t,e.length-t.length)!==-1}function h(e,t){if("property"===r.arrayAccessForm&&y(t.toString(),"_asArray")||0===t.toString().indexOf(r.attributePrefix)||0===t.toString().indexOf("__")||e[t]instanceof Function)return!0;else return!1}function b(e){var t=0;if(e instanceof Object)for(var r in e)if(!h(e,r))t++;else;return t}function T(e){var t=[];if(e instanceof Object)for(var n in e)if(n.toString().indexOf("__")===-1&&0===n.toString().indexOf(r.attributePrefix))t.push(n);return t}function M(e){var t="";if(e.__cdata)t+="<![CDATA["+e.__cdata+"]]>";if(e.__text)if(r.escapeMode)t+=a(e.__text);else t+=e.__text;return t}function S(e){var t="";if(e instanceof Object)t+=M(e);else if(null!==e)if(r.escapeMode)t+=a(e);else t+=e;return t}function j(e,t,r){var n="";if(0===e.length)n+=g(e,t,r,!0);else for(var s=0;s<e.length;s++)n+=k(e[s],t,T(e[s]));return n}function k(e,t,n){var s="";if(r.jsAttributeFilter&&r.jsAttributeFilter.call(null,t,e))return s;if(r.jsAttributeConverter)e=r.jsAttributeConverter.call(null,t,e);if((void 0===e||null===e||""===e)&&r.selfClosingElements)s+=g(e,t,n,!0);else if("object"==typeof e)if("[object Array]"===Object.prototype.toString.call(e))s+=j(e,t,n);else if(e instanceof Date){s+=g(e,t,n,!1);s+=r.jsDateUTC?e.toUTCString():e.toISOString();s+=v(e,t)}else{var i=b(e);if(i>0||e.__text||e.__cdata){s+=g(e,t,n,!1);s+=_(e);s+=v(e,t)}else if(r.selfClosingElements)s+=g(e,t,n,!0);else{s+=g(e,t,n,!1);s+=v(e,t)}}else{s+=g(e,t,n,!1);s+=S(e);s+=v(e,t)}return s}function _(e){var t="";var r=b(e);if(r>0)for(var n in e)if(!h(e,n)){var s=e[n];var i=T(s);t+=k(s,n,i)}else;t+=S(e);return t}function I(t){if(void 0===t)return null;if("string"!=typeof t)return null;var r=null;var n=null;if(e){r=new e;n=r.parseFromString(t,"text/xml")}else if(window&&window.DOMParser){r=new window.DOMParser;var s=null;var i=window.ActiveXObject||"ActiveXObject"in window;if(!i)try{s=r.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(o){s=null}try{n=r.parseFromString(t,"text/xml");if(null!==s&&n.getElementsByTagNameNS(s,"parsererror").length>0)n=null}catch(o){n=null}}else{if(0===t.indexOf("<?"))t=t.substr(t.indexOf("?>")+2);n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(t)}return n}var x="3.1.1";r=r||{};n();s();var P={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.asArray=function C(e){if(void 0===e||null===e)return[];else if(e instanceof Array)return e;else return[e]};this.toXmlDateTime=function w(e){if(e instanceof Date)return e.toISOString();else if("number"==typeof e)return new Date(e).toISOString();else return null};this.asDateTime=function O(e){if("string"==typeof e)return l(e);else return e};this.xml2dom=function A(e){return I(e)};this.dom2js=function E(e){return p(e,null)};this.js2dom=function R(e){var t=this.js2xml(e);return I(t)};this.xml2js=function U(e){var t=I(e);if(null!=t)return this.dom2js(t);else return null};this.js2xml=function N(e){return _(e)};this.getVersion=function F(){return x}}})},"./node_modules/xhr/index.js":function(e,t,r){"use strict";function n(e,t){for(var r=0;r<e.length;r++)t(e[r])}function s(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function i(e,t,r){var n=e;if(m(t)){r=t;if("string"==typeof e)n={uri:e}}else n=f(t,{uri:e});n.callback=r;return n}function o(e,t,r){t=i(e,t,r);return a(t)}function a(e){function t(){if(4===l.readyState)setTimeout(i,0)}function r(){var e=void 0;if(l.response)e=l.response;else e=l.responseText||c(l);if(b)try{e=JSON.parse(e)}catch(t){}return e}function n(e){clearTimeout(T);if(!(e instanceof Error))e=new Error(""+(e||"Unknown XMLHttpRequest Error"));e.statusCode=0;return u(e,M)}function i(){if(!f){var t;clearTimeout(T);if(e.useXDR&&void 0===l.status)t=200;else t=1223===l.status?204:l.status;var n=M;var s=null;if(0!==t){n={body:r(),statusCode:t,method:g,headers:{},url:p,rawRequest:l};if(l.getAllResponseHeaders)n.headers=d(l.getAllResponseHeaders())}else s=new Error("Internal XMLHttpRequest Error");return u(s,n,n.body)}}if("undefined"==typeof e.callback)throw new Error("callback argument missing");var a=!1;var u=function S(t,r,n){if(!a){a=!0;e.callback(t,r,n)}};var l=e.xhr||null;if(!l)if(e.cors||e.useXDR)l=new o.XDomainRequest;else l=new o.XMLHttpRequest;var m;var f;var p=l.url=e.uri||e.url;var g=l.method=e.method||"GET";var v=e.body||e.data;var y=l.headers=e.headers||{};var h=!!e.sync;var b=!1;var T;var M={body:void 0,headers:{},statusCode:0,method:g,url:p,rawRequest:l};if("json"in e&&e.json!==!1){b=!0;y["accept"]||y["Accept"]||(y["Accept"]="application/json");if("GET"!==g&&"HEAD"!==g){y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json");v=JSON.stringify(e.json===!0?v:e.json)}}l.onreadystatechange=t;l.onload=i;l.onerror=n;l.onprogress=function(){};l.onabort=function(){f=!0};l.ontimeout=n;l.open(g,p,!h,e.username,e.password);if(!h)l.withCredentials=!!e.withCredentials;if(!h&&e.timeout>0)T=setTimeout(function(){if(!f){f=!0;l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT";n(e)}},e.timeout);if(l.setRequestHeader){for(m in y)if(y.hasOwnProperty(m))l.setRequestHeader(m,y[m])}else if(e.headers&&!s(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");if("responseType"in e)l.responseType=e.responseType;if("beforeSend"in e&&"function"==typeof e.beforeSend)e.beforeSend(l);l.send(v||null);return l}function c(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(r){}return null}function u(){}var l=r("./node_modules/global/window.js");var m=r("./node_modules/is-function/index.js");var d=r("./node_modules/parse-headers/parse-headers.js");var f=r("./node_modules/xtend/immutable.js");e.exports=o;o.XMLHttpRequest=l.XMLHttpRequest||u;o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:l.XDomainRequest;n(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,r,n){r=i(t,r,n);r.method=e.toUpperCase();return a(r)}})},"./node_modules/xtend/immutable.js":function(e,t){function r(){var e={};for(var t=0;t<arguments.length;t++){var r=arguments[t];for(var s in r)if(n.call(r,s))e[s]=r[s]}return e}e.exports=r;var n=Object.prototype.hasOwnProperty},"./src/entry/mixin.js":function(e,t,r){"use strict";var n=r("./src/polyfill/weixin-app/platform.js");var s=r("./node_modules/xhr/index.js");var i=r("./external/socketio/socket.io.js");var o=r("./node_modules/javascript-natural-sort/naturalSort.js");var a=r("./node_modules/deep-access/index.js");var c=r("./src/util/index.js");var u=r("./src/util/support.js");var l=r("./src/util/blob.js");var m=r("./src/util/ajax/index.js");var d=r("./src/util/loggerPlugin.js");var f=r("./src/util/usePlugin.js");e.exports=function(e){c.merge(e,{platform:n,xhr:s,io:i,naturalSort:o,deepAccess:a,util:c,support:u,blob:l,ajax:m,LoggerPlugin:d,usePlugin:f})}},"./src/entry/nim.js":function(e,t,r){"use strict";r("./src/polyfill/weixin-app.js");var n=r("./src/im/api/nim/index.js");var s=r("./src/entry/mixin.js");s(n);e.exports=n},"./src/im/api/base/avSignal.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/typeof.js");var i=n(s);var o=r("./src/im/api/base/index.js").fn;var a=r("./src/util/index.js");var c=r("./src/im/protocol/map/configBase.js");var u=r("./src/im/model/avSignal.js");o.signalingCreate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.type,r=e.channelName,n=e.ext;a.verifyOptions(e,"type","api::signalling");return this.sendCmdUsePromise("signalingCreate",{avSignalTag:{type:t,channelName:r,ext:n}}).then(function(e){var t=e.avSignalTag;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingDelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.verifyOptions(e,"channelId","api::signalling");return this.sendCmdUsePromise("signalingDelay",{avSignalTag:e}).then(function(e){var t=e.avSignalTag;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingClose=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.offlineEnabled;a.verifyOptions(e,"channelId","api::signalling");return this.sendCmdUsePromise("signalingClose",{avSignalTag:a.merge(e,{isSave:t===!0?1:0})}).then(function(e){var t=e.avSignalTag;t.offlineEnabled=1===t.isSave?!0:!1;delete t.isSave;return Promise.resolve(t);
})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingJoin=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.offlineEnabled;a.verifyOptions(e,"channelId","api::signalling");return this.sendCmdUsePromise("signalingJoin",{avSignalTag:a.merge(e,{isSave:t===!0?1:0})}).then(function(e){var t=e.avSignalTag;var r=t.members;if("string"==typeof t.members)r=JSON.parse(t.members).map(function(e){return u.parseAvSignalMember(e)});t.members=r;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingLeave=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.offlineEnabled;a.verifyOptions(e,"channelId","api::signalling");return this.sendCmdUsePromise("signalingLeave",{avSignalTag:a.merge(e,{isSave:t===!0?1:0})}).then(function(e){var t=e.avSignalTag;t.offlineEnabled=1===t.isSave?!0:!1;delete t.isSave;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingGetChannelInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.channelName;a.verifyOptions(e,"channelName","api::signalling");return this.sendCmdUsePromise("signalingGetChannelInfo",{avSignalTag:{channelName:t}}).then(function(e){var t=e.avSignalTag;var r=t.members;if("string"==typeof t.members)r=JSON.parse(t.members).map(function(e){return u.parseAvSignalMember(e)});t.members=r;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingInvite=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.account,r=e.offlineEnabled,n=e.pushInfo,s=void 0===n?{}:n;a.verifyOptions(e,"channelId requestId account","api::signalling");if("object"===(0,i["default"])(s.pushPayload))s.pushPayload=JSON.stringify(s.pushPayload);var o=a.merge(e,s,{to:t,isSave:r===!0?1:0,needPush:s.needPush===!0?1:0,needBadge:s.needBadge===!1?0:1});return this.sendCmdUsePromise("signalingInvite",{avSignalTag:o}).then(function(e){var t=e.avSignalTag;t.offlineEnabled=1===t.isSave?!0:!1;t.needBadge=1===t.needBadge?!0:!1;t.needPush=1===t.needPush?!0:!1;delete t.isSave;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingCancel=function(e){var t=e.account,r=e.offlineEnabled;a.verifyOptions(e,"channelId requestId account","api::signalling");return this.sendCmdUsePromise("signalingCancel",{avSignalTag:a.merge(e,{to:t,isSave:r===!0?1:0})}).then(function(e){var t=e.avSignalTag;t.offlineEnabled=1===t.isSave?!0:!1;delete t.isSave;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingCreateAndJoin=function(e){var t=this;var r=e.channelName,n=e.uid,s=void 0===n?0:n,i=e.offlineEnabled,o=void 0===i?!0:i,c=e.attachExt,u=void 0===c?"":c;var l="";return this.signalingCreate(e)["catch"](function(e){if(10405===e.code){t.logger.warn("api::avSignal:signalingCall room already exists:",e);return t.signalingGetChannelInfo({channelName:r})}return Promise.reject(e)}).then(function(e){l=e.channelId;var r={channelId:l,offlineEnabled:o,attachExt:u};if(s)a.merge(r,{uid:s});return t.signalingJoin(r)})};o.signalingCall=function(e){var t=this;var r=e.account,n=e.offlineEnabled,s=e.requestId;a.verifyOptions(e,"type requestId account","api::signalling");var i="";return this.signalingCreateAndJoin(e).then(function(o){t.logger.log("api::avSignal:signalingCall join:",o);i=o.channelId||i;var a={channelId:i,account:r,requestId:s,offlineEnabled:n,attachExt:e.attachExt||"",pushInfo:e.pushInfo||{}};return t.signalingInvite(a)})};o.signalingReject=function(e){var t=e.account,r=e.offlineEnabled;a.verifyOptions(e,"channelId requestId account","api::signalling");return this.sendCmdUsePromise("signalingReject",{avSignalTag:a.merge(e,{to:t,isSave:r===!0?1:0})}).then(function(e){var t=e.avSignalTag;t.offlineEnabled=1===t.isSave?!0:!1;delete t.isSave;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingAccept=function(e){var t=this;var r=e.account,n=e.offlineEnabled;a.verifyOptions(e,"channelId requestId account","api::signalling");return this.sendCmdUsePromise("signalingAccept",{avSignalTag:a.merge(e,{to:r,isSave:n===!0?1:0})}).then(function(e){var t=e.avSignalTag;t.offlineEnabled=1===t.isSave?!0:!1;delete t.isSave;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))}).then(function(r){var n=e.autoJoin;if(n){var s={channelId:e.channelId,offlineEnabled:e.offlineEnabled,attachExt:e.joinAttachExt,uid:e.uid};return t.signalingJoin(s)}else return r})};o.signalingControl=function(e){var t=e.account;a.verifyOptions(e,"channelId","api::signalling");return this.sendCmdUsePromise("signalingControl",{avSignalTag:a.merge(e,t?{to:t}:{})}).then(function(e){var t=e.avSignalTag;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingSync=function(){return this.sendCmdUsePromise("sync",{sync:{avSignal:0}}).then(function(e){var t=e.avSignalTag;return Promise.resolve(t)})["catch"](function(e){return Promise.reject(u.parseAvSignalError(e))})};o.signalingMarkMsgRead=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.verifyOptions(e,"msgid","api::signalling");var t=c.idMap.avSignal;var r=void 0;if("string"==typeof e.msgid)r=[e.msgid];else r=e.msgid;return this.sendCmd("batchMarkRead",{sid:t.id,cid:t.signalingNotify,ids:r})}},"./src/im/api/base/connect.js":function(e,t,r){"use strict";var n=r("./src/im/api/base/index.js").fn;n.isConnected=function(){if(this.protocol)return this.protocol.isConnected();else return!1};n.connect=function(){this.protocol.appLogin=0;this.protocol.connect(!0)};n.disconnect=function(e){e=e||{};this.protocol.disconnect(e.done)}},"./src/im/api/base/index.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(){}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);var a=r("./node_modules/eventemitter3/index.js");var c=r("./src/util/index.js");var u=c.notundef;var l=r("./src/util/logger.js");var m=r("./src/util/config.js");var d={};s.getInstance=function(e){var t=this;e=p(e);c.verifyOptions(e,"account","api::Base.getInstance");var r=t.genInstanceName(e);var n=d[r];if(!n)n=d[r]=new t(e);else s.updateInstance(n,e);return n};s.updateInstance=function(e,t){e.setOptions(t);e.connect()};var f=s.fn=s.prototype=Object.create(new a);var p=function v(e){if(e.nosSurvivalTime){c.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance");c.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")}else e.nosSurvivalTime=1/0;return e};f.updatePrivateConf=function(e){if(e&&"object"===(0,o["default"])(e.privateConf)){var t=e.privateConf;if("string"==typeof t.lbs_web)e.lbsUrl=t.lbs_web;if("boolean"==typeof t.link_ssl_web)e.secure=t.link_ssl_web;if("boolean"==typeof t.https_enabled)e.httpsEnabled=t.https_enabled;e.uploadUrl=t.nos_uploader_web?t.nos_uploader_web:null;e.chunkUploadUrl=t.nos_uploader_web?t.nos_uploader_web:null;e.replaceUrl=t.nos_downloader?t.nos_downloader:null;e.downloadUrl=t.nos_accelerate?t.nos_accelerate:null;e.downloadHost=t.nos_accelerate_host?t.nos_accelerate_host:null;e.ntServerAddress=t.nt_server||null;e.kibanaServer=t.kibana_server;e.statisticServer=t.statistic_server;e.reportGlobalServer=t.report_global_server}if(null===e.ntServerAddress||""===e.ntServerAddress)m.ntServerAddress=null;else m.ntServerAddress=e.ntServerAddress||m.defaultReportUrl;m.uploadUrl=e.uploadUrl||m.uploadUrl;m.chunkUploadUrl=e.chunkUploadUrl||m.chunkUploadUrl;m.downloadUrl=e.downloadUrl||m.downloadUrl;m.downloadHost=e.downloadHost||m.downloadHost;m.replaceUrl=e.replaceUrl||m.replaceUrl;m.httpsEnabled=e.httpsEnabled||m.httpsEnabled;return e};f.init=function(e){var t=this;c.verifyOptions(e,"account","api::Base.init");e=this.updatePrivateConf(e);var r=t.account=e.account=e.account+"";var n=e.constructor;var i=n.genInstanceName(e);var o=d[i];if(e._disableSingleton)o=null;if(o){s.updateInstance(o,e);return o}else{t.name=i;d[i]=t}t.logger=e.logger=new l({debug:e.debug,logFunc:e.logFunc,prefix:t.subType});e.api=t;var a=t.protocol=new e.Protocol(e);a.name="Protocol-"+i;a.account=r;a.api=t;a.message=t.message=new e.Message({account:r});t.options=c.copy(e);t.reset();return t};f.destroy=function(e){function t(t){n.logger.warn("ApiBase::destroy: instance destroyed ...");Object.getOwnPropertyNames(n).forEach(function(e){delete n[e]});if(d){delete d[r];d[r]=null}if(e.done instanceof Function)e.done(t)}e=e||{};var r=this.name;if(r){if(this.protocol&&this.protocol.resetPush)this.protocol.resetPush();var n=this;this.disconnect({done:t})}};f.reset=function(){var e=this.updatePrivateConf(this.options);c.verifyBooleanWithDefault(e,"exifOrientation",!0,"","api::Base.reset")};f.setOptions=function(e){this.reset();this.protocol.setOptions(e)};f.processCallback=function(e,t){g(e,t)};f.processCallbackPromise=function(e,t){var r=new Promise(function(r,n){g(e,t,!0,r,n)});return r};var g=function y(e,t,r,n,s){var i="api::processCallback";if(r)i="api::processCallbackPromise";c.verifyCallback(e,"done",i);e.callback=function(o,a,l){var m=e.callback.options;a=a||m;if(t)a=m;if(c.isFunction(e.cbaop)){var d=e.cbaop(o,a);if(u(d))a=d}var f=e.done;if(c.isObject(a)){delete a.done;delete a.cb;delete a.callback}if(r)if(o)s({message:"生成接口回调错误",callFunc:i,event:o});else n(a);else f(o,a,l)};e.callback.options=c.copy(e)};f.processPs=function(e){if(c.notexist(e.ps))e.ps=""};f.processCustom=function(e){if(c.notexist(e.custom))e.custom=""};f.sendCmd=function(){this.protocol.sendCmd.apply(this.protocol,arguments)};f.sendCmdWithResp=function(e,t,r){this.sendCmd(e,t,function(e,t,n){if(c.isFunction(r))if(e)r(e,t);else r(null,n)})};f.cbAndSendCmd=function(e,t){var r=this.processCallbackPromise(t);this.sendCmd(e,t);return r};f.sendCmdUsePromise=function(e,t){
var r=this;return new Promise(function(n,s){r.sendCmd(e,t,function(e,t,r){if(e)s(e);else{var i=c.merge({},t,r);n(i)}})})};s.use=function(e,t){if(e&&e.install&&c.isFunction(e.install))e.install(this,t)};s.rmAllInstances=function(){for(var e in d)d[e].destroy();d={}};f.logout=function(e){this.protocol.shouldReconnect=!1;this.protocol.doLogout=!0;this.processCallback(e);this.sendCmd("logout",e,e.callback)};e.exports=s;r("./src/im/api/base/connect.js");r("./src/im/api/base/msg.js");r("./src/im/api/base/nos.js");r("./src/im/api/base/nosViewImage.js");r("./src/im/api/base/misc.js");r("./src/im/api/base/report.js");r("./src/im/api/base/avSignal.js")},"./src/im/api/base/misc.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t,r,n){var s=!1;var i="";if(1===r){if(e.indexOf(t)>=0){s=!0;i=t}}else if(2===r){i=new RegExp(t,"g");if(i.test(e))s=!0}if(s&&""!==i)switch(n){case 1:return e.replace(i,"**");case 2:return{code:2};case 3:return{code:3}}return e}function i(e,t){var r=this;var n=t.match;var i=t.operate;var o=e;for(var c=0;c<t.keys.length;c++){var u=t.keys[c];var l=u.match||n;var m=u.operate||i;try{o=s(o,u.key,l,m);if("object"===("undefined"==typeof o?"undefined":(0,a["default"])(o)))return o}catch(d){r.logger.warn("misc::filterContent: js cannot parse this regexp ",d)}}return o}var o=r("./node_modules/babel-runtime/helpers/typeof.js");var a=n(o);var c=r("./src/util/index.js");var u=r("./src/im/api/base/index.js").fn;u.uploadSdkLogUrl=function(e){c.verifyOptions(e,"url","misc::uploadSdkLogUrl");return this.cbAndSendCmd("uploadSdkLogUrl",e)};u.getClientAntispamLexicon=function(e){var t=this;e=e||{};var r=e.done;if(!(r instanceof Function))r=function s(){};e={clientAntispam:{version:0}};var n=this;return this.protocol.sendCmd("getClientAntispam",e,function(e,s,i){if(e){n.protocol.logger.error("misc::getClientAntispamLexicon:",e);r.call(t,e,{})}else{r.call(t,null,i);n.antispamLexicon=i.clientAntispam||{}}})};u.filterClientAntispam=function(e){var t=e.content,r=e.antispamLexicon;if(!t)return{code:404,errmsg:"待反垃圾文本content不存在"};r=r||this.antispamLexicon||{};var n=this.antispamLexicon&&this.antispamLexicon.thesaurus;if(!n)return{code:404,errmsg:"没有反垃圾词库或者词库格式不合法"};try{n=JSON.parse(n).thesaurus}catch(s){this.protocol.logger.error("misc::filterClientAntispam: parse thesaurus error");return{code:500,errmsg:"反垃圾词库格式不合法"}}var o=t;for(var c=0;c<n.length;c++){o=i.call(this,o,n[c]);if("object"===("undefined"==typeof o?"undefined":(0,a["default"])(o))){if(2===o.code)return{code:200,type:2,errmsg:"建议拒绝发送",content:t,result:""};else if(3===o.code)return{code:200,type:3,errmsg:"建议服务器处理反垃圾，发消息带上字段clientAntiSpam",content:t,result:t}}else;}if(o===t)return{code:200,type:0,errmsg:"",content:t,result:o};else return{code:200,type:1,errmsg:"已对特殊字符做了过滤",content:t,result:o}}},"./src/im/api/base/msg.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/typeof.js");var i=n(s);var o=r("./src/im/api/base/index.js").fn;var a=r("./src/util/index.js");var c=r("./node_modules/x2js/x2js.js");var u=r("./src/im/model/nimerror.js");var l=r("./src/util/config.js");var m=r("./src/util/nos.js");var d=r("./src/util/upload.js");var f=r("./src/util/blob.js");o.sendText=function(e){var t=this;t.processCallback(e);e.msg=new t.message.TextMessage(e);return t.sendMsg(e)};o.previewFile=function(e){a.verifyOptions(e,"done","msg::previewFile");if(!e.type)e.type="file";a.verifyParamPresentJustOne(e,"dataURL blob fileInput filePath wxFilePath fileObject","msg::previewFile");if(a.exist(e.maxSize))a.verifyParamType("maxSize",e.maxSize,"number","api::previewFile");if(a.exist(e.commonUpload))a.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile");if(e.nosSurvivalTime){a.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance");a.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")}else e.nosSurvivalTime=this.nosSurvivalTime;e.filePath=e.filePath||e.wxFilePath;delete e.wxFilePath;if(e.dataURL)e.blob=f.fromDataURL(e.dataURL);else if(e.blob);else if(e.fileInput){e.fileInput=a.verifyFileInput(e.fileInput,"msg::previewFile");if(e.fileInput.files){if(!e.fileInput.files.length){e.done(u.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e);return}e.fileSize=e.fileInput.files[0].size}e.fileInputName=a.getFileName(e.fileInput)}this.processCallback(e);var t=JSON.stringify(m.genResponseBody(e.type)||{}).replace(/"/gi,'\\"');var r=null;var n=e.transcode?"getNosTokenTrans":"getNosToken";if(e.transcode){a.verifyOptions(e,"fileInput","msg::previewFile");var s=a.getFileInfo(e.fileInput);r={transToken:{name:s.name,type:s.transcodeType,transType:"png"===e.transcode?11:10,size:s.size,body:t}}}else r=t;this[n]({responseBody:r,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:function(t,r){if(t)e.done(t);else{if(e.transcode){e.nosToken=r.nosToken;e.docId=r.docId}else e.nosToken=r;this._doPreviewFile(e)}}.bind(this)})};o._doPreviewFile=function(e){function t(t,s,i){e.uploaddone=n;if(t)e.done(t,e.callback.options);else{s=m.parseResponse(s,r.options.exifOrientation);if(!i){s.url=l.genDownloadUrl(e.nosToken,f.Object);if(e.nosToken.shortUrl)s._url_safe=e.nosToken.shortUrl}if(a.exist(e.fileInputName))s.name=e.fileInputName;else if(e.blob){var o=e.blob.name;s.name=o||"blob-"+s.md5;if(!o){var c=e.blob.type;s.ext=c.slice(c.lastIndexOf("/")+1)}}else if(e.filePath)s.name=e.filePath;else if(e.fileObject)s.name=e.fileObject.fileName;if(!s.ext){var u=s.name.lastIndexOf(".");if(u===-1)s.ext="unknown";else s.ext=s.name.slice(u+1)}s.size=s.size||0;e.done(null,a.copy(s))}}var r=this;var n=e.uploaddone;var s=l.genUploadUrl(e.nosToken.bucket);var o=l.genChunkUploadUrl(e.nosToken);var c;if(e.commonUpload||!o||l.isWeixinApp||l.isNodejs||l.isRN){e.commonUpload=!0;c=s}else c=o;var f=this.assembleUploadParams(e.nosToken);var p="file";if(l.isWeixinApp){a.verifyOptions(e,"filePath","msg::_doPreviewFile");r.fileQuickTransfer(e,t,function(){wx.uploadFile({url:c,filePath:e.filePath,name:p,formData:f,fail:function r(e){console.log("error:","api::msg:upload file failed",e)},success:function n(e){if(200===e.statusCode)try{t(null,JSON.parse(e.data))}catch(r){console.log("error:","parse wx upload file res error",r);t({code:"PARSE_WX_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else t({code:e.statusCode,msg:e.errMsg})}})})}else if(l.isNodejs){var g={url:c,name:p,formData:f,success:function y(e){if(200===e.statusCode)try{t(null,JSON.parse(e.data))}catch(r){console.log("error:","parse nodejs upload file res error",r);t({code:"PARSE_NODEJS_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else t({code:e.statusCode,msg:e.errMsg})},fail:function h(e){console.log("error:","api::msg:upload file failed",e)}};if(e.filePath)g.filePath=e.filePath;else{if("object"!==(0,i["default"])(e.fileObject))throw new u("Nodejs上传fileObject参数类型应如 {fileName:..,fileData:..} ");g.fileData=e.fileObject.fileData}r.fileQuickTransfer(e,t,function(){d.uploadFile(g)})}else if(l.isRN){var v={url:c,name:p,formData:f,filePath:e.filePath,success:function b(e){if(e.ok&&200===e.status)try{e.md5=e.headers.map&&e.headers.map.etag&&e.headers.map.etag[0]||"UNKNOWN";t(null,e)}catch(r){console.log("error:","parse React Native upload file res error",r);t({code:"PARSE_React_Native_UPLOAD_FILE_RES_ERROR",res:e})}else t({code:e.status,msg:e.statusText})},fail:function T(e){console.log("error:","api::msg:upload file failed",e)}};r.fileQuickTransfer(e,t,function(){d.uploadFile(v)})}else{e.uploaddone=t;e.url=c;e.params=f;e.fileName=p;r.fileQuickTransfer(e,t,function(){return new d(e)})}};o.fileQuickTransfer=function(e,t,r){var n=this;e=e||{};if(!(t instanceof Function))t=function p(){};if(!(r instanceof Function))r=function g(){};var s=e.fastPass;if(s)try{s=JSON.parse(s);e.fastPass=s}catch(i){n.protocol.logger.error("快传参数解析失败")}var o=e.fileInputName||e.name||e.blob&&e.blob.name||"";var a=e.fileSize||e.size||e.blob&&e.blob.size||0;var c=s?((s.md5||e.digest||"")+"").trim():"";var u=e.type||e.blob&&e.blob.type;if(c&&a>=l.threshold){var m=!0;var d={name:o,md5:c,ext:o.slice(o.lastIndexOf(".")+1),type:u};switch(u){case"image":if(!s||!s.w||!s.h){m=!1;n.protocol.logger.error("快传 image 文件缺少参数 w 或 h")}else{d.w=s.w;d.h=s.h}break;case"video":if(!(s&&s.w&&s.h&&s.dur)){m=!1;n.protocol.logger.error("快传 video 文件缺少参数 w 或 h 或 dur")}else{d.w=s.w;d.h=s.h;d.dur=s.dur}break;case"audio":if(!s||!s.dur){m=!1;n.protocol.logger.error("快传 audio 文件缺少参数 dur")}else d.dur=s.dur}if(!m){r();return}var f={fileQuickTransfer:{md5:c}};if(a)f.fileQuickTransfer.size=a;return this.protocol.sendCmd("fileQuickTransfer",f,function(e,s,i){if(e||!i||!i.fileQuickTransfer||!i.fileQuickTransfer.url){n.protocol.logger.error("misc::fileQuickTransfer: not found",e,s,i);r()}if(i&&i.fileQuickTransfer&&i.fileQuickTransfer.threshold)l.threshold=i.fileQuickTransfer.threshold||0;if(i&&i.fileQuickTransfer&&i.fileQuickTransfer.url){d.size=a||i.fileQuickTransfer.size;d.url=i.fileQuickTransfer.url;if(i.fileQuickTransfer._url_safe)d._url_safe=i.fileQuickTransfer._url_safe;t(e,d,!0)}})}r()};o.sendFile=function(e){var t=this;if(!e.type)e.type="file";a.verifyParamPresentJustOne(e,"dataURL blob fileInput file filePath wxFilePath fileObject","msg::sendFile");if(a.exist(e.maxSize))a.verifyParamType("maxSize",e.maxSize,"number","api::previewFile");if(a.exist(e.commonUpload))a.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile");t.processCallback(e);e.filePath=e.filePath||e.wxFilePath;delete e.wxFilePath;if(e.dataURL)t._previewAndSendFile(e);else if(e.blob)t._previewAndSendFile(e);else if(e.fileInput){e.fileInput=a.verifyFileInput(e.fileInput,"msg::sendFile");if(e.fileInput.files&&!e.fileInput.files.length){e.done(u.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::sendFile",fileInput:e.fileInput}),e.callback.options);return}t._previewAndSendFile(e)}else if(e.filePath||e.fileObject)t._previewAndSendFile(e);else if(e.file){
var r;var n=e.file._url_safe;if(n){r=e.file.url;e.file.url=n;delete e.file._url_safe}e.msg=new t.message.FileMessage(e);return t.sendMsg(e,r)}};o._previewAndSendFile=function(e){var t=this;a.verifyCallback(e,"uploaddone beforesend","msg::_previewAndSendFile");var r=e.done;e.done=function(n,s){e.done=r;if(n){e.uploaddone(n,e.callback.options);e.done(n,e.callback.options)}else{if(/chatroom/.test(e.scene))return;e.uploaddone(null,a.copy(s));var i;var o=s._url_safe;if(o){i=s.url;s.url=o;delete s._url_safe}e.file=s;e.msg=new t.message.FileMessage(e);e.beforesend(t.sendMsg(e,i))}};t.previewFile(e)};o.assembleUploadParams=function(e){if(e)return{Object:decodeURIComponent(e.objectName),"x-nos-token":e.token,"x-nos-entity-type":"json"};else return null};o.deleteFile=function(e){a.verifyParamPresentJustOne(e,"docId","msg::deleteFile");this.removeFile({docId:e.docId,callback:function t(r,n){if(r)e.error&&e.error(r,n);else e.success&&e.success(n)}})};o.getFile=function(e){a.verifyParamPresentJustOne(e,"docId","msg::getFile");this.fetchFile({docId:e.docId,callback:function t(r,n){if(r)e.error&&e.error(r,n);else e.success&&e.success(n.info)}})};o.getFileList=function(e){var t=e.fromDocId,r=void 0===t?"":t,n=e.limit,s=void 0===n?10:n;var i={limit:s};if(r)i.fromDocId=r;this.fetchFileList({fileListParam:i,callback:function o(t,r){if(t){if(s>30)t.message=t.message+"::文档条数超过限制:30";e.error&&e.error(t,r)}else e.success&&e.success(r)}})};o.sendGeo=function(e){var t=this;t.processCallback(e);e.msg=new t.message.GeoMessage(e);return t.sendMsg(e)};o.sendTipMsg=function(e){var t=this;t.processCallback(e);e.msg=new t.message.TipMessage(e);return t.sendMsg(e)};o.sendCustomMsg=function(e){var t=this;t.processCallback(e);e.msg=new t.message.CustomMessage(e);return t.sendMsg(e)};o.sendRobotMsg=function(e){var t=this;t.processCallback(e);e.msg=new t.message.RobotMessage(e);return t.sendMsg(e)};o.sendMsg=function(e,t){var r=this;var n=r.protocol;var s=e.msg;var i={};var o=!!e.isLocal;if(o){if(e.time)s.time=e.time;if(e.idClient)s.idClient=e.idClient}if(e.resend)if("out"!==e.flow||"fail"!==e.status)return a.onError("只能重发发送失败的消息");e.callback.options.idClient=s.idClient;r.beforeSendMsg(e,i);var c=e.rtnMsg=r.formatReturnMsg(s);if(t&&!r.options.keepNosSafeUrl&&c.file){c.file._url_safe=c.file.url;c.file.url=t;if("audio"===c.type)c.file.mp3Url=t+(~t.indexOf("?")?"&":"?")+"audioTrans&type=mp3"}if(c.hasOwnProperty("chatroomId")&&!c.chatroomId)return a.onError("聊天室未连接");if(o){c.status="success";c.isLocal=!0}if(n.storeSendMsg)i.promise=n.storeSendMsg(c);e.cbaop=function(e){if(e&&"server"!==e.from){c.status="fail";if(n.updateSendMsgError)n.updateSendMsgError(c);return c}};if(!o){if(t&&!r.options.keepNosSafeUrl&&e.callback)e.callback.originUrl=t;i.msg=s;r.sendCmd(e.cmd,i,e.callback)}r.afterSendMsg(e);if(o)setTimeout(function(){c=a.simpleClone(c);e.done(null,c)},0);return a.copy(c)};o.beforeSendMsg=function(){};o.afterSendMsg=function(){};o.formatReturnMsg=function(e){var t=this;e=a.copy(e);t.protocol.completeMsg(e);e.status="sending";e=t.message.reverse(e);return e};o.resendMsg=function(e){var t=this;a.verifyOptions(e,"msg","msg::resendMsg");t.trimMsgFlag(e);e.resend=!0;return t._sendMsgByType(e)};o.forwardMsg=function(e){var t=this;a.verifyOptions(e,"msg","msg::forwardMsg");t.trimMsgFlag(e);t.beforeForwardMsg(e);e.forward=!0;e.msg.idClient=a.guid();return t._sendMsgByType(e)};o.trimMsgFlag=function(e){if(e&&e.msg){e.msg=a.copy(e.msg);delete e.msg.resend;delete e.msg.forward}};o.beforeForwardMsg=function(){};o._sendMsgByType=function(e){var t=this;a.verifyOptions(e,"msg","msg::_sendMsgByType");a.verifyParamValid("msg.type",e.msg.type,t.message.validTypes,"msg::_sendMsgByType");a.merge(e,e.msg);switch(e.type){case"text":return t.sendText(e);case"image":case"audio":case"video":case"file":return t.sendFile(e);case"geo":return t.sendGeo(e);case"custom":return t.sendCustomMsg(e);case"tip":return t.sendTipMsg(e);default:throw new u("不能发送类型为 "+e.type+" 的消息")}};o.parseRobotTemplate=function(e){function t(e){if(e.link){var t=e.link;if(!Array.isArray(t))t=[t];t=t.map(function(e){if(e.image)e.image=n(e);if(e.text)e.text=r(e);if("url"===e._type){e.type="url";e.style=e._style||"";e.target=e._target;delete e._target;delete e._style}else if("block"===e._type){e.type="block";e.style=e._style||"";e.params=e._params||"";e.target=e._target;delete e._params;delete e._target;delete e._style}delete e._type;return e});e.link=t}return e.link}function r(e){if(!Array.isArray(e.text))e.text=[e.text];e.text=e.text.map(function(e){return{type:"text",name:e._name,text:e.__text}});return e.text}function n(e){if(!Array.isArray(e.image))e.image=[e.image];e.image=e.image.map(function(e){return{type:"image",name:e._name,url:e._url}});return e.image}if(/<template[^>\/]+\/>/.test(e))return{raw:e,json:[{type:"text",name:"",text:""}]};if(!/<template[^>\/]+>/.test(e))return{raw:e,json:[{type:"text",name:"",text:e}]};var s=new c({escapeMode:!1});e=e.replace(/<template [^>]+>/,"<template>");var i=s.xml2js(e);i=i.template.LinearLayout;if(!Array.isArray(i))i=[i];var o=[];i=i.forEach(function(e){if(e.image)o=o.concat(n(e));if(e.text)o=o.concat(r(e));if(e.link)o=o.concat(t(e))});return{raw:e,json:o}}},"./src/im/api/base/nos.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s=r("./src/im/api/base/index.js").fn;var i=r("./src/im/model/ImageOp.js");var o=r("./src/util/nos.js");var a=r("./src/im/model/nimerror.js");s.transDoc=function(e){n.verifyOptions(e,"fileInput done","nos::transDoc");try{var t=e.fileInput.files[0];var r=["ppt","pdf","pptx"];var s=e.fileInputName=t.name;var i={ppt:1,pptx:2,pdf:3};var c=s.substring(s.lastIndexOf(".")+1);if(r.indexOf(c)<0){e.done(a.newNoFileError("请上传正确格式的文件【ppt, pptx, pdf】",{callFunc:"nos: transDoc",fileInput:e.fileInput}),e);return}}catch(u){e.done(a.newNoFileError("请上传正确的文件节点",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e);return}var l=JSON.stringify(o.genResponseBody("file")||{}).replace(/"/gi,'\\"');var m={transToken:{name:s,type:i[c],transType:"png"===e.transcode?11:10,size:t.size,body:l}};this.getNosTokenTrans({responseBody:m,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:function(t,r){if(t)e.done(t);else{e.nosToken=r.nosToken;e.docId=r.docId;this._doPreviewFile(e)}}.bind(this)})};s.getSimpleNosToken=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.num=1;n.verifyOptions(e);return this.cbAndSendCmd("getSimpleNosToken",e)};s.getNosToken=function(e){var t=e.callback,r=e.nosToken,n=e.responseBody;var s={tag:r.nosScene};if(r.nosSurvivalTime&&r.nosSurvivalTime!==1/0)s.expireSec=r.nosSurvivalTime;this.sendCmd("getNosToken",{responseBody:n,nosToken:s},t)};s.getNosTokenTrans=function(e){this.sendCmd("getNosTokenTrans",e.responseBody,e.callback)};s.packFileDownloadName=function(e){n.verifyOptions(e,"url name",!0,"","nos::packFileDownloadName");var t=e.url;return t+n.genUrlSep(t)+"download="+encodeURIComponent(e.name)};s.audioToMp3=function(e){n.verifyOptions(e,"url","nos::audioToMp3");var t=e.url;return t+n.genUrlSep(t)+"audioTrans&type=mp3"};s.removeFile=function(e){this.sendCmd("removeFile",e,e.callback)};s.fetchFile=function(e){this.sendCmd("fetchFile",e,e.callback)};s.fetchFileList=function(e){this.sendCmd("fetchFileList",e,e.callback)};s.stripImageMeta=function(e){return this.beforeProcessImage(e,"stripmeta")};s.qualityImage=function(e){return this.beforeProcessImage(e,"quality")};s.interlaceImage=function(e){return this.beforeProcessImage(e,"interlace")};s.rotateImage=function(e){return this.beforeProcessImage(e,"rotate")};s.blurImage=function(e){return this.beforeProcessImage(e,"blur")};s.cropImage=function(e){return this.beforeProcessImage(e,"crop")};s.thumbnailImage=function(e){return this.beforeProcessImage(e,"thumbnail")};s.beforeProcessImage=function(e,t){var r=n.copy(e);r.type=t;e.ops=[r];return this.processImage(e)};s.processImage=function(e){var t=this;n.verifyOptions(e,"url ops",!0,"","nos::processImage");n.verifyParamType("ops",e.ops,"array","nos::processImage");var r=e.ops.map(function(e){n.verifyOptions(e,"type",!0,"","nos::processImage");n.verifyParamValid("type",e.type,i.validTypes,"nos::processImage");return t["gen"+e.type.slice(0,1).toUpperCase()+e.type.slice(1)+"Op"](e)});t.processCallback(e);t.sendCmd("processImage",{url:e.url,imageOps:r},e.callback)};s.genStripmetaOp=function(e){return new i({type:e.type,stripmeta:e.strip?1:0})};s.genQualityOp=function(e){n.verifyOptions(e,"quality",!0,"","nos::genQualityOp");n.verifyParamType("quality",e.quality,"number","nos::genQualityOp");n.verifyParamMin("quality",e.quality,0,"nos::genQualityOp");n.verifyParamMax("quality",e.quality,100,"nos::genQualityOp");var t=Math.round(e.quality);return new i({type:e.type,qualityQuality:t})};s.genInterlaceOp=function(e){return new i({type:e.type})};s.genRotateOp=function(e){n.verifyOptions(e,"angle",!0,"","nos::genRotateOp");n.verifyParamType("angle",e.angle,"number","nos::genRotateOp");for(;e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t=Math.round(e.angle);return new i({type:e.type,rotateAngle:t})};s.genBlurOp=function(e){n.verifyOptions(e,"radius sigma","nos::genBlurOp");n.verifyParamType("radius",e.radius,"number","nos::genBlurOp");n.verifyParamMin("radius",e.radius,1,"nos::genBlurOp");n.verifyParamMax("radius",e.radius,50,"nos::genBlurOp");n.verifyParamType("sigma",e.sigma,"number","nos::genBlurOp");n.verifyParamMin("sigma",e.sigma,0,"nos::genBlurOp");var t=Math.round(e.radius);var r=Math.round(e.sigma);return new i({type:e.type,blurRadius:t,blurSigma:r})};s.genCropOp=function(e){n.verifyOptions(e,"x y width height","nos::genCropOp");n.verifyParamType("x",e.x,"number","nos::genCropOp");n.verifyParamMin("x",e.x,0,"nos::genCropOp");n.verifyParamType("y",e.y,"number","nos::genCropOp");n.verifyParamMin("y",e.y,0,"nos::genCropOp");n.verifyParamType("width",e.width,"number","nos::genCropOp");n.verifyParamMin("width",e.width,0,"nos::genCropOp");n.verifyParamType("height",e.height,"number","nos::genCropOp");
n.verifyParamMin("height",e.height,0,"nos::genCropOp");var t=Math.round(e.x);var r=Math.round(e.y);var s=Math.round(e.width);var o=Math.round(e.height);return new i({type:e.type,cropX:t,cropY:r,cropWidth:s,cropHeight:o})};s.genThumbnailOp=function(){var e={cover:"z",contain:"x",crop:"y"};return function(t){n.verifyOptions(t,"mode","nos::genThumbnailOp");n.verifyParamValid("mode",t.mode,Object.keys(e),"nos::genThumbnailOp");if("contain"===t.mode)n.verifyParamAtLeastPresentOne(t,"width height","nos::genThumbnailOp");else n.verifyOptions(t,"width height","nos::genThumbnailOp");if(n.undef(t.width))t.width=0;if(n.undef(t.height))t.height=0;n.verifyParamType("width",t.width,"number","nos::genThumbnailOp");n.verifyParamMin("width",t.width,0,"nos::genThumbnailOp");n.verifyParamType("height",t.height,"number","nos::genThumbnailOp");n.verifyParamMin("height",t.height,0,"nos::genThumbnailOp");var r=Math.round(t.width);var s=Math.round(t.height);var o=new i({type:t.type,thumbnailMode:e[t.mode],thumbnailWidth:r,thumbnailHeight:s});if("crop"===t.mode)if(n.notundef(t.axis)){if(n.undef(t.axis.x))t.axis.x=5;if(n.undef(t.axis.y))t.axis.y=5;n.verifyParamMin("axis.x",t.axis.x,0,"nos::genThumbnailOp");n.verifyParamMax("axis.x",t.axis.x,10,"nos::genThumbnailOp");n.verifyParamMin("axis.y",t.axis.y,0,"nos::genThumbnailOp");n.verifyParamMax("axis.y",t.axis.y,10,"nos::genThumbnailOp");var a=Math.round(t.axis.x);var c=Math.round(t.axis.y);o.thumbnailAxisX=a;o.thumbnailAxisY=c}if(n.notundef(t.enlarge)){n.verifyParamType("enlarge",t.enlarge,"boolean","nos::genThumbnailOp");if(t.enlarge)o.thumbnailEnlarge=1}return o}}();s.getNosOriginUrl=function(e){var t=this;n.verifyOptions(e,"safeShortUrl",!0,"","nos::getNosOriginUrl");n.verifyParamType("safeShortUrl",e.safeShortUrl,"string","nos::getNosOriginUrl");if(/^http(s)?:/.test(e.safeShortUrl)&&~e.safeShortUrl.indexOf("im_url=1")){t.processCallback(e);t.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e.safeShortUrl}},e.callback)}else e.done(new a("参数 “safeShortUrl” 内容非文件安全短链",{callFunc:"nos: getNosOriginUrl"}),e)}},"./src/im/api/base/nosViewImage.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/typeof.js");var i=n(s);var o=r("./src/util/url.js");var a=r("./src/util/index.js");var c=r("./src/im/api/base/index.js").fn;c.viewImageSync=function(e){var t=this.options;a.verifyOptions(e,"url","nos::viewImageSync");var r=e.url;var n=(0,o.url2object)(r),s=n.protocol,c=n.hostname,u=n.path,l=n.query;if("boolean"==typeof e.strip)l["stripmeta"]=e.strip?1:0;if("number"==typeof e.quality){a.verifyParamMin("quality",e.quality,0,"nos::viewImageSync");a.verifyParamMax("quality",e.quality,100,"nos::viewImageSync");l["quality"]=Math.round(e.quality)}if("boolean"==typeof e.interlace)l["interlace"]=e.interlace?1:0;if("number"==typeof e.rotate)l["rotate"]=Math.round(e.rotate);if("object"===(0,i["default"])(e.thumbnail)){var m=e.thumbnail.mode||"crop";var d=e.thumbnail.width;var f=e.thumbnail.height;if(d>=0&&f>=0&&d<4096&&f<4096)if(d>0||f>0){switch(m){case"crop":m="y";break;case"contain":m="x";break;case"cover":m="z";break;default:m="x"}l["thumbnail"]=""+d+m+f}}if(t.downloadUrl){var p=(0,o.url2object)(e.url);var g=t.downloadUrl;var v=p.path;var y=v.indexOf("/");if(y!==-1){var h=v.substring(0,y);var b=v.substring(y+1);g=g.replace("{bucket}",h).replace("{object}",b)}var T=(0,o.url2object)(g);return(0,o.object2url)({protocol:T.protocol,hostname:T.hostname,path:T.path,query:a.merge(T.query,l)})}else return(0,o.object2url)({protocol:s,hostname:c,path:u,query:l})};c.viewImageStripMeta=function(e){a.verifyOptions(e,"url strip","nos::viewImageStripMeta");a.verifyParamType("strip",e.strip,"boolean","nos::viewImageStripMeta");var t="stripmeta="+(e.strip?1:0);var r=(0,o.genUrlSep)(e.url);return e.url+r+t};c.viewImageQuality=function(e){a.verifyOptions(e,"url quality","nos::viewImageQuality");a.verifyParamType("quality",e.quality,"number","nos::viewImageQuality");a.verifyParamMin("quality",e.quality,0,"nos::viewImageQuality");a.verifyParamMax("quality",e.quality,100,"nos::viewImageQuality");var t=Math.round(e.quality);var r="quality="+t;var n=(0,o.genUrlSep)(e.url);return e.url+n+r};c.viewImageInterlace=function(e){a.verifyOptions(e,"url","nos::viewImageInterlace");var t="interlace=1";var r=(0,o.genUrlSep)(e.url);return e.url+r+t};c.viewImageRotate=function(e){a.verifyOptions(e,"url angle","nos::viewImageRotate");a.verifyParamType("angle",e.angle,"number","nos::viewImageRotate");for(;e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t=Math.round(e.angle);var r="rotate="+t;var n=(0,o.genUrlSep)(e.url);return e.url+n+r};c.viewImageBlur=function(e){a.verifyOptions(e,"url radius sigma","nos::viewImageBlur");a.verifyParamType("radius",e.radius,"number","nos::viewImageBlur");a.verifyParamMin("radius",e.radius,1,"nos::viewImageBlur");a.verifyParamMax("radius",e.radius,50,"nos::viewImageBlur");a.verifyParamType("sigma",e.sigma,"number","nos::viewImageBlur");a.verifyParamMin("sigma",e.sigma,0,"nos::viewImageBlur");var t=Math.round(e.radius);var r=Math.round(e.sigma);var n="blur="+t+"x"+r;var s=(0,o.genUrlSep)(e.url);return e.url+s+n};c.viewImageCrop=function(e){a.verifyOptions(e,"url x y width height","nos::viewImageCrop");a.verifyParamType("x",e.x,"number","nos::viewImageCrop");a.verifyParamMin("x",e.x,0,"nos::viewImageCrop");a.verifyParamType("y",e.y,"number","nos::viewImageCrop");a.verifyParamMin("y",e.y,0,"nos::viewImageCrop");a.verifyParamType("width",e.width,"number","nos::viewImageCrop");a.verifyParamMin("width",e.width,0,"nos::viewImageCrop");a.verifyParamType("height",e.height,"number","nos::viewImageCrop");a.verifyParamMin("height",e.height,0,"nos::viewImageCrop");var t=Math.round(e.x);var r=Math.round(e.y);var n=Math.round(e.width);var s=Math.round(e.height);var i="crop="+t+"_"+r+"_"+n+"_"+s;var c=(0,o.genUrlSep)(e.url);return e.url+c+i};c.viewImageThumbnail=function(){var e={cover:"z",contain:"x",crop:"y"};return function(t){a.verifyOptions(t,"url mode","nos::viewImageThumbnail");a.verifyParamValid("mode",t.mode,Object.keys(e),"nos::viewImageThumbnail");if("contain"===t.mode)a.verifyParamAtLeastPresentOne(t,"width height","nos::viewImageThumbnail");else a.verifyOptions(t,"width height","nos::viewImageThumbnail");if(a.undef(t.width))t.width=0;if(a.undef(t.height))t.height=0;a.verifyParamType("width",t.width,"number","nos::viewImageThumbnail");a.verifyParamMin("width",t.width,0,"nos::viewImageThumbnail");a.verifyParamType("height",t.height,"number","nos::viewImageThumbnail");a.verifyParamMin("height",t.height,0,"nos::viewImageThumbnail");var r=Math.round(t.width);var n=Math.round(t.height);var s="thumbnail="+r+e[t.mode]+n;if("crop"===t.mode)if(a.notundef(t.axis)){if(a.undef(t.axis.x))t.axis.x=5;if(a.undef(t.axis.y))t.axis.y=5;a.verifyParamMin("axis.x",t.axis.x,0,"nos::viewImageThumbnail");a.verifyParamMax("axis.x",t.axis.x,10,"nos::viewImageThumbnail");a.verifyParamMin("axis.y",t.axis.y,0,"nos::viewImageThumbnail");a.verifyParamMax("axis.y",t.axis.y,10,"nos::viewImageThumbnail");var i=Math.round(t.axis.x);var c=Math.round(t.axis.y);s=s+"&axis="+i+"_"+c}if(a.notundef(t.enlarge)){a.verifyParamType("enlarge",t.enlarge,"boolean","nos::viewImageThumbnail");if(t.enlarge)s+="&enlarge=1"}var u=(0,o.genUrlSep)(t.url);return t.url+u+s}}()},"./src/im/api/base/report.js":function(e,t,r){"use strict";var n=r("./src/im/api/base/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/util/ajax/index.js");var o=r("./src/util/config.js");var a=r("./src/polyfill/weixin-app/platform.js");a=a||{};a.name=a.name||"";a.version=a.version||"";n.reportLogs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=this;var r=t.options;var n=o.ntServerAddress;if(n){var c=o.info;e=s.merge(e,{appkey:r.appKey,uid:r.account,os:"web",session:t.protocol.sdkSession||"",ver:c.sdkVersion,type:t.subType,platform:""+a.name.toLowerCase()+a.version.replace(/(\.\d+)+$/,"")});var u=n+s.genUrlSep(n);var l=[];for(var m in e)l.push(m+"="+e[m]);u+=l.join("&");i(u,{proxyUrl:s.url2origin(u)+"/lbs/res/cors/nej_proxy_frame.html",timeout:o.xhrTimeout,onload:function d(){},onerror:function f(e){t.logger.info("report::ajax report error",e)}})}}},"./src/im/api/nim/audio.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");n.audioToText=function(e){s.verifyOptions(e,"url","audio::audioToText");e.audioToText=s.filterObj(e,"url");var t=this;t.processCallback(e);t.sendCmd("audioToText",e)}},"./src/im/api/nim/chatroom.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/util/config.js");n.getChatroomAddress=function(e){s.verifyOptions(e,"chatroomId","chatroom::getChatroomAddress");var t=this;e.isWeixinApp=i.isWeixinApp;t.processCallback(e);t.sendCmd("getChatroomAddress",e)}},"./src/im/api/nim/connect.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");n.kick=function(e){s.verifyOptions(e,"deviceIds","link::kick");this.processCallback(e);this.sendCmd("kick",{deviceIds:e.deviceIds.slice(0)},e.callback)}},"./src/im/api/nim/db.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;n.clearDB=function(e){var t=this;var r=t.db;t.processCallback(e);var n=e.done;if(r.enable)r.clear().then(n,n);else n()};n.removeDB=function(e){var t=this;var r=t.db;t.processCallback(e);var n=e.done;if(r.enable)r.destroy().then(n,n);else n()};n.closeDB=function(e){var t=this;var r=t.db;t.processCallback(e);var n=e.done;if(r.enable)r.close().then(n,n);else n()}},"./src/im/api/nim/eventService.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){if("object"===("undefined"==typeof e?"undefined":(0,o["default"])(e))){if(e.msgEventSubscribes)e=e.msgEventSubscribes;else if(e.msgEventSubscribe)e=e.msgEventSubscribe;else if(e.accounts)e=e.accounts;else if(e.msgEvent){e=e.msgEvent;
if(e.time)e.time=+e.time}if(1===e.sync)e.sync=!0;else if(0===e.sync)e.sync=!1}return e}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);var a=r("./src/im/api/nim/index.js").fn;var c=r("./src/util/index.js");var u=r("./src/im/model/msgEvent.js");var l=r("./src/im/model/msgEventSubscribe.js");a.batchSendEventsCmds=function(e,t,r){var n=this;var i=100;var o=c.dropArrayDuplicates(t.accounts);o=c.reshape2d(o,i);var a=[];o.forEach(function(r){a.push(new Promise(function(i,o){var a=c.simpleClone(t);a.accounts=r;n.sendCmdWithResp(e,a,function(e,t){if(e)o(e);else i(s(t))})}))});Promise.all(a).then(function(e){var t=null;if(e.length>0)if(e[0].msgEventSubscribe){var n=e[0].msgEventSubscribe;n=s(n);var i=[];e.forEach(function(e){i=i.concat(e.accounts)});t={accounts:i,msgEventSubscribe:n}}else{t=[];e.forEach(function(e){t=t.concat(e)})}r(null,t)},function(e){r(e,null)})};a.publishEvent=function(e){var t=this;var r=new u(e);r=r.assembleEvent();t.processCallback(e);this.sendCmdWithResp("publishEvent",{msgEvent:r},function n(t,r){if(!t)r=s(r);e.callback(t,r)})};a.subscribeEvent=function(e){var t=this;c.verifyOptions(e,"accounts","event::subscribeEvent");var r=new l(e);c.verifyParamType("accounts",e.accounts,"array","event::subscribeEvent");t.processCallback(e);r=r.assembleEvent();this.batchSendEventsCmds("subscribeEvent",{msgEventSubscribe:r,accounts:e.accounts},function(t,r){if(!t&&r)r={failedAccounts:r};e.callback(t,r)})};a.unSubscribeEventsByAccounts=function(e){var t=this;c.verifyOptions(e,"accounts","event::unSubscribeEventsByAccounts");c.verifyParamType("accounts",e.accounts,"array","event::unSubscribeEventsByAccounts");var r=new l(e);r=r.assembleEvent();t.processCallback(e);this.batchSendEventsCmds("unSubscribeEventsByAccounts",{msgEventSubscribe:r,accounts:e.accounts},function(t,r){if(!t&&r)r={failedAccounts:r};e.callback(t,r)})};a.unSubscribeEventsByType=function(e){var t=this;var r=new l(e);r=r.assembleEvent();t.processCallback(e);this.sendCmdWithResp("unSubscribeEventsByType",{msgEventSubscribe:r},function n(t,r){e.callback(t)})};a.querySubscribeEventsByAccounts=function(e){var t=this;c.verifyOptions(e,"accounts","event::querySubscribeEventsByAccounts");c.verifyParamType("accounts",e.accounts,"array","event::querySubscribeEventsByAccounts");var r=new l(e);r=r.assembleEvent();t.processCallback(e);this.batchSendEventsCmds("querySubscribeEventsByAccounts",{msgEventSubscribe:r,accounts:e.accounts},function(t,r){if(!t&&r)r={msgEventSubscribes:r};e.callback(t,r)})};a.querySubscribeEventsByType=function(e){var t=this;var r=new l(e);r=r.assembleEvent();t.processCallback(e);this.sendCmdWithResp("querySubscribeEventsByType",{msgEventSubscribe:r},function n(t,r){if(!t)r={msgEventSubscribes:s(r)};e.callback(t,r)})}},"./src/im/api/nim/friend.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.notundef;var o=r("./src/im/model/friend.js");n.friendRequest=function(e){s.verifyOptions(e,"type account","friend::friendRequest");s.verifyParamValid("type",e.type,o.validTypes(),"friend::friendRequest");this.processPs(e);this.processCallback(e);var t={account:e.account,type:o.getByteFromType(e.type),ps:e.ps};if(i(e.idServer))t.idServer=e.idServer;this.sendCmd("friendRequest",t,e.callback)};n.addFriend=function(e){e.type="addFriend";this.friendRequest(e)};n.applyFriend=function(e){e.type="applyFriend";this.friendRequest(e)};n.passFriendApply=function(e){s.verifyOptions(e,"idServer","friend::passFriendApply");e.type="passFriendApply";this.friendRequest(e)};n.rejectFriendApply=function(e){s.verifyOptions(e,"idServer","friend::rejectFriendApply");e.type="rejectFriendApply";this.friendRequest(e)};n.deleteFriend=function(e){s.verifyOptions(e,"account","friend::deleteFriend");var t=e.delAlias===!0;this.processCallback(e);this.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:t?1:0}},e.callback)};n.updateFriend=function(e){this.processCallback(e);var t=new o(e);this.sendCmd("updateFriend",{friend:t,single:!0},e.callback)};n.getFriends=function(e){function t(){r.sendCmd("getFriends",{timetag:i,NOTSTORE:"timetag"},e.callback)}var r=this;var n=r.db;var i=0;s.verifyOptions(e);r.processCallback(e);if(n.enable)n.getFriendsTimetag().then(function(e){i=e;t()},t);else t()}},"./src/im/api/nim/index.js":function(e,t,r){"use strict";function n(e){var t=this;t.subType="im";t.nosScene=e.nosScene||"im";t.nosSurvivalTime=e.nosSurvivalTime;e.Protocol=i;e.Message=a;e.constructor=n;return t.init(e)}var s=r("./src/im/api/base/index.js");var i=r("./src/im/protocol/im/index.js");var o=r("./src/util/config.js");var a=r("./src/im/model/message/im/index.js");var c=r("./src/im/protocol/parser/index.js").IM;n.Protocol=i;n.parser=c;n.use=s.use;n.getInstance=s.getInstance;n.rmAllInstances=s.rmAllInstances;n.genInstanceName=function(e){return"NIM-account-"+e.account};var u=n.fn=n.prototype=Object.create(s.prototype);n.info=u.info=o.info;e.exports=n;r("./src/im/api/nim/model.js");r("./src/im/api/nim/connect.js");r("./src/im/api/nim/relation.js");r("./src/im/api/nim/user.js");r("./src/im/api/nim/friend.js");r("./src/im/api/nim/robot.js");r("./src/im/api/nim/team.js");r("./src/im/api/nim/superTeam.js");r("./src/im/api/nim/session.js");r("./src/im/api/nim/msg.js");r("./src/im/api/nim/sysMsg.js");r("./src/im/api/nim/chatroom.js");r("./src/im/api/nim/nos.js");r("./src/im/api/nim/nosViewImage.js");r("./src/im/api/nim/audio.js");r("./src/im/api/nim/db.js");r("./src/im/api/nim/notification.js");r("./src/im/api/nim/eventService.js")},"./src/im/api/nim/model.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.isArray;var o=r("./src/im/model/teamMember.js");n.mergeObjArray=function(e,t,r){if(!e)e=[];if(!t)return e;if(!i(t))t=[t];if(!t.length)return e;r=r||{};return s.mergeObjArray(e,t,r)};n.cutObjArray=function(e,t,r){if(!e)return e;if(!t)return e;if(!i(t))t=[t];if(!t.length)return e;r=r||{};return s.cutObjArray(e,t,r)};n.mergeLoginPorts=function(e,t){return this.mergeObjArray(e,t,{keyPath:"deviceId"})};n.cutLoginPorts=function(e,t){return this.cutObjArray(e,t,{keyPath:"deviceId",sortPath:"type"})};n.mergeRelations=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})};n.cutRelations=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})};n.findRelation=function(e,t){return s.findObjInArray(e,{keyPath:"account",value:t})};n.mergeFriends=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})};n.cutFriends=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})};n.cutFriendsByAccounts=function(e,t){if(!i(t))t=[t];var r=t.map(function(e){return{account:e}});return this.cutFriends(e,r)};n.findFriend=function(e,t){return s.findObjInArray(e,{keyPath:"account",value:t})};n.mergeUsers=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})};n.findUser=function(e,t){return s.findObjInArray(e,{keyPath:"account",value:t})};n.mergeTeams=function(e,t){return this.mergeObjArray(e,t,{keyPath:"teamId"})};n.cutTeams=function(e,t){return this.cutObjArray(e,t,{keyPath:"teamId"})};n.findTeam=function(e,t){return s.findObjInArray(e,{keyPath:"teamId",value:t})};n.assembleTeamOwner=o.assembleOwner;n.assembleTeamMembers=o.assembleMembers;n.genTeamMemberId=o.genId;n.mergeTeamMembers=function(e,t){return this.mergeObjArray(e,t)};n.cutTeamMembers=function(e,t){return this.cutObjArray(e,t)};n.cutTeamMembersByAccounts=function(e,t,r){if(!i(r))r=[r];var n=o.assembleMembers({teamId:t},r);return this.cutTeamMembers(e,n)};n.findTeamMember=function(e,t){return s.findObjInArray(e,{keyPath:"id",value:t})};n.mergeSessions=function(e,t){return this.mergeObjArray(e,t,{sortPath:"updateTime",desc:!0})};n.cutSessions=function(e,t){return this.cutObjArray(e,t)};n.cutSessionsByIds=function(e,t){if(!i(t))t=[t];var r=t.map(function(e){return{id:e}});return this.cutSessions(e,r)};n.findSession=function(e,t){return s.findObjInArray(e,{keyPath:"id",value:t})};n.mergeMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idClient",sortPath:"time"})};n.cutMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idClient"})};n.cutMsgsByIdClients=function(e,t){if(!i(t))t=[t];var r=t.map(function(e){return{idClient:e}});return this.cutMsgs(e,r)};n.findMsg=function(e,t){return s.findObjInArray(e,{keyPath:"idClient",value:t})};n.mergeSysMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idServer",desc:!0})};n.cutSysMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idServer"})};n.cutSysMsgsByIdServers=function(e,t){if(!i(t))t=[t];var r=t.map(function(e){return{idServer:e}});return this.cutSysMsgs(e,r)};n.findSysMsg=function(e,t){return s.findObjInArray(e,{keyPath:"idServer",value:t})}},"./src/im/api/nim/msg.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.undef;var o=s.notundef;var a=r("./src/util/device.js");var c=r("./src/im/model/session.js");var u=r("./src/im/model/systemMessage.js");var l=r("./src/im/model/nimerror.js");n.beforeSendMsg=function(e){var t=this;var r=t.protocol;var n=e.msg;if(n.to===t.account)n.fromDeviceId=a.deviceId;n.userUpdateTime=r.myInfo&&r.myInfo.updateTime;var s;switch(n.getScene()){case"p2p":s="sendMsg";break;case"team":s="sendTeamMsg";break;case"superTeam":s="sendSuperTeamMsg"}if(e.filter){s="sendFilterMsg";n.filter=!0}e.cmd=s};n.afterSendMsg=function(e){var t=e.rtnMsg;var r=c.genSessionByMsg(t);this.protocol.onUpdateSession(r)};n.beforeForwardMsg=function(e){s.verifyOptions(e,"msg scene to","msg::beforeForwardMsg");e.msg.scene=e.scene;e.msg.to=e.to};n.markMsgRead=function(e){var t=this;var r=t.protocol;if(e&&!t.db.enable&&!r.options.autoMarkRead)r.markMsgRead(e,!0);else t.logger.warn("api::markMsgRead: 不需要标记消息为已收到 (没有消息, 或者启用了数据库, 或者启用了自动标记已收到)")};n.sendMsgReceipt=function(e){var t=this;s.verifyOptions(e);t.processCallback(e);if(e.msg){var r="target idClient time";s.verifyOptions(e,"msg","msg::sendMsgReceipt");var n=e.msg;s.verifyOptions(n,r,!0,"msg.","msg::sendMsgReceipt");
if(t.protocol.shouldSendMsgReceipt(n))t.sendCmd("sendMsgReceipt",{msgReceipt:{to:n.target,idClient:n.idClient,time:n.time}},e.callback);else e.done()}else e.done()};n.isMsgRemoteRead=function(e){return this.protocol.isMsgRemoteRead(e)};n.deleteMsg=function(e){var t=this;s.verifyOptions(e,"msg","msg::deleteMsg");var r=e.msg;if("team"!==r.scene&&"out"!==r.flow||"success"!==r.status||r.from===r.to||r.isLocal)return e.done(l.newParamError("只能删除自己发送给别人的, 并且发送成功的非本地消息",{callFunc:"msg::deleteMsg"}),e);s.verifyOptions(r,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsg");s.verifyParamValid("msg.scene",r.scene,t.message.validScenes,"msg::deleteMsg");var n=s.simpleClone(r);this.processPs(n);this.processCallback(e);if(o(e.opeAccount))n.opeAccount=e.opeAccount;else if(i(n.opeAccount))n.opeAccount=n.from;if("p2p"===n.scene)n.type="deleteMsgP2p";else n.type="deleteMsgTeam";n.deletedIdClient=n.idClient;n.deletedIdServer=n.idServer;n=new u(n);t.sendCmd("deleteMsg",{sysMsg:n,msg:r},e.callback)};var m={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};n.getHistoryMsgs=function(e){var t=this;s.verifyOptions(e,"scene to","msg::getHistoryMsgs");s.verifyParamValid("scene",e.scene,t.message.validScenes,"msg::getHistoryMsgs");if("undefined"==typeof e.beginTime)e.beginTime=0;s.verifyParamType("beginTime",e.beginTime,"number","msg::getHistoryMsgs");if("undefined"==typeof e.endTime)e.endTime=0;s.verifyParamType("endTime",e.endTime,"number","msg::getHistoryMsgs");if("undefined"==typeof e.lastMsgId||null===e.lastMsgId)e.lastMsgId="0";if("undefined"==typeof e.limit)e.limit=100;s.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs");s.verifyParamMax("limit",e.limit,100,"msg::getHistoryMsgs");if(o(e.reverse))s.verifyParamType("reverse",e.reverse,"boolean","msg::getHistoryMsgs");else e.reverse=!1;if(o(e.asc))s.verifyParamType("asc",e.asc,"boolean","msg::getHistoryMsgs");else e.asc=!1;if(i(e.msgTypes))e.msgTypes=[];else if(Array.isArray(e.msgTypes)){e.msgTypes=e.msgTypes.map(function(e){return m[e]});e.msgTypes=e.msgTypes.filter(function(e){return"number"==typeof e})}else if("number"==typeof m[e.msgTypes])e.msgTypes=[m[e.msgTypes]];else e.msgTypes=[];t.processCallback(e);if(e.asc)e.cbaop=function(e,t){if(!e)t.msgs=t.msgs.reverse()};var r;switch(e.scene){case"p2p":r="getHistoryMsgs";break;case"team":r="getTeamHistoryMsgs";break;case"superTeam":r="getSuperTeamHistoryMsgs"}var n={scene:e.scene,to:e.to,beginTime:e.beginTime,endTime:e.endTime,lastMsgId:e.lastMsgId,limit:e.limit,reverse:e.reverse,msgTypes:e.msgTypes};t.sendCmd(r,n,e.callback)};n.searchHistoryMsgs=function(e){var t=this;s.verifyOptions(e,"scene to keyword","msg::searchHistoryMsgs");s.verifyParamValid("scene",e.scene,t.message.validScenes,"msg::searchHistoryMsgs");if("undefined"==typeof e.beginTime)e.beginTime=0;s.verifyParamType("beginTime",e.beginTime,"number","msg::searchHistoryMsgs");if("undefined"==typeof e.endTime)e.endTime=0;s.verifyParamType("endTime",e.endTime,"number","msg::searchHistoryMsgs");if("undefined"==typeof e.limit)e.limit=100;s.verifyParamType("limit",e.limit,"number","msg::searchHistoryMsgs");s.verifyParamMax("limit",e.limit,100,"msg::searchHistoryMsgs");if(o(e.reverse))s.verifyParamType("reverse",e.reverse,"boolean","msg::searchHistoryMsgs");else e.reverse=!1;if(o(e.asc))s.verifyParamType("asc",e.asc,"boolean","msg::searchHistoryMsgs");else e.asc=!1;t.processCallback(e);if(e.asc)e.cbaop=function(e,t){if(!e)t.msgs=t.msgs.reverse()};var r;switch(e.scene){case"p2p":r="searchHistoryMsgs";break;case"team":r="searchTeamHistoryMsgs"}var n=s.filterObj(e,"scene to beginTime endTime keyword limit reverse");t.sendCmd(r,n,e.callback)};n.getLocalMsgs=function(e){function t(){var t=s.simpleClone(e);t.msgs=c;delete t.callback;delete t.done;e.done(a,t)}var r=this;var n=r.db;var a=null;var c=[];s.verifyOptions(e);var u=!1;if(o(e.start)){u=!0;s.verifyParamType("start",e.start,"number","msg::getLocalMsgs")}var l=!1;if(o(e.end)){l=!0;s.verifyParamType("end",e.end,"number","msg::getLocalMsgs")}if(u&&l&&e.end<=e.start)s.onParamError("参数 end 必须晚于 start");if(i(e.limit))e.limit=100;s.verifyParamType("limit",e.limit,"number","msg::getLocalMsgs");s.verifyParamMin("limit",e.limit,1,"msg::getLocalMsgs");r.processCallback(e);if(n.enable)n.getMsgs(e).then(function(e){c=e;t()},function(e){e=e||{};e.message=e.message||"msg::getLocalMsgs:db error";t()});else t()};n.getLocalMsgByIdClient=function(e){function t(){e.msg=o;e.done(i,e)}var r=this;var n=r.db;var i;var o=null;s.verifyOptions(e,"idClient","msg::getLocalMsgByIdClient");r.processCallback(e);if(n.enable)n.getMsgByIdClient(e.idClient).then(function(e){if(e)o=e;t()},function(e){i=e;t()});else t()};n.getLocalMsgsByIdClients=function(e){function t(){e.msgs=o;e.done(i,e)}var r=this;var n=r.db;var i;var o=[];s.verifyOptions(e,"idClients","msg::getLocalMsgByIdClient");s.verifyParamType("idClients",e.idClients,"array","msg::getLocalMsgByIdClient");r.processCallback(e);if(n.enable)n.getMsgsByIdClients(e.idClients).then(function(e){o=e.filter(function(e){return!!e});t()},function(e){i=e;t()});else t()};n.updateLocalMsg=function(e){function t(){e.msg=o;e.done(i,e)}var r=this;var n=r.db;var i;var o=null;s.verifyOptions(e,"idClient","msg::updateLocalMsg");r.processCallback(e);if(n.enable){var a=s.filterObj(e,"idClient localCustom");n.updateMsg(a).then(function(e){o=e;t()},function(e){i=e;t()})}else t()};n.deleteLocalMsg=function(e){function t(){e.done(n,e)}var r=this;var n;s.verifyOptions(e,"msg","msg::deleteLocalMsg");var i=e.msg;s.verifyOptions(i,"idClient sessionId",!0,"msg.","msg::deleteLocalMsg");r.processCallback(e);r.protocol.deleteLocalMsg(i).then(t,function(e){n=e;t()})};n.deleteLocalMsgsBySession=function(e){function t(e){o=e;r()}function r(){e.done(o,e)}var n=this;var i=n.db;var o;s.verifyOptions(e,"scene to","msg::deleteLocalMsgsBySession");s.verifyParamValid("scene",e.scene,n.message.validScenes,"msg::deleteLocalMsgsBySession");e.sessionId=e.scene+"-"+e.to;e.delLastMsg=e.delLastMsg===!0;n.processCallback(e);if(i.enable)i.deleteMsgsBySessionId(e).then(function(){if(e.delLastMsg)i.updateSession({id:e.sessionId,lastMsg:null}).then(function(t){n.protocol.onUpdateSession(t);e.session=t;r()},t);else r()},t);else{if(e.delLastMsg)n.protocol.onUpdateSession({id:e.sessionId,lastMsg:null});r()}};n.deleteAllLocalMsgs=function(e){function t(){e.done(s,e)}var r=this;var n=r.db;var s;r.processCallback(e);if(n.enable)n.deleteAllMsgs().then(function(){t()},function(e){s=e;t()})};n.clearServerHistoryMsgs=function(e){var t=this;s.verifyOptions(e,"account","msg::clearServerHistoryMsgs");var r=!(e.delRoam===!1);t.processCallback(e);t.sendCmd("clearServerHistoryMsgs",{clearMsgsParams:{account:e.account,delRoam:r?1:0}},e.callback)}},"./src/im/api/nim/nos.js":function(e,t,r){"use strict"},"./src/im/api/nim/nosViewImage.js":function(e,t,r){"use strict"},"./src/im/api/nim/notification.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/im/model/pushNotificationMultiportConfig.js");var i=r("./src/util/index.js");var o=i.undef;n.getPushNotificationMultiportConfig=function(){return this.protocol.getPushNotificationMultiportConfig()};n.updatePushNotificationMultiportConfig=function(e){i.verifyOptions(e);if(o(e.shouldPushNotificationWhenPCOnline))e.shouldPushNotificationWhenPCOnline=!0;e.donnop=new s(e);this.processCallback(e);this.sendCmd("updateDonnop",e)}},"./src/im/api/nim/relation.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");n.markInBlacklist=function(e){s.verifyOptions(e,"account isAdd","relation::markInBlacklist");s.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInBlacklist");this.processCallback(e);this.sendCmd("markInBlacklist",{account:e.account,isAdd:e.isAdd},e.callback)};n.addToBlacklist=function(e){e.isAdd=!0;return this.markInBlacklist(e)};n.removeFromBlacklist=function(e){e.isAdd=!1;return this.markInBlacklist(e)};n.markInMutelist=function(e){s.verifyOptions(e,"account","relation::markInMutelist");s.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInMutelist");this.processCallback(e);this.sendCmd("markInMutelist",{account:e.account,isAdd:e.isAdd},e.callback)};n.addToMutelist=function(e){e.isAdd=!0;return this.markInMutelist(e)};n.removeFromMutelist=function(e){e.isAdd=!1;return this.markInMutelist(e)};n.getRelations=function(e){function t(){r.sendCmd("getRelations",{timetag:i,NOTSTORE:"timetag"},e.callback)}var r=this;var n=r.db;var i=0;e=s.verifyOptions(e);r.processCallback(e);if(n.enable)n.getRelationsTimetag().then(function(e){i=e;t()},t);else t()}},"./src/im/api/nim/robot.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;n.getRobots=function(e){e=e||{};e.type="getRobots";this.processCallback(e);this.sendCmd("sync",{sync:{robots:0}},e.callback)}},"./src/im/api/nim/session.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.undef;var o=s.notundef;n.setCurrSession=function(e){var t=this;t.resetSessionUnread(e);t.protocol.setCurrSession(e)};n.resetAllSessionUnread=function(){var e=this;for(var t in e.protocol.sessionSet)if(e.protocol.sessionSet[t].unread>0)e.resetSessionUnread(t)};n.resetSessionUnread=function(e){var t=this;t.protocol.resetSessionUnread(e);if(t.options.syncSessionUnread){var r=t.protocol.findSession(e);if(r)if(r.lastMsg)if(r.scene&&r.to){var n=r.lastMsg.time;if(!(r&&r.ack&&r.ack>=n)){var s={scene:"p2p"===r.scene?0:1,to:r.to,timetag:n};t.sendCmd("markSessionAck",s)}else t.logger.warn("api::resetSessionUnread: session ack not needs "+e)}else t.logger.warn("api::resetSessionUnread: session.scene|to undefined "+e);else t.logger.warn("api::resetSessionUnread: session.lastMsg undefined "+e);else t.logger.warn("api::resetSessionUnread: session undefined "+e)}};n.resetCurrSession=function(){this.protocol.setCurrSession("")};n.insertLocalSession=function(e){function t(){e.session=i;e.done(n,e);
}var r=this;var n;var i;s.verifyOptions(e,"scene to","scene::insertLocalSession");s.verifyParamValid("scene",e.scene,r.message.validScenes,"scene::insertLocalSession");r.processCallback(e);r.protocol.insertLocalSession(e).then(function(e){i=e;t()},function(e){n=e;t()})};n.getLocalSessions=function(e){function t(){e.sessions=c;e.done(a,e)}var r=this;var n=r.db;var a;var c=[];s.verifyOptions(e);if(i(e.limit))e.limit=100;s.verifyParamType("limit",e.limit,"number","scene::getLocalSessions");s.verifyParamMax("limit",e.limit,100,"scene::getLocalSessions");if(o(e.reverse))s.verifyParamType("reverse",e.reverse,"boolean","scene::getLocalSessions");else e.reverse=!1;r.processCallback(e);if(n.enable)n.getSessions(e).then(function(e){c=e;r.protocol.mergeSessions(c);t()},function(e){a=e;t()});else t()};n.getLocalSession=function(e){function t(){e.done(i,o)}var r=this;var n=r.db;var i;var o=null;s.verifyOptions(e,"sessionId","scene::getLocalSession");s.verifyParamType("sessionId",e.sessionId,"string","scene::getLocalSession");if(!n.enable){if(r.protocol.sessionSet&&r.protocol.sessionSet[e.sessionId])o=r.protocol.sessionSet[e.sessionId];t()}else{r.processCallback(e);n.getSession(e.sessionId).then(function(e){if(e)o=e;t()},function(e){i=e;t()})}};n.updateLocalSession=function(e){function t(){r.protocol.onUpdateSession(o);e.session=o;e.done(i,e)}var r=this;var n=r.db;var i;s.verifyOptions(e,"id","scene::updateLocalSession");r.processCallback(e);var o=s.filterObj(e,"id localCustom");if(n.enable)n.updateSession(o).then(function(e){o=e;t()},function(e){i=e;t()});else t()};n.deleteLocalSession=function(e){function t(){e.done(i,e)}var r=this;var n=r.db;var i;s.verifyOptions(e,"id","session::deleteLocalSession");r.processCallback(e);if(n.enable)n.deleteSession(e.id).then(function(){r.protocol.deleteLocalSession(e.id);t()},function(e){i=e;t()});else t()};n.deleteSession=function(e){s.verifyOptions(e,"scene to","session::deleteSession");this.processCallback(e);e.sessions=[{scene:e.scene,to:e.to}];this.deleteSessions(e)};n.deleteSessions=function(e){s.verifyOptions(e,"sessions","session::deleteSessions");s.verifyParamType("sessions",e.sessions,"array","session::deleteSessions");e.sessions.forEach(function(e,t){s.verifyOptions(e,"scene to",!0,"sessions["+t+"].","session::deleteSessions")});this.processCallback(e);this.sendCmd("deleteSessions",{sessions:e.sessions.map(function(e){return e.scene+"|"+e.to})},e.callback)}},"./src/im/api/nim/superTeam.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.undef;var o=r("./src/im/model/superTeam.js");var a=r("./src/im/model/superTeamMember.js");n.addSuperTeamMembers=function(e){s.verifyOptions(e,"teamId accounts","superTeam::addSuperTeamMembers");s.verifyParamType("accounts",e.accounts,"array","superTeam::addSuperTeamMembers");var t=s.deduplicate(e.accounts);this.processCallback(e);var r={teamId:e.teamId,accounts:t};this.sendCmd("addSuperTeamMembers",r,e.callback)};n.removeSuperTeamMembers=function(e){s.verifyOptions(e,"teamId accounts","team::removeSuperTeamMembers");s.verifyParamType("accounts",e.accounts,"array","team::removeSuperTeamMembers");var t=s.deduplicate(e.accounts);this.processCallback(e);var r={teamId:e.teamId,accounts:t};this.sendCmd("removeSuperTeamMembers",r,e.callback)};n.leaveSuperTeam=function(e){s.verifyOptions(e,"teamId","superTeam::leaveSuperTeam");this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveSuperTeam",t,e.callback)};n.getSuperTeam=function(e){function t(){r.sendCmd("getSuperTeam",{teamId:e.teamId},e.callback)}var r=this;var n=r.db;var i;s.verifyOptions(e,"teamId","team::getSuperTeam");r.processCallback(e);e.cbaop=function(e,t){if(!e)r.logger.log("api::getSuperTeam: cbaop "+i,t)};i=e.teamId;if(n.enable&&!e.sync)n.getSuperTeam(i).then(function(n){if(n){r.logger.log("api::getSuperTeam: db.getSuperTeam "+i,n);e.done(null,n)}else t()},t);else t()};n.getSuperTeams=function(e){function t(){r.sendCmd("getSuperTeams",{timetag:i,NOTSTORE:"timetag"},e.callback)}var r=this;var n=r.db;var i=0;s.verifyOptions(e);r.processCallback(e);if(n.enable)n.getSuperTeamsTimetag().then(function(e){i=e;t()},t);else t()};n.updateSuperTeam=function(e){s.verifyOptions(e,"teamId","superTeam::updateSuperTeam");e.action="update";this.processCallback(e);e.team=new o(e);this.sendCmd("updateSuperTeam",{team:e.team,single:!0},e.callback)};n.updateInfoInSuperTeam=function(e){s.verifyOptions(e,"teamId","superTeam::updateInfoInSuperTeam");this.processCallback(e);this.sendCmd("updateInfoInSuperTeam",{superTeamMember:new a(e),single:!0},e.callback)};n.getSuperTeamMembers=function(e){function t(){r.sendCmd("getSuperTeamMembers",{teamId:e.teamId,timetag:n,needPaging:e.needPaging,pagingParams:e.pagingParams,NOTSTORE:"timetag"},e.callback)}var r=this;var n=0;var i="teamId";var o,a,c;e.needPaging=!!e.needPaging;c=e.needPaging;var i=c?"teamId pagingParams":"teamId";s.verifyOptions(e,i,"superTeam::getSuperTeamMembers");if(c){o=+e.pagingParams.size;a=+e.pagingParams.current;s.verifyParamType("pagingParams.size",o,"number","api::superTeam::getSuperTeamMembers");s.verifyParamType("pagingParams.current",a,"number","api::superTeam::getSuperTeamMembers")}r.processCallback(e);var u=r.db;if(u.enable)u.getSuperTeam(e.teamId).then(function(r){if(r){var s=r.memberUpdateTime;u.getSuperTeamMembersTimetag(e.teamId).then(function(r){if(!isNaN(s)&&!isNaN(r)&&s<=r)u.getSuperTeamMembers(e.teamId).then(function(t){var r={teamId:e.teamId};if(e.needPaging){r.members=t.slice(o*a,(a+1)*o);r.size=o;r.current=a;r.total=t.length}else r.members=t;e.done(null,r)},t);else{n=r;t()}},t)}else t()},t);else t()}},"./src/im/api/nim/sysMsg.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.undef;var o=s.notundef;var a=r("./src/im/model/systemMessage.js");n.markSysMsgRead=function(e){function t(){e.done(i,e)}var r=this;var n=r.db;var i;var o=Promise.resolve();var a=r.protocol;s.verifyOptions(e,"sysMsgs","sysmsg::markSysMsgRead");var c=e.sysMsgs;if(!s.isArray(c))c=[c];if(n.enable)o=n.markSysMsgRead(c).then(function(e){c=e;a.onUpdateSysMsg(e)});else{c=c.filter(function(e){return!e.read});if(c.length){if(!a.options.autoMarkRead)a.markSysMsgRead(c,!0);c.forEach(function(e){e.read=!0});a.onUpdateSysMsg(c)}}o.then(function(){return a.reduceSysMsgUnread(c)}).then(t,function(e){i=e;t()})};n.sendCustomSysMsg=function(e){var t=this;s.verifyOptions(e,"scene to content","sysmsg::sendCustomSysMsg");s.verifyParamValid("scene",e.scene,t.message.validScenes,"sysmsg::sendCustomSysMsg");t.processCallback(e);if("p2p"===e.scene)e.type="customP2p";else e.type="customTeam";e.sysMsg=new a(e);var r="sendCustomSysMsg";if(e.filter)r="sendFilterCustomSysMsg";t.sendCmd(r,{sysMsg:e.sysMsg,single:!0},e.callback);return t.formatReturnSysMsg(e.sysMsg)};n.formatReturnSysMsg=function(e){var t=this;e=s.copy(e);t.protocol.completeSysMsg(e);e.status="sending";e=a.reverse(e);return e};n.getLocalSysMsgs=function(e){function t(){e.sysMsgs=u;e.done(c,e)}var r=this;var n=r.db;var c;var u=[];s.verifyOptions(e);if(e.category)s.verifyParamValid("category",e.category,a.validCategories,"sysmsg::getLocalSysMsgs");if(e.type)s.verifyParamValid("type",e.type,a.validTypes,"sysmsg::getLocalSysMsgs");if(i(e.limit))e.limit=100;s.verifyParamType("limit",e.limit,"number","sysmsg::getLocalSysMsgs");s.verifyParamMax("limit",e.limit,100,"sysmsg::getLocalSysMsgs");if(o(e.reverse))s.verifyParamType("reverse",e.reverse,"boolean","sysmsg::getLocalSysMsgs");else e.reverse=!1;r.processCallback(e);if(n.enable)n.getSysMsgs(e).then(function(e){u=e;t()},function(e){c=e;t()});else t()};n.updateLocalSysMsg=function(e){function t(){e.sysMsg=o;e.done(i,e)}var r=this;var n=r.db;var i;var o=null;s.verifyOptions(e,"idServer","sysmsg::updateLocalSysMsg");r.processCallback(e);if(n.enable){var a=s.filterObj(e,"idServer state localCustom");n.updateSysMsg(a).then(function(e){o=e;t()},function(e){i=e;t()})}else t()};n.deleteLocalSysMsg=function(e){function t(){e.done(i,e)}var r=this;var n=r.db;var i;s.verifyOptions(e,"idServer","sysmsg::deleteLocalSysMsg");r.processCallback(e);if(n.enable)n.deleteSysMsg(e.idServer).then(function(){t()},function(e){i=e;t()});else t()};n.deleteAllLocalSysMsgs=function(e){function t(){n.protocol.onUpdateSysMsgUnread({});e.done(r,e)}var r;var n=this;var s=n.db;n.processCallback(e);if(s.enable)s.deleteAllSysMsgs().then(function(){t()},function(e){r=e;t()})}},"./src/im/api/nim/team.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.undef;var o=r("./src/im/model/team.js");var a=r("./src/im/model/teamMember.js");n.createTeam=function(e){s.verifyOptions(e,"type name","team::createTeam");if(i(e.accounts))e.accounts=[];else s.verifyParamType("accounts",e.accounts,"array","team::createTeam");e.action="create";this.processPs(e);this.processCallback(e);e.team=new o(e);var t={team:e.team,accounts:e.accounts.slice(0),ps:e.ps};this.sendCmd("createTeam",t,e.callback)};n.updateTeam=function(e){s.verifyOptions(e,"teamId","team::updateTeam");e.action="update";this.processCallback(e);e.team=new o(e);this.sendCmd("updateTeam",{team:e.team,single:!0},e.callback)};n.addTeamMembers=function(e){s.verifyOptions(e,"teamId accounts","team::addTeamMembers");s.verifyParamType("accounts",e.accounts,"array","team::addTeamMembers");this.processPs(e);if(s.notexist(e.custom))e.custom="";this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0),ps:e.ps,attach:e.custom};this.sendCmd("addTeamMembers",t,e.callback)};n.removeTeamMembers=function(e){s.verifyOptions(e,"teamId accounts","team::removeTeamMembers");s.verifyParamType("accounts",e.accounts,"array","team::removeTeamMembers");this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0)};this.sendCmd("removeTeamMembers",t,e.callback)};n.acceptTeamInvite=function(e){s.verifyOptions(e,"idServer teamId from","team::acceptTeamInvite");this.processCallback(e);var t={
idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("acceptTeamInvite",t,e.callback)};n.rejectTeamInvite=function(e){s.verifyOptions(e,"idServer teamId from","team::rejectTeamInvite");this.processPs(e);this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectTeamInvite",t,e.callback)};n.applyTeam=function(e){s.verifyOptions(e,"teamId","team::applyTeam");this.processPs(e);this.processCallback(e);var t={teamId:e.teamId,ps:e.ps};this.sendCmd("applyTeam",t,e.callback)};n.passTeamApply=function(e){s.verifyOptions(e,"idServer teamId from","team::passTeamApply");this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("passTeamApply",t,e.callback)};n.rejectTeamApply=function(e){s.verifyOptions(e,"idServer teamId from","team::rejectTeamApply");this.processPs(e);this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectTeamApply",t,e.callback)};n.addTeamManagers=function(e){s.verifyOptions(e,"teamId accounts","team::addTeamManagers");s.verifyParamType("accounts",e.accounts,"array","team::addTeamManagers");this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0)};this.sendCmd("addTeamManagers",t,e.callback)};n.removeTeamManagers=function(e){s.verifyOptions(e,"teamId accounts","team::removeTeamManagers");s.verifyParamType("accounts",e.accounts,"array","team::removeTeamManagers");this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0)};this.sendCmd("removeTeamManagers",t,e.callback)};n.updateInfoInTeam=function(e){s.verifyOptions(e,"teamId","team::updateInfoInTeam");this.processCallback(e);this.sendCmd("updateInfoInTeam",{teamMember:new a(e),single:!0},e.callback)};n.updateNickInTeam=function(e){s.verifyOptions(e,"teamId account","team::updateNickInTeam");this.processCallback(e);this.sendCmd("updateNickInTeam",{teamMember:new a(e),single:!0},e.callback)};n.updateMuteStateInTeam=function(e){var t=this;s.verifyOptions(e,"teamId account mute","team::updateMuteStateInTeam");t.processCallback(e);e.mute=e.mute?1:0;t.sendCmd("updateMuteStateInTeam",e)};n.getMutedTeamMembers=function(e){var t=this;s.verifyOptions(e,"teamId","team::getMutedTeamMembers");t.processCallback(e);t.sendCmd("getMutedTeamMembers",e)};n.leaveTeam=function(e){s.verifyOptions(e,"teamId","team::leaveTeam");this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveTeam",t,e.callback)};n.transferTeam=function(e){s.verifyOptions(e,"teamId account leave","team::transferTeam");s.verifyParamType("leave",e.leave,"boolean","team::transferTeam");this.processCallback(e);var t={teamId:e.teamId,account:e.account,leave:e.leave};this.sendCmd("transferTeam",t,e.callback)};n.dismissTeam=function(e){s.verifyOptions(e,"teamId","team::dismissTeam");this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("dismissTeam",t,e.callback)};n.getTeam=function(e){function t(){r.sendCmd("getTeam",{teamId:e.teamId},e.callback)}var r=this;var n=r.db;var i;s.verifyOptions(e,"teamId","team::getTeam");r.processCallback(e);e.cbaop=function(e,t){if(!e)r.logger.log("api::getTeam: cbaop "+i,t)};i=e.teamId;if(n.enable&&!e.sync)n.getTeam(i).then(function(n){if(n&&n.validToCurrentUser){r.logger.log("api::getTeam: db.getTeam "+i,n);e.done(null,n)}else t()},t);else t()};n.getTeams=function(e){function t(){r.sendCmd("getTeams",{timetag:i,NOTSTORE:"timetag"},e.callback)}var r=this;var n=r.db;var i=0;s.verifyOptions(e);r.processCallback(e);if(n.enable)n.getTeamsTimetag().then(function(e){i=e;t()},t);else t()};n.getTeamMembers=function(e){function t(){r.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:n,NOTSTORE:"timetag"},e.callback)}var r=this;var n=0;s.verifyOptions(e,"teamId","team::getTeamMembers");r.processCallback(e);t()};n.getTeamMemberByTeamIdAndAccount=function(e){function t(){r.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:n,NOTSTORE:"timetag"},function(t,r,n){var s={};if(r&&r.members&&r.members.length)for(var i=0;i<r.members.length;i++)if(r.members[i].account===e.account){s[e.account]=r.members[i];break}e.callback(t,s,n)})}var r=this;var n=0;s.verifyParamType("teamId",e.teamId,"numeric or numeric string","team::getTeamMemberByTeamIdAndAccount");s.verifyOptions(e,"account","team::getTeamMemberByTeamIdAndAccount");r.processCallback(e);t()};n.getTeamMemberInvitorAccid=function(e){var t=this;var r=0;s.verifyParamType("teamId",e.teamId,"numeric or numeric string","team::getTeamMemberInvitorAccid");if(!i(e.accounts)){s.verifyParamType("accounts",e.accounts,"array","team::getTeamMemberInvitorAccid");if(e.accounts.length>200)s.onParamError("accounts 参数数组长度不能超过200","team::getTeamMemberInvitorAccid")}var n={teamId:e.teamId};if(e.accounts.length)n.accounts=e.accounts.slice(0);t.processCallback(e);t.sendCmd("getTeamMemberInvitorAccid",n,function(t,r,n){e.callback(t,n&&n.accountsMap||{})})};n.notifyForNewTeamMsg=function(e){var t=this;s.verifyOptions(e,"teamIds","team::notifyForNewTeamMsg");var r=t.protocol.notifyForNewTeamMsg(e.teamIds);r.then(function(t){e.done(null,t)},function(t){e.done(t)})};n.getMyTeamMembers=function(e){var t=this;s.verifyOptions(e,"teamIds","team::getMyTeamMembers");var r=t.processCallbackPromise(e);t.sendCmd("getMyTeamMembers",e);return r};n.getLocalTeams=function(e){function t(){e.teams=o;e.done(i,e)}var r=this;var n=r.db;var i;var o=[];s.verifyOptions(e,"teamIds","team::getLocalTeams");s.verifyParamType("teamIds",e.teamIds,"array","team::getLocalTeams");r.processCallback(e);if(n.enable)n.getTeamsByTeamIds(e.teamIds).then(function(e){o=e.filter(function(e){return!!e});t()},function(e){i=e;t()});else t()};n.getLocalTeamMembers=function(e){function t(){e.members=o;e.done(i,e)}var r=this;var n=r.db;var i;var o=[];s.verifyOptions(e,"teamId accounts","team::getLocalTeamMembers");s.verifyParamType("accounts",e.accounts,"array","team::getLocalTeamMembers");r.processCallback(e);if(n.enable)n.getInvalidTeamMembers(e.teamId,e.accounts).then(function(e){o=e.filter(function(e){return!!e});t()},function(e){i=e;t()});else t()};n.deleteLocalTeam=function(e){function t(){e.done(i,e)}var r=this;var n=r.db;var i;s.verifyOptions(e,"teamId","team::deleteLocalTeam");r.processCallback(e);if(n.enable)n.deleteTeam(e.teamId).then(function(){t()},function(e){i=e;t()});else t()};n.muteTeamAll=function(e){var t=this;s.verifyOptions(e,"teamId type","team::muteTeamAll");switch(e.type){case"none":e.muteType=0;break;case"normal":e.muteType=1;break;case"all":e.muteType=2;break;default:e.muteType=1}t.processCallback(e);t.sendCmd("muteTeamAll",e)};n.sendTeamMsgReceipt=function(e){var t=this;s.verifyOptions(e,"teamMsgReceipts","team::sendTeamMsgReceipt");t.processCallback(e);t.sendCmd("sendTeamMsgReceipt",e)};n.getTeamMsgReads=function(e){var t=this;s.verifyOptions(e,"teamMsgReceipts","team::getTeamMsgReads");t.processCallback(e);t.sendCmd("getTeamMsgReads",e)};n.getTeamMsgReadAccounts=function(e){var t=this;s.verifyOptions(e,"teamMsgReceipt","team::getTeamMsgReadAccounts");t.processCallback(e);t.sendCmd("getTeamMsgReadAccounts",e)}},"./src/im/api/nim/user.js":function(e,t,r){"use strict";var n=r("./src/im/api/nim/index.js").fn;var s=r("./src/util/index.js");var i=s.objs2accounts;var o=r("./src/im/model/user.js");n.updateMyInfo=function(e){s.verifyOptions(e);this.processCallback(e);e.user=new o(e);delete e.user.account;this.sendCmd("updateMyInfo",{user:e.user,single:!0},e.callback)};n.getMyInfo=function(e){var t=this;e=e||{};e.account=t.account;return t.getUser(e)};n.getUser=function(e){function t(){r.sendCmd("getUsers",{accounts:[i],single:!0},e.callback)}var r=this;var n=r.db;var i;s.verifyOptions(e,"account","user::getUser");r.processCallback(e);e.cbaop=function(e,t){if(!e){t=t[0]||null;r.logger.log("api::getUser: cbaop "+i,t);return t}};i=e.account;if(e.sync)t();else if(n.enable)n.getUser(i).then(function(n){if(n){r.logger.log("api::getUser: db.getUser "+i,n);e.done(null,n)}else t()},t);else t()};n.getUsers=function(e){function t(){r.sendCmd("getUsers",{accounts:o,single:!0},e.callback)}var r=this;var n=r.db;var o;var a=[];s.verifyOptions(e,"accounts","user::getUsers");s.verifyParamType("accounts",e.accounts,"array","user::getUsers");r.processCallback(e);e.cbaop=function(e,t){if(!e){t=t.concat(a);r.logger.log("api::getUsers: cbaop "+o,t);return t}};o=s.deduplicate(e.accounts);s.verifyArrayMax("accounts",e.accounts,150,"user::getUsers");if(e.sync)t();else if(n.enable)n.getUsers(o).then(function(n){if(n&&n.length===o.length){r.logger.log("api::getUsers: db.getUsers",n);e.done(null,n)}else{a=n;var s=i(n);var c=[];o.forEach(function(e){if(s.indexOf(e)===-1)c.push(e)});o=c;t()}},t);else t()}},"./src/im/db/broadcastMsg.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i=s.notundef;var o="broadcastMsg";n.putBroadcastMsg=function(e){var t=this;return new Promise(function(r){function n(){a--;if(0===a)r(i)}if(!s.isArray(e))e=[e];var i=[];var a=e.length;e.forEach(function(e){e=s.copy(e);t.put(o,e).then(function(e){i.push(e[0]);n()},n)})})};n.getBroadcastMsgs=function(e){var t=this;e=e||{};return t.getAll(o,e)}},"./src/im/db/friend.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i="friend";n.mergeFriends=function(e,t,r){var n=this;return n.updateAndDelete(i,e,t).then(function(){n.logger.log("db::mergeFriends: updateAndDelete done",e);if(r)n.updateFriendTimetag(r);return[e,t,r]})};n.putFriend=function(e){return this.put(i,e)};n.updateFriend=function(e){var t=this;e=s.copy(e);var r=e.account;return this.getOne(i,null,r,{modifyObj:e}).then(function(n){if(n)t.logger.log("db::updateFriend: "+r,e);else t.logger.warn("db::updateFriend: no record "+r);return n})};n.deleteFriend=function(e){var t=this;var r=t.remove(i,e);var n=t.deleteUser(e);return Promise.all([r,n])};n.getFriends=function(){var e=function t(e){return e.valid};return this.getAll(i,{filter:e})};n.getFriend=function(e){return this.getOne(i,null,e)}},"./src/im/db/index.js":function(e,t,r){
"use strict";var n=r("./src/polyfill/libDb/general.js");n.fn=n.prototype;e.exports=n;r("./src/im/db/kv.js");r("./src/im/db/timetag.js");r("./src/im/db/relation.js");r("./src/im/db/friend.js");r("./src/im/db/team.js");r("./src/im/db/superTeam.js");r("./src/im/db/user.js");r("./src/im/db/msg.js");r("./src/im/db/sysMsg.js");r("./src/im/db/broadcastMsg.js");r("./src/im/db/session.js")},"./src/im/db/kv.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s="kv";n.setKey=function(e,t){return this.put(s,{key:e,value:t})};n.getKey=function(e){return this.get(s,e).then(function(e){return e&&e.value})};n.setDonnop=function(e){return this.setKey("donnop",e)};n.getDonnop=function(){return this.getKey("donnop")}},"./src/im/db/msg.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/util/config.js");var o="session";var a="msg1";var c="sessionId";var u="time";var l="status";var m="sessionTime";n.putMsg=function(e){var t=this;if(!s.isArray(e))e=[e];if(!e.length||e[0].filter)return Promise.resolve();e=e.filter(function(e){return!e.ignore});return t.put(a,e)};n.updateMsg=function(e){var t=this;if(!e.filter){var r=e.idClient;var n=s.filterObj(e,"resend status idServer time localCustom");return t.getOne(a,null,r,{modifyObj:n}).then(function(e){if(e)t.logger.log("db::updateMsg: "+r,n);else t.logger.warn("db::updateMsg: no record "+r);return e})}};n.getMsgs=function(e){if(i.isBrowser)return this.getMsgsIndexedDB(e);else if(i.isRN)return this.getMsgsRN(e);else return Promise.resolve()};n.getMsgsRN=function(e){var t=this;var r={};if("number"==typeof e.start)r.lowerBound=["time",e.start];if("number"==typeof e.end&&e.end!==1/0)r.upperBound=["time",e.end];r.desc=!1;r.sortIndex="time";if("boolean"==typeof e.desc)r.desc=e.desc;if("number"==typeof e.limit)r.limit=e.limit;r.searchIndex=[];if(e.sessionId)r.searchIndex.push(["sessionId",e.sessionId]);if("string"==typeof e.type)r.searchIndex.push(["type",e.type]);return t.getAll(a,r)};n.getMsgsIndexedDB=function(e){var t=this;t.checkDB();e=e||{};var r=u;var n=!1;var i=!1;var o=e.sessionId||[];var c=e.sessionIds||[];if(s.isString(o))o=[o];else if(!Array.isArray(o))o=[];if(s.isString(c))c=[c];else if(!Array.isArray(c))c=[];var l=o.concat(c);if(1===l.length){n=!0;r=m;o=l[0]}else if(l.length>1){n=!0;i=!0;c=l}var d=e.start||0;var f=e.end||1/0;var p=d;var g=f;if(n&&!i){p=[o,d];g=[o,f]}var v=e.desc!==!1;var y=e.limit||100;var h=!1;var b=!1;var T=e.type||[];var M=e.types||[];if(s.isString(T))T=[T];else if(!Array.isArray(T))T=[];if(s.isString(M))M=[M];else if(!Array.isArray(M))M=[];var S=T.concat(M);if(1===S.length){h=!0;T=S[0]}else if(S.length>1){h=!0;b=!0;M=S}var j=e.keyword||"";var k=e.filterFunc;var _=void 0;if(i||h||j||s.isFunction(k))_=function I(e){if(i&&c.indexOf(e.sessionId)===-1)return!1;if(h)if(b){if(M.indexOf(e.type)===-1)return!1}else if(T!==e.type)return!1;if(j){var t=e.text||e.tip||"";if(t.indexOf(j)===-1)return!1}if(k)return k(e);else return!0};return t.server.query(a,r).bound(p,g,!0,!0).desc(v).limit(y).filter(_).execute()};n.getMsgCountAfterAck=function(e){if(i.isBrowser)return this.getMsgCountAfterAckIndexedDB(e);else if(i.isRN)return this.getMsgCountAfterAckRN(e);else return Promise.resolve()};n.getMsgCountAfterAckRN=function(e){var t=this;e=e||{};var r=e,n=r.sessionId,s=r.ack;t.checkDB();return t.getAll(a,{searchIndex:["sessionId",n],lowerBound:["time",s]}).then(function(t){var r=t.filter(function(t){if("out"===t.flow)return!1;else if("notification"===t.type)if(e.shouldCountNotifyUnread(t))return!0;else return!1;return!0});return Promise.resolve(r.length)})};n.getMsgCountAfterAckIndexedDB=function(e){var t=this;e=e||{};var r=e,n=r.sessionId;t.checkDB();return t.server.query(a,m).bound([n,e.ack],[n,1/0],!0,!0).execute().then(function(t){var r=t.filter(function(t){if("out"===t.flow)return!1;else if("notification"===t.type)if(e.shouldCountNotifyUnread(t))return!0;else return!1;return!0});return Promise.resolve(r.length)})};n.amendMsg=function(e){if(e){if(s.notexist(e.text))e.text="";return e}else return null};n.getMsgByIdClient=function(e){var t=this;return t.getOne(a,null,e).then(function(e){return t.amendMsg(e)})};n.getMsgsByIdClients=function(e){var t=this;var r=[];var n;e.forEach(function(e){n=t.getMsgByIdClient(e);r.push(n)});return Promise.all(r)};n.clearSendingMsgs=function(){var e=this;return e.getOnly(a,l,"sending",{modifyObj:{status:"fail"}}).then(function(t){e.logger.log("db::clearSendingMsgs: msgs send failed",t)})};n.deleteMsg=function(e){var t=this;var r=[];var n;if(!s.isArray(e))e=[e];e.forEach(function(e){n=t.getOne(a,null,e,{remove:!0}).then(function(e){t.logger.log("db::deleteMsg:",e);return e});r.push(n)});return 1===r.length?r[0]:Promise.all(r)};n.deleteMsgsBySessionId=function(e){var t=this;return t.getOnly(a,c,e.sessionId,{remove:!0})};n.deleteAllMsgs=function(){var e=this;var t=e.clearTable(a);var r=e.clearTable(o);return Promise.all([t,r])}},"./src/im/db/relation.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i="blacklist";var o="mutelist";n.mergeRelations=function(e,t,r,n,s){var a=this;var c=a.updateAndDelete(i,e,t);var u=a.updateAndDelete(o,r,n);return Promise.all([c,u]).then(function(){a.logger.log("db::mergeRelations: timetag "+s);a.updateRelationTimetag(s);return[e,t,r,n,s]})};n.getRelations=function(){var e=this;var t=e.getAll(i);var r=e.getAll(o);return Promise.all([t,r])};n.markInBlacklist=function(e){var t=this;e=s.copy(e);if(e.isAdd){var r=e.record;return t.put(i,r)}else{var n=e.account;return t.remove(i,n)}};n.markInMutelist=function(e){var t=this;e=s.copy(e);if(e.isAdd){var r=e.record;return t.put(o,r)}else{var n=e.account;return t.remove(o,n)}}},"./src/im/db/session.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i=s.notundef;var o="session";var a="updateTime";n.putSession=function(e){e=s.merge({},e);if("undefined"==typeof e.updateTime)if(e.lastMsg&&e.lastMsg.time)e.updateTime=e.lastMsg.time;delete e.unread;return this.modifyOrPut({table:o,obj:e,key:"id",modifyObjWhenPut:{unread:0}})};n.getSessions=function(e){e=e||{};var t=!e.reverse;var r=e.limit||100;var n=e.lastSessionId;var s=e.sessionId;var c=!1;var u;if(i(n))u=function l(e){if(c)return!0;else{if(e.id===n)c=!0;return!1}};else if(i(s))return this.get(o,s);return this.getAll(o,{index:a,desc:t,limit:r,filter:u})};n.getSession=function(e){return this.get(o,e)};n.updateSession=function(e){var t=this;var r=e.id;var n=s.filterObj(e,"ack unread lastMsg localCustom msgReceiptTime msgReceiptServerTime");Object.keys(e).forEach(function(t){if(0===t.indexOf("last"))n[t]=e[t]});return this.getOne(o,null,r,{modifyObj:n}).then(function(e){if(e)t.logger.log("db::updateSession: "+r,n);else t.logger.warn("db::updateSession: no record "+r);return e})};n.resetSessionUnread=function(e){return this.updateSession({id:e,unread:0})};n.deleteSession=function(e){return this.remove(o,e)}},"./src/im/db/superTeam.js":function(e,t,r){"use strict";function n(e){return e.valid&&e.validToCurrentUser}function s(e){return e&&e.valid}function i(e){if(e)a.fillUndef(e,{mute:!1,custom:""});return e}var o=r("./src/im/db/index.js").fn;var a=r("./src/util/index.js");var c=r("./src/im/model/nimerror.js");var u=r("./src/im/model/superTeam.js");var l=r("./src/im/model/superTeamMember.js");var m="superTeam";var d="teamId";var f="account";var p="superTeamMember";o.mergeSuperTeams=function(e,t,r){var n=this;var s=n.put(m,e);var i=n.leaveTeams(t,r);return Promise.all([s,i]).then(function(){n.logger.log("db::mergeSuperTeams:");n.updateSuperTeamTimetag(r);return[e,t,r]})};o.putSuperTeam=function(e){if(e){if(!a.isArray(e))e=[e];e.forEach(function(e){e.validToCurrentUser=!0});return this.put(m,e)}};o.updateSuperTeam=function(e){var t=this;e=a.copy(e);var r=e.teamId;return t.getOne(m,null,r,{modifyObj:e}).then(function(n){if(n)t.logger.log("db::updateSuperTeam: "+r,e);else{t.logger.warn("db::updateSuperTeam: no record "+r);return t.putSuperTeam(e)}return n})};o.leaveSuperTeam=function(e){var t=this;return t.updateSuperTeam({teamId:e,validToCurrentUser:!1}).then(function(){return t.removeAllSuperTeamMembers(e)})};o.dismissSuperTeam=function(e,t){var r=this;var n={teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t};return r.updateSuperTeam(n).then(function(){return r.removeAllSuperTeamMembers(e)})};o.leaveSuperTeams=function(e,t){var r=this;var n=[];var s;e.forEach(function(e){s=r.leaveSuperTeam(e.teamId,t);n.push(s)});return Promise.all(n)};o.getSuperTeamsByTeamIds=function(e){var t=this;var r=[];var n;e.forEach(function(e){n=t.getSuperTeam(e);r.push(n)});return Promise.all(r)};o.getSuperTeam=function(e){e=""+e;var t=this;return t.getOne(m,null,e).then(function(e){if(!e)return null;t.updateSuperTeamProperties([e]);return e})};o.getSuperTeams=function(){var e=this;return e.getAll(m,{filter:n}).then(function(t){e.updateSuperTeamProperties(t);return t})};o.updateSuperTeamProperties=function(e){e.forEach(function(e){if(e)u.fillProperties(e)})};o.mergeSuperTeamMembers=function(e,t,r,n){var s=this;var i=s.putSuperTeamMembers(t);var o=s.updateSuperTeamMembers(r);return Promise.all([i,o]).then(function(){s.logger.log("db::mergeSuperTeamMembers: "+e);return s.updateSuperTeamMemberTimetag(e,n)})};o.putSuperTeamMembers=function(e){return this.put(p,e)};o.getSuperTeamMembersByAccount=function(e){var t=this;return t.getOnly(p,f,e,{filter:s,mapper:i}).then()};o.getSuperTeamMembers=function(e){var t=this;e=""+e;var r=function n(e){return e.valid};return t.getOnly(p,d,e,{filter:r,mapper:i}).then(function(e){return t.updateSuperTeamMemberProperties(e).then(function(){return e})})};o.updateSuperTeamMemberProperties=function(e){var t=this;var r=[];var n;e.forEach(function(e){if(l.fillProperties(e)){n=t.updateSuperTeamMember(e);r.push(n)}});return Promise.all(r)};o.getInvalidSuperTeamMembers=function(e,t){var r=this;e=""+e;var n=[];var s;t.forEach(function(t){s=r.getOne(p,"id",l.genId(e,t)).then(function(e){
return i(e)});n.push(s)});return Promise.all(n)};o.updateSuperTeamMember=function(e){var t=this;var r=e.teamId;var n=e.account;var s=l.genId(r,n);var o=a.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne(p,"id",s,{modifyObj:o,mapper:i}).then(function(e){if(e)t.logger.log("db::updateSuperTeamMember: "+r+" "+n,o);else t.logger.warn("db::updateSuperTeam: no record "+r+" "+n);return e})};o.updateSuperTeamMembers=function(e){var t=this;if(!e.length)return Promise.resolve();var r=[];var n;e.forEach(function(e){n=t.updateSuperTeamMember(e);r.push(n)});return Promise.all(r)};o.removeSuperTeamMembersByAccounts=function(e,t){var r=t.map(function(t){return{teamId:e,account:t,valid:!1}});return this.updateSuperTeamMembers(r)};o.removeAllSuperTeamMembers=function(e){var t=this;var r={valid:!1};return t.getOnly(p,d,e,{modifyObj:r}).then(function(){t.logger.warn("db::removeAllSuperTeamMembers: "+e);return t.deleteSuperTeamMemberTimetag(e)})};o.deleteSuperTeamMembers=function(e){var t=this;return t.getOnly(p,d,e,{remove:!0}).then(function(){t.logger.warn("db::deleteTeamMembers: "+e);t.deleteSuperTeamMemberTimetag(e)})};o.deleteSuperTeam=function(e){var t=this;var r=[];var s;if(!a.isArray(e))e=[e];e.forEach(function(e){e=""+e;s=t.get(m,e).then(function(r){if(r&&n(r))throw c.stillInTeamError({callFunc:"team::deleteTeam",team:r});else{var s=t.remove(m,e);var i=t.deleteSuperTeamMembers(e);return Promise.all([s,i])}});r.push(s)});return 1===r.length?r[0]:Promise.all(r)}},"./src/im/db/sysMsg.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i=s.notundef;var o="sysMsg";var a="idServer";var c="type";var u="category";var l="sysMsgUnread";n.putSysMsg=function(e){var t=this;return new Promise(function(r){function n(){a--;if(0===a)r(i)}if(!s.isArray(e))e=[e];if(!e[0].filter){var i=[];var a=e.length;e.forEach(function(e){e=s.copy(e);t.put(o,e).then(function(e){i.push(e[0]);n()},n)})}})};n.getSysMsgs=function(e){var t=this;e=e||{};var r=!e.reverse;var n=e.limit||100;var s=null;var a=null;if(e.category){s=u;a=e.category}if(e.type){s=c;a=e.type}var l=e.lastIdServer;var m=!1;var d=e.read;var f;if(i(l)||i(d))f=function p(e){function t(){if(i(d))return e.read===d;else return!0}if(i(l)){l=""+l;if(m)return t();else{if(e.idServer===l)m=!0;return!1}}return t()};e={filter:f,desc:r,limit:n};if(!s)return t.getAll(o,e);else return t.getOnly(o,s,a,e)};n.getSysMsgByIdServer=function(e){return this.getOne(o,a,e)};n.updateSysMsg=function(e){var t=this;if(!e.filter){var r=""+e.idServer;var n=s.filterObj(e,"read state error localCustom");return this.getOne(o,a,r,{modifyObj:n}).then(function(e){if(e)t.logger.log("db::updateSysMsg: "+r,n);else t.logger.warn("db::updateSession: "+r);return e})}};n.markSysMsgRead=function(e){var t=this;return new Promise(function(r,n){if(!s.isArray(e))e=[e];var i=[];var o;var a=[];var c;e.forEach(function(e){o=t.getSysMsgByIdServer(e.idServer).then(function(e){if(e&&!e.read){c=t.updateSysMsg({idServer:e.idServer,read:!0});a.push(c)}},n);i.push(o)});Promise.all(i).then(function(){Promise.all(a).then(function(e){r(e)},n)},n)})};n.deleteSysMsg=function(e){var t=this;var r=[];var n;if(!s.isArray(e))e=[e];e.forEach(function(e){e=""+e;n=t.getOne(o,a,e,{remove:!0});r.push(n)});return 1===r.length?r[0]:Promise.all(r)};n.deleteAllSysMsgs=function(){var e=this;var t=e.clearTable(o);var r=e.clearTable(l);return Promise.all([t,r])};n.getSysMsgUnread=function(){return this.getAll(l).then(function(e){var t={};e.forEach(function(e){t[e.type]=e.num});return t})};n.updateSysMsgUnread=function(e){var t=this;e=s.copy(e);var r=[];Object.keys(e).forEach(function(t){r.push({type:t,num:e[t]})});return this.put(l,r).then(function(){t.logger.log("db::updateSysMsgUnread: ",e);return e})}},"./src/im/db/team.js":function(e,t,r){"use strict";function n(e){return e.valid&&e.validToCurrentUser}function s(e){return e&&e.valid}function i(e){if(e)a.fillUndef(e,{mute:!1,custom:""});return e}var o=r("./src/im/db/index.js").fn;var a=r("./src/util/index.js");var c=r("./src/im/model/nimerror.js");var u=r("./src/im/model/team.js");var l=r("./src/im/model/teamMember.js");var m="team";var d="teamId";var f="account";var p="teamMember";o.mergeTeams=function(e,t,r){var n=this;var s=n.put(m,e);var i=n.leaveTeams(t,r);return Promise.all([s,i]).then(function(){n.logger.log("db::mergeTeams:");n.updateTeamTimetag(r);return[e,t,r]})};o.putTeam=function(e){if(e){if(!a.isArray(e))e=[e];e.forEach(function(e){e.validToCurrentUser=!0});return this.put(m,e)}};o.updateTeam=function(e){var t=this;e=a.copy(e);var r=e.teamId;return t.getOne(m,null,r,{modifyObj:e}).then(function(n){if(n)t.logger.log("db::updateTeam: "+r,e);else{t.logger.warn("db::updateTeam: no record "+r);if(e.validToCurrentUser)return t.putTeam(e)}return n})};o.transferTeam=function(e,t,r){var n=this;var s=e.teamId;var i=e.memberUpdateTime;var o={teamId:s,account:t,type:"normal",updateTime:i};var a={teamId:s,account:r,type:"owner",updateTime:i};return n.updateTeamMembers([o,a]).then(function(){return n.putTeam(e).then(function(){n.logger.log("db::transferTeam: "+e.teamId+" "+t+" -> "+r);return[e,t,r]})})};o.leaveTeam=function(e){var t=this;return t.updateTeam({teamId:e,validToCurrentUser:!1}).then(function(){return t.removeAllTeamMembers(e)})};o.dismissTeam=function(e,t){var r=this;var n={teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t};return r.updateTeam(n).then(function(){return r.removeAllTeamMembers(e)})};o.leaveTeams=function(e,t){var r=this;var n=[];var s;e.forEach(function(e){s=r.leaveTeam(e.teamId,t);n.push(s)});return Promise.all(n)};o.getTeamsByTeamIds=function(e){var t=this;var r=[];var n;e.forEach(function(e){n=t.getTeam(e);r.push(n)});return Promise.all(r)};o.getTeam=function(e){e=""+e;var t=this;return t.getOne(m,null,e).then(function(e){if(!e)return null;t.updateTeamProperties([e]);return e})};o.getTeams=function(){var e=this;return e.getAll(m,{filter:n}).then(function(t){e.updateTeamProperties(t);return t})};o.updateTeamProperties=function(e){e.forEach(function(e){if(e)u.fillProperties(e)})};o.mergeTeamMembers=function(e,t,r,n){var s=this;var i=s.putTeamMembers(t);var o=s.updateTeamMembers(r);return Promise.all([i,o]).then(function(){s.logger.log("db::mergeTeamMembers: "+e);return s.updateTeamMemberTimetag(e,n)})};o.putTeamMembers=function(e){return this.put(p,e)};o.getTeamMembersByAccount=function(e){var t=this;return t.getOnly(p,f,e,{filter:s,mapper:i}).then()};o.getTeamMembers=function(e){var t=this;e=""+e;var r=function n(e){return e.valid};return t.getOnly(p,d,e,{filter:r,mapper:i}).then(function(e){return t.updateTeamMemberProperties(e).then(function(){return e})})};o.updateTeamMemberProperties=function(e){var t=this;var r=[];var n;e.forEach(function(e){if(l.fillProperties(e)){n=t.updateTeamMember(e);r.push(n)}});return Promise.all(r)};o.getInvalidTeamMembers=function(e,t){var r=this;e=""+e;var n=[];var s;t.forEach(function(t){s=r.getOne(p,null,l.genId(e,t)).then(function(e){return i(e)});n.push(s)});return Promise.all(n)};o.updateTeamMember=function(e){var t=this;var r=e.teamId;var n=e.account;var s=l.genId(r,n);var o=a.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne(p,null,s,{modifyObj:o,mapper:i}).then(function(e){if(e)t.logger.log("db::updateTeamMember: "+r+" "+n,o);else t.logger.warn("db::updateTeam: no record "+r+" "+n);return e})};o.updateTeamMembers=function(e){var t=this;if(!e.length)return Promise.resolve();var r=[];var n;e.forEach(function(e){n=t.updateTeamMember(e);r.push(n)});return Promise.all(r)};o.updateTeamManagers=function(e,t,r,n){var s=t.map(function(t){return{teamId:e,account:t,type:r?"manager":"normal",updateTime:n}});return this.updateTeamMembers(s)};o.removeTeamMembersByAccounts=function(e,t){var r=t.map(function(t){return{teamId:e,account:t,valid:!1}});return this.updateTeamMembers(r)};o.removeAllTeamMembers=function(e){var t=this;var r={valid:!1};return t.getOnly(p,d,e,{modifyObj:r}).then(function(){t.logger.warn("db::removeAllTeamMembers: "+e);return t.deleteTeamMemberTimetag(e)})};o.deleteTeamMembers=function(e){var t=this;return t.getOnly(p,d,e,{remove:!0}).then(function(){t.logger.warn("db::deleteTeamMembers: "+e);t.deleteTeamMemberTimetag(e)})};o.deleteTeam=function(e){var t=this;var r=[];var s;if(!a.isArray(e))e=[e];e.forEach(function(e){e=""+e;s=t.get(m,e).then(function(r){if(r&&n(r))throw c.stillInTeamError({callFunc:"team::deleteTeam",team:r});else{var s=t.remove(m,e);var i=t.deleteTeamMembers(e);return Promise.all([s,i])}});r.push(s)});return 1===r.length?r[0]:Promise.all(r)}},"./src/im/db/timetag.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;n.getTimetags=function(e){var t={};var r=function n(e){if(e.name.indexOf("team-")!==-1)t[e.name]=0;else t[e.name]=e.value;return e};return this.getAll("timetag",{filter:e,mapper:r}).then(function(){return t})};n.getTeamMemberTimetags=function(){return this.getTimetags(function(e){return e.name.indexOf("team-")!==-1})};n.getTimetag=function(e){return this.getOne("timetag",null,e).then(function(e){e=e||{value:0};return e.value})};n.getTeamMemberTimetag=function(e){return 0};n.updateTimetag=function(e,t){var r={name:e,value:t};return this.put("timetag",r)};n.updateMyInfoTimetag=function(e){return this.updateTimetag("myInfo",e)};n.updateRelationTimetag=function(e){return this.updateTimetag("relations",e)};n.getRelationsTimetag=function(){return this.getTimetag("relations")};n.updateFriendTimetag=function(e){return this.updateTimetag("friends",e)};n.getFriendsTimetag=function(){return this.getTimetag("friends")};n.updateFriendUserTimetag=function(e){return this.updateTimetag("friendUsers",e)};n.updateTeamTimetag=function(e){return this.updateTimetag("teams",e)};n.getTeamsTimetag=function(){return this.getTimetag("teams")};n.updateSuperTeamTimetag=function(e){return this.updateTimetag("superTeams",e)};n.getSuperTeamsTimetag=function(){return this.getTimetag("superTeams")};n.updateTeamMemberTimetag=function(e,t){
return this.updateTimetag("team-"+e,t)};n.getTeamMembersTimetag=function(e){return this.getTimetag("team-"+e)};n.updateSuperTeamMemberTimetag=function(e,t){return this.updateTimetag("superTeam-"+e,t)};n.getSuperTeamMembersTimetag=function(e){return this.getTimetag("superTeam-"+e)};n.updateMyTeamMembersTimetag=function(e){return this.updateTimetag("myTeamMembers",e)};n.getBroadcastMsgTimetag=function(e){return this.getTimetag("broadcastMsg")};n.updateBroadcastMsgTimetag=function(e){return this.updateTimetag("broadcastMsg",parseInt(e))};n.updateRoamingMsgTimetag=function(e){return this.updateTimetag("roamingMsgs",e)};n.updateSuperTeamRoamingMsgTimetag=function(e){return this.updateTimetag("superTeamRoamingMsgs",e)};n.updateMsgReceiptsTimetag=function(e){return this.updateTimetag("msgReceipts",e)};n.updateDonnopTimetag=function(e){return this.updateTimetag("donnop",e)};n.updateDeleteMsgTimetag=function(e){return this.updateTimetag("deleteMsg",e)};n.updateSessionAck=function(e){return this.updateTimetag("sessionAck",e)};n.deleteTimetag=function(e){return this.remove("timetag",e)};n.deleteTeamMemberTimetag=function(e){return this.deleteTimetag("team-"+e)};n.deleteSuperTeamMemberTimetag=function(e){return this.deleteTimetag("superTeam-"+e)}},"./src/im/db/user.js":function(e,t,r){"use strict";var n=r("./src/im/db/index.js").fn;var s=r("./src/util/index.js");var i="user";n.mergeMyInfo=function(e,t){var r=this;return r.put(i,e).then(function(){if(t)return r.updateMyInfoTimetag(e.updateTime);else return e})};n.mergeFriendUsers=function(e,t){var r=this;return r.putUsers(e).then(function(){r.updateFriendUserTimetag(t)})};n.putUsers=function(e){return this.put(i,e)};n.putUser=function(e){return this.put(i,e)};n.updateUser=function(e){var t=this;e=s.copy(e);var r=e.account;return this.getOne(i,null,r,{modifyObj:e}).then(function(n){if(n)t.logger.log("db::updateUser: "+r,e);else t.logger.warn("db::updateUser: no record "+r);return n})};n.putUsersIfIsFriend=function(e){var t=this;var r=[];var n=[];var s;e.forEach(function(e){s=t.getFriend(e.account).then(function(r){if(r){s=t.putUser(e);n.push(s)}return r});r.push(s)});return Promise.all(r).then(function(){return Promise.all(n).then(function(e){return e})})};n.deleteUser=function(e){return this.remove(i,e)};n.getUser=function(e){return this.getOne(i,null,e)};n.getUsers=function(e){function t(t){return e.indexOf(t.account)!==-1}return this.getAll(i,{filter:t})};n.getAllUsers=function(){return this.getAll(i)}},"./src/im/model/ImageOp.js":function(e,t,r){"use strict";function n(e){s.verifyOptions(e,"type","image::ImageOp");s.verifyParamValid("type",e.type,n.validTypes,"image::ImageOp");s.merge(this,e);this.type=i[e.type]}var s=r("./src/util/index.js");var i={stripmeta:0,blur:2,quality:3,crop:4,rotate:5,thumbnail:7,interlace:9};var o={0:"stripmeta",1:"type",2:"blur",3:"quality",4:"crop",5:"rotate",6:"pixel",7:"thumbnail",8:"watermark",9:"interlace",10:"tmp"};n.validTypes=Object.keys(i);n.reverse=function(e){var t=s.copy(e);t.type=o[t.type];return t};n.reverseImageOps=function(e){return e.map(function(e){return n.reverse(e)})};e.exports=n},"./src/im/model/avSignal.js":function(e,t,r){"use strict";var n={1:"ROOM_CLOSE",2:"ROOM_JOIN",3:"INVITE",4:"CANCEL_INVITE",5:"REJECT",6:"ACCEPT",7:"LEAVE",8:"CONTROL"};var s={1:"accid",2:"uid",3:"createTime",4:"expireTime",5:"web_uid"};var i={10404:"ROOM_NOT_EXISTS",10405:"ROOM_HAS_EXISTS",10406:"ROOM_MEMBER_NOT_EXISTS",10407:"ROOM_MEMBER_HAS_EXISTS",10408:"INVITE_NOT_EXISTS",10409:"INVITE_HAS_REJECT",10410:"INVITE_HAS_ACCEPT",10201:"PEER_NIM_OFFLINE",10202:"PEER_PUSH_OFFLINE",10419:"ROOM_MEMBER_EXCEED",10420:"ROOM_MEMBER_HAS_EXISTS_OTHER_CLIENT",10417:"UID_CONFLICT"};var o=function u(e){return n[e]||e};var a=function l(e){var t={};Object.keys(e).forEach(function(r){t[s[r]]=e[r]});return t};var c=function m(e){e.message=i[e.code]||e.message||e;return e};e.exports={parseAvSignalType:o,parseAvSignalMember:a,parseAvSignalError:c}},"./src/im/model/friend.js":function(e,t,r){"use strict";function n(e){s.verifyOptions(e,"account","friend::Friend");s.verifyParamAtLeastPresentOne(e,"alias custom","friend::Friend");this.account=e.account;if(i(e.alias))this.alias=e.alias;if(i(e.custom))this.custom=e.custom}var s=r("./src/util/index.js");var i=s.notundef;var o={addFriend:1,applyFriend:2,passFriendApply:3,rejectFriendApply:4};var a={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};n.reverse=function(e){var t=s.filterObj(e,"account alias custom createTime updateTime serverex");if(i(e.flag))t.valid="1"===e.flag;if(i(t.createTime))t.createTime=+t.createTime;if(i(t.updateTime))t.updateTime=+t.updateTime;return t};n.validTypes=function(){return Object.keys(o)};n.getByteFromType=function(e){return o[e]};n.getTypeFromByte=function(e){return a[e]};n.assembleFriend=function(e){var t=+new Date;return{account:e,alias:"",createTime:t,custom:"",updateTime:t,valid:!0}};e.exports=n},"./src/im/model/loginPort.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(){}var i=r("./src/util/device.js");var o=n(i);var a=o["default"].clientTypeMap;s.reverse=function(e){var t=e;t.type=a[t.type];return t};s.reverseType=function(e){return a[e]||e};e.exports=s},"./src/im/model/message/base/message.js":function(e,t,r){"use strict";function n(){}var s=r("./src/util/device.js");n.typeMap={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};var i=n.typeReverseMap={0:"text",1:"image",2:"audio",3:"video",4:"geo",5:"notification",6:"file",10:"tip",11:"robot",100:"custom"};n.validTypes=Object.keys(n.typeMap);n.setFlow=function(e,t){var r=t===e.from;if(r&&t===e.to)r=s.deviceId===e.fromDeviceId;e.flow=r?"out":"in";if("robot"===e.type)if(e.content&&e.content.msgOut)e.flow="in"};n.getType=function(e){var t=e.type;return i[t]||t};e.exports=n},"./src/im/model/message/im/audio.js":function(e,t,r){"use strict";function n(){}var s=r("./src/im/model/message/im/file.js");var i=r("./src/util/index.js");n.prototype=Object.create(s.prototype);n.verifyFile=function(e,t){i.verifyOptions(e,"dur",!0,"file.",t)};e.exports=n},"./src/im/model/message/im/custom.js":function(e,t,r){"use strict";function n(e){i.verifyOptions(e,"content","msg::CustomMessage");e.type="custom";s.call(this,e);this.attach=e.content}var s=r("./src/im/model/message/im/message.js");var i=r("./src/util/index.js");n.prototype=Object.create(s.prototype);n.reverse=function(e){var t=s.reverse(e);t.content=e.attach;return t};e.exports=n},"./src/im/model/message/im/file.js":function(e,t,r){"use strict";function n(e){if(o.notundef(e.type))o.verifyFileType(e.type,"msg::FileMessage");else e.type="file";o.verifyOptions(e,"file","msg::FileMessage");o.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage");switch(e.type){case"image":c.verifyFile(e.file,"msg::FileMessage");break;case"audio":u.verifyFile(e.file,"msg::FileMessage");break;case"video":l.verifyFile(e.file,"msg::FileMessage")}i.call(this,e);this.attach=JSON.stringify(e.file)}var s=r("./src/util/url.js");var i=r("./src/im/model/message/im/message.js");var o=r("./src/util/index.js");var a=r("./src/util/config.js");n.prototype=Object.create(i.prototype);n.reverse=function(e){var t=i.reverse(e);e.attach=e.attach?""+e.attach:"";t.file=e.attach?JSON.parse(e.attach):{};t.file.url=(0,s.genPrivateUrl)(t.file.url);if("audio"===t.type&&!t.file.mp3Url)t.file.mp3Url=t.file.url+(~t.file.url.indexOf("?")?"&":"?")+"audioTrans&type=mp3";if(a.httpsEnabled&&0!==t.file.url.indexOf("https://"))t.file.url=t.file.url.replace("http","https");return t};e.exports=n;var c=r("./src/im/model/message/im/image.js");var u=r("./src/im/model/message/im/audio.js");var l=r("./src/im/model/message/im/video.js")},"./src/im/model/message/im/geo.js":function(e,t,r){"use strict";function n(e){e.type="geo";i.verifyOptions(e,"geo","msg::GeoMessage");i.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage");i.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage");i.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage");i.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage");s.call(this,e);this.attach=JSON.stringify(e.geo)}var s=r("./src/im/model/message/im/message.js");var i=r("./src/util/index.js");n.prototype=Object.create(s.prototype);n.reverse=function(e){var t=s.reverse(e);e.attach=e.attach?""+e.attach:"";t.geo=e.attach?JSON.parse(e.attach):{};return t};e.exports=n},"./src/im/model/message/im/image.js":function(e,t,r){"use strict";function n(){}var s=r("./src/util/index.js");var i=r("./src/im/model/message/im/file.js");n.prototype=Object.create(i.prototype);n.verifyFile=function(e,t){s.verifyOptions(e,"w h",!0,"file.",t)};e.exports=n},"./src/im/model/message/im/index.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s=function p(e){this.account=e.account};var i=s.prototype;var o=i.Message=r("./src/im/model/message/im/message.js");var a=i.TextMessage=r("./src/im/model/message/im/text.js");var c=i.FileMessage=r("./src/im/model/message/im/file.js");var u=i.GeoMessage=r("./src/im/model/message/im/geo.js");var l=i.NotificationMessage=r("./src/im/model/message/im/notification.js");var m=i.CustomMessage=r("./src/im/model/message/im/custom.js");var d=i.TipMessage=r("./src/im/model/message/im/tip.js");var f=i.RobotMessage=r("./src/im/model/message/im/robot.js");i.validScenes=o.validScenes;i.validTypes=o.validTypes;i.reverse=function(e){var t;var r=o.getType(e);switch(r){case"text":t=a.reverse(e);break;case"image":case"audio":case"video":case"file":t=c.reverse(e);break;case"geo":t=u.reverse(e);break;case"notification":t=l.reverse(e);break;case"custom":t=m.reverse(e);break;case"tip":t=d.reverse(e);break;case"robot":t=f.reverse(e);break;default:t=o.reverse(e)}o.setExtra(t,this.account);return t};i.reverseMsgs=function(e,t){var r=this;var s;var i;return e.map(function(e){e=r.reverse(e);if(t){s=t.modifyObj;if(s)e=n.merge(e,s);i=t.mapper;if(n.isFunction(i))e=i(e)}return e})};e.exports=s;
},"./src/im/model/message/im/message.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){a.verifyOptions(e,"scene to type","msg::Message");a.verifyParamValid("scene",e.scene,v,"msg::Message");var t=this;t.scene=p[e.scene];t.to=""+e.to;t.type=y[e.type];t.resend=e.resend?1:0;if(!e.resend)t.idClient=a.guid();else{a.verifyOptions(e,"idClient","msg::Message");t.idClient=e.idClient}if(u(e.text))t.body=""+e.text;if(u(e.custom))if("object"===(0,o["default"])(e.custom))t.custom=JSON.stringify(e.custom);else t.custom=""+e.custom;if(u(e.body))t.body=""+e.body;if(u(e.pushContent))t.pushContent=""+e.pushContent;if(u(e.pushPayload))t.pushPayload=""+e.pushPayload;var r=e.apns;if(u(r)&&"team"===e.scene){var n=r.accounts;if(u(n))a.verifyParamType("apns.accounts",n,"array","msg::Message");t.apnsAccounts=n?JSON.stringify(n):f;t.apnsContent=r.content||e.pushContent||"";a.verifyBooleanWithDefault(r,"forcePush",!0,"options.apns","msg::Message");t.apnsForcePush=r.forcePush?1:0}if(u(e.isHistoryable))t.isHistoryable=e.isHistoryable?1:0;if(u(e.isRoamingable))t.isRoamingable=e.isRoamingable?1:0;if(u(e.isSyncable))t.isSyncable=e.isSyncable?1:0;if(u(e.cc))t.cc=e.cc?1:0;if(u(e.isPushable))t.isPushable=e.isPushable?1:0;if(u(e.isOfflinable))t.isOfflinable=e.isOfflinable?1:0;if(u(e.isUnreadable))t.isUnreadable=e.isUnreadable?1:0;if(u(e.needPushNick))t.needPushNick=e.needPushNick?1:0;if(u(e.needMsgReceipt))t.needMsgReceipt=e.needMsgReceipt?1:0;if(u(e.yidunEnable))t.yidunEnable=e.yidunEnable?1:0;if(u(e.antiSpamUsingYidun))t.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0;if(u(e.clientAntiSpam))t.clientAntiSpam=e.clientAntiSpam?1:0;if(u(e.antiSpamContent))if("object"===(0,o["default"])(e.antiSpamContent))t.antiSpamContent=JSON.stringify(e.antiSpamContent);else t.antiSpamContent=""+e.antiSpamContent;if(u(e.antiSpamBusinessId))if("object"===(0,o["default"])(e.antiSpamBusinessId))t.antiSpamBusinessId=JSON.stringify(e.antiSpamBusinessId);else t.antiSpamBusinessId=""+e.antiSpamBusinessId}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);var a=r("./src/util/index.js");var c=a.undef;var u=a.notundef;var l=a.exist;var m=r("./src/im/model/loginPort.js");var d=r("./src/im/model/message/base/message.js");var f="#%@all@%#";var p={p2p:0,team:1,superTeam:5};var g={0:"p2p",1:"team",5:"superTeam"};var v=Object.keys(p);var y=d.typeMap;var h=d.validTypes;a.merge(s.prototype,d.prototype);s.prototype.getScene=function(){return g[this.scene]};s.getType=d.getType;s.reverse=function(e){var t=g[e.scene];var r={scene:t||e.scene,from:e.from,fromNick:e.fromNick,fromClientType:m.reverseType(e.fromClientType),fromDeviceId:e.fromDeviceId,to:""+e.to,time:+e.time,type:s.getType(e),text:l(e.body)?e.body:"",isHistoryable:c(e.isHistoryable)||1===+e.isHistoryable,isRoamingable:c(e.isRoamingable)||1===+e.isRoamingable,isSyncable:c(e.isSyncable)||1===+e.isSyncable,cc:c(e.cc)||1===+e.cc,isPushable:c(e.isPushable)||1===+e.isPushable,isOfflinable:c(e.isOfflinable)||1===+e.isOfflinable,isUnreadable:c(e.isUnreadable)||1===+e.isUnreadable,isReplyMsg:c(e.isReplyMsg)||1===+e.isReplyMsg,needPushNick:c(e.needPushNick)||1===+e.needPushNick,needMsgReceipt:1===+e.needMsgReceipt,isLocal:!1};if(e.isInBlackList)r.isInBlackList=1===+e.isInBlackList;if(u(e.isMuted))r.isMuted=1===+e.isMuted;if(u(e.resend))r.resend=1===+e.resend;if(u(e.idClient))r.idClient=e.idClient;if(u(e.idServer))r.idServer=""+e.idServer;if(u(e.userUpdateTime))r.userUpdateTime=+e.userUpdateTime;if(u(e.custom))r.custom=e.custom;if(u(e.pushContent))r.pushContent=e.pushContent;if(u(e.pushPayload))r.pushPayload=e.pushPayload;if(u(e.tempTeamMemberCount))r.tempTeamMemberCount=+e.tempTeamMemberCount;if(u(e.apnsAccounts)){r.apns={};if(e.apnsAccounts!==f){var n=e.apnsAccounts;try{r.apns.accounts=JSON.parse(n)}catch(i){r.apns.accounts=[]}}r.apns.content=e.apnsContent||"";r.apns.forcePush=1===+e.apnsForcePush}r.status=e.status||"success";if(u(e.filter))r.filter=e.filter;return r};s.setExtra=function(e,t){e.target=s.getMsgTarget(e,t);e.sessionId=e.scene+"-"+e.target;d.setFlow(e,t)};s.getMsgTarget=function(e,t){if("p2p"===e.scene)return e.to===t?e.from:e.to;else if("team"===e.scene||"superTeam"===e.scene)return e.to};s.deduplication=function(e){var t={};var r=[];var n;e.forEach(function(e){n=e.idClient;if(!t[n]){t[n]=!0;r.push(e)}});return r};s.sortMsgs=function(e){e=e.slice(0);a.sortObjArray(e,{sortPath:"time"});return e};s.getLastMsg=function(e){e=s.sortMsgs(e);return e[e.length-1]};s.getLastNotIgnoredMsg=function(e){e=s.sortMsgs(e);var t=null;for(var r=e.length-1;r>=0;r--){t=e[r];if(!t.ignore)return t}return null};s.getMaxTimetag=function(e){return s.getLastMsg(e).time};s.validScenes=v;s.validTypes=h;e.exports=s},"./src/im/model/message/im/notification.js":function(e,t,r){"use strict";function n(){}var s=r("./src/util/index.js");var i=s.notundef;var o=r("./src/im/model/message/im/message.js");var a=r("./src/im/protocol/parser/index.js").IM;var c=r("./src/im/model/team.js");var u=r("./src/im/model/user.js");var l={};var m={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMute",101:"netcallMiss",102:"netcallBill",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam"};n.prototype=Object.create(o.prototype);n.reverse=function(e){var t=o.reverse(e);e.attach=e.attach?""+e.attach:"";if(e.attach){var r=JSON.parse(e.attach);t.attach={type:m[r.id]||r.id};if(i(r.data)){var n=r.data;if(i(n.tinfo))t.attach.team=c.reverse(a.syncUnserialize(n.tinfo,"team"),!0);if(i(n.ids))t.attach.accounts=n.ids;if(i(n.id))t.attach.account=n.id;if(i(n.uinfos))t.attach.users=n.uinfos.map(function(e){return u.reverse(a.syncUnserialize(e,"user"))});if(i(n.mute))t.attach.mute=1===+n.mute;if(i(n.attach))t.attach.custom=n.attach;if(i(n.channel))t.attach.channelId=n.channel;if(i(n.calltype))t.attach.netcallType=n.calltype;if(i(n.duration))t.attach.duration=n.duration;if(i(n.time))t.attach.time=n.time;if(i(n.from))t.attach.from=n.from;if(i(n.ext))t.attach.ext=n.ext;if(t.attach.accounts&&t.attach.accounts.length<=2&&t.from===t.to)t.attach.accounts.some(function(e){if(e!==t.to){t.to=e;return!0}})}}else t.attach={};return t};e.exports=n},"./src/im/model/message/im/robot.js":function(e,t,r){"use strict";function n(e){i.verifyOptions(e,"content","msg::RobotMessage");if(i.undef(e.robotAccid))e.robotAccid=e.to;var t=e.content;switch(t.type){case"welcome":if(i.undef(e.body))this.body="欢迎消息";break;case"text":i.verifyOptions(t,"content","msg::RobotMessage");if(i.undef(e.body))this.body=t.content;break;case"link":i.verifyOptions(t,"target","msg::RobotMessage")}if(t.type)t.type=o[t.type];t={param:t,robotAccid:e.robotAccid};this.attach=JSON.stringify(t);e.type="robot";s.call(this,e)}var s=r("./src/im/model/message/im/message.js");var i=r("./src/util/index.js");var o={welcome:"00",text:"01",link:"03"};var a={"01":"text","02":"image","03":"answer",11:"template"};n.prototype=Object.create(s.prototype);n.reverse=function(e){var t=s.reverse(e);if("robot"===t.type){var r=JSON.parse(e.attach);if(r.param)r.param.type=a[r.param.type]||"unknown";if(r.robotMsg){r=i.merge(r,r.robotMsg);var n=r.message;if("bot"===r.flag)r.message=n.map(function(e){e.type=a[e.type]||"unknown";return e});else if("faq"===r.flag);delete r.robotMsg}t.content=r}return t};e.exports=n},"./src/im/model/message/im/text.js":function(e,t,r){"use strict";function n(e){i.verifyOptions(e,"text","msg::TextMessage");e.type="text";s.call(this,e)}var s=r("./src/im/model/message/im/message.js");var i=r("./src/util/index.js");n.prototype=Object.create(s.prototype);n.reverse=function(e){var t=s.reverse(e);return t};e.exports=n},"./src/im/model/message/im/tip.js":function(e,t,r){"use strict";function n(e){i.verifyOptions(e,"tip","msg::TipMessage");e.type="tip";s.call(this,e);this.body=e.tip}var s=r("./src/im/model/message/im/message.js");var i=r("./src/util/index.js");n.prototype=Object.create(s.prototype);n.reverse=function(e){var t=s.reverse(e);t.text="";t.tip=e.body;if(e.attach)t.attach=e.attach;return t};e.exports=n},"./src/im/model/message/im/video.js":function(e,t,r){"use strict";function n(){}var s=r("./src/im/model/message/im/file.js");var i=r("./src/util/index.js");n.prototype=Object.create(s.prototype);n.verifyFile=function(e,t){i.verifyOptions(e,"dur w h",!0,"file.",t)};e.exports=n},"./src/im/model/msgEvent.js":function(e,t,r){"use strict";function n(e){s.verifyOptions(e,"type value","event::MsgEvent");s.verifyParamType("type",e.type,"number","event::MsgEvent");s.verifyParamType("value",e.value,"number","event::MsgEvent");this.type=e.type;this.value=e.value;this.idClient=s.guid();if(i(e.custom))this.custom=""+e.custom;this.validTime=e.validTime||604800;s.verifyParamType("validTime",this.validTime,"number","event::MsgEvent");s.verifyParamMin("validTime",this.validTime,60,"event::MsgEvent");s.verifyParamMax("validTime",this.validTime,604800,"event::MsgEvent");if(i(e.broadcastType)){s.verifyParamType("broadcastType",e.broadcastType,"number","event::MsgEvent");if([1,2].indexOf(e.broadcastType)<0)throw new o('参数错误"broadcastType":只能为1或2');this.broadcastType=e.broadcastType}else this.broadcastType=2;if(i(e.sync)){s.verifyParamType("sync",e.sync,"boolean","event::MsgEvent");this.sync=e.sync}else this.sync=!1}var s=r("./src/util/index.js");var i=s.notundef;var o=r("./src/im/model/nimerror.js");n.prototype.assembleEvent=function(){return{type:this.type,value:this.value,idClient:this.idClient,custom:this.custom||"",validTime:this.validTime,broadcastType:this.broadcastType,sync:this.sync===!0?1:0}};e.exports=n},"./src/im/model/msgEventSubscribe.js":function(e,t,r){"use strict";function n(e){s.verifyOptions(e,"type","event::MsgEventSubscribe");s.verifyParamType("type",e.type,"number","event::MsgEventSubscribe");if(s.findObjIndexInArray([1,2,3],e.type)<0)s.verifyParamMin("type",e.type,1e5,"event::MsgEventSubscribe");
this.type=e.type;if(i(e.subscribeTime)){s.verifyParamType("subscribeTime",e.subscribeTime,"number","event::MsgEventSubscribe");s.verifyParamMin("subscribeTime",e.subscribeTime,60,"event::MsgEventSubscribe");s.verifyParamMax("subscribeTime",e.subscribeTime,2592e3,"event::MsgEventSubscribe");this.subscribeTime=e.subscribeTime}else this.subscribeTime=2592e3;if(i(e.sync)){s.verifyParamType("sync",e.sync,"boolean","event::MsgEventSubscribe");this.sync=e.sync}else this.sync=!0}var s=r("./src/util/index.js");var i=s.notundef;n.prototype.assembleEvent=function(e){return{type:this.type,subscribeTime:this.subscribeTime,sync:this.sync===!0?1:0}};e.exports=n},"./src/im/model/nimerror.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var n=this;n.message=e||r.message||"";if("object"===("undefined"==typeof t?"undefined":(0,o["default"])(t))){n.event=t;n.code="Other_Error"}else if("undefined"!=typeof t)n.code=t;n.timetag=+new Date;if("undefined"!=typeof r)n.event=r;if(n.event){n.callFunc=n.event.callFunc||null;delete n.event.callFunc}}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);s.prototype=Object.create(Error.prototype);s.prototype.name="NIMError";var a={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消"};var c=[200,406,808,810];c.forEach(function(e){a[e]=null});s.genError=function(e){var t=a[e];if(void 0===t)t="操作失败";if(null===t)return null;else return new s(t,e)};s.multiInstance=function(e){return new s("不允许初始化多个实例","Not_Allow_Multi_Instance",e)};s.newNetworkError=function(e){var t="Error_Internet_Disconnected";return new s(a[t],t,e)};s.newConnectError=function(e){var t="Connect_Failed";return new s(a[t]||null,t,e)};s.newConnectionError=function(e){var t="Error_Connection_is_not_Established";return new s(a[t],t,e)};s.newSocketStateError=function(e){var t="Error_Connection_Socket_State_not_Match";return new s(a[t],t,e)};s.newTimeoutError=function(e){var t="Error_Timeout";return new s(a[t],t,e)};s.newFrequencyControlError=function(e){var t=416;var r=new s(a[t],t,e);r.from="local";return r};s.newParamError=function(e,t){var r="Param_Error";return new s(e||a[r],r,t)};s.newNoFileError=function(e,t){var r="No_File_Selected";return new s(e||a[r],r,t)};s.newWrongFileTypeError=function(e,t){var r="Wrong_File_Type";return new s(e||a[r],r,t)};s.newFileTooLargeError=function(e,t){var r="File_Too_Large";return new s(e||a[r],r,t)};s.newCORSIframeError=function(e){var t="Cross_Origin_Iframe";return new s(a[t],t,e)};s.newSupportError=function(e,t,r){return new s("不支持"+e,"Not_Support_"+t,r)};s.newSupportDBError=function(e){return s.newSupportError("数据库","DB",e)};s.noDBError=function(e){var t="NO_DB";return new s(a[t],t,e)};s.newDBError=function(e){var t="DB";return new s(a[t],t,e)};s.newUnknownError=function(e){var t="Error_Unknown";return new s(a[t],t,e)};s.stillInTeamError=function(e){var t="Still_In_Team";return new s(a[t],t,e)};s.sessionExist=function(e){var t="Session_Exist";return new s(a[t],t,e)};s.sessionNotExist=function(e){var t="Session_Not_Exist";return new s(a[t],t,e)};s.cancel=function(e){var t="Operation_Canceled";return new s(a[t],t,e)};s.customError=function(e,t){e=e||"Other_Error";t=t||{};var r="";if(!t.message)r=a[e]||e;if("object"!==("undefined"==typeof e?"undefined":(0,o["default"])(e)))return new s(r,e,t);else if("undefined"==typeof t)return new s(r,"Other_Error",e);else return new s(r,"Other_Error",t)};e.exports=s},"./src/im/model/pushNotificationMultiportConfig.js":function(e,t,r){"use strict";function n(e){var t=this;if(i(e.shouldPushNotificationWhenPCOnline))t.open=e.shouldPushNotificationWhenPCOnline?2:1}var s=r("./src/util/index.js");var i=s.notundef;n.getDefaultConfig=function(){return{shouldPushNotificationWhenPCOnline:!0}};n.reverse=function(e){var t={shouldPushNotificationWhenPCOnline:1!==+e.open};return t};e.exports=n},"./src/im/model/session.js":function(e,t,r){"use strict";function n(){}var s=r("./src/util/index.js");n.parse=function(e){var t=e.split("|");return{scene:t[0],to:t[1]}};n.genSessionByMsg=function(e){var t={id:e.sessionId,scene:e.scene,to:e.target,updateTime:e.time,lastMsg:e};return t};n.appendLastMsg=function(e){var t=e.lastMsg;var r=s.capFirstLetter(t.type);e["last"+r+"Msg"]=t;var n=s.capFirstLetter(t.flow);e["last"+n+"Msg"]=t};n.genSessionByMsgs=function(e,t){var r=e.getLastNotIgnoredMsg(t);if(r)return n.genSessionByMsg(r);else return null};n.trim=function(e){delete e.msgReceiptSendTime;delete e.msgReceiptServerTime;delete e.ack;delete e.unreadMsgs};n.isComplete=function(e){return e.id&&e.scene&&e.to};e.exports=n},"./src/im/model/specialRelation.js":function(e,t,r){"use strict";function n(){}var s=r("./src/util/index.js");n.parse=function(e){var t=s.copy(e);t.isBlacked="1"===t.isBlacked;t.isMuted="1"===t.isMuted;t.createTime=+t.createTime;t.updateTime=+t.updateTime;return t};e.exports=n},"./src/im/model/superTeam.js":function(e,t,r){"use strict";function n(e){var t=this;i.verifyOptions(e,"action","superTeam::SuperTeam");i.verifyOptions(e,"teamId","superTeam::SuperTeam");if(o(e.teamId))t.teamId=e.teamId;if(o(e.type))t.type=f[e.type];if(o(e.avatar))t.avatar=""+e.avatar;if(o(e.name))t.name=""+e.name;if(o(e.intro))t.intro=""+e.intro;if(o(e.announcement))t.announcement=""+e.announcement;if(o(e.custom))t.custom=""+e.custom;d.forEach(t.setMode.bind(t,e))}function s(e,t){t+="Mode";if(o(e[t]))e[t]=l[t][e[t]]}var i=r("./src/util/index.js");var o=i.notundef;var a=i.fillPropertyWithDefault;var c=Object.keys;var u={};var l={};var m={};var d=[];var f={normal:0,advanced:1};var p={0:"normal",1:"advanced"};n.prototype.setMode=function(e,t){var r=this;t+="Mode";if(o(e[t])){i.verifyParamValid(t,e[t],m[t],"Superteam::Team");r[t]=u[t][e[t]]}};n.reverse=function(e,t){var r=i.copy(e);if(o(r.teamId))r.teamId=""+r.teamId;if(o(r.type))r.type=p[r.type];if(o(r.level))r.level=+r.level;if(o(r.valid))r.valid=1===+r.valid;if(o(r.memberNum))r.memberNum=+r.memberNum;if(o(r.memberUpdateTime))r.memberUpdateTime=+r.memberUpdateTime;if(o(r.createTime))r.createTime=+r.createTime;if(o(r.updateTime))r.updateTime=+r.updateTime;if(o(r.validToCurrentUser))r.validToCurrentUser="1"===r.validToCurrentUser;if(o(r.mute))r.mute="1"===r.mute;if(o(r.muteType))switch(r.muteType){case"0":r.mute=!1;r.muteType="none";break;case"1":r.mute=!0;r.muteType="normal";break;case"2":r.mute=!0;r.muteType="all"}else if(o(r.mute))if(1===r.mute){r.mute=!0;r.muteType="normal"}else{r.mute=!1;r.muteType="none"}d.forEach(s.bind(null,r));delete r.bits;if(!t)n.fillProperties(r);return r};n.fillProperties=function(e){var t=a(e,"avatar","");return t};e.exports=n},"./src/im/model/superTeamMember.js":function(e,t,r){"use strict";function n(e){var t=this;s.verifyOptions(e,"teamId","superTeam::TeamMember");s.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam muteNotiType custom","superTeam::SuperTeamMember");t.teamId=e.teamId;if(i(e.account))t.account=e.account;if(i(e.nickInTeam))t.nickInTeam=e.nickInTeam;if(i(e.muteNotiType))t.bits=e.muteNotiType;else if(i(e.muteTeam)){t.bits=0;if(e.muteTeam)t.bits+=1}if(i(e.mute))t.mute=e.mute?1:0;if(i(e.custom))t.custom=""+e.custom}var s=r("./src/util/index.js");var i=s.notundef;var o=s.fillPropertyWithDefault;var a={0:"normal",1:"owner",2:"manager"};n.reverse=function(e){var t=s.copy(e);if(i(t.teamId))t.teamId=""+t.teamId;if(i(t.type))t.type=a[t.type];if(i(t.active))t.active=1===+t.active;if(i(t.valid))t.valid=1===+t.valid;if(i(t.mute))t.mute=1===+t.mute;if(i(t.joinTime))t.joinTime=+t.joinTime;if(i(t.updateTime))t.updateTime=+t.updateTime;if(i(t.bits)){var r=t.bits;delete t.bits;t.muteTeam=!!(1&r);t.muteNotiType=r}if(i(t.teamId)&&i(t.account))t.id=n.genId(t.teamId,t.account);return t};n.reverseMembers=function(e){return e.map(function(e){return n.reverse(e)})};n.fillProperties=function(e){var t=o(e,"mute",!1);var r=o(e,"custom","");return t||r};n.genId=function(e,t){return e+"-"+t};n.accounts2ids=function(e,t){return t.map(function(t){return n.genId(e,t)})};n.assembleMembers=function(e,t){if(!s.isArray(t))t=[t];return t.map(function(t){return n.assembleMember(e,t)})};n.assembleMember=function(e,t){return{id:n.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}};n.assembleOwner=function(e){var t=n.assembleMember(e,e.owner);t.type="owner";return t};e.exports=n},"./src/im/model/systemMessage.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){var t=this;a.verifyOptions(e,"type to","sysmsg::SystemMessage");a.verifyParamValid("type",e.type,s.validTypes,"sysmsg::SystemMessage");if(e.type.indexOf("custom")!==-1){a.verifyOptions(e,"content","sysmsg::SystemMessage");t.attach=e.content;if(u(e.apnsText))t.apnsText=""+e.apnsText;if(u(e.pushPayload))if("object"===(0,
o["default"])(e.pushPayload))t.pushPayload=JSON.stringify(e.pushPayload);else t.pushPayload=""+e.pushPayload;if(u(e.sendToOnlineUsersOnly))t.sendToOnlineUsersOnly=e.sendToOnlineUsersOnly?0:1;if(u(e.cc))t.cc=e.cc?1:0;if(u(e.isPushable))t.isPushable=e.isPushable?1:0;if(u(e.isUnreadable))t.isUnreadable=e.isUnreadable?1:0;if(u(e.needPushNick))t.needPushNick=e.needPushNick?1:0}t.time=e.time||+new Date;t.type=f[e.type];t.to=e.to;if(u(e.from))t.from=e.from;if(u(e.ps))t.ps=e.ps;if(u(e.deletedIdClient))t.deletedIdClient=e.deletedIdClient;if(u(e.deletedIdServer))t.deletedIdServer=e.deletedIdServer;if(u(e.opeAccount))t.opeAccount=e.opeAccount;if(u(e.yidunEnable))t.yidunEnable=e.yidunEnable?1:0;if(u(e.antiSpamContent))if("object"===(0,o["default"])(e.antiSpamContent))t.antiSpamContent=JSON.stringify(e.antiSpamContent);else t.antiSpamContent=""+e.antiSpamContent;if(u(e.antiSpamBusinessId))if("object"===(0,o["default"])(e.antiSpamBusinessId))t.antiSpamBusinessId=JSON.stringify(e.antiSpamBusinessId);else t.antiSpamBusinessId=""+e.antiSpamBusinessId;t.idClient=e.idClient||a.guid()}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);var a=r("./src/util/index.js");var c=a.undef;var u=a.notundef;var l=r("./src/im/protocol/parser/index.js").IM;var m=r("./src/im/model/team.js");var d=r("./src/im/model/teamMember.js");var f={customP2p:100,customTeam:101,deleteMsgP2p:7,deleteMsgTeam:8};var p={0:"applyTeam",1:"rejectTeamApply",2:"teamInvite",3:"rejectTeamInvite",5:"friendRequest",6:"deleteFriend",7:"deleteMsgP2p",8:"deleteMsgTeam",100:"customP2p",101:"customTeam",102:"customP2p"};var g={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var v="team";var y="friend";var h="msg";var b=[v,y,h];var T={applyTeam:v,rejectTeamApply:v,teamInvite:v,rejectTeamInvite:v,addFriend:y,applyFriend:y,passFriendApply:y,rejectFriendApply:y,deleteFriend:y,deleteMsg:h};s.validTypes=Object.keys(f).concat(Object.keys(T));s.validCategories=["team","friend"];s.isCustom=function(e){return"custom"===e.type};s.reverse=function(e){var t={time:+e.time,to:e.to,type:p[e.type]};if(u(e.from))t.from=e.from;if(u(e.idServer))t.idServer=""+e.idServer;if(u(e.deletedIdClient))t.deletedIdClient=e.deletedIdClient;if(u(e.deletedIdServer))t.deletedIdServer=""+e.deletedIdServer;if(u(e.deletedMsgTime))t.deletedMsgTime=+e.deletedMsgTime;if(u(e.deletedMsgFromNick))t.deletedMsgFromNick=""+e.deletedMsgFromNick;if(u(e.opeAccount))t.opeAccount=e.opeAccount;if(u(e.ps))t.ps=e.ps;e.attach=e.attach?""+e.attach:"";if("customP2p"===t.type||"customTeam"===t.type){t.content=e.attach;if(u(e.apnsText))t.apnsText=e.apnsText;if(u(e.pushPayload))t.pushPayload=e.pushPayload;a.merge(t,{sendToOnlineUsersOnly:c(e.sendToOnlineUsersOnly)||0===+e.sendToOnlineUsersOnly,cc:c(e.cc)||1===+e.cc,isPushable:c(e.isPushable)||1===+e.isPushable,isUnreadable:c(e.isUnreadable)||1===+e.isUnreadable,needPushNick:u(e.needPushNick)&&1===+e.needPushNick});t.scene=t.type.slice(6).toLowerCase();t.type="custom"}else if("deleteMsgP2p"===t.type||"deleteMsgTeam"===t.type){t.scene=t.type.slice(9).toLowerCase();t.type="deleteMsg"}else{if(e.attach){t.attach={};var r=JSON.parse(e.attach);if(u(r.vt)){t.type=g[r.vt];delete t.attach}else{if(u(r.tinfo))t.attach.team=m.reverse(l.syncUnserialize(r.tinfo,"team"));if(u(r.tlist))t.attach.member=d.reverse(l.syncUnserialize(r.tlist,"teamMember"));if(u(r.attach))t.attach.custom=r.attach}}t.category=T[t.type];t.read=!1;t.state="init"}if(u(e.cc))t.cc=1===+e.cc;t.status=e.status||"success";if(u(e.filter))t.filter=e.filter;return t};s.reverseSysMsgs=function(e,t){t=t||{};var r=t.mapper;var n=a.isFunction(r);return e.map(function(e){e=s.reverse(e);if(n)e=r(e);return e})};s.completeUnread=function(e){e=e||{};b.forEach(function(t){delete e[t]});var t;Object.keys(T).forEach(function(r){e[r]=e[r]||0;if(e[r]<0)e[r]=0;t=T[r];e[t]=e[t]||0;e[t]=e[t]+e[r]});e.total=0;b.forEach(function(t){e.total+=e[t]});return e};e.exports=s},"./src/im/model/team.js":function(e,t,r){"use strict";function n(e){var t=this;i.verifyOptions(e,"action","team::Team");switch(e.action){case"create":i.verifyOptions(e,"teamId",!1,"team::Team");i.verifyOptions(e,"type name","team::Team");i.verifyParamValid("type",e.type,g,"team::Team");if(o(e.level)){i.verifyParamType("level",e.level,"number","team::Team");t.level=e.level}break;case"update":i.verifyOptions(e,"teamId","team::Team");i.verifyOptions(e,"type",!1,"team::Team")}if(o(e.teamId))t.teamId=e.teamId;if(o(e.type))t.type=f[e.type];if(o(e.avatar))t.avatar=""+e.avatar;if(o(e.name))t.name=""+e.name;if(o(e.intro))t.intro=""+e.intro;if(o(e.announcement))t.announcement=""+e.announcement;m.forEach(t.setMode.bind(t,e));if(o(e.custom))t.custom=""+e.custom}function s(e,t){t+="Mode";if(o(e[t]))e[t]=l[t][e[t]]}var i=r("./src/util/index.js");var o=i.notundef;var a=i.fillPropertyWithDefault;var c=Object.keys;var u={};var l={};var m=[];var d={};var f={normal:0,advanced:1};var p={0:"normal",1:"advanced"};var g=c(f);var v=u.joinMode={noVerify:0,needVerify:1,rejectAll:2};l.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"};m.push("join");d.joinMode=c(v);var y=u.beInviteMode={needVerify:0,noVerify:1};l.beInviteMode={0:"needVerify",1:"noVerify"};m.push("beInvite");d.beInviteMode=c(y);var h=u.inviteMode={manager:0,all:1};l.inviteMode={0:"manager",1:"all"};m.push("invite");d.inviteMode=c(h);var b=u.updateTeamMode={manager:0,all:1};l.updateTeamMode={0:"manager",1:"all"};m.push("updateTeam");d.updateTeamMode=c(b);var T=u.updateCustomMode={manager:0,all:1};l.updateCustomMode={0:"manager",1:"all"};m.push("updateCustom");d.updateCustomMode=c(T);var M=n.prototype;M.setMode=function(e,t){var r=this;t+="Mode";if(o(e[t])){i.verifyParamValid(t,e[t],d[t],"team::Team");r[t]=u[t][e[t]]}};n.reverse=function(e,t){var r=i.copy(e);if(o(r.teamId))r.teamId=""+r.teamId;if(o(r.type))r.type=p[r.type];if(o(r.level))r.level=+r.level;if(o(r.valid))r.valid=1===+r.valid;if(o(r.memberNum))r.memberNum=+r.memberNum;if(o(r.memberUpdateTime))r.memberUpdateTime=+r.memberUpdateTime;if(o(r.createTime))r.createTime=+r.createTime;if(o(r.updateTime))r.updateTime=+r.updateTime;if(o(r.validToCurrentUser))r.validToCurrentUser="1"===r.validToCurrentUser;if(o(r.mute))r.mute="1"===r.mute;if(o(r.muteType))switch(r.muteType){case"0":r.mute=!1;r.muteType="none";break;case"1":r.mute=!0;r.muteType="normal";break;case"2":r.mute=!0;r.muteType="all"}else if(o(r.mute))if(1===r.mute){r.mute=!0;r.muteType="normal"}else{r.mute=!1;r.muteType="none"}m.forEach(s.bind(null,r));delete r.bits;if(!t)n.fillProperties(r);return r};n.fillProperties=function(e){var t=a(e,"beInviteMode","needVerify");var r=a(e,"inviteMode","manager");var n=a(e,"updateTeamMode","manager");var s=a(e,"updateCustomMode","manager");var i=a(e,"avatar","");return t||r||n||s||i};e.exports=n},"./src/im/model/teamMember.js":function(e,t,r){"use strict";function n(e){var t=this;s.verifyOptions(e,"teamId","team::TeamMember");s.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam muteNotiType custom","team::TeamMember");t.teamId=e.teamId;if(i(e.account))t.account=e.account;if(i(e.nickInTeam))t.nickInTeam=e.nickInTeam;if(i(e.muteNotiType))t.bits=e.muteNotiType;else if(i(e.muteTeam)){t.bits=0;if(e.muteTeam)t.bits+=1}if(i(e.mute))t.mute=e.mute?1:0;if(i(e.custom))t.custom=""+e.custom}var s=r("./src/util/index.js");var i=s.notundef;var o=s.fillPropertyWithDefault;var a={0:"normal",1:"owner",2:"manager"};n.reverse=function(e){var t=s.copy(e);if(i(t.teamId))t.teamId=""+t.teamId;if(i(t.type))t.type=a[t.type];if(i(t.active))t.active=1===+t.active;if(i(t.valid))t.valid=1===+t.valid;if(i(t.mute))t.mute=1===+t.mute;if(i(t.joinTime))t.joinTime=+t.joinTime;if(i(t.updateTime))t.updateTime=+t.updateTime;if(i(t.bits)){var r=t.bits;delete t.bits;t.muteTeam=!!(1&r);t.muteNotiType=r}if(i(t.teamId)&&i(t.account))t.id=n.genId(t.teamId,t.account);return t};n.reverseMembers=function(e){return e.map(function(e){return n.reverse(e)})};n.fillProperties=function(e){var t=o(e,"mute",!1);var r=o(e,"custom","");return t||r};n.genId=function(e,t){return e+"-"+t};n.accounts2ids=function(e,t){return t.map(function(t){return n.genId(e,t)})};n.assembleMembers=function(e,t){if(!s.isArray(t))t=[t];return t.map(function(t){return n.assembleMember(e,t)})};n.assembleMember=function(e,t){return{id:n.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0,invitorAccid:""}};n.assembleOwner=function(e){var t=n.assembleMember(e,e.owner);t.type="owner";return t};e.exports=n},"./src/im/model/user.js":function(e,t,r){"use strict";function n(e){i.merge(this,e);if(i.notundef(this.gender)){i.verifyParamValid("gender",this.gender,n.validGenders,"user::User");this.gender=o[this.gender]}if(i.notundef(this.email)&&""!==this.email)i.verifyEmail("email",this.email,"user::User");if(i.notundef(this.birth)&&""!==this.birth)i.verifyBirth("birth",this.birth,"user::User");if(i.notundef(this.tel)&&""!==this.tel)i.verifyTel("tel",this.tel,"user::User")}var s=r("./src/util/url.js");var i=r("./src/util/index.js");var o={unknown:0,male:1,female:2};var a={0:"unknown",1:"male",2:"female"};n.reverse=function(e){var t=i.filterObj(e,"account nick avatar _avatar_safe sign gender email birth tel custom createTime updateTime");if(i.notundef(t.avatar))t.avatar=(0,s.genPrivateUrl)(t.avatar);if(i.notundef(t.gender))t.gender=a[t.gender];if(i.notundef(t.createTime))t.createTime=+t.createTime;if(i.notundef(t.updateTime))t.updateTime=+t.updateTime;return t};n.reverseUsers=function(e){return e.map(function(e){return n.reverse(e)})};n.validGenders=Object.keys(o);e.exports=n},"./src/im/protocol/base/auth.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/extends.js");var i=n(s);var o=r("./src/im/protocol/base/index.js").fn;var a=r("./src/im/model/nimerror.js");var c=r("./src/polyfill/weixin-app/platform.js");var u=r("./src/im/model/loginPort.js");var l=r("./src/util/device.js");
var m=r("./src/util/config.js");var d=r("./src/util/index.js");var f=d.notundef;o.login=function(){var e=this;Promise.resolve().then(function(){return e.assembleLogin()}).then(function(t){e.sendCmd("login",(0,i["default"])({},t),e.onLogin.bind(e))});e.autoconnect=!1};o.genSessionKey=function(){var e={};return function(){var t=this;var r=t.name;var n=e[r]=e[r]||d.guid();return n}}();o.assembleIMLogin=function(){var e=this;var t=e.options;var r=t.account;var n=e.autoconnect?0:1;e.sdkSession=e.genSessionKey();var s={appLogin:n,appKey:t.appKey,account:r,token:t.token,sdkVersion:m.info.sdkVersion,protocolVersion:m.info.protocolVersion,os:c.os.toString(),browser:c.name+" "+c.version,clientType:m.CLIENTTYPE||16,session:e.sdkSession,deviceId:l.deviceId,isReactNative:m.isRN?1:0,customTag:t.customTag||""};return s};o.onLogin=function(e,t){var r=this;r.loginResult=t;if(!e){r.startHeartbeat();r.afterLogin(t)}else r.onAuthError(e,"link::onLogin")};o.afterLogin=d.emptyFunc;o.notifyLogin=function(){var e=this;var t=e.loginResult;e.logger.info("link::notifyLogin: on connect",t);e.options.onconnect(t)};o.logout=function(){var e="done disconnect";if(!this.doLogout){if(this.isConnected()){var t=new a(e,"logout");this.onAuthError(t,"link::logout")}}else{this.doLogout=!1;e="done logout";this.onAuthError(new a(e,"logout"),"link::logout")}};o.onKicked=function(e){var t=this;var r=e.content;var n=r.from;var s=r.reason;var i=r.custom;var o={reason:t.kickedReasons[s]||"unknown",message:t.kickedMessages[s]||"未知原因"};if(f(n))o.from=u.reverseType(n);if(f(i))o.custom=i;if(t.shouldNotifyKicked(o)){var c=new a("被踢了","kicked");d.merge(c,o);t.onAuthError(c,"link::onKicked")}else{t.logger.warn("link::onKicked: silentlyKick");t.shouldReconnect=!0;t.hasNotifyDisconnected=!0;t.disconnectSocket()}};o.shouldNotifyKicked=function(e){return"silentlyKick"!==e.reason};o.onAuthError=function(e,t){var r=this;r.shouldReconnect=!1;e=e||a.newConnectionError({callFunc:t});e.callFunc=e.callFunc||t||null;r.markAllCallbackInvalid(e);r.notifyDisconnect(e)}},"./src/im/protocol/base/avSignal.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/base/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/im/model/avSignal.js");n.processAvSignal=function(e){console.log(e,"avSignal...");switch(e.cmd){case"signalingCreate":break;case"signalingDelay":break;case"signalingClose":break;case"signalingJoin":break;case"signalingLeave":break;case"signalingInvite":break;case"signalingCancel":break;case"signalingReject":break;case"signalingAccept":break;case"signalingControl":break;case"signalingSyncMsgRead":break;case"signalingGetChannelInfo":break;case"signalingNotify":this.onSignalingNotify(e);break;case"signalingMutilClientSyncNotify":this.onSignalingMutilClientSyncNotify(e);break;case"signalingUnreadMessageSyncNotify":this.onSignalingUnreadMessageSyncNotify(e);break;case"signalingChannelsSyncNotify":this.onSignalingMembersSyncNotify(e);break;default:this.logger.log("avSignal::unhandled cmd:",e.cmd)}};var o=function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.needPush)e.needPush="1"===e.needPush;if(e.needBadge)e.needBadge="1"===e.needBadge;if(e.channelInValid)e.channelInValid="1"===e.channelInValid;if(e.attach){var t=JSON.parse(e.attach);e.eventType=i.parseAvSignalType(t.type)}if(e.members){var r=JSON.parse(e.members);e.members=r.map(function(e){return i.parseAvSignalMember(e)})}return e};n.onSignalingNotify=function(e){if(!e.error){if(e.raw&&e.raw.r&&e.raw.r.length&&e.content&&e.content.avSignalTag)e.content.avSignalTag.msgid=e.raw.r[0];var t=e.content.avSignalTag;if(Array.isArray(t))t=t.map(function(e){return o(e)});else t=o(t);this.emitAPI({type:"signalingNotify",obj:t});if(s.isFunction(this.options.onSignalingNotify))this.options.onSignalingNotify(t)}else{var r=e.error;this.logger.error("protocal::avSignal:onSignalingNotify error",r);this.emitAPI({type:"error",error:r});this.options.onerror(r)}};n.onSignalingMutilClientSyncNotify=function(e){if(!e.error){this.emitAPI({type:"signalingMutilClientSyncNotify",obj:e.content});if(s.isFunction(this.options.onSignalingMutilClientSyncNotify))this.options.onSignalingMutilClientSyncNotify(e.content)}else{var t=e.error;this.logger.error("protocal::avSignal:onSignalingMutilClientSyncNotify error",t);this.emitAPI({type:"error",error:t});this.options.onerror(t)}};n.onSignalingUnreadMessageSyncNotify=function(e){if(!e.error){var t=e.content.avSignalTag;if(Array.isArray(t))t=t.map(function(e){return o(e)});this.emitAPI({type:"signalingUnreadMessageSyncNotify",obj:t});if(s.isFunction(this.options.onSignalingUnreadMessageSyncNotify))this.options.onSignalingUnreadMessageSyncNotify(t)}else{var r=e.error;this.logger.error("protocal::avSignal:onSignalingUnreadMessageSyncNotify error",r);this.emitAPI({type:"error",error:r});this.options.onerror(r)}};n.onSignalingMembersSyncNotify=function(e){if(!e.error){var t=e.content.avSignalTag;if(!Array.isArray(t))t=[t];t=t.map(function(e){return o(e)});this.emitAPI({type:"signalingChannelsSyncNotify",obj:t});if(s.isFunction(this.options.onSignalingMembersSyncNotify))this.options.onSignalingMembersSyncNotify(t)}else{var r=e.error;this.logger.error("protocal::avSignal:onSignalingMembersSyncNotify error",r);this.emitAPI({type:"error",error:r});this.options.onerror(r)}}},"./src/im/protocol/base/connect.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/base/index.js").fn;var s=r("./src/im/model/nimerror.js");var i=r("./node_modules/backo2/index.js");var o=r("./external/socketio/socket.io.js");var a=r("./src/util/config.js");var c=r("./src/util/index.js");n.initConnect=function(){var e=this;e.socket=null;e.retryCount=0;e.connecting=!1;e.initConnecting=!1;e.shouldReconnect=!0;e.hasNotifyDisconnected=!1;e.doLogout=!1};n.resetConnect=function(){var e=this;var t=e.options;if(c.notundef(t.needReconnect)){c.verifyParamType("needReconnect",t.needReconnect,"boolean","link::resetConnect");e.needReconnect=t.needReconnect}else e.needReconnect=!0;e.logger.log("link::resetConnect: needReconnect "+e.needReconnect);if(c.notundef(t.reconnectionAttempts))c.verifyParamType("reconnectionAttempts",t.reconnectionAttempts,"number","link::resetConnect");if(c.notundef(t.noCacheLinkUrl))c.verifyParamType("noCacheLinkUrl",t.noCacheLinkUrl,"boolean","link::resetConnect");e.reconnectionAttempts="number"==typeof t.reconnectionAttempts?t.reconnectionAttempts:1/0;e.backoff=new i({min:a.reconnectionDelay,max:a.reconnectionDelayMax,jitter:a.reconnectionJitter})};n.connect=function(e){var t=this;if(e)if(t.initConnecting){t.logger.warn("link::connect: already init connecting");return}else clearTimeout(t.reconnectTimer);if(!t.isConnected())if(!t.connecting){t.connecting=!0;t.hasNotifyDisconnected=!1;if(!t.socket||!t.socket||!t.socket.socket)if(t.options.socketUrl&&"string"==typeof t.options.socketUrl)t.connectToUrl(t.options.socketUrl);else{var r=t.getNextSocketUrl();if(r&&!t.options.noCacheLinkUrl)t.connectToUrl(r);else t.refreshSocketUrl()}else{t.logger.info("link::connect: try connecting...");t.socket.socket.connect()}}else t.logger.warn("link::connect: already connecting");else t.logger.warn("link::connect: already connected")};n.getNextSocketUrl=function(){return this.socketUrls.shift()};n.isConnected=function(){var e=this;return!!e.socket&&!!e.socket.socket&&e.socket.socket.connected};n.connectToUrl=function(e){var t=this;e=e||"";t.logger.log("link::connectToUrl: "+e);if("undefined"==typeof window){var r=c.getGlobal();var n=e.split(":");if(r&&!r.location&&n.length>1)r.location={protocol:n[0],hostname:n[1].slice(2),port:n[2]};this.options.transports=["websocket"]}var s=this.options.transports||["websocket","xhr-polling"];t.socket=o.connect(e,{transports:s,reconnect:!1,"force new connection":!0,"connect timeout":a.connectTimeout});t.logger.info("link::connectToUrl: socket url: "+e+", transports: "+JSON.stringify(s));t.socket.on("connect",t.onConnect.bind(t));t.socket.on("handshake_failed",t.onHandshakeFailed.bind(t));t.socket.on("connect_failed",t.onConnectFailed.bind(t));t.socket.on("error",t.onError.bind(t));t.socket.on("message",t.onMessage.bind(t));t.socket.on("disconnect",function(r){t.logger.warn("link::connectToUrl: socket url: "+e+", disconnected");if(t.doLogout)t.logout();else t.onDisconnect(!0,"link::socketDisconnect")})};n.disconnect=function(e){function t(t){r.logger.info("link::disconnect: socket finally closed, ",t);clearTimeout(r.disconnectCallbackTimer);e(t)}var r=this;if(!(e instanceof Function))e=function n(){};clearTimeout(r.connectTimer);r.disconnectCallbackTimer=setTimeout(function(){e.call(r,"mark disconnected due to timeout")},1e4);if(r.socket&&r.socket.socket&&r.socket.socket.transport)r.socket.socket.transport.onDisconnectDone=function(e){t(e)};else t(null);if(r.isConnected()){r.logger.log("link::disconnect: start disconnecting");r.logout()}else if(r.connecting){r.logger.log("link::disconnect: abort connecting");r.disconnectSocket()}else{r.logger.log("link::disconnect: start otherwise");r.connecting=!1;r.shouldReconnect=!1;r.needReconnect=!1;r.options.ondisconnect({callFunc:"link::disconnect",message:"manually disconnect status"})}};n.onConnect=function(){var e=this;if(e.backoff)e.backoff.reset();e.reconnectStatus=e.retryCount>0?1:0;e.retryCount=0;e.connecting=!1;e.initConnecting=!1;e.shouldReconnect=!0;e.hasNotifyDisconnected=!1;e.logger.log("link::onConnect: socket onconnected, start login");e.login();e.api.reportLogs({event:"ws_connected"})};n.onHandshakeFailed=function(){this.api.reportLogs({event:"ws_handshake_failed"});this.onDisconnect(!1,"link::onHandshakeFailed")};n.onConnectFailed=function(){this.api.reportLogs({event:"ws_connect_failed"});this.onDisconnect(!1,"link::onConnectFailed")};n.onError=function(){var e=arguments[0];if(e){this.api.reportLogs({event:"connect_timeout"});if("undefined"!=typeof e.x5ImgDecodeStatus)return;else if("[object Object]"===Object.prototype.toString.call(e)&&Object.keys(e).length<=0)return;this.onMiscError("连接错误",new s(e,"LINK_ERROR",{
callFunc:"link::onError"}))}this.connecting=!1};n.onDisconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var r=this;r.connected=e;r.connecting=!1;r.markAllCallbackInvalid(s.newNetworkError({callFunc:t}));r.stopHeartbeat();r.reconnect()};n.willReconnect=function(){var e=this;return e.shouldReconnect&&e.needReconnect&&e.retryCount<e.reconnectionAttempts};n.reconnect=function(){var e=this;if(e.willReconnect())if(e.socket&&e.socket.socket&&e.socket.socket.transport&&e.socket.socket.transport.websocket){e.logger.info("link::reconnect: on socket closed");e.socket.socket.transport.onConnectionOver=function(){e.logger.log("link::reconnect: on connectionOver");clearTimeout(e.reconnectTimer);e.doReconnect()};try{e.socket.socket.transport.websocket.close()}catch(t){e.logger.warn("link::reconnect: force disconnect error:",t)}}else{clearTimeout(e.reconnectTimer);e.reconnectTimer=setTimeout(function(){e.logger.info("link::reconnect: on socket timeout");e.doReconnect()},3e4)}else e.notifyDisconnect()};n.doReconnect=function(){var e=this;e.socket=null;if(e.connected)e.autoconnect=!0;e.retryCount++;e.appLogin=1;var t=e.backoff.duration();e.logger.info("link::reconnect: will retry after "+t+"ms, retryCount "+e.retryCount);e.options.onwillreconnect({retryCount:e.retryCount,duration:t});clearTimeout(e.connectTimer);e.connectTimer=setTimeout(function(){e.connect()},t)};n.notifyConnectError=function(e){var t=this;var r=s.newConnectError({message:e,callFunc:"link::notifyConnectError"});t.logger.error("link::notifyConnectError:",r);t.options.onerror(r)};n.notifyDisconnect=function(e){var t=this;if(!t.hasNotifyDisconnected){t.hasNotifyDisconnected=!0;t.disconnectSocket();e=e||new s;e.retryCount=t.retryCount;e.willReconnect=t.willReconnect();if(t.backoff)t.backoff.reset();t.retryCount=0;if(t.socket&&t.socket.socket&&t.socket.socket.transport&&t.socket.socket.transport.websocket){t.logger.info("link::notifyDisconnect: ondisconnected",e);t.socket.socket.transport.onConnectionOver=function(){t.socket=null;t.options.ondisconnect(e)}}else{t.logger.info("link::notifyDisconnect: ondisconnected/no transport ws",e);t.options.ondisconnect(e)}if(t.onWbNotifyHangup instanceof Function)t.onWbNotifyHangup({content:{account:t.account,channelId:null,timetag:+Date()}})}};n.disconnectSocket=function(){var e=this;if(e.isConnected()||e.connecting)try{e.connecting=!1;e.shouldReconnect=!1;e.needReconnect=!1;e.socket.disconnect()}catch(t){e.logger.info("link::disconnectSocket: disconnect failed, error ",t)}}},"./src/im/protocol/base/index.js":function(e,t,r){"use strict";function n(e){var t=this;if(s.undef(e.secure))e.secure=!0;t.options=s.copy(e);t.keepNosSafeUrl=t.options.keepNosSafeUrl||!1;if(s.notundef(e.defaultLinkUrl)&&s.isString(e.defaultLinkUrl))i.optionDefaultLinkUrl=t.options.defaultLinkUrl.trim();else i.optionDefaultLinkUrl="";t.init();t.connect();t.initConnecting=!0}var s=r("./src/util/index.js");var i=r("./src/util/config.js");var o=r("./src/im/model/nimerror.js");var a=n.fn=n.prototype;a.init=function(){var e=this;e.logger=e.options.logger;e.getNosOriginUrlReqNum=0;e.checkNosReqNum=0;e.cmdTaskArray=[];e.timerMap={};e.cmdCallbackMap={};e.cmdContentMap={};e.initConnect();e.reset()};a.reset=function(){var e=this;e.resetConnect()};a.setOptions=function(e){var t=this;var r=t.options;var n=Object.keys(r);var i=n.indexOf("account");if(i!==-1)n.splice(i,1);e=s.filterObj(e,n);t.options=s.merge(r,e);t.reset()};a.sendCmd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var r=arguments[2];var n=this;n.heartbeat();if("heartbeat"!==e)n.logger.warn("protocol::sendCmd: "+e,t);var s=e;e=n.parser.createCmd(e,t);var i=e.SER;var o;t=t||{};n.cmdContentMap[i]=t;if(t.single){delete t.single;o=Object.keys(t);if(1===o.length)n.cmdContentMap[i]=t[o[0]]}if(t.NOTSTORE){o=t.NOTSTORE.split(" ");o.forEach(function(e){delete t[e]});delete t.NOTSTORE}r=r||t.callback;if(r)n.cmdCallbackMap[i]=r;n.cmdTaskArray.push({cmdName:s,cmd:JSON.stringify(e)});n.startCmdTaskTimer()};a.startCmdTaskTimer=function(){var e=this;if(!e.cmdTaskTimer)e.cmdTaskTimer=setTimeout(function(){var t=e.cmdTaskArray.shift();e.cmdTaskTimer=null;if(t)e.executeCmdTask(t);if(e.cmdTaskArray.length)e.startCmdTaskTimer()},0)};a.executeCmdTask=function(e){var t=this;var r=e.cmdName;var n=e.cmd;n=JSON.parse(n);var s=n.SER;if(t.isFrequencyControlled(r)){t.logger.warn("protocol::executeCmdTask: "+r+" hit freq control");t.markCallbackInvalid(s,o.newFrequencyControlError({callFunc:"protocol::executeCmdTask",message:r+" hit freq control"}))}else if(!t.isConnected()){t.logger.warn("protocol::executeCmdTask: "+r+" not connected");t.markCallbackInvalid(s,o.newSocketStateError({callFunc:"protocol::executeCmdTask",message:r+" not connected"}))}else{if("heartbeat"!==r)t.logger.log("protocol::sendCmd: "+r+" "+JSON.stringify(n));t.doSendCmd(n)}};a.isFrequencyControlled=function(e){var t=this.frequencyControlMap&&this.frequencyControlMap[e];if(t)if(Date.now()<t.from+t.duration)return!0;else delete this.frequencyControlMap[e]};a.doSendCmd=function(e){function t(){r.markCallbackInvalid(n,o.newSocketStateError({callFunc:"protocol::doSendCmd",message:"ser "+n+" socketSendJson Error"}));r.onDisconnect(!0,"protocol::doSendCmd:socketSendJson")}var r=this;var n=e.SER;r.timerMap[n]=setTimeout(function(){r.markCallbackInvalid(n,o.newTimeoutError({callFunc:"protocol::doSendCmd",message:"ser "+n+" Timeout Error"}))},i.cmdTimeout);try{if(r.socket&&r.socket.send)r.socket.send(JSON.stringify(e));else t()}catch(s){t()}};a.getObjWithSer=function(e){var t=this;var r=t.cmdContentMap[e];if(r&&!r.isImSyncDataObj)delete t.cmdContentMap[e];return r&&s.copy(r)};a.getCallbackWithSer=function(e){var t=this;var r=t.cmdCallbackMap[e];if(r&&!r.isImSyncDataCb)delete t.cmdCallbackMap[e];return r};a.getTimerWithSer=function(e){var t=this;var r=t.timerMap[e];delete t.timerMap[e];return r};a.clearTimerWithSer=function(e){var t=this;var r=t.getTimerWithSer(e);if(r)clearTimeout(r)};a.markCallbackInvalid=function(e,t){var r=this;r.getObjWithSer(e);r.clearTimerWithSer(e);var n=r.getCallbackWithSer(e);if(n){var s=n.options;setTimeout(function(){n(t||o.newUnknownError({ser:e}),s)},0)}};a.markAllCallbackInvalid=function(e){var t=this;Object.keys(this.cmdCallbackMap).forEach(function(r){t.markCallbackInvalid(r,e)})};a.getPacketObj=function(e){var t=null;if(e)if(e.raw){var r=e.raw.ser;if(s.notundef(r))t=this.getObjWithSer(r)}return t};a.callPacketAckCallback=function(e){var t=this;if(e&&e.raw){var r=e.raw.ser;if(s.notundef(r)){t.clearTimerWithSer(r);var n=t.getCallbackWithSer(r);if(n){if(n.originUrl&&e.obj&&e.obj.file){e.obj.file._url_safe=e.obj.file.url;e.obj.file.url=n.originUrl;if("audio"===e.obj.type)e.obj.file.mp3Url=n.originUrl+(~n.originUrl.indexOf("?")?"&":"?")+"audioTrans&type=mp3"}if(e.promise)e.promise.then(function(){n(e.error,e.obj)},function(s){s.callFunc="protocol::callPacketAckCallback";s.message="Resp Promoise Error: cmd: "+e.cmd+", ser: "+r;var i=o.customError("CALLBACK_ACK_ERR",s);t.logger.error("protocol::callPacketAckCallback: promise error "+JSON.stringify(s));n(i,e.obj,e.content)});else n(e.error,e.obj,e.content)}}}};a.onMessage=function(e){var t=this;t.heartbeat();t.parser.parseResponse(e).then(function(e){if(e.notFound)t.logger.warn("protocol::onMessage: packet not found "+JSON.stringify(e));if(e.error){e.error.message=e.cmd+" error: "+e.error.message;t.logger.error("protocol::onMessage: packet error "+JSON.stringify(e.error))}else if(!e.content&&"heartbeat"!==e.cmd)t.logger.warn("protocol::onMessage: packet.content undefined "+JSON.stringify(e));if(e.frequencyControlDuration){t.logger.error("protocol::onMessage: server freq control "+JSON.stringify(e.cmd));t.frequencyControlMap=t.frequencyControlMap||{};t.frequencyControlMap[e.cmd]={from:+new Date,duration:e.frequencyControlDuration}}e.obj=t.getPacketObj(e);if("heartbeat"!==e.cmd&&"getClientAntispam"!==e.cmd)t.logger.log("protocol::recvCmd: "+e.cmd+" "+e.rawStr);var r="process"+s.capFirstLetter(e.service);if(t[r]){if("heartbeat"!==e.cmd)t.logger.warn("protocol::recvCmd: "+e.cmd+" "+r,e.content);if("syncDone"===e.cmd){if(t.cmdCallbackMap[e.raw.ser]&&t.cmdCallbackMap[e.raw.ser].isImSyncDataCb){t.cmdCallbackMap[e.raw.ser].isImSyncDataCb=!1;var n=function(e,t){this.checkNosReqNum++;if(!(this.getNosOriginUrlReqNum<=0||this.checkNosReqNum>=10))setTimeout(n,300);else this[e](t)}.bind(t,r,e);n.call(t,r,e)}}else t[r](e)}else t.logger.warn("protocol::onMessage: "+r+" not found");t.callPacketAckCallback(e)})};a.onMiscError=function(e,t,r){if(t)this.notifyError(e,t,r)};a.onCustomError=function(e,t){var r=o.customError(e,t);var n=t.message||"未知错误";this.onMiscError(n,r)};a.notifyError=function(e,t,r){var n=this;if(n.isConnected()){n.logger.error((e||"")+" "+n.name,t,r);n.options.onerror(t,r)}};a.emitAPI=function(e){var t=e.type,r=e.obj;this.api.emit(t,r)};e.exports=n;r("./src/im/protocol/base/connect.js");r("./src/im/protocol/base/auth.js");r("./src/im/protocol/base/link.js");r("./src/im/protocol/base/misc.js");r("./src/im/protocol/base/avSignal.js")},"./src/im/protocol/base/link.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/base/index.js").fn;var s=r("./src/util/config.js");n.processLink=function(e){switch(e.cmd){case"heartbeat":}};n.startHeartbeat=function(){var e=this;e.stopHeartbeat();e.heartbeatTimer=setTimeout(function(){e.sendCmd("heartbeat",null,e.onHeartbeat.bind(e))},s.heartbeatInterval)};n.stopHeartbeat=function(){var e=this;if(e.heartbeatTimer){clearTimeout(e.heartbeatTimer);e.heartbeatTimer=null}};n.onHeartbeat=function(e,t){var r=this;if(!e)r.startHeartbeat();else{e.callFunc="link::onHeartbeat";r.api.reportLogs({event:"ping_timeout"});r.onCustomError("heartbeat error","HEARTBEAT_ERROR",e)}};n.heartbeat=function(){}},"./src/im/protocol/base/misc.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/base/index.js").fn;var s=r("./src/im/model/ImageOp.js");n.processMisc=function(e){
switch(e.cmd){case"getSimpleNosToken":if(!e.error)e.obj=e.content.nosTokens[0];break;case"getNosToken":if(!e.error)e.obj=e.content.nosToken;break;case"notifyUploadLog":if(!e.error)this.emitAPI({type:"notifyUploadLog"});break;case"audioToText":if(!e.error)e.obj.text=e.content.text;break;case"processImage":e.obj.imageOps=s.reverseImageOps(e.obj.imageOps);if(!e.error)e.obj={url:e.content.url};break;case"getNosTokenTrans":if(!e.error)e.obj={nosToken:e.content.nosToken,docId:e.content.docId};break;case"getNosOriginUrl":if(!e.error)e.obj=e.content.nosFileUrlTag.originUrl;break;case"notifyTransLog":if(!e.error)this.emitAPI({type:"notifyTransLog",obj:e.content.transInfo});break;case"fetchFile":if(!e.error)e.obj=e.content;break;case"fetchFileList":if(!e.error)e.obj=e.content;break;case"removeFile":if(!e.error)e.obj=e.content}}},"./src/im/protocol/im/auth.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/im/model/loginPort.js");n.assembleLogin=function(){var e=this;var t=e.assembleIMLogin();if(e.addPushInfo instanceof Function)return e.addPushInfo(t);else return Promise.resolve({login:t})};n.afterLogin=function(){var e=this;if(this.initPush instanceof Function)this.initPush();var t=this.db;if(t.enable){var r=this.account;if(this.options.appendAppKeyForDBName)r+="-"+this.options.appKey;this.db.init(r).then(function(){e.notifyLogin();e.syncData()},function(r){e.logger.warn("link::afterLogin: no db",r);t.reset(!1);e.notifyLogin();e.syncData()})}else{this.logger.info("link::afterLogin: no db");this.notifyLogin();this.syncData()}};n.processAuth=function(e){var t=this;switch(e.cmd){case"login":if(!e.error){e.content=e.content||{};t.loginAndroidPush&&t.loginAndroidPush(e.content.aosPushInfo||{});e.obj=e.content.loginRes;t.connectionId=e.content.loginRes.connectionId;t.onLoginPortsChange(e,2)}break;case"kicked":t.onKicked(e);return;case"multiPortLogin":t.onLoginPortsChange(e,e.content.state);break;case"kick":if(!e.error)e.obj.deviceIds=e.content.deviceIds}};n.onLoginPortsChange=function(e,t){var r=this;var n=e.content.loginPorts;if(n&&n.length){var i=!0;switch(t){case 2:i=!0;break;case 3:i=!1}n.forEach(function(e){e.type=s.reverseType(e.type);e.time=+e.time;e.online=i});n=n.filter(function(e){return e.connectionId!==r.connectionId});if(n.length){r.logger.info("link::onLoginPortsChange:",n);r.options.onloginportschange(n)}}};n.kickedReasons=["","samePlatformKick","serverKick","otherPlatformKick","silentlyKick"];n.kickedMessages=["","不允许同一个帐号在多个地方同时登录","被服务器踢了","被其它端踢了","悄悄被踢"]},"./src/im/protocol/im/chatroom.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;n.processChatroom=function(e){var t=this;switch(e.cmd){case"getChatroomAddress":t.onChatroomAddress(e)}};n.onChatroomAddress=function(e){if(!e.error)e.obj.address=e.content.address}},"./src/im/protocol/im/connect.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/config.js");var i=r("./src/util/index.js");var o=r("./src/util/ajax/index.js");n.refreshSocketUrl=function(){function e(e){r.socketUrls=[];if(s.isWeixinApp)e=e.data;else e=JSON.parse(e);e.common.link.forEach(function(e){r.socketUrls.push(s.formatSocketUrl({url:e,secure:r.options.secure}))});e.common["link.default"].forEach(function(e){e=s.formatSocketUrl({url:e,secure:r.options.secure});if(r.socketUrls.indexOf(e)===-1)r.socketUrls.push(e)});try{s.uploadUrl=e.nosup[0]}catch(t){}s.chunkUploadUrl=s.chunkUploadUrl||e["nos-chunk"]||"";r.logger.info("link::refreshSocketUrl: ajax load, got socket urls ",r.socketUrls);r.connectToUrl(r.getNextSocketUrl())}function t(e){r.logger.error("link::refreshSocketUrl: ajax lbs error",e);r.api.reportLogs({event:"nimlb",code:3001});var t=s.getDefaultLinkUrl(r.options.secure);if(t){r.logger.info("link::refreshSocketUrl: use default link url",t);r.connectToUrl(t)}else r.onDisconnect(!1,"link::refreshSocketUrl")}var r=this;var n=r.options;var a=s.info;var c=n.lbsUrl;c=c+i.genUrlSep(c)+"k="+n.appKey+"&id="+n.account+"&sv="+a.sdkVersion+"&pv="+a.protocolVersion;r.logger.info("link::refreshSocketUrl: ajax "+c);if(s.isWeixinApp){c=c.replace(/:\d+/,"");wx.request({url:c,success:e,fail:t})}else o(c,{proxyUrl:i.url2origin(c)+"/lbs/res/cors/nej_proxy_frame.html",timeout:s.xhrTimeout,onload:e,onerror:t})}},"./src/im/protocol/im/eventService.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){e=e||{};var t=c.copy(e);if(t.clientType)t.clientType=u[t.clientType]||"";if(t.serverCustom){t.custom=JSON.parse(t.serverCustom);if("string"==typeof t.custom[0])t.custom=t.custom[0];delete t.serverCustom}return t}var i=r("./src/util/device.js");var o=n(i);var a=r("./src/im/protocol/im/index.js").fn;var c=r("./src/util/index.js");var u=o["default"].clientTypeMap;a.processEventService=function(e){var t=this;var r=e.content;var n=e.error;var i=t.options||{};if(n){n.callFunc="events::processEventService";t.onCustomError("事件服务解包失败","EVENT_SERVICE_ERROR",n)}switch(e.cmd){case"pushEvent":if(c.isFunction(i.onpushevents)){var o={msgEvents:[s(r.msgEvent)]};i.onpushevents(o)}break;case"pushEvents":if(c.isFunction(i.onpushevents)){var a=r.msgEvents;var u=a.map(function(e){return s(e)});a={msgEvents:u};i.onpushevents(a)}}}},"./src/im/protocol/im/filter.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;n.processFilter=function(e){var t=this;switch(e.cmd){case"sendFilterMsg":t.onSendMsg(e,!0);break;case"filterMsg":t.onMsg(e,!0);break;case"filterSysMsg":t.onSysMsg(e,!0);break;case"sendFilterCustomSysMsg":t.onSendSysMsg(e,!0)}}},"./src/im/protocol/im/friend.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=s.objs2accounts;var o=r("./src/im/model/friend.js");var a=r("./src/im/model/user.js");n.processFriend=function(e){var t=this,r=e.obj,n=e.content,s=e.error;switch(e.cmd){case"friendRequest":t.updateFriendSysMsg(e);if(!s)t.onFriendRequest(r);break;case"syncFriendRequest":t.onFriendRequest(n,!0);break;case"deleteFriend":if(!s)t.onDeleteFriend(r);break;case"syncDeleteFriend":t.onDeleteFriend(n,!0);break;case"updateFriend":if(!s)t.onUpdateFriend(r);break;case"syncUpdateFriend":t.onUpdateFriend(n.friend,!0);break;case"getFriends":t.onFriends(e);break;case"syncFriends":t.onFriends(e);break;case"syncFriendUsers":t.onFriendUsers(e)}};n.onFriends=function(e){function t(){if(m)l.forEach(function(e){e=o.reverse(e);if(e.valid)f.push(e);else p.push(e)});s.logger.info("friend::onFriends: parse friends",i(f),f,"delete",i(p),p);if(!l.length)m=!1;else{m=!0;d=e.content.timetag}}function r(t,r){e.promise=new Promise(function(e,i){function o(){if(!u)a.getFriends().then(function(r){f=r;n();e();t()}).then(void 0,function(e){e._msg="get friends error";i(e);r(e)});else{n();e();t()}}if(m)a.mergeFriends(f,p,d).then(function(){o()}).then(void 0,function(e){e._msg="merge friends error";i(e);r(e)});else{s.logger.info("friend::onFriends: no merge friends");o()}}).then(void 0,function(e){e._msg="merge friends data error";r(e);throw e})}function n(){s.timetags.friends=d;f.invalid=p;if(u){s.syncResult.friends=f;s.syncResult.invalidFriends=p}else{s.logger.info("friend::onFriends: get friends bingo",i(f),f);e.obj=f}}var s=this,a=s.db,c=e.error,u=s.packetFromSync(e),l=e.content.friends,m=!0,d,f=[],p=[];var g=new Promise(function(e,s){if(!c){t();if(a.enable)r(e,s);else{n();e()}}else if(u)s(c)})["catch"](function(e){s.logger.error("friend::onFriends: ",e);return Promise.reject(e)});if(u){g.cmd="friends";s.syncPromiseArray.push(g)}};n.onFriendRequest=function(e,t){var r=Promise.resolve();var n=this;var s=n.db;var i=e.type;i=e.type=o.getTypeFromByte(i)||i;var a="addFriend"===i||"passFriendApply"===i;if(a){var c=e.friend=o.assembleFriend(e.account);if(s.enable)r=s.putFriend(c)}if(t)n.onSyncFriendAction(e);return r};n.onSyncFriendAction=function(e){var t=this;t.logger.info("friend::onSyncFriendActionon:",e);t.options.onsyncfriendaction(e)};n.onDeleteFriend=function(e,t){var r=Promise.resolve();var n=this;var s=n.db;if(s.enable)r=s.deleteFriend(e.account);if(t){e.type="deleteFriend";n.onSyncFriendAction(e)}return r};n.onUpdateFriend=function(e,t){var r=this;var n=r.db;var s=o.reverse(e);if(n.enable)n.updateFriend(s);if(t)r.onSyncFriendAction({type:"updateFriend",friend:s})};n.onFriendUsers=function(e){var t=this;var r=t.db;var n=e.content;var s=n.users.map(function(e){return a.reverse(e)});t.logger.warn("friend::onFriendUsers: parse users",i(s),s);var o=n.timetag;var c=Promise.resolve();if(r.enable)c=r.mergeFriendUsers(s,o);t.timetags.friendUsers=o;c.cmd="friendUsers";t.syncPromiseArray.push(c);t.syncResult.users=s;if(!t.syncing)t.onSyncDone()};n.updateFriendSysMsg=function(e){var t=e.obj;var r;var n=e.error;var i;if(e.obj.idServer){if(!n){var a=t.type;a=o.getTypeFromByte(a)||a;switch(a){case"passFriendApply":r="passed";break;case"rejectFriendApply":r="rejected"}}else{r="error";n=s.filterObj(n,"code message")}i={idServer:t.idServer,state:r};if(n)i.error=n;this.updateSysMsg(i)}}},"./src/im/protocol/im/index.js":function(e,t,r){"use strict";function n(e){var t=this;c.verifyOptions(e,"appKey account token","protocol::IMProtocol");c.verifyCallback(e,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onUpdateSuperTeamMember","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onupdateteammember","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol");
t.db=e.api.db=new s({logger:e.logger});i.call(t,e)}var s=r("./src/im/db/index.js");var i=r("./src/im/protocol/base/index.js");var o=r("./src/im/model/nimerror.js");var a=r("./src/util/config.js");var c=r("./src/util/index.js");var u=c.undef;var l=r("./src/im/model/pushNotificationMultiportConfig.js");var m=r("./src/im/protocol/parser/index.js");var d=r("./src/im/model/systemMessage.js");var f=i.fn;var p=n.fn=n.prototype=Object.create(f);p.init=function(){var e=this;f.init.call(e);m.IM.setProtocol(e);e.parser=m.IM;e.sendCmd.bind(e);e.socketUrls=[];e.syncing=!0;e.hasSynced=!1;e.hasSyncedTeamMembers=!1;e.syncPromiseArray=[];e.syncResult={};e.syncTeamMembersPromiseArray=[];e.syncSuperTeamMembersPromiseArray=[];e.syncTeamMembersResult={};e.timetags={};e.sysMsgUnread=d.completeUnread({});e.resetUnsettledMsgs();e.resetUnsettledSysMsgs();e.msgPromise=Promise.resolve();e.sysMsgPromise=Promise.resolve();e.sessionSet={};e.msgReceiptTasks={};e.userSet={};e.pushNotificationMultiportConfig=l.getDefaultConfig()};p.reset=function(){var e=this;f.reset.call(e);var t=e.options;e.db.reset(t.db);if(u(t.lbsUrl))t.lbsUrl=a.lbsUrl;e.resetAutoMarkRead()};p.resetAutoMarkRead=function(){var e=this.options;c.verifyBooleanWithDefault(e,"autoMarkRead",!0,"","protocol::resetAutoMarkRead")};p.resetUnsettledMsgs=function(){var e=this;e.unhandledMsgs=[];e.unupdatedMsgs=[]};p.resetUnsettledSysMsgs=function(){var e=this;e.unhandledSysMsgs=[];e.unupdatedSysMsgs=[]};p.packetFromSync=function(e){return!e.obj||!!e.obj.sync};e.exports=n;r("./src/im/protocol/im/connect.js");r("./src/im/protocol/im/auth.js");r("./src/im/protocol/im/sync.js");r("./src/im/protocol/im/user.js");r("./src/im/protocol/im/friend.js");r("./src/im/protocol/im/robot.js");r("./src/im/protocol/im/team.js");r("./src/im/protocol/im/superTeam.js");r("./src/im/protocol/im/notify.js");r("./src/im/protocol/im/msg.js");r("./src/im/protocol/im/msgReceipt.js");r("./src/im/protocol/im/msgDelete.js");r("./src/im/protocol/im/sysMsg.js");r("./src/im/protocol/im/session.js");r("./src/im/protocol/im/sessionAck.js");r("./src/im/protocol/im/chatroom.js");r("./src/im/protocol/im/filter.js");r("./src/im/protocol/im/eventService.js")},"./src/im/protocol/im/msg.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=s.undef;var o=r("./src/util/device.js");var a=r("./src/im/model/teamMember.js");var c=r("./src/im/model/superTeamMember.js");var u=r("./src/im/model/session.js");var l=r("./src/im/protocol/map/configIM.js");n.processMsg=function(e){var t=this;switch(e.cmd){case"sendMsg":t.onSendMsg(e);break;case"msg":t.onMsg(e);break;case"sysMsg":t.onSysMsg(e);break;case"broadcastMsg":t.onBroadcastMsg(e);break;case"sendCustomSysMsg":t.onSendSysMsg(e);break;case"getHistoryMsgs":case"searchHistoryMsgs":t.onHistoryMsgs(e);break;case"syncSendMsg":t.onMsg(e);break;case"deleteSessions":t.onDeleteSessions(e);break;case"sendMsgReceipt":t.onSendMsgReceipt(e);break;case"msgReceipt":t.onMsgReceipt(e);break;case"onDeleteMsg":t.onDeleteMsg(e);break;case"onMsgDeleted":t.onMsgDeleted(e);break;case"onDeleteMsgOfflineRoaming":t.onDeleteMsgOfflineRoaming(e);break;case"onMarkSessionAck":t.onMarkSessionAck(e);break;case"syncMarkSessionAck":t.syncMarkSessionAck(e)}};n.checkIgnore=function(e){var t=this;e.forEach(function(e){if("notification"===e.type&&!e.ignore&&t.options.shouldIgnoreNotification(e))e.ignore=!0})};n.filterIgnore=function(e){return e.filter(function(e){return!e.ignore})};n.genSessionByMsgs=function(e){var t=this;t.checkIgnore(e);return u.genSessionByMsgs(t.message.Message,e)};n.onRoamingMsgs=function(e){var t=this;var r=t.message;var n=r.Message;var s=n.getMaxTimetag;var i=r.reverseMsgs(e.content.msgs);var o=s(i);i=n.sortMsgs(i);i=n.deduplication(i);var a=i[0];var c=a.sessionId;var u=t.genSessionByMsgs(i);t.cacheSyncedSession(u);var l=t.putMsg(i,"roamingMsgs").then(function(e){i=e;i=t.filterIgnore(i);if(i.length){t.logger.info("msg::onRoamingMsgs: putRoamingMsgs",c,i.length,i);t.syncResult.roamingMsgs=t.syncResult.roamingMsgs||[];t.syncResult.roamingMsgs.push({sessionId:c,scene:a.scene,to:a.target,msgs:i,timetag:o});if(!t.syncing)t.onSyncDone()}})["catch"](function(e){t.logger.error("msg::onRoamingMsgs: ",e);return Promise.reject(e)});l.cmd="roamingMsgs-"+c;t.syncPromiseArray.push(l)};n.onOfflineMsgs=function(e,t){function r(e){if(c.length){var t=i.getMaxTimetag(c);var r=c[0].scene;var s=c[0].target;n.markMsgRead(c);c=i.sortMsgs(c);c=i.deduplication(c);var o=n.genSessionByMsgs(c);n.cacheSyncedSession(o);m=n.putMsg(c,"offlineMsgs").then(function(i){c=i;c=n.filterIgnore(c);if(c.length){n.logger.info("msg::onOfflineMsgs： toreLastSession",d,e,c.length,c);n.syncResult[d]=n.syncResult[d]||[];n.syncResult[d].push({sessionId:e,scene:r,to:s,msgs:c,timetag:t})}})["catch"](function(e){n.logger.error("msg::onOfflineMsgs: ",e);return Promise.reject(e)});m.cmd="offlineMsgs-"+e;n.syncPromiseArray.push(m)}}var n=this;var s=n.message;var i=s.Message;var o=null;if(t)o={filter:!0};var a=s.reverseMsgs(e.content.msgs,{modifyObj:o});var c=[];var u="";var l;var m;var d=t?"offlineFilterMsgs":"offlineMsgs";a.forEach(function(e){l=e.sessionId;if(l!==u){r(u);c=[];c.push(e);u=l}else c.push(e)});r(u)};n.markUnreadByMsgsPromise=function(e){var t=this;var r=t.db;if(r.enable)r.getSession(e).then(function(r){if(r.ack)t.markUnreadBySessionAck({sessionId:e,ack:r.ack})})};n.completeMsg=function(e){var t=this;e.from=t.account;e.fromNick=t.myInfo&&t.myInfo.nick;e.fromClientType="Web";e.fromDeviceId=o.deviceId;if(!e.time)e.time=+new Date;return e};n.onMsgs=function(e){var t=this;t.message.reverseMsgs(e.content.msgs,{mapper:function r(e){t.handleMsg(e)}})};n.onMsg=function(e,t){var r=this;var n=r.message.reverse(e.content.msg);if(t)n.filter=!0;if(r.syncing){r.logger.log("msg::onMsg:is in syncing ...");r.unhandledMsgs.push({type:"onMsg",msg:n})}else r.handleMsg(n)};n.onBroadcastMsgs=function(e){var t=this;var r=e.content.broadcastMsgs;r=r.sort(function(e,t){return e.broadcastId-t.broadcastId});t.putBroadcastMsgs(r)};n.onBroadcastMsg=function(e){var t=this;var r=e.content.broadcastMsg;r.time=r.timestamp;if(t.syncing)t.unhandledMsgs.push({type:"onBroadcastMsg",msg:r});else if(r)t.putBroadcastMsg(r)};n.pushMsgTask=function(e){var t=this;t.msgPromise=t.msgPromise.then(function(){return e()})};n.handleMsg=function(e){var t=this;var r=t.db;var n=e.time;t.markMsgRead(e);t.msgPromise=t.msgPromise.then(function(){return t.putMsg(e,"onMsg")}).then(function(s){t.logger.log("msg::handleMsg:putMsg: ",e);if(!r.enable)return Promise.resolve();var i=r.updateRoamingMsgTimetag(n);var o=Promise.resolve();if("superTeam"===e.scene)o=r.updateSuperTeamRoamingMsgTimetag(n);return Promise.all([i,o])}).then(function(){t.logger.log("msg::handleMsg:updateRoamingMsgTimetag: ",n,e);if(e)return t.checkUserUpdate(e)}).then(function(){if(e){var r=e.type;t.logger.log("msg::handleMsg:checkUserUpdate: "+e.scene+" "+r+" msg"+("notification"===r?" "+e.attach.type:""),e);switch(r){case"notification":return t.onTeamNotificationMsg(e)}}}).then(function(){if(e&&!e.ignore){t.logger.info("msg::handleMsg:onmsg: ",e);setTimeout(function(){t.options.onmsg(s.copy(e))},0)}}).then(void 0,function(e){e.callFunc="msg::handleMsg";t.onCustomError("消息处理错误",e)})};n.putMsg=function(e,t){function r(e){if("roamingMsgs"===t||"offlineMsgs"===t)n.cacheSyncedSession(e)}if(!s.isArray(e))e=[e];if(e[0].filter)return Promise.resolve(e);var n=this;var o=n.db;var a=o.enable;var c=Promise.resolve();var u=n.message.Message;var l=u.getLastMsg(e);var m=l.flow;var d=l.sessionId!==n.currSessionId;var f=n.genSessionByMsgs(e);r(f);var p=!1;var g=[];n.checkIgnore(e);n.logger.log("start");c=c.then(function(){if(!a&&!n.options.autoMarkRead&&"roamingMsgs"!==t&&f){n.sessionUnreadMsgs=n.sessionUnreadMsgs||{};n.sessionUnreadMsgs[f.id]=n.sessionUnreadMsgs[f.id]||[];n.sessionUnreadMsgs[f.id]=n.sessionUnreadMsgs[f.id].concat(e.filter(function(e){var t=n.options.shouldCountNotifyUnread(e);return t}))}if(a&&"roamingMsgs"!==t&&"offlineMsgs"!==t){n.logger.log("msg::putMsg:db.putMsg: ",f);return o.putMsg(e)}else return e}).then(function(t){var r=[];e.forEach(function(e){if(n.checkMsgUnique(e))r.push(e)});e=r;if(a)g=t;else g=e;return Promise.resolve(e)});c=c.then(function(e){if(e.length){f=n.genSessionByMsgs(e);r(f);if(a&&f)return new Promise(function(t,r){o.getSessions({sessionId:f.id}).then(function(r){if(r&&r.lastMsg){var s=r.lastMsg;if(f.lastMsg)if(f.lastMsg.time<s.time)f.lastMsg=s}n.logger.log("msg::putMsg:db.getSessions: ",f);if(g.length)if(f)o.putSession(f).then(function(e){t(e)});else t(r);else{p=!0;g=e;t(r)}})})}return Promise.resolve(f)});c=c.then(function(e){if(f)if(g.length){var s="roamingMsgs"===t;var c=n.options.syncSessionUnread;var u=f.id;var l=n.findSession(u)||{};var v=l.ack||0;var y="offlineMsgs"===t||s&&c||"onMsg"===t&&"in"===m&&d;if(y){if(a&&e){f=e;v=v||f.ack||0}else{e=l;if(e)f.unread=e.unread||0}r(f);f.unread=f.unread||0;var h=0;g.forEach(function(e){var t=n.options.shouldCountNotifyUnread(e);var r=("notification"!==e.type||"notification"===e.type&&t)&&(i(e.isUnreadable)||e.isUnreadable);if(r&&c)r=e.time>v&&"out"!==e.flow;if(r){h++;if(c&&!a){var s=l.unreadMsgs||[];s.push(e);f.unreadMsgs=s}}});console.log(f);f.unread+=h;n.logger.log("msg::putMsg:updateSession: ",f);r(f);if(a&&!p)return o.updateSession({id:f.id,unread:f.unread})}}});if("onMsg"===t)c=c.then(function(){if(e.length&&f){n.onUpdateSession(f);if(n.options.syncSessionUnread&&!d)n.api.resetSessionUnread(n.currSessionId)}});else if("sendMsg"===t&&!d&&f&&f.lastMsg&&f.lastMsg.isLocal){n.onUpdateSession(f);n.api.resetSessionUnread(n.currSessionId)}return c.then(function(){return Promise.resolve(e)})};n.putBroadcastMsgs=function(e){var t=this;var r=t.db;var n=e.length;if(n>0){t.doMarkBroadcastMsgsRead(e);if(r.enable){var i=e[n-1].broadcastId;r.updateBroadcastMsgTimetag(i);return r.putBroadcastMsg(e).then(function(){setTimeout(function(){t.doMarkMsgsRead();t.options.onbroadcastmsgs(s.copy(e))},0);return Promise.resolve(e);
})}else setTimeout(function(){t.options.onbroadcastmsgs(s.copy(e))},0)}return e};n.putBroadcastMsg=function(e){var t=this;var r=t.db;t.doMarkBroadcastMsgsRead([e]);if(r.enable){if(e.broadcastId)r.updateBroadcastMsgTimetag(e.broadcastId);return r.putBroadcastMsg(e).then(function(){setTimeout(function(){t.options.onbroadcastmsg(s.copy(e))},0);return Promise.resolve(e)})}else{setTimeout(function(){t.options.onbroadcastmsg(s.copy(e))},0);return e}};n.doMarkBroadcastMsgsRead=function(e){var t=7;var r=17;e=e.map(function(e){return e.broadcastId});this.sendCmd("batchMarkRead",{sid:t,cid:r,ids:e})};n.cacheSyncedSession=function(e){var t=this;if(e&&t.syncResult){e=s.merge({},e);t.syncResult.sessions=t.syncResult.sessions||{};var r=e.id;t.syncResult.sessions[r]=s.merge(t.syncResult.sessions[r],e);if(i(t.syncResult.sessions[r].unread))t.syncResult.sessions[r].unread=0;t.mergeSession(t.syncResult.sessions[r])}};n.checkMsgUnique=s.genCheckUniqueFunc("idClient");n.storeSendMsg=function(e){var t=this;if(t.syncing)t.unhandledMsgs.push({type:"sendMsg",msg:e});else{var r=t.putMsg(e,"sendMsg");t.msgPromise=t.msgPromise.then(function(){return r});return r}};n.updateSendMsgError=function(e){var t=this;if(t.syncing)t.unupdatedMsgs.push(e);else{var r=t.updateMsg(e);t.msgPromise=t.msgPromise.then(function(){return r});return r}};n.onSendMsg=function(e,t){function r(){n.completeMsg(s);var r=e.error&&7101===e.error.code;if(!e.error||r){s.idServer=e.content.msg.idServer;s.time=+e.content.msg.time}if(e.error)s.status="fail";else s.status="success";s=n.message.reverse(s);if(t)s.filter=!0;e.obj=s;if(n.syncing)n.unupdatedMsgs.push(s);else n.msgPromise=Promise.all([n.msgPromise,e.obj.promise]).then(function(e){if(!e.length)s.resend=!0;return n.updateMsg(s).then(function(){if(n.options.syncSessionUnread&&n.currSessionId===s.sessionId)n.api.resetSessionUnread(n.currSessionId);n.resolveMsgReceiptTask(s);return s})})}var n=this;var s=e.obj&&e.obj.msg||e.content.msg;if(!e.obj){var i=n.db;if(i&&i.enable)i.getMsgByIdClient(s.idClient).then(function(e){if(e){s=e;r()}},function(e){r()})}else r()};n.updateLocalMsg=function(e){var t=this;var r=t.updateMsg(e);t.msgPromise=t.msgPromise.then(function(){return r});return r};n.updateMsg=function(e){if(e.filter)return Promise.resolve(e);var t=this;var r=t.db;var n="success"===e.status;var s=u.genSessionByMsg(e);var i=!!e.isLocal;if(r.enable)return r.updateMsg(e).then(function(o){var a=r.updateSession(s);var c=Promise.resolve();var u=Promise.resolve();if(n&&o&&!i){c=r.updateRoamingMsgTimetag(o.time);if("superTeam"===e.scene)u=r.updateSuperTeamRoamingMsgTimetag(o.time)}t.onUpdateSession(s);return Promise.all([a,c,u])});else{if(n&&!i)t.timetags.roamingMsgs=e.time;t.onUpdateSession(s);return Promise.resolve(e)}};n.updateRoamingMsgTimetag=function(e){var t=this;var r=t.db;if(r.enable)return r.updateRoamingMsgTimetag(e);else{t.timetags.roamingMsgs=e;return Promise.resolve(e)}};n.checkUserUpdate=function(e){var t=this;var r=e.from;if(r===t.account)return Promise.resolve();else return new Promise(function(n){function i(){t.api.getUser({account:r,sync:!0,done:function e(r,s){if(!r)setTimeout(function(){t.logger.log("user::checkUserUpdate: onupdateuser",s.account,s);t.options.onupdateuser(s)},0);n()}})}var o=t.userSet[r];if(!o)i();else{var a=+o.updateTime;var c=+e.userUpdateTime;if(!isNaN(a)&&!isNaN(c)&&s.isNumber(a)&&s.isNumber(c)&&a<c)i();else n()}})};n.processUnsettledMsgs=function(){var e=this;e.unhandledMsgs.forEach(function(t){var r=t.msg;switch(t.type){case"onMsg":e.handleMsg(r);break;case"sendMsg":e.msgPromise=e.msgPromise.then(function(){return e.putMsg(r)});break;case"onBroadcastMsg":e.msgPromise=e.msgPromise.then(function(){return e.putBroadcastMsg(r)})}});e.unupdatedMsgs.forEach(function(t){e.msgPromise=e.msgPromise.then(function(){return e.updateMsg(t)})});e.resetUnsettledMsgs()};n.onTeamNotificationMsg=function(e){var t=this;var r=t.db;var n=e.attach;var s=n.type;var i=e.from;var o=e.to;var a=e.time;var c=n.team;var u=n.account;var l=n.accounts;switch(s){case"updateTeam":c.updateTime=a;return t.onUpdateTeam(c);case"addTeamMembers":return t.onAddTeamMembers(e,c,l);case"removeTeamMembers":return t.onRemoveTeamMembers(c,o,l);case"acceptTeamInvite":return t.onAddTeamMembers(e,c,[i]);case"passTeamApply":return t.onAddTeamMembers(e,c,[u]);case"addTeamManagers":return t.updateTeamManagers(e,o,l,!0,a);case"removeTeamManagers":return t.updateTeamManagers(e,o,l,!1,a);case"leaveTeam":return t.onRemoveTeamMembers(c,o,[i]);case"dismissTeam":return t.onDismissTeam(o,a);case"transferTeam":return t.transferTeam(e,c,i,u);case"updateTeamMute":return t.onUpdateTeamMembersMute(e,c,[u],n.mute);case"updateSuperTeam":c.updateTime=a;return t.onUpdateSuperTeam(c);case"addSuperTeamMembers":return t.onAddSuperTeamMembers(e,c,l);case"removeSuperTeamMembers":return t.onRemoveSuperTeamMembers(c,o,l);case"leaveSuperTeam":return t.onRemoveSuperTeamMembers(c,o,[i]);case"dismissSuperTeam":return t.onDismissSuperTeam(o,a)}};n.onAddSuperTeamMembers=function(e,t,r){var n=this;var i=n.db;var o=t.teamId;var a=c.assembleMembers(t,r);e.attach.members=a;var u={team:t,accounts:r,members:a};n.logger.info("team::onAddSuperTeamMembers: ",u);n.options.onAddSuperTeamMembers(s.simpleClone(u));if(i.enable){var l=i.putSuperTeamMembers(a);var m=Promise.resolve();if(r.indexOf(n.account)>-1&&t)m=i.putSuperTeam(t);return Promise.all([l,m])}};n.onRemoveSuperTeamMembers=function(e,t,r){var n=this;var i=n.db;var o={team:e,accounts:r};n.logger.info("team::onRemoveSuperTeamMembers:",o);n.options.onRemoveSuperTeamMembers(s.simpleClone(o));if(i.enable)if(r.indexOf(n.account)===-1){var a=i.removeSuperTeamMembersByAccounts(t,r);var c=Promise.resolve();if(e)c=i.putSuperTeam(e);return Promise.all([a,c])}else return i.leaveSuperTeam(t)};n.onDismissSuperTeam=function(e,t){var r=this;var n=r.db;var s={teamId:e};r.logger.info("team::onDismissSuperTeam:",s);r.options.onDismissSuperTeam(s);if(n.enable)return n.dismissSuperTeam(e,t)};n.onAddTeamMembers=function(e,t,r){var n=this;var i=n.db;var o=t.teamId;var c=a.assembleMembers(t,r);e.attach.members=c;var u={team:t,accounts:r,members:c};n.logger.info("team::onAddTeamMembers: ",u);n.options.onAddTeamMembers(s.simpleClone(u));if(i.enable){var l;var m=i.putTeam(t);var d=r.indexOf(n.account)===-1;if(d)l=i.putTeamMembers(c);else{n.logger.warn("team::onAddTeamMembers: user join team",o);m=new Promise(function(e){n.api.getTeamMembers({teamId:o,sync:!0,done:function t(){e()}})})}return Promise.all([l,m])}};n.onRemoveTeamMembers=function(e,t,r){var n=this;var i=n.db;var o={team:e,accounts:r};n.logger.info("team::onRemoveTeamMembers:",o);n.options.onRemoveTeamMembers(s.simpleClone(o));if(i.enable)if(r.indexOf(n.account)===-1){var a=i.removeTeamMembersByAccounts(t,r);var c=Promise.resolve();if(e)c=i.putTeam(e);return Promise.all([a,c])}else return i.leaveTeam(t)};n.updateTeamManagers=function(e,t,r,n,i){var o=this;var c=o.db;var u=e.attach.members=r.map(function(e){return{id:a.genId(t,e),type:n?"manager":"normal",updateTime:i}});var l={teamId:""+t,memberUpdateTime:i};e.attach.team=l;var m={team:l,accounts:r,isManager:n,members:u};o.logger.info("team::updateTeamManagers:",m);o.options.onUpdateTeamManagers(s.simpleClone(m));if(c.enable){var d=c.updateTeam(l);var f=c.updateTeamManagers(t,r,n,i);return Promise.all([d,f])}};n.onDismissTeam=function(e,t){var r=this;var n=r.db;var s={teamId:e};r.logger.info("team::onDismissTeam:",s);r.options.onDismissTeam(s);if(n.enable)return n.dismissTeam(e,t)};n.transferTeam=function(e,t,r,n){var i=this;var o=i.db;var c=t.teamId;var u=t.memberUpdateTime;var l={id:a.genId(c,r),type:"normal",updateTime:u};var m={id:a.genId(c,n),type:"owner",updateTime:u};e.attach.members=[l,m];var d={team:t,from:l,to:m};i.logger.info("team::transferTeam:",d);i.options.onTransferTeam(s.simpleClone(d));if(o.enable)return o.transferTeam(t,r,n)};n.onUpdateTeamMembersMute=function(e,t,r,n){var i=this;var o=i.db;var c=c;var u=r.map(function(e){return{id:a.genId(t.teamId,e),account:e,teamId:t.teamId,mute:n,updateTime:t.memberUpdateTime}});e.attach.members=u;var l={team:t,accounts:r,members:u,mute:n};i.logger.info("team::onUpdateTeamMembersMute:",l);i.options.onUpdateTeamMembersMute(s.simpleClone(l));if(o.enable){var m=o.updateTeamMembers(u);var d=o.putTeam(t);return Promise.all([m,d])}};n.onHistoryMsgs=function(e){if(!e.error)e.obj.msgs=this.message.reverseMsgs(e.content.msgs)};n.isFilterMsgs=function(e){return!!e[0].filter};n.splitMsgs=function(e,t,r,n){e.forEach(function(e){if(!e.filter)switch(e.scene){case"p2p":t.push(e);break;case"team":r.push(e)}else n.push(e)})};n.markMsgRead=function(e,t){if(!s.isArray(e))e=[e];var r=this;var n=r.db;if(n.enable||r.options.autoMarkRead||t){var i=[];var o=[];var a=[];r.splitMsgs(e,i,o,a);r.markP2pMsgsRead(i);r.markTeamMsgsRead(o);r.markFilterMsgsRead(a)}};n.markP2pMsgsRead=function(e){if(e.length){var t=l.idMap.msg.id;var r=l.idMap.msg.msg;this.doMarkMsgsRead(t,r,e)}};n.markTeamMsgsRead=function(e){if(e.length){var t=l.idMap.team.id;var r=l.idMap.team.teamMsg;this.doMarkMsgsRead(t,r,e)}};n.markFilterMsgsRead=function(e){if(e.length){var t=l.idMap.filter.id;var r=l.idMap.filter.filterMsg;this.doMarkMsgsRead(t,r,e)}};n.markSysMsgRead=function(e,t){if(!s.isArray(e))e=[e];var r=this;var n=r.db;if(n.enable||r.options.autoMarkRead||t){var i,o;if(r.isFilterMsgs(e)){i=l.idMap.filter.id;o=l.idMap.filter.filterSysMsg}else{i=l.idMap.msg.id;o=l.idMap.msg.sysMsg}r.doMarkMsgsRead(i,o,e)}};n.doMarkMsgsRead=function(e,t,r){if(r&&r.length){if(r[0].attach&&("netcallBill"===r[0].attach.type||"netcallMiss"===r[0].attach.type)){e=9;t=11}this.sendCmd("batchMarkRead",{sid:e,cid:t,ids:r.map(function(e){return e.idServer})})}}},"./src/im/protocol/im/msgDelete.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/im/model/systemMessage.js");var i=r("./src/im/model/session.js");var o=r("./src/util/index.js");n.onDeleteMsg=function(e){var t=this.db;delete e.obj.sysMsg;if(!e.error)e.promise=this.deleteLocalMsg(e.obj.msg).then(function(){
var r=e.obj.msg;if(t.enable)t.getTimetag("deleteMsg").then(function(e){e=e||0;if(r.time>=e)t.updateDeleteMsgTimetag((new Date).getTime())})})};n.onMsgDeleted=function(e){if(!e.error){var t=this;var r=t.db;var n=s.reverse(e.content.sysMsg);n=t.processDeleteMsgSysMsg(n);t.markSysMsgRead(n);t.deleteLocalMsg(n.msg).then(function(){if(r.enable)r.updateDeleteMsgTimetag(n.time+1);t.handleSysMsg(n)})}};n.processDeleteMsgSysMsg=function(e){var t=this;e.msg={};["scene","from","to"].forEach(function(t){e.msg[t]=e[t]});e.msg.idClient=e.deletedIdClient;e.msg.idServer=e.deletedIdServer;e.msg.time=e.deletedMsgTime;e.msg.fromNick=e.deletedMsgFromNick;e.opeAccount=e.opeAccount||e.from;e.msg.opeAccount=e.opeAccount;t.message.Message.setExtra(e.msg,t.account);return e};n.onDeleteMsgOfflineRoaming=function(e){if(!e.error){var t=this;var r=1===+e.content.type?"offline":"roaming";var n=s.reverseSysMsgs(e.content.sysMsgs,{mapper:function a(e){return t.processDeleteMsgSysMsg(e)}});t.logger.info("msg::onDeleteMsgOfflineRoaming: on delete "+r,n);if("offline"===r)t.markSysMsgRead(n);var i=e.content.timetag;t.timetags.deleteMsg=i;t.syncResult.deleteMsgTimetag=i;var o=t.putSysMsg(n,"offlineSysMsgs")["catch"](function(e){t.logger.error("msgDelete::onDeleteMsgOfflineRoaming: ",e);return Promise.reject(e)});o.cmd="deleteMsgSysMsgs "+r;t.syncPromiseArray.push(o);t.syncResult.deleteMsgSysMsgs=t.syncResult.deleteMsgSysMsgs||[];t.syncResult.deleteMsgSysMsgs.push({type:r,sysMsgs:n})}};n.deleteMsgOfflineRoaming=function(e,t){if(!e)return Promise.resolve();var r=this;r.logger.info("msg::deleteMsgOfflineRoaming: ",e,t);var n=r.db;var s=[];e.forEach(function(e){e.sysMsgs.forEach(function(e){var a=r.deleteLocalMsg(e.msg,{cbUpdateSession:function c(e){e=r.mergeSession(e);e=o.simpleClone(e);i.trim(e);var s=o.findObjIndexInArray(t,{value:e.id});if(s!==-1)t[s]=o.merge({},t[s],e);if(n.enable)return n.updateSession(e)}});s.push(a)})});return Promise.all(s).then(function(){if(n.enable)return n.updateDeleteMsgTimetag(r.syncResult.deleteMsgTimetag)})};n.deleteLocalMsg=function(e,t){var r=this;var n=r.db;t=t||{};var s=t.cbUpdateSession||r.updateLocalSession.bind(r);if(n.enable&&e){var i=!1;var o=null;var a=null;var c=e.sessionId;return n.getMsgs({sessionId:c,limit:1}).then(function(t){if(t&&t[0]&&t[0].idClient===e.idClient)i=!0}).then(function(){return n.getMsgByIdClient(e.idClient)}).then(function(t){a=t;return n.deleteMsg(e.idClient)}).then(function(){if(i)return n.getMsgs({sessionId:c,limit:1})}).then(function(e){if(i)if(e&&e[0])o=e[0]}).then(function(){if(r.options.rollbackDelMsgUnread)return n.getSessions({sessionId:c})}).then(function(e){var t={id:c,lastMsg:o};var n=e&&e.msgReceiptTime||0;if(e&&a&&n<a.time&&r.options.account===a.to&&e.unread){r.logger.log("msgDelete::deleteLocalMsg:db.getSessions: ",e);t.unread=e.unread-1}return s(t)})}else{if(r.options.rollbackDelMsgUnread&&e&&e.sessionId){var u=r.findSession(e.sessionId);var l=u.msgReceiptTime||0;if(u&&l<e.time&&r.options.account===e.to&&u.unread){r.logger.log("msgDelete::deleteLocalMsg:getSessions: ",u);u.unread=u.unread-1;r.onUpdateSession(u)}}return Promise.resolve()}}},"./src/im/protocol/im/msgReceipt.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");n.onOfflineMsgReceipts=function(e){var t=this;var r=t.db;var n=e.content.msgReceipts;var s=t.syncResult.msgReceipts=[];var i=[];var o;var a="msgReceipts";var c=t.syncResult.sessions||{};n.forEach(function(e){e.time=+e.time;var n=e.sessionId="p2p-"+e.from;a+="-"+n;o=Promise.resolve();var u=c[n];if(r.enable)o=r.getSession(n).then(function(s){s=s||u;if(s&&t.shouldUpdateSessionFromMsgReceipt(s,e)){var i=t.genSessionFromMsgReceipt(s,e);var o=t.syncResult.sessions;if(o&&o[n]){o=o[n];if(o.lastMsg&&i.lastMsg&&o.lastMsg.time>i.lastMsg.time)i.lastMsg=o.lastMsg}return r.putSession(i).then(function(e){if(e)t.cacheSyncedSession(e)})}})["catch"](function(e){t.logger.error("msgReceipt::onOfflineMsgReceipt: ",e);return Promise.reject(e)});else if(u)s.push(e);i.push(o)});o=Promise.all(i).then(function(){if(r.enable)return r.updateMsgReceiptsTimetag(e.content.timetag)});o.cmd=a;t.syncPromiseArray.push(o)};n.mergeSessionAndMsgReceipts=function(e,t){var r=this;var n={};e=e||[];t=t||[];e.forEach(function(e){n[e.id]=e});t.forEach(function(t){var s=n[t.sessionId];if(r.shouldUpdateSessionFromMsgReceipt(s,t)){var i=r.genSessionFromMsgReceipt(s,t);e=r.api.mergeSessions(e,i)}});return e};n.shouldUpdateSessionFromMsgReceipt=function(e,t){return!e||!e.msgReceiptServerTime||t.time>e.msgReceiptServerTime};n.genSessionFromMsgReceipt=function(e,t){var r=t.time;var n={id:t.sessionId,msgReceiptTime:r,msgReceiptServerTime:r};if(e&&e.id===t.sessionId)n=s.merge({},e,n);if(!e||!e.updateTime)n.updateTime=r;return n};n.onMsgReceipt=function(e){var t=this;var r=t.db;var n=e.content.msgReceipt;n.time=+n.time;var s=n.idClient;var i=Promise.resolve();if(r.enable&&s)i=r.getMsgByIdClient(s);i.then(function(e){var r;if(e)if(e.idServer)r=e.time;else{t.msgReceiptTasks[s]=n;return}else r=n.time;n.msgReceiptTime=r;t.updateSessionMsgReceiptTime(n)})};n.resolveMsgReceiptTask=function(e){var t=this;var r=t.msgReceiptTasks[e.idClient];if(r){r.msgReceiptTime=e.time;this.updateSessionMsgReceiptTime(r)}};n.updateSessionMsgReceiptTime=function(e){var t=this;var r=t.db;var n={id:"p2p-"+e.from,msgReceiptTime:e.msgReceiptTime,msgReceiptServerTime:e.time};if(r.enable)r.putSession(n);t.onUpdateSession(n)};n.onSendMsgReceipt=function(e){var t=this;if(!e.error){var r=e.obj.msgReceipt;var n=+r.time;var s=+e.content.msgReceipt.time;var i=t.sessionSet["p2p-"+r.to];i.msgReceiptSendTime=Math.min(n,s)}};n.shouldSendMsgReceipt=function(e){if(e&&"p2p"===e.scene&&"success"===e.status){var t=this.sessionSet[e.sessionId];if(t){var r=t.msgReceiptSendTime;return!r||r<e.time}}return!1};n.isMsgRemoteRead=function(e){var t=this;if(e&&"p2p"===e.scene&&"out"===e.flow&&"success"===e.status){var r=t.sessionSet[e.sessionId];if(r&&r.msgReceiptTime)return e.time<=r.msgReceiptTime}return!1}},"./src/im/protocol/im/notify.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/im/model/pushNotificationMultiportConfig.js");n.processNotify=function(e){var t=this;switch(e.cmd){case"syncOfflineMsgs":t.onOfflineMsgs(e);break;case"batchMarkRead":break;case"syncOfflineSysMsgs":t.onOfflineSysMsgs(e);break;case"syncRoamingMsgs":case"syncSuperTeamRoamingMsgs":t.onRoamingMsgs(e);break;case"syncOfflineFilterMsgs":t.onOfflineMsgs(e,!0);break;case"syncOfflineFilterSysMsgs":t.onOfflineSysMsgs(e,!0);break;case"syncMsgReceipts":t.onOfflineMsgReceipts(e);break;case"syncDonnop":t.onDonnop(e,!0);break;case"syncSessionAck":t.syncSessionAck(e);break;case"syncRobots":t.onRobots(e);break;case"syncBroadcastMsgs":t.onBroadcastMsgs(e)}};n.onDonnop=function(e,t){if(!e.error){var r=this;var n=r.db;var s=i.reverse(e.content.donnop);r.mergeDonnop(s);var o=r.dbDonnop();if(t){var a=e.content.timetag;r.timetags.donnop=a;if(n.enable)o=o.then(function(){return r.db.updateDonnopTimetag(a)})["catch"](function(e){r.logger.error("notify::onDonnop: ",e);return Promise.reject(e)});o.cmd="donnop";r.syncPromiseArray.push(o)}else r.onPushNotificationMultiportConfigUpdate()}};n.onUpdateDonnop=function(e){var t=this;if(!e.error){var r=e.obj;if(r){t.mergeDonnop(s.filterObj(r,["shouldPushNotificationWhenPCOnline"]));t.dbDonnop();t.onPushNotificationMultiportConfigUpdate()}}};n.getPushNotificationMultiportConfig=function(){var e=this;return s.merge({},e.pushNotificationMultiportConfig)};n.mergeDonnop=function(e){var t=this;t.pushNotificationMultiportConfig=s.merge({},t.pushNotificationMultiportConfig,e)};n.dbDonnop=function(){var e=this;var t=e.db;if(t.enable)return e.db.setDonnop(e.pushNotificationMultiportConfig);else return Promise.resolve()};n.onPushNotificationMultiportConfigUpdate=function(){var e=this;setTimeout(function(){var t=e.getPushNotificationMultiportConfig();e.logger.info("link::onPushNotificationMultiportConfigUpdate:",t);e.options.onPushNotificationMultiportConfigUpdate(t)})}},"./src/im/protocol/im/robot.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");n.onRobots=function(e){var t=this;var r=e.content;if(s.isFunction(t.options.onrobots))if(Array.isArray(r.robots)){var n=r.robots.filter(function(e){if(!e.botid)return!1;else return!0});if(n.length>0)t.options.onrobots(n||[])}}},"./src/im/protocol/im/session.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/im/model/session.js");var o=r("./src/im/model/nimerror.js");n.mergeSession=function(e){e=s.copyWithNull(e);var t=this.sessionSet;var r=e.id;var n=t[r];if(n&&n.lastMsg&&e&&e.lastMsg&&e.lastMsg.isLocal){var i=n.lastMsg.time||0;var o=e.lastMsg.time||0;if(o<i)return n}t[r]=s.merge(n,e);e=t[r];if(s.undef(e.unread))e.unread=0;return e};n.mergeSessions=function(e){var t=this;e=e||[];e.forEach(function(e){t.mergeSession(e)})};n.deleteLocalSession=function(e){var t=this;if(!s.isArray(e))e=[e];e.forEach(function(e){delete t.sessionSet[e]})};n.onDeleteSessions=function(e){e.obj=e.obj.sessions.map(function(e){return i.parse(e)})};n.onUpdateSession=function(e){var t=this;return new Promise(function(r){if(e){e=t.mergeSession(e);e=s.simpleClone(e);i.trim(e);if(i.isComplete(e)){t.logger.info("session::onUpdateSession:",e.id,s.simpleClone(e));t.options.onupdatesession(e);r(e)}}else r(e)})};n.setCurrSession=function(e){var t=this;e=""+e;t.currSessionId=e;t.logger.info("session::setCurrSession:",e)};n.findSession=function(e){return this.sessionSet[e]};n.resetSessionUnread=function(e){function t(){s={id:e,unread:0};r.onUpdateSession(s)}e=""+e;var r=this;var n=r.db;var s;if(r.findSession(e)){if(n.enable)n.resetSessionUnread(e);if(!r.options.autoMarkRead&&r.sessionUnreadMsgs&&r.sessionUnreadMsgs[e]){var i=r.sessionUnreadMsgs[e];r.markMsgRead(i,!0);r.sessionUnreadMsgs[e]=[]}t()}else r.logger.warn("session::resetSessionUnread: no session "+e);
};n.insertLocalSession=function(e){var t=this;var r=t.db;var n=t.sessionSet;return new Promise(function(a,c){var u=e.scene;var l=e.to;var m=u+"-"+l;var d=t.findSession(m);if(!d){var f;if(s.isNumber(e.updateTime))f=e.updateTime;else{var p=[];var g;for(var v in n)if(n.hasOwnProperty(v)){g=n[v];if(s.isNumber(g.updateTime))p.push(g.updateTime)}f=Math.max.apply(Math,p)+1;f=Math.max(f,+new Date)}var y=Promise.resolve();if(r.enable)y=r.getMsgs({sessionId:m,limit:1});y.then(function(e){if(s.isArray(e)&&1===e.length){var n=e[0];d=i.genSessionByMsg(n);d.updateTime=f}else d={id:m,scene:u,to:l,updateTime:f,lastMsg:null};if(r.enable)r.putSession(d).then(a,c);else a(d);t.onUpdateSession(d)})}else c(o.sessionExist({callFunc:"session::insertLocalSession",session:d}))})};n.updateLocalSession=function(e,t){var r=this;return new Promise(function(n,i){var a=r.db;var c=r.findSession(e.id);if(c){var u=Promise.resolve();var l=s.filterObj(e,"id lastMsg localCustom unread");if(a.enable)u=a.updateSession(l);u.then(function(e){return r.onUpdateSession(e,t)}).then(n,function(e){i({callFunc:"session::updateLocalSession",event:e})})}else i(o.sessionNotExist({sessionId:e.id,callFunc:"session::updateLocalSession"}))})}},"./src/im/protocol/im/sessionAck.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;n.syncSessionAck=function(e){var t=this;var r=t.db;var n=Promise.resolve();[[e.content.p2p,"p2p"],[e.content.team.m_map,"team"]].forEach(function(e){var s=e[0];var i=e[1];Object.keys(s).forEach(function(e){var o=i+"-"+e;var a={id:o,ack:s[e]};if(r.enable)n=n.then(function(){return r.putSession(a)}).then(function(){t.markUnreadBySessionAck({sessionId:o,ack:s[e]})});t.mergeSession(a)})});t.logger.warn("session::syncSessionAck: parse offline session ack",t.sessionSet);var s=e.content.timetag;if(r.enable)n=n.then(function(){return t.db.updateSessionAck(s)})["catch"](function(e){t.logger.error("sessionAck::syncSessionAck: ",e);return Promise.reject(e)});n.cmd="sessionAck";t.syncPromiseArray.push(n)};n.onMarkSessionAck=function(e){if(!e.error)this.storeSessionAck(e.obj)};n.syncMarkSessionAck=function(e){this.storeSessionAck(e.content)};n.storeSessionAck=function(e){var t=this;var r=t.options.syncSessionUnread;if(r){var n=t.db;var s=0===e.scene?"p2p":"team";var i=s+"-"+e.to;var o=e.timetag;var a=t.findSession(i)||{};var c=a.ack||0;if(!(o<=c)){var u={id:i,ack:o};t.mergeSession(u);if(n.enable)n.updateSession(u);t.logger.info("session::storeSessionAck:",u);t.markUnreadBySessionAck({sessionId:i,ack:u.ack})}else t.logger.warn("session::storeSessionAck: ack <= ackInMemory",o)}};n.markUnreadBySessionAck=function(e){var t=e.sessionId,r=e.ack;var n=this;var s=n.db;if(s.enable)n.pushMsgTask(function(){return s.getMsgCountAfterAck({shouldCountNotifyUnread:n.options.shouldCountNotifyUnread,sessionId:t,ack:r}).then(function(e){var r={id:t,unread:e};n.logger.log("session::markUnreadBySessionAck: db.getMsgCountAfterAck done");if(n.syncing)n.cacheSyncedSession(r);n.onUpdateSession(r);return s.updateSession(r)})});else{var i=n.findSession(t);if(i){var o=i.unreadMsgs;if(o&&o.length){var a=0;var c=[];for(var u=o.length-1;u>=0;u--){var l=o[u];if(l.time>r){a++;c.push(l)}else break}i.unreadMsgs=c;i.unread=a;n.logger.info("session::markUnreadBySessionAck: unread "+a);n.onUpdateSession(i)}}}}},"./src/im/protocol/im/superTeam.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/typeof.js");var i=n(s);var o=r("./src/im/protocol/im/index.js").fn;var a=r("./src/util/index.js");var c=a.objs2accounts;var u=a.teams2ids;var l=r("./src/im/model/superTeam.js");var m=r("./src/im/model/superTeamMember.js");o.processSuperTeam=function(e){var t=this;var r=e.error;var n,s,o;if(void 0===(0,i["default"])(e.obj))e.obj={};switch(e.cmd){case"sendSuperTeamMsg":t.onSendMsg(e);break;case"superTeamMsg":t.onMsg(e);break;case"syncSuperTeams":t.onSuperTeams(e);break;case"syncSuperTeamMembers":t.onSuperTeamMembers(e);break;case"syncCreateSuperTeam":n=l.reverse(e.content.team);o=m.assembleOwner(n);t.logger.info("team::processTeam: sync createTeam",n,o);t.options.onSyncCreateSuperTeam(n,o);t.onCreateSuperTeam(n,o);break;case"getSuperTeamHistoryMsgs":case"searchSuperTeamHistoryMsgs":t.onHistoryMsgs(e);break;case"addSuperTeamMembers":case"removeSuperTeamMembers":case"leaveSuperTeam":break;case"updateInfoInSuperTeam":if(!r){s=e.obj;s.account=t.account;s.id=m.genId(s.teamId,s.account);s=m.reverse(s);e.obj=s;t.onUpdateSuperTeamMember(s)}break;case"syncUpdateSuperTeamMember":s=m.reverse(e.content.teamMember);t.onUpdateSuperTeamMember(s);break;case"updateSuperTeam":e.obj=l.reverse(e.obj,!0);break;case"getSuperTeam":if(!e.error)e.obj=l.reverse(e.content.team);break;case"getSuperTeams":t.onSuperTeams(e);break;case"getSuperTeamMembers":t.onSuperTeamMembers(e)}};o.onSuperTeams=function(e){function t(){if(c)a.forEach(function(e){e=l.reverse(e);if(e.validToCurrentUser)d.push(e);else f.push(e)});s.logger.info("superTeam::onSuperTeams: parseData",u(d),d,"invalid",u(f),f);if(!a.length)c=!1;else{c=!0;m=e.content.timetag}}function r(t,r){e.promise=new Promise(function(e,a){function u(){if(!o)i.getSuperTeams().then(function(r){d=r;n();e();t()}).then(void 0,function(e){e.message="db.getSuperTeams error";e.callFunc="superTeam::afterMergeData";a(e);r(e)});else{n();e();t()}}if(c)i.mergeSuperTeams(d,f,m).then(function(){u()}).then(void 0,function(e){var t={callFunc:"superTeam::onSuperTeams:mergeData",message:"db.mergeSuperTeams error",event:e};a(t);r(t)});else{s.logger.warn("superTeam::onSuperTeams:mergeData: no teams need merge");u()}}).then(void 0,function(e){e.message="merge teams data error";e.callFunc="superTeam::mergeData";r(e);throw e})}function n(){s.timetags.superTeams=m;d.invalid=f;if(o){s.syncResult.superTeams=d;s.syncResult.invalidSuperTeams=f}else{s.logger.info("superTeam::onSuperTeams: not in syncing, get teams",u(d),d);e.obj=d}}e.content=e.content||{};var s=this;var i=s.db;var o=s.packetFromSync(e);var a=e.content.teams||[];var c=!0;var m;var d=[];var f=[];if(e.error)switch(e.error.code){case 803:e.error=null;c=!1}var p=new Promise(function(s,a){if(!e.error){t();if(i.enable)r(s,a);else{n();s()}}else if(o)a(e.error)})["catch"](function(e){s.logger.error("superTeam::onSuperTeams: ",e);return Promise.reject(e)});if(o){p.cmd="superteams";s.syncPromiseArray.push(p)}};o.onCreateSuperTeam=function(e,t){var r=this.db;if(r.enable){r.putSuperTeam(e);r.putSuperTeamMembers(t)}};o.onSuperTeamMembers=function(e){function t(){if(o)i.forEach(function(e){e=m.reverse(e);if(e.valid)l.push(e);else d.push(e)});n.logger.warn("team::onSuperTeamMembers: parseData",u,c(l),l,"invalid",c(d),d);if(!i.length)o=!1;else{o=!0;a=e.content.timetag}}function r(){n.logger.info("team::onSuperTeamMembers",u,c(l),l);var t={teamId:u};if(p){t.size=g;t.current=v;t.total=l.length;t.members=l.slice(g*v,(v+1)*g)}else t.members=l;t.members.invalid=d;e.obj=t}e.content=e.content||{};var n=this;var s=n.db;var i=e.content.members||[];var o=!0;var a;var u;var l=[];var d=[];var f=e.content&&e.content.isAll;var p,g,v;if(e.obj){u=e.obj.teamId;p=e.obj.needPaging;if(p){g=e.obj.pagingParams.size;v=e.obj.pagingParams.current}}if(!u)u=e.content.teamId;u=""+u;if(e.error)switch(e.error.code){case 406:e.error=null;o=!1}if(!e.error){t();if(s.enable)e.promise=new Promise(function(t,r){function i(){s.getSuperTeamMembers(u).then(function(r){var n={teamId:u};if(p){n.size=g;n.current=v;n.total=r.length;n.members=r.slice(g*v,(v+1)*g)}else n.members=r;n.members.invalid=d;e.obj=n;t()})["catch"](function(e){r(e)})}if(o){var c=Promise.resolve();if(f)c=s.deleteSuperTeamMembers(u);c.then(function(){s.mergeSuperTeamMembers(u,l,d,a).then(function(){i()})["catch"](function(e){r(e)})})["catch"](function(e){n.logger.error("onSuperTeamMembers::db.mergeSuperTeamMembers:: error",e)})}else{console.log(t,r);i()}});else if(f)r()}};o.onUpdateSuperTeamMember=function(e){var t=this;if(!e.updateTime)e.updateTime=+new Date;t.logger.warn("superTeam::onUpdateSuperTeamMember: ",e);t.options.onUpdateSuperTeamMember(a.simpleClone(e));var r={teamId:e.teamId,memberUpdateTime:e.updateTime};t.onUpdateSuperTeam(r);var n=this.db;if(n.enable)n.updateSuperTeamMember(e)};o.onUpdateSuperTeam=function(e){var t=this;t.logger.info("superteam::onUpdateSuperTeam:",e);t.options.onUpdateSuperTeam(a.simpleClone(e));var r=t.db;if(r.enable)r.updateSuperTeam(e)}},"./src/im/protocol/im/sync.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/toConsumableArray.js");var i=n(s);var o=r("./src/im/protocol/im/index.js").fn;var a=r("./src/util/index.js");var c=r("./src/im/model/nimerror.js");var u=a.undef;var l=a.objs2ids;var m=a.objs2accounts;var d=a.teams2ids;var f=r("./src/im/model/session.js");var p=a.getGlobal();o.beforeSync=function(){var e=this;var t=e.db;if(t.enable)return t.clearSendingMsgs();else return Promise.resolve()};o.syncData=function(){function e(e){t.syncPromiseArray=[];t.syncResult={};t.syncTeamMembersPromiseArray=[];t.syncSuperTeamMembersPromiseArray=[];t.syncTeamMembersResult={};t.checkNosReqNum=0;t.getNosOriginUrlReqNum=0;a.verifyBooleanWithDefault(n,"syncRelations syncFriends syncFriendUsers syncTeams syncSuperTeams syncRoamingMsgs syncSuperTeamRoamingMsgs syncMsgReceipts syncExtraTeamInfo",!0,"","sync::syncData");a.verifyBooleanWithDefault(n,"syncFilter syncTeamMembers syncSuperTeamMembers",!1,"","sync::syncData");var r={};e=e||{};if(p._nimForceSyncIM){t.logger.warn("sync::syncData: nimForceSyncIM");delete e.teams;p._nimForceSyncIM=!1}r.myInfo=e.myInfo||0;r.offlineMsgs=0;if(n.syncRelations)r.relations=e.relations||0;if(n.syncFriends)r.friends=e.friends||0;if(n.syncFriendUsers)r.friendUsers=e.friendUsers||0;if(n.syncRobots)r.robots=e.robots||0;if(n.syncTeams)r.teams=e.teams||0;if(n.syncSuperTeams)r.superTeams=e.superTeams||0;if(n.syncRoamingMsgs)r.roamingMsgs=e.roamingMsgs||0;if(n.syncSuperTeamRoamingMsgs)r.superTeamRoamingMsgs=e.superTeamRoamingMsgs||0;
if(n.syncMsgReceipts)r.msgReceipts=e.msgReceipts||0;if(n.syncExtraTeamInfo)r.myTeamMembers=e.myTeamMembers||0;if(n.syncSessionUnread)r.sessionAck=e.sessionAck||0;if(n.syncBroadcastMsgs)r.broadcastMsgs=e.broadcastMsg||0;r.donnop=e.donnop||0;r.deleteMsg=e.deleteMsg||0;if(n.syncFilter)r.filterMsgs=0;var s=t.onSyncData.bind(t);s.isImSyncDataCb=!0;t.sendCmd("sync",{sync:r,isImSyncDataObj:!0},s)}var t=this;var r=t.db;var n=t.options;var s=r.enable;t.syncing=!0;if(s)t.beforeSync().then(function(){return t.db.getTimetags()}).then(function(t){e(t)},function(){e()});else e(t.timetags)};o.onSyncData=function(e,t){if(e&&this.syncRetryTimes>3){this.syncRetryTimes=0;e.callFunc="sync::onSyncData";this.onCustomError("SYNC_DATA_ERROR",e)}};o.processSync=function(e){var t=this;t.syncRetryTimes=t.syncRetryTimes||0;t.syncRetryTimes++;switch(e.cmd){case"syncDone":if(e.error)if(t.syncRetryTimes>3);else t.syncData();else{t.timetags.sync=e.content.timetag;t.onSyncDone()}break;case"syncTeamMembersDone":t.onSyncTeamMembersDone()}};o.onSyncDone=function(e){function t(){if(M){y.logger.info("sync::onSyncDone: after sync",a.promises2cmds(M));M=[];k=S.blacklist||[];_=S.invalidBlacklist||[];I=S.mutelist||[];x=S.invalidMutelist||[];P=S.friends;C=S.invalidFriends||[];w=S.myInfo;O=S.users;E=S.superTeams;U=S.invalidSuperTeams;A=S.teams;R=S.invalidTeams||[];N=S.sessions;F=S.msgReceipts;D=S.roamingMsgs;L=S.offlineMsgs;B=S.offlineFilterMsgs;H=S.offlineSysMsgs;z=S.offlineCustomSysMsgs;W=S.offlineFilterSysMsgs;J=S.offlineFilterCustomSysMsgs;V=S.broadcastMsgs;X=S.sysMsgUnread;if(N){var e=[];Object.keys(N).forEach(function(t){e.push(N[t])});N=e.sort(function(e,t){return t.updateTime-e.updateTime})}var t=Promise.resolve();if(b)t=r().then(function(e){var t={};e.forEach(function(e){var r=e.sessionId;if(!t[r]){t[r]=!0;y.markUnreadByMsgsPromise(r)}})});t.then(function(){if(b&&!y.hasSynced){y.hasSynced=!0;n()}var e=y.syncPromiseArray;var t=e.filter(function(e){return"sessionAck"===e.cmd});if(0===t.length)t.push(Promise.resolve());var r=e.filter(function(e){return"sessionAck"!==e.cmd});if(0===r.length)r.push(Promise.resolve());Promise.all(r).then(function(){return Promise.all(t)},function(e){e.callFunc="sync::onSyncDone";e.message="afterSync syncNormalPromise 出错";y.onCustomError("SYNC_NORMAL_ERROR",e)}).then(s,function(e){e.callFunc="sync::onSyncDone";e.message="afterSync syncSessionAckPromise 出错";y.onCustomError("SYNC_SESSION_ACK_ERROR",e)}).then(function(){return Promise.all(M)},function(e){e.callFunc="sync::onSyncDone";e.message="afterSync taskAfterSync 出错";y.onCustomError("SYNC_NORMAL_ERROR",e)}).then(p,function(e){e.callFunc="sync::onSyncDone";e.message="taskAfterSync syncDBDataPromise 出错";y.onCustomError("SYNC_SESSION_ACK_ERROR",e)})["catch"](function(e){y.syncData()})})}else y.logger.warn("sync::onSyncDone: after sync --no promiseArray")}function r(){var e=[];var t;var r=[];if(D)D.forEach(function(e){r=[].concat((0,i["default"])(r),(0,i["default"])(e.msgs))});if(L)L.forEach(function(e){r=[].concat((0,i["default"])(r),(0,i["default"])(e.msgs))});t=h.putMsg(r);e.push(t);return Promise.all(e).then(function(){return r})}function n(){if(T.syncRelations){j=h.getRelations().then(function(e){k=e[0];I=e[1];k.invalid=_;I.invalid=x},function(e){e._msg="on relations error";return e})["catch"](function(e){y.logger.error("sync::syncRelation: ",e);return Promise.reject(e)});M.push(j)}if(T.syncFriends){j=h.getFriends().then(function(e){P=e;P.invalid=C},function(e){e._msg="on friends error";return e})["catch"](function(e){y.logger.error("sync::syncFriends: ",e);return Promise.reject(e)});M.push(j)}if(u(w)){j=h.getUser(y.account).then(function(e){w=e},function(e){e._msg="on myInfo error";return e})["catch"](function(e){y.logger.error("sync::syncMyInfo: ",e);return Promise.reject(e)});M.push(j)}if(T.syncFriendUsers){j=h.getFriends().then(function(e){return e.map(function(e){return e.account})}).then(function(e){return h.getUsers(e)}).then(function(e){O=e},function(e){e._msg="on users error";return e})["catch"](function(e){y.logger.error("sync::syncFriendUser: ",e);return Promise.reject(e)});M.push(j)}if(T.syncTeams){j=h.getTeams().then(function(e){A=e;A.invalid=R},function(e){e._msg="on teams error";return e})["catch"](function(e){y.logger.error("sync::syncTeams: ",e);return Promise.reject(e)});M.push(j)}if(T.syncSuperTeams){j=h.getSuperTeams().then(function(e){E=e;E.invalid=U},function(e){e._msg="on superteams error";return e})["catch"](function(e){y.logger.error("sync::syncSuperTeams: ",e);return Promise.reject(e)});M.push(j)}j=h.getTeamMembersByAccount(y.account).then(function(e){y.mergeMyTeamMembers(e)})["catch"](function(e){y.logger.error("sync::getTeamMembersByAccount: ",e);return Promise.reject(e)});M.push(j);j=h.getDonnop().then(function(e){y.mergeDonnop(e)})["catch"](function(e){y.logger.error("sync::donnop: ",e);return Promise.reject(e)});M.push(j);j=h.getSessions().then(function(e){N=e},function(e){e._msg="on sessions error";return e})["catch"](function(e){y.logger.error("sync::getSession: ",e);return Promise.reject(e)});M.push(j);j=h.getSysMsgUnread().then(function(e){X=e},function(e){e._msg="on sysMsgUnread error";return e})["catch"](function(e){y.logger.error("sync::getSysMsgUnread: ",e);return Promise.reject(e)});M.push(j)}function s(){y.logger.info("sync::onSyncDone: taskAfterSync");o();var e=[];e.push(y.deleteMsgOfflineRoaming(S.deleteMsgSysMsgs,N));return Promise.all(e)}function o(){if(S.deleteMsgSysMsgs){var e={};if(D)D.forEach(function(t){e[t.sessionId]=t});var t={};if(L)L.forEach(function(e){t[e.sessionId]=e});var r=y.api;S.deleteMsgSysMsgs.forEach(function(n){n.sysMsgs.forEach(function(n){var s=n.msg;var i=s.sessionId;[e,t].forEach(function(e){if(e[i])e[i].msgs=r.cutMsgs(e[i].msgs,s)})})});if(!h.enable)[D,L].forEach(function(e){if(e)e.forEach(function(e){if(e.msgs.length){var t=y.genSessionByMsgs(e.msgs);y.cacheSyncedSession(t);N=r.mergeSessions(N,t)}else N=r.cutSessions(N,{id:e.sessionId})})})}}function p(){setTimeout(g,0)}function g(){var e=[];var t;var r;if(k){y.logger.info("sync::notifyDataAsync: on blacklist",m(k),k);T.onblacklist(k)}if(I){y.logger.info("sync::notifyDataAsync: on mutelist",m(I),I);T.onmutelist(I)}if(P){y.logger.info("sync::notifyDataAsync: on friends",m(P),P);T.onfriends(P)}if(w){y.logger.info("sync::notifyDataAsync: on myInfo",w);y.myInfo=w;T.onmyinfo(a.copy(w))}if(O){O.forEach(function(e){y.mergeUser(e)});y.logger.info("sync::notifyDataAsync: on users",m(O),O);T.onusers(O)}if(A){y.logger.info("sync::notifyDataAsync: on teams",d(A),A);T.onteams(A)}if(E){y.logger.info("sync::notifyDataAsync: onSuperTeams",d(E),E);T.onSuperTeams(E)}if(F)if(!y.hasSynced&&N&&N.length||y.hasSynced)N=y.mergeSessionAndMsgReceipts(N,F);if(N&&N.length){N.forEach(function(e){if(y.syncResult.sessions&&y.syncResult.sessions[e.id]&&"number"==typeof y.syncResult.sessions[e.id].unread)e.unread=y.syncResult.sessions[e.id].unread;y.mergeSession(e);f.trim(e)});y.logger.info("sync::notifyDataAsync: on sessions",l(N),N);T.onsessions(N)}if(D)D.forEach(function(t){e.push(t.timetag);r=t.msgs;if(r.length){y.logger.info("sync::notifyDataAsync: on roaming msgs",t.sessionId,r.length,r);T.onroamingmsgs(t);if("superTeam"===r[0].scene)h.updateSuperTeamRoamingMsgTimetag(t.timetag)}});if(L)L.forEach(function(t){e.push(t.timetag);r=t.msgs;if(r.length){y.logger.info("sync::notifyDataAsync: on offline msgs",t.sessionId,r.length,r);T.onofflinemsgs(t)}});if(B)B.forEach(function(t){e.push(t.timetag);r=t.msgs;if(r.length){y.logger.info("sync::notifyDataAsync: on offline filter msgs",t.sessionId,r.length,r);T.onofflinefiltermsgs(r)}});var n=[];var s=[];if(S.deleteMsgSysMsgs)S.deleteMsgSysMsgs.forEach(function(e){if("roaming"===e.type)n=n.concat(e.sysMsgs);else s=s.concat(e.sysMsgs)});if(n.length){q=q||[];q=q.concat(n)}if(s.length){H=H||[];H=H.concat(s)}if(q){y.logger.info("sync::notifyDataAsync: on roaming sys msgs",q.length,q);T.onroamingsysmsgs(q)}if(H){y.logger.info("sync::notifyDataAsync: on offline sys msgs",H.length,H);T.onofflinesysmsgs(H)}if(W){y.logger.info("sync::notifyDataAsync: on offline filter sys msgs",W.length,W);T.onofflinefiltersysmsgs(W)}if(z){y.logger.info("sync::notifyDataAsync: on offline custom sys msgs",z.length,z);T.onofflinecustomsysmsgs(z)}if(J){y.logger.info("sync::notifyDataAsync: on offline filter custom sys msgs",J.length,J);T.onofflinefiltercustomsysmsgs(J)}if(X){X=a.merge({},y.sysMsgUnread,X);y.sysMsgUnread=a.merge({},X);y.logger.info("sync::notifyDataAsync: on sysMsgUnread",X);T.onsysmsgunread(X)}var i=y.getPushNotificationMultiportConfig();y.logger.info("sync::notifyDataAsync: on pushNotificationMultiportConfig",i);T.onPushNotificationMultiportConfig(i);if(e.length){t=Math.max.apply(Math,e);y.updateRoamingMsgTimetag(t).then(v,v)}else v();y.syncPromiseArray=[];y.syncResult={}}function v(){y.processUnsettledMsgs();y.processUnsettledSysMsgs();if(y.syncing)T.onsyncdone();y.syncing=!1;if(T.syncTeamMembers&&A&&A.length)throw new c("sync team members api deprecated!");else;}var y=this;var h=y.db;var b=h.enable;var T=y.options;var M=y.syncPromiseArray;var S=y.syncResult;var j;var k;var _;var I;var x;var P;var C;var w;var O;var A;var E;var R;var U;var N;var F;var D;var L;var B;var q;var H;var z;var W;var J;var V;var X;t()};o.syncTeamMembers=function(e){function t(t){var n={};t=t||{};e.forEach(function(e){n[e.teamId]=0},r);r.sendCmd("syncTeamMembers",{sync:n},r.onSyncTeamMembers.bind(r))}var r=this;t(r.timetags)};o.onSyncTeamMembers=function(e,t){e.callFunc="sync::onSyncTeamMembers";e.message="同步群成员错误";this.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)};o.onSyncTeamMembersDone=function(){function e(){o.logger.log("sync::onSyncTeamMembersDone: afterSync",a.promises2cmds(d));d=[];if(c.enable&&!o.hasSyncedTeamMembers){o.hasSyncedTeamMembers=!0;t()}else r()}function t(){if(!u.syncTeams||!u.syncTeamMembers)return i();c.getTeams().then(function(e){e.forEach(function(e){var t=e.teamId;f=new Promise(function(e,r){o.api.getTeamMembers({teamId:t,done:function n(s,i){if(s)r({
callFunc:"sync::getTeamMembers: teamId-"+t,message:"sync team members error"});l[t]=i.members||[];e()}})});d.push(f)});if(d.length)Promise.all(d).then(r,function(e){e.callFunc="sync::onSyncTeamMembersDone";e.message="pullFullData promiseArray notifyData 错误";o.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)});else r()},function(e){e.callFunc="sync::onSyncTeamMembersDone";e.message="pullFullData getTeams 错误";o.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)})}function r(){setTimeout(n,0)}function n(){var e,t;Object.keys(l).forEach(function(r){if(r.indexOf("invalid")===-1){e=l[r];t=l[r+"-invalid"]||[];e.invalid=t;s(r,e)}});i()}function s(e,t){o.logger.info("sync::onSyncTeamMembersDone: onTeamMembers",e,m(t),t);u.onteammembers({teamId:e,members:t})}function i(){o.logger.info("sync::onSyncTeamMembersDone: bingo");u.onsyncteammembersdone();o.syncTeamMembersResult=null;o.syncTeamMembersPromiseArray=null}var o=this,c=o.db,u=o.options,l=o.syncTeamMembersResult,d=o.syncTeamMembersPromiseArray,f;if(d.length)Promise.all(d).then(e,function(e){e.callFunc="sync::onSyncTeamMembersDone";e.message="同步群成员 syncTeamMembersPromiseArray 错误";o.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)})["catch"](function(t){o.logger.log("sync::onSyncTeamMembersDone: syncTeamMembersPromiseArray promise ",t);e()});else e()}},"./src/im/protocol/im/sysMsg.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=r("./src/im/model/systemMessage.js");n.splitSysMsgs=function(e,t){var r;for(var n=e.length-1;n>=0;n--){r=e[n];if(i.isCustom(r)){e.splice(n,1);t.push(r)}}};n.onOfflineSysMsgs=function(e,t){var r=this;var n=e.content.sysMsgs.map(function(e){e=i.reverse(e);if(t)e.filter=!0;return e});n=n.reverse();r.markSysMsgRead(n);var s=[];r.splitSysMsgs(n,s);var o=t?"offlineFilterSysMsgs":"offlineSysMsgs";var a=t?"offlineFilterCustomSysMsgs":"offlineCustomSysMsgs";if(n.length){var c=r.putSysMsg(n,"offlineSysMsgs").then(function(e){n=e;if(n.length){r.logger.info("sysmsg::onOfflineSysMsgs: ",o,n.length,n);r.syncResult[o]=r.syncResult[o]||[];r.syncResult[o]=r.syncResult[o].concat(n)}})["catch"](function(e){r.logger.error("sysMsg::onOfflineSysMsgs: ",e);return Promise.reject(e)});c.cmd="sysMsgs";r.syncPromiseArray.push(c)}if(s.length){r.logger.info("sysmsg::onOfflineSysMsgs: ",a,s);r.syncResult[a]=r.syncResult[a]||[];r.syncResult[a]=r.syncResult[a].concat(s)}};n.onSendSysMsg=function(e,t){var r=this;var n=e.obj;r.completeSysMsg(n);if(!e.error)n.status="success";else n.status="fail";n=i.reverse(n);if(t)e.obj.filter=!0;e.obj=n};n.completeSysMsg=function(e){e.from=this.account;return e};n.onSysMsg=function(e,t){var r=this;var n=i.reverse(e.content.sysMsg);r.markSysMsgRead(n);if(t)n.filter=!0;if(i.isCustom(n)){r.logger.info("sysmsg::onSysMsg: on customSysMsg",n);r.options.oncustomsysmsg(n)}else if(r.syncing)r.unhandledSysMsgs.push(n);else r.handleSysMsg(n)};n.handleSysMsg=function(e){var t=this;var r=e.type;var n=e.from;t.sysMsgPromise=t.sysMsgPromise.then(function(){return t.putSysMsg(e,"onSysMsg")}).then(function(t){e=t[0]}).then(function(){if(e){var s;var i=Promise.resolve();switch(r){case"addFriend":s={type:"addFriend",account:n};i=t.onFriendRequest(s);break;case"passFriendApply":s={type:"passFriendApply",account:n};i=t.onFriendRequest(s);break;case"deleteFriend":i=t.onDeleteFriend({account:n})}if(s&&s.friend)e.friend=s.friend;return i}}).then(function(){if(e){t.logger.info("sysmsg::handleSysMsg: ",r,e);setTimeout(function(){t.options.onsysmsg(e)},0)}})};n.putSysMsg=function(e,t){if(!s.isArray(e))e=[e];if(e[0].filter)return Promise.resolve(e);var r=this;var n=r.db;var i=n.enable;var o=Promise.resolve();var a=[];o=o.then(function(){if(i)return n.putSysMsg(e);else return e}).then(function(t){var n=[];e.forEach(function(e){if(r.checkSysMsgUnique(e))n.push(e)});e=n;if(i)a=t;else a=e});o=o.then(function(){return r.getSysMsgUnread().then(function(n){if(!a.length){a=e;a.backward=!0}return r.updateSysMsgUnread(a,n,1).then(function(e){if("offlineSysMsgs"===t)r.syncResult.sysMsgUnread=e;if("onSysMsg"===t)r.onUpdateSysMsgUnread(e)})})});return o.then(function(){return e})};n.checkSysMsgUnique=s.genCheckUniqueFunc("idServer");n.getSysMsgUnread=function(){var e=this;var t=e.db;return new Promise(function(r){if(t.enable)t.getSysMsgUnread().then(function(e){r(e)},function(){r(e.sysMsgUnread)});else r(e.sysMsgUnread)})};n.updateSysMsgUnread=function(e,t,r){if(!s.isArray(e))e=[e];if(!e.length)return Promise.resolve(t);t=t||{};var n=this;var o=n.db;var a;e.forEach(function(e){if(r>0&&!e.read||r<0&&e.read){a=e.type;t[a]=(t[a]||0)+r}});t=i.completeUnread(t);n.sysMsgUnread=t;if(o.enable&&!e.backward)return o.updateSysMsgUnread(t);else return Promise.resolve(t)};n.reduceSysMsgUnread=function(e){var t=this;return t.getSysMsgUnread().then(function(r){return t.updateSysMsgUnread(e,r,-1)}).then(function(e){t.onUpdateSysMsgUnread(e)})};n.onUpdateSysMsgUnread=function(e){var t=this;setTimeout(function(){t.logger.info("sysmsg::onUpdateSysMsgUnread:",e);t.options.onupdatesysmsgunread(e)},0)};n.updateSysMsg=function(e){var t=this;var r=t.db;var n;if(r.enable)n=r.updateSysMsg(e);else n=Promise.resolve(e);n.then(function(e){t.onUpdateSysMsg(e)})};n.onUpdateSysMsg=function(e){var t=this;setTimeout(function(){if(!s.isArray(e))e=[e];e.forEach(function(e){t.logger.info("sysmsg::onUpdateSysMsg:",e);t.options.onupdatesysmsg(e)})},0)};n.processUnsettledSysMsgs=function(){var e=this;e.unhandledSysMsgs.forEach(function(t){e.handleSysMsg(t)});e.resetUnsettledSysMsgs()}},"./src/im/protocol/im/team.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=s.objs2accounts;var o=s.teams2ids;var a=r("./src/im/model/team.js");var c=r("./src/im/model/teamMember.js");n.processTeam=function(e){var t=this;var r=e.error;var n=void 0;var s=void 0;var i=void 0;if("undefined"==typeof e.obj)e.obj={};switch(e.cmd){case"createTeam":n=e.obj.team;if(!r)n=e.content.team;n=a.reverse(n);e.obj.team=n;i=c.assembleOwner(n);e.obj.owner=i;if(!r){var o={team:n,owner:i};t.logger.info("team::processTeam: create team",o);t.onCreateTeam(n,i)}break;case"syncCreateTeam":n=a.reverse(e.content.team);i=c.assembleOwner(n);t.logger.info("team::processTeam: sync createTeam",n,i);t.options.onsynccreateteam(n,i);t.onCreateTeam(n,i);break;case"sendSuperTeamMsg":t.onSendMsg(e);break;case"sendTeamMsg":t.onSendMsg(e);break;case"teamMsg":t.onMsg(e);break;case"teamMsgs":t.onMsgs(e);break;case"addTeamMembers":case"removeTeamMembers":case"leaveTeam":case"dismissTeam":case"addTeamManagers":case"removeTeamManagers":case"transferTeam":break;case"updateInfoInTeam":if(!r){s=e.obj;s.account=t.account;s.id=c.genId(s.teamId,s.account);s=c.reverse(s);e.obj=s;t.mergeMyTeamMembers(s);t.onUpdateTeamMember(s)}break;case"updateNickInTeam":e.obj=c.reverse(e.obj);break;case"updateTeam":e.obj=a.reverse(e.obj,!0);break;case"applyTeam":if(!e.error)e.obj=a.reverse(e.content.team);break;case"passTeamApply":t.updateTeamSysMsgState(e,"passed");break;case"rejectTeamApply":t.updateTeamSysMsgState(e,"rejected");break;case"acceptTeamInvite":t.updateTeamSysMsgState(e,"passed");if(!e.error)e.obj=a.reverse(e.content.team);break;case"rejectTeamInvite":t.updateTeamSysMsgState(e,"rejected");break;case"getTeam":if(!e.error)e.obj=a.reverse(e.content.team);break;case"getTeams":t.onTeams(e);break;case"getTeamMembers":t.onTeamMembers(e);break;case"syncTeams":t.onTeams(e);break;case"syncTeamMembers":t.onTeamMembers(e);break;case"getTeamHistoryMsgs":case"searchTeamHistoryMsgs":t.onHistoryMsgs(e);break;case"syncSendTeamMsg":t.onMsg(e);break;case"notifyTeamMsgReads":t.onTeamMsgReceipt(e);break;case"syncUpdateTeamMember":s=c.reverse(e.content.teamMember);t.onUpdateTeamMember(s);if(s.account===t.account)t.mergeMyTeamMembers(s);break;case"updateMuteStateInTeam":break;case"getMyTeamMembers":if(!e.error)e.obj=c.reverseMembers(e.content.teamMembers);break;case"getMutedTeamMembers":if(!e.error)e.obj={teamId:e.obj.teamId,members:c.reverseMembers(e.content.teamMembers)};break;case"syncMyTeamMembers":t.onSyncMyTeamMembers(e)}};n.onCreateTeam=function(e,t){var r=this.db;if(r.enable){r.putTeam(e);r.putTeamMembers(t)}this.options.onCreateTeam(e,t)};n.onTeams=function(e){function t(){if(l)u.forEach(function(e){e=a.reverse(e);if(e.validToCurrentUser)d.push(e);else f.push(e)});s.logger.info("team::onTeams: parseData",o(d),d,"invalid",o(f),f);if(!u.length)l=!1;else{l=!0;m=e.content.timetag}}function r(t,r){e.promise=new Promise(function(e,o){function a(){if(!c)i.getTeams().then(function(r){d=r;n();e();t()}).then(void 0,function(e){e.message="db.getTeams error";e.callFunc="team::afterMergeData";o(e);r(e)});else{n();e();t()}}if(l)i.mergeTeams(d,f,m).then(function(){a()}).then(void 0,function(e){var t={callFunc:"team::onTeams:mergeData",message:"db.mergeTeams error",event:e};o(t);r(t)});else{s.logger.warn("team::onTeams:mergeData: no teams need merge");a()}}).then(void 0,function(e){e.message="merge teams data error";e.callFunc="team::mergeData";r(e);throw e})}function n(){s.timetags.teams=m;d.invalid=f;if(c){s.syncResult.teams=d;s.syncResult.invalidTeams=f;if(!s.syncing)s.onSyncDone()}else{s.logger.info("team::onTeams: not in syncing, get teams",o(d),d);e.obj=d}}e.content=e.content||{};var s=this;var i=s.db;var c=s.packetFromSync(e);var u=e.content.teams||[];var l=!0;var m;var d=[];var f=[];if(e.error)switch(e.error.code){case 803:e.error=null;l=!1}var p=new Promise(function(s,o){if(!e.error){t();if(i.enable)r(s,o);else{n();s()}}else if(c)o(e.error)})["catch"](function(e){s.logger.error("team::onTeams: ",e);return Promise.reject(e)});if(c){p.cmd="teams";s.syncPromiseArray.push(p)}};n.onTeamMembers=function(e){function t(){if(u)a.forEach(function(e){e=c.reverse(e);if(e.valid)d.push(e);else f.push(e)});n.logger.warn("team::onTeamMembers: parseData",m,i(d),d,"invalid",i(f),f);if(!a.length)u=!1;else{u=!0;l=e.content.timetag}}function r(){d.invalid=f;if(o){n.syncTeamMembersResult[m]=d;n.syncTeamMembersResult[m+"-invalid"]=f;
n.timetags["team-"+m]=l}else{n.logger.info("team::onTeamMembers: not syncing, get members",m,i(d),d);e.obj={teamId:m,members:d}}}e.content=e.content||{};var n=this;var s=n.db;var o=n.packetFromSync(e);var a=e.content.members||[];var u=!0;var l;var m;var d=[];var f=[];if(e.obj)m=e.obj.teamId;if(!m)m=e.content.teamId;m=""+m;if(e.error)switch(e.error.code){case 406:e.error=null;u=!1}var p=new Promise(function(s,i){if(!e.error){t();r();s()}else if(o){n.logger.error("team::onTeamMember: team error:",m,e.error);i({callFunc:"team::onTeamMembers",event:e.error,message:"teamId-"+m+" 获取群成员错误"})}});if(o){p.cmd=m;n.syncTeamMembersPromiseArray.push(p)}};n.onUpdateTeamMember=function(e){var t=this;if(!e.updateTime)e.updateTime=+new Date;t.logger.info("team::onUpdateTeamMember: ",e);t.options.onupdateteammember(s.simpleClone(e));var r={teamId:e.teamId,memberUpdateTime:e.updateTime};t.onUpdateTeam(r);var n=this.db;if(n.enable)n.updateTeamMember(e)};n.onUpdateTeam=function(e){var t=this;t.logger.info("team::onUpdateTeam:",e);t.options.onUpdateTeam(s.simpleClone(e));var r=t.db;if(r.enable)r.updateTeam(e)};n.onSyncMyTeamMembers=function(e){var t=this;var r=t.db;var n=c.reverseMembers(e.content.teamMembers);t.logger.info("team::onSyncMyTeamMembers:",n);if(r.enable){var s=r.putTeamMembers(n).then(function(){return r.updateMyTeamMembersTimetag(e.content.timetag)})["catch"](function(e){t.logger.error("team::syncMyTeamMember: ",e);return Promise.reject(e)});s.cmd="myTeamMembers";t.syncTeamMembersPromiseArray.push(s)}t.mergeMyTeamMembers(n)};n.mergeMyTeamMembers=function(e){if(!s.isArray(e))e=[e];var t=this;var r=t.myTeamMembersMap=t.myTeamMembersMap||{};e.forEach(function(e){var t=e.teamId;r[t]=s.merge(r[t],e)});t.logger.info("team::mergeMyTeamMembers:",r)};n.notifyForNewTeamMsg=function(e){if(!s.isArray(e))e=[e];var t=this;var r=this.myTeamMembersMap||{};var n={};var i=[];e.forEach(function(e){if(s.exist(r[e]))n[e]=r[e].muteNotiType;else i.push(e)});var o=Promise.resolve(n);if(i.length)o=t.api.getMyTeamMembers({teamIds:i,promise:!0}).then(function(e){t.mergeMyTeamMembers(e);e.forEach(function(e){n[e.teamId]=e.muteNotiType});return n});return o};n.updateTeamSysMsgState=function(e,t){var r=e.error;var n;if(r){t="error";r=s.filterObj(r,"code message")}n={idServer:e.obj.idServer,state:t};if(r)n.error=r;this.updateSysMsg(n)};n.onTeamMsgReceipt=function(e){var t=e.content;var r=e.error;if(r)this.logger.error("team::onTeamMsgReceipt:",r);if(t&&t.teamMsgReceipts)this.options.onTeamMsgReceipt(t)}},"./src/im/protocol/im/user.js":function(e,t,r){"use strict";var n=r("./src/im/protocol/im/index.js").fn;var s=r("./src/util/index.js");var i=s.objs2accounts;var o=r("./src/im/model/specialRelation.js");var a=r("./src/im/model/user.js");n.processUser=function(e){var t=this;var r=t.db;var n=e.obj;var s=e.error;var i=e.content;var o;switch(e.cmd){case"markInBlacklist":if(!s)t.markInBlacklist(n);break;case"syncMarkInBlacklist":t.markInBlacklist(i,!0);break;case"markInMutelist":if(!s)t.markInMutelist(n);break;case"syncMarkInMutelist":t.markInMutelist(i,!0);break;case"getRelations":if(!s)t.onRelations(e);break;case"syncMyInfo":t.onMyInfo(e,!0);break;case"updateMyInfo":if(!s){n.updateTime=i.timetag;t.onUpdateMyInfo(e,n)}break;case"syncUpdateMyInfo":t.onUpdateMyInfo(e,i.user,!0);break;case"getUsers":if(!s){o=i.users.map(function(e){e=a.reverse(e);t.mergeUser(e);return e});e.obj=o;if(r.enable)r.putUsers(o)}break;case"updateDonnop":t.onUpdateDonnop(e);break;case"syncUpdateDonnop":t.onDonnop(e,!1)}};n.onMyInfo=function(e){function t(){l=a.reverse(c.user);s.logger.info("user::onMyInfo: parseData",l)}function r(e,t){i.mergeMyInfo(l,u).then(function(){n();e()}).then(void 0,function(e){e.message="db.mergeMyInfo error";e.callFunc="user::onMyInfo";t(e)})}function n(){s.timetags.myInfo=l.updateTime;if(u)s.syncResult.myInfo=l}var s=this;var i=s.db;var o=e.error;var c=e.content;var u=!0;var l=void 0;var m=new Promise(function(e,a){if(!o){t();if(i.enable)r(e,a);else{n();e()}}else if(u){if(o)o.callFunc="user::onMyInfo";e(o);s.syncData()}})["catch"](function(e){s.logger.error("user::onMyInfo: ",e);return Promise.reject(e)});if(u){m.cmd="myInfo";s.syncPromiseArray.push(m)}};n.onUpdateMyInfo=function(e,t,r){var n=this;var i=n.db;var o=a.reverse(t);var c=s.merge(n.myInfo,o);n.myInfo=c;if(r){n.logger.info("user::onUpdateMyInfo:",c);n.options.onupdatemyinfo(c)}else e.obj=c;if(i.enable){o.account=n.account;i.updateUser(o)}};n.onRelations=function(e){function t(){l.forEach(function(e){e=o.parse(e);var t={account:e.account,createTime:e.createTime,updateTime:e.updateTime};if(e.isBlacked)f.push(t);else p.push(t);if(e.isMuted)g.push(t);else v.push(t)});s.logger.info("user::onRelations: parse blacklist",i(f),f,"delete",i(p),p);s.logger.info("user::onRelations: parse mutelist",i(g),g,"delete",i(v),v);if(!l.length)m=!1;else{m=!0;d=e.content.timetag}}function r(t,r){e.promise=new Promise(function(e,i){function o(){if(!u)a.getRelations().then(function(r){f=r[0];g=r[1];n();e();t()}).then(void 0,function(e){e.message="db.getRelations error";e.callFunc="user::onRelations";i(e);r(e)});else{n();e();t()}}if(m)a.mergeRelations(f,p,g,v,d).then(function(){o()}).then(void 0,function(e){e.message="db.mergeRelations error";e.callFunc="user::onRelations";i(e);r(e)});else{s.logger.warn("user::onRelations: no relations need merge");o()}}).then(void 0,function(e){e.message="merge relations data error";e.callFunc="user::onRelations";r(e);throw e})}function n(){s.timetags.relations=d;f.invalid=p;g.invalid=v;if(u){s.syncResult.blacklist=f;s.syncResult.mutelist=g;s.syncResult.invalidBlacklist=p;s.syncResult.invalidMutelist=v}else{s.logger.info("user::onRelations: get relations",f,g);e.obj.blacklist=f;e.obj.mutelist=g}}var s=this;var a=s.db;var c=e.error;var u=s.packetFromSync(e);var l=e.content.specialRelations;var m=!0;var d=void 0;var f=[];var p=[];var g=[];var v=[];var y=new Promise(function(e,i){if(!c){t();if(a.enable)r(e,i);else{n();e()}}else if(u){e(c);s.syncData()}})["catch"](function(e){s.logger.error("user::onRelations: ",e);return Promise.reject(e)});if(u){y.cmd="relations";s.syncPromiseArray.push(y)}};n.markInBlacklist=function(e,t){var r=this;var n=r.db;e.record={account:e.account,updateTime:+new Date};if(n.enable)n.markInBlacklist(e);if(t){r.logger.info("user::markInBlacklist:",e);r.options.onsyncmarkinblacklist(e)}};n.markInMutelist=function(e,t){var r=this;var n=r.db;e.record={account:e.account,updateTime:+new Date};if(n.enable)n.markInMutelist(e);if(t){r.logger.info("user::markInMutelist:",e);r.options.onsyncmarkinmutelist(e)}};n.mergeUser=function(e){this.userSet[e.account]=e}},"./src/im/protocol/map/configBase.js":function(e,t,r){"use strict";var n={link:{id:1,heartbeat:2},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15}};var s={heartbeat:{sid:n.link.id,cid:n.link.heartbeat},getSimpleNosToken:{sid:n.misc.id,cid:n.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:n.misc.id,cid:n.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:n.misc.id,cid:n.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:n.misc.id,cid:n.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:n.misc.id,cid:n.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:n.misc.id,cid:n.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:n.misc.id,cid:n.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:n.misc.id,cid:n.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getNosTokenTrans:{sid:n.misc.id,cid:n.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:n.misc.id,cid:n.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:n.misc.id,cid:n.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:n.misc.id,cid:n.misc.removeFile,params:[{type:"String",name:"docId"}]},signalingCreate:{sid:n.avSignal.id,cid:n.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:n.avSignal.id,cid:n.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:n.avSignal.id,cid:n.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:n.avSignal.id,cid:n.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:n.avSignal.id,cid:n.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:n.avSignal.id,cid:n.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:n.avSignal.id,cid:n.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:n.avSignal.id,cid:n.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:n.avSignal.id,cid:n.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:n.avSignal.id,cid:n.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:n.avSignal.id,cid:n.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]}};var i={"1_2":{service:"link",cmd:"heartbeat"},"6_1":{
service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]}};e.exports={idMap:n,cmdConfig:s,packetConfig:i}},"./src/im/protocol/map/configChatroom.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s=r("./src/im/protocol/map/configBase.js");var i=n.merge({},s.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,updateChatroom:14,updateMyChatroomMemberInfo:15,getChatroomMembersInfo:16,kickChatroomMember:17,updateChatroomMemberTempMute:19,queueOffer:20,queuePoll:21,queueList:22,peak:23,queueDrop:24,queueInit:25,queueChange:26},user:{id:3,syncRobot:16}});var o=n.merge({},s.cmdConfig,{login:{sid:i.chatroom.id,cid:i.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:i.chatroom.id,cid:i.chatroom.logout},sendMsg:{sid:i.chatroom.id,cid:i.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:i.chatroom.id,cid:i.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:i.chatroom.id,cid:i.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},markChatroomMember:{sid:i.chatroom.id,cid:i.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:i.chatroom.id,cid:i.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:i.chatroom.id,cid:i.chatroom.getChatroom},updateChatroom:{sid:i.chatroom.id,cid:i.chatroom.updateChatroom,params:[{type:"Property",name:"chatroom"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},updateMyChatroomMemberInfo:{sid:i.chatroom.id,cid:i.chatroom.updateMyChatroomMemberInfo,params:[{type:"Property",name:"chatroomMember"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"bool",name:"needSave"}]},getChatroomMembersInfo:{sid:i.chatroom.id,cid:i.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:i.chatroom.id,cid:i.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]},updateChatroomMemberTempMute:{sid:i.chatroom.id,cid:i.chatroom.updateChatroomMemberTempMute,params:[{type:"String",name:"account"},{type:"long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},queueOffer:{sid:i.chatroom.id,cid:i.chatroom.queueOffer,params:[{type:"string",name:"elementKey"},{type:"string",name:"elementValue"},{type:"bool",name:"transient"}]},queuePoll:{sid:i.chatroom.id,cid:i.chatroom.queuePoll,params:[{type:"string",name:"elementKey"}]},queueList:{sid:i.chatroom.id,cid:i.chatroom.queueList},peak:{sid:i.chatroom.id,cid:i.chatroom.peak},queueDrop:{sid:i.chatroom.id,cid:i.chatroom.queueDrop},queueInit:{sid:i.chatroom.id,cid:i.chatroom.queueInit,params:[{type:"int",name:"limit"}]},queueChange:{sid:i.chatroom.id,cid:i.chatroom.queueChange,params:[{type:"StrStrMap",name:"elementMap"},{type:"bool",name:"needNotify"},{type:"string",name:"notifyExt"}]},syncRobot:{sid:i.user.id,cid:i.user.syncRobot,params:[{type:"long",name:"timetag"}]}});var a="chatroom";var c=n.merge({},s.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"3_16":{service:a,cmd:"syncRobot",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"13_2":{service:a,cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"}]},"13_3":{service:a,cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:a,cmd:"logout"},"13_6":{service:a,cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:a,cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:a,cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:a,cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:a,cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:a,cmd:"closeChatroom"},"13_13":{service:a,cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_14":{service:a,cmd:"updateChatroom"},"13_15":{service:a,cmd:"updateMyChatroomMemberInfo"},"13_16":{service:a,cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:a,cmd:"kickChatroomMember"},"13_19":{service:a,cmd:"updateChatroomMemberTempMute"},"13_20":{service:a,cmd:"queueOffer"},"13_21":{service:a,cmd:"queuePoll",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_22":{service:a,cmd:"queueList",response:[{type:"KVArray",name:"queueList"}]},"13_23":{service:a,cmd:"peak",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_24":{service:a,cmd:"queueDrop"},"13_25":{service:a,cmd:"queueInit"},"13_26":{service:a,cmd:"queueChange",response:[{type:"StrArray",name:"elementKeyArray"}]}});e.exports={idMap:i,cmdConfig:o,packetConfig:c}},"./src/im/protocol/map/configIM.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s=r("./src/im/protocol/map/configBase.js");var i=n.merge({},s.idMap,{auth:{id:2,login:3,kicked:5,logout:6,multiPortLogin:7,kick:8},user:{id:3,updatePushToken:1,appBackground:2,markInBlacklist:3,getBlacklist:4,markInMutelist:5,getMutelist:6,getRelations:8,getUsers:7,updateMyInfo:10,updateDonnop:15,syncMyInfo:109,syncUpdateMyInfo:110},notify:{id:4,markRead:3,syncOfflineMsgs:4,batchMarkRead:5,syncOfflineSysMsgs:6,syncRoamingMsgs:9,syncMsgReceipts:12,syncRobots:15,syncBroadcastMsgs:16,syncSuperTeamRoamingMsgs:17},sync:{id:5,sync:1,syncTeamMembers:2,syncSuperTeamMembers:3},msg:{id:7,sendMsg:1,msg:2,sysMsg:3,getHistoryMsgs:6,sendCustomSysMsg:7,searchHistoryMsgs:8,deleteSessions:9,getSessions:10,syncSendMsg:101,sendMsgReceipt:11,msgReceipt:12,deleteMsg:13,msgDeleted:14,markSessionAck:16,broadcastMsg:17,clearServerHistoryMsgs:18},team:{id:8,createTeam:1,sendTeamMsg:2,teamMsg:3,teamMsgs:4,addTeamMembers:5,removeTeamMembers:6,updateTeam:7,leaveTeam:8,getTeam:9,getTeams:10,getTeamMembers:11,dismissTeam:12,applyTeam:13,passTeamApply:14,rejectTeamApply:15,addTeamManagers:16,removeTeamManagers:17,transferTeam:18,updateInfoInTeam:19,updateNickInTeam:20,acceptTeamInvite:21,rejectTeamInvite:22,getTeamHistoryMsgs:23,searchTeamHistoryMsgs:24,updateMuteStateInTeam:25,getMyTeamMembers:26,getMutedTeamMembers:27,sendTeamMsgReceipt:28,getTeamMsgReads:29,getTeamMsgReadAccounts:30,notifyTeamMsgReads:31,muteTeamAll:32,getTeamMemberInvitorAccid:33,syncMyTeamMembers:126,syncTeams:109,syncTeamMembers:111,syncCreateTeam:101,syncSendTeamMsg:102,syncUpdateTeamMember:119},superTeam:{id:21,sendSuperTeamMsg:2,superTeamMsg:3,addSuperTeamMembers:5,removeSuperTeamMembers:6,leaveSuperTeam:7,updateSuperTeam:8,getSuperTeam:9,getSuperTeams:12,updateInfoInSuperTeam:10,getMySuperTeamMembers:11,getSuperTeamMembers:13,getSuperTeamHistoryMsgs:14,syncMySuperTeamMembers:111,syncSuperTeams:109,syncSuperTeamMembers:113,syncCreateSuperTeam:101,syncSendSuperTeamMsg:102,syncUpdateSuperTeamMember:110},friend:{id:12,friendRequest:1,syncFriendRequest:101,deleteFriend:2,syncDeleteFriend:102,updateFriend:3,syncUpdateFriend:103,getFriends:4},chatroom:{
id:13,getChatroomAddress:1},filter:{id:101,sendFilterMsg:1,filterMsg:2,filterSysMsg:3,sendFilterCustomSysMsg:7},eventService:{id:14,publishEvent:1,pushEvent:2,subscribeEvent:3,unSubscribeEventsByAccounts:4,unSubscribeEventsByType:5,querySubscribeEventsByAccounts:6,querySubscribeEventsByType:7,pushEvents:9}});var o=n.merge({},s.cmdConfig,{login:{sid:i.auth.id,cid:i.auth.login,params:[{type:"Property",name:"login"}]},logout:{sid:i.auth.id,cid:i.auth.logout},kick:{sid:i.auth.id,cid:i.auth.kick,params:[{type:"StrArray",name:"deviceIds"}]},updatePushToken:{sid:i.user.id,cid:i.user.updatePushToken,params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"int",name:"pushkit"}]},appBackground:{sid:i.user.id,cid:i.user.appBackground,params:[{type:"bool",name:"isBackground"},{type:"Int",name:"badge"}]},markInBlacklist:{sid:i.user.id,cid:i.user.markInBlacklist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getBlacklist:{sid:i.user.id,cid:i.user.getBlacklist,params:[{type:"long",name:"time"}]},markInMutelist:{sid:i.user.id,cid:i.user.markInMutelist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getMutelist:{sid:i.user.id,cid:i.user.getMutelist,params:[{type:"long",name:"time"}]},getRelations:{sid:i.user.id,cid:i.user.getRelations,params:[{type:"long",name:"timetag"}]},getUsers:{sid:i.user.id,cid:i.user.getUsers,params:[{type:"StrArray",name:"accounts"}]},updateMyInfo:{sid:i.user.id,cid:i.user.updateMyInfo,params:[{type:"Property",name:"user"}]},updateDonnop:{sid:i.user.id,cid:i.user.updateDonnop,params:[{type:"Property",name:"donnop"}]},markRead:{sid:i.notify.id,cid:i.notify.markRead,params:[{type:"long",name:"id"},{type:"ph",name:"ph"}]},batchMarkRead:{sid:i.notify.id,cid:i.notify.batchMarkRead,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},sync:{sid:i.sync.id,cid:i.sync.sync,params:[{type:"Property",name:"sync"}]},syncTeamMembers:{sid:i.sync.id,cid:i.sync.syncTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},syncSuperTeamMembers:{sid:i.sync.id,cid:i.sync.syncSuperTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},sendMsg:{sid:i.msg.id,cid:i.msg.sendMsg,params:[{type:"Property",name:"msg"}]},getHistoryMsgs:{sid:i.msg.id,cid:i.msg.getHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},sendCustomSysMsg:{sid:i.msg.id,cid:i.msg.sendCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},searchHistoryMsgs:{sid:i.msg.id,cid:i.msg.searchHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSessions:{sid:i.msg.id,cid:i.msg.getSessions,params:[{type:"long",name:"time"}]},deleteSessions:{sid:i.msg.id,cid:i.msg.deleteSessions,params:[{type:"StrArray",name:"sessions"}]},sendMsgReceipt:{sid:i.msg.id,cid:i.msg.sendMsgReceipt,params:[{type:"Property",name:"msgReceipt"}]},deleteMsg:{sid:i.msg.id,cid:i.msg.deleteMsg,params:[{type:"Property",name:"sysMsg"}]},markSessionAck:{sid:i.msg.id,cid:i.msg.markSessionAck,params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},clearServerHistoryMsgs:{sid:i.msg.id,cid:i.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParams"}]},sendSuperTeamMsg:{sid:i.superTeam.id,cid:i.superTeam.sendSuperTeamMsg,params:[{type:"Property",name:"msg"}]},addSuperTeamMembers:{sid:i.superTeam.id,cid:i.superTeam.addSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamMembers:{sid:i.superTeam.id,cid:i.superTeam.removeSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},leaveSuperTeam:{sid:i.superTeam.id,cid:i.superTeam.leaveSuperTeam,params:[{type:"long",name:"teamId"}]},updateSuperTeam:{sid:i.superTeam.id,cid:i.superTeam.updateSuperTeam,params:[{type:"Property",name:"team"}]},getSuperTeam:{sid:i.superTeam.id,cid:i.superTeam.getSuperTeam,params:[{type:"long",name:"teamId"}]},getSuperTeams:{sid:i.superTeam.id,cid:i.superTeam.getSuperTeams,params:[{type:"long",name:"timetag"}]},getSuperTeamMembers:{sid:i.superTeam.id,cid:i.superTeam.getSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},updateInfoInSuperTeam:{sid:i.superTeam.id,cid:i.superTeam.updateInfoInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},getSuperTeamHistoryMsgs:{sid:i.superTeam.id,cid:i.superTeam.getSuperTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},getMySuperTeamMembers:{sid:i.superTeam.id,cid:i.superTeam.getMySuperTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},createTeam:{sid:i.team.id,cid:i.team.createTeam,params:[{type:"Property",name:"team"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}]},sendTeamMsg:{sid:i.team.id,cid:i.team.sendTeamMsg,params:[{type:"Property",name:"msg"}]},addTeamMembers:{sid:i.team.id,cid:i.team.addTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}]},removeTeamMembers:{sid:i.team.id,cid:i.team.removeTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateTeam:{sid:i.team.id,cid:i.team.updateTeam,params:[{type:"Property",name:"team"}]},leaveTeam:{sid:i.team.id,cid:i.team.leaveTeam,params:[{type:"long",name:"teamId"}]},getTeam:{sid:i.team.id,cid:i.team.getTeam,params:[{type:"long",name:"teamId"}]},getTeams:{sid:i.team.id,cid:i.team.getTeams,params:[{type:"long",name:"timetag"}]},getTeamMembers:{sid:i.team.id,cid:i.team.getTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},dismissTeam:{sid:i.team.id,cid:i.team.dismissTeam,params:[{type:"long",name:"teamId"}]},applyTeam:{sid:i.team.id,cid:i.team.applyTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passTeamApply:{sid:i.team.id,cid:i.team.passTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:i.team.id,cid:i.team.rejectTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},addTeamManagers:{sid:i.team.id,cid:i.team.addTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:i.team.id,cid:i.team.removeTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},transferTeam:{sid:i.team.id,cid:i.team.transferTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateInfoInTeam:{sid:i.team.id,cid:i.team.updateInfoInTeam,params:[{type:"Property",name:"teamMember"}]},updateNickInTeam:{sid:i.team.id,cid:i.team.updateNickInTeam,params:[{type:"Property",name:"teamMember"}]},acceptTeamInvite:{sid:i.team.id,cid:i.team.acceptTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:i.team.id,cid:i.team.rejectTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},getTeamHistoryMsgs:{sid:i.team.id,cid:i.team.getTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},searchTeamHistoryMsgs:{sid:i.team.id,cid:i.team.searchTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},updateMuteStateInTeam:{sid:i.team.id,cid:i.team.updateMuteStateInTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"int",name:"mute"}]},getMyTeamMembers:{sid:i.team.id,cid:i.team.getMyTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},getMutedTeamMembers:{sid:i.team.id,cid:i.team.getMutedTeamMembers,params:[{type:"long",name:"teamId"}]},sendTeamMsgReceipt:{sid:i.team.id,cid:i.team.sendTeamMsgReceipt,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReads:{sid:i.team.id,cid:i.team.getTeamMsgReads,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReadAccounts:{sid:i.team.id,cid:i.team.getTeamMsgReadAccounts,params:[{type:"Property",name:"teamMsgReceipt"}]},muteTeamAll:{sid:i.team.id,cid:i.team.muteTeamAll,params:[{type:"long",name:"teamId"},{type:"int",name:"muteType"}]},getTeamMemberInvitorAccid:{sid:i.team.id,cid:i.team.getTeamMemberInvitorAccid,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},friendRequest:{sid:i.friend.id,cid:i.friend.friendRequest,params:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:i.friend.id,cid:i.friend.deleteFriend,params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams"}]},updateFriend:{sid:i.friend.id,cid:i.friend.updateFriend,params:[{type:"Property",name:"friend"}]},getFriends:{sid:i.friend.id,cid:i.friend.getFriends,params:[{type:"long",name:"timetag"}]},getChatroomAddress:{sid:i.chatroom.id,cid:i.chatroom.getChatroomAddress,params:[{type:"long",name:"chatroomId"},{type:"bool",name:"isWeixinApp"}]},sendFilterMsg:{sid:i.filter.id,cid:i.filter.sendFilterMsg,params:[{type:"Property",name:"msg"}]},sendFilterCustomSysMsg:{sid:i.filter.id,cid:i.filter.sendFilterCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},publishEvent:{sid:i.eventService.id,cid:i.eventService.publishEvent,params:[{type:"Property",name:"msgEvent"}]},pushEvent:{sid:i.eventService.id,cid:i.eventService.pushEvent},subscribeEvent:{sid:i.eventService.id,
cid:i.eventService.subscribeEvent,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:i.eventService.id,cid:i.eventService.unSubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:i.eventService.id,cid:i.eventService.unSubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},querySubscribeEventsByAccounts:{sid:i.eventService.id,cid:i.eventService.querySubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},querySubscribeEventsByType:{sid:i.eventService.id,cid:i.eventService.querySubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},pushEvents:{sid:i.eventService.id,cid:i.eventService.pushEvents}});var a=n.merge({},s.packetConfig,{"2_3":{service:"auth",cmd:"login",response:[{type:"Property",name:"loginRes"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"},{type:"Property",name:"aosPushInfo"}]},"2_5":{service:"auth",cmd:"kicked",response:[{type:"Number",name:"from"},{type:"Number",name:"reason"}]},"2_6":{service:"auth",cmd:"logout"},"2_7":{service:"auth",cmd:"multiPortLogin",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"}]},"2_8":{service:"auth",cmd:"kick",response:[{type:"StrArray",name:"deviceIds"}]},"3_1":{service:"user",cmd:"updatePushToken"},"3_2":{service:"user",cmd:"appBackground"},"3_3":{service:"user",cmd:"markInBlacklist"},"3_103":{service:"user",cmd:"syncMarkInBlacklist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_4":{service:"user",cmd:"getBlacklist",response:[{type:"StrArray",name:"blacklist"}]},"3_5":{service:"user",cmd:"markInMutelist"},"3_105":{service:"user",cmd:"syncMarkInMutelist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_6":{service:"user",cmd:"getMutelist",response:[{type:"StrArray",name:"mutelist"}]},"3_8":{service:"user",cmd:"getRelations",response:[{type:"PropertyArray",name:"specialRelations",entity:"specialRelation"},{type:"Number",name:"timetag"}]},"3_7":{service:"user",cmd:"getUsers",response:[{type:"PropertyArray",name:"users",entity:"user"}]},"3_10":{service:"user",cmd:"updateMyInfo",response:[{type:"Number",name:"timetag"}]},"3_15":{service:"user",cmd:"updateDonnop",response:[{type:"Number",name:"timetag"}]},"3_115":{service:"user",cmd:"syncUpdateDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"3_109":{service:"user",cmd:"syncMyInfo",response:[{type:"Property",name:"user"},{type:"Number",name:"timetag"}]},"3_110":{service:"user",cmd:"syncUpdateMyInfo",response:[{type:"Property",name:"user"}]},"4_1":{service:"notify"},"4_2":{service:"notify"},"4_3":{service:"notify",cmd:"markRead"},"4_4":{service:"notify",cmd:"syncOfflineMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_5":{service:"notify",cmd:"batchMarkRead"},"4_6":{service:"notify",cmd:"syncOfflineSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_9":{service:"notify",cmd:"syncRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_17":{service:"notify",cmd:"syncSuperTeamRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_12":{service:"notify",cmd:"syncMsgReceipts",response:[{type:"PropertyArray",name:"msgReceipts",entity:"msgReceipt"},{type:"Number",name:"timetag"}]},"4_13":{service:"notify",cmd:"syncDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"4_14":{service:"notify",cmd:"syncSessionAck",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},"4_15":{service:"notify",cmd:"syncRobots",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"4_16":{service:"notify",cmd:"syncBroadcastMsgs",response:[{type:"PropertyArray",name:"broadcastMsgs",entity:"broadcastMsg"}]},"4_100":{service:"notify",cmd:"syncOfflineFilterMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_101":{service:"notify",cmd:"syncOfflineFilterSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"5_1":{service:"sync",cmd:"syncDone",response:[{type:"Number",name:"timetag"}]},"5_2":{service:"sync",cmd:"syncTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"5_3":{service:"sync",cmd:"syncSuperTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"7_1":{service:"msg",cmd:"sendMsg",response:[{type:"Property",name:"msg"}],trivialErrorCodes:[7101]},"7_2":{service:"msg",cmd:"msg",response:[{type:"Property",name:"msg"}]},"7_3":{service:"msg",cmd:"sysMsg",response:[{type:"Property",name:"sysMsg"}]},"7_6":{service:"msg",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_7":{service:"msg",cmd:"sendCustomSysMsg",trivialErrorCodes:[7101]},"7_8":{service:"msg",cmd:"searchHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_9":{service:"msg",cmd:"deleteSessions"},"7_10":{service:"msg",cmd:"getSessions",response:[{type:"StrArray",name:"sessions"}]},"7_101":{service:"msg",cmd:"syncSendMsg",response:[{type:"Property",name:"msg"}]},"7_11":{service:"msg",cmd:"sendMsgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_12":{service:"msg",cmd:"msgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_13":{service:"msg",cmd:"onDeleteMsg"},"7_14":{service:"msg",cmd:"onMsgDeleted",response:[{type:"Property",name:"sysMsg"}]},"7_15":{service:"msg",cmd:"onDeleteMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"7_16":{service:"msg",cmd:"onMarkSessionAck"},"7_17":{service:"msg",cmd:"broadcastMsg",response:[{type:"Property",name:"broadcastMsg"}]},"7_18":{service:"msg",cmd:"clearServerHistoryMsgs"},"7_116":{service:"msg",cmd:"syncMarkSessionAck",response:[{type:"Number",name:"scene"},{type:"String",name:"to"},{type:"Number",name:"timetag"}]},"21_2":{service:"superTeam",cmd:"sendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_3":{service:"superTeam",cmd:"superTeamMsg",response:[{type:"Property",name:"msg"}]},"21_5":{service:"superTeam",cmd:"addSuperTeamMembers",response:[{type:"StrArray",name:"abortedAccidList"},{type:"long",name:"timetag"}]},"21_6":{service:"superTeam",cmd:"removeSuperTeamMembers"},"21_7":{service:"superTeam",cmd:"leaveSuperTeam"},"21_8":{service:"superTeam",cmd:"updateSuperTeam",response:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},"21_9":{service:"superTeam",cmd:"getSuperTeam",response:[{type:"Property",name:"team"}]},"21_12":{service:"superTeam",cmd:"getSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_10":{service:"superTeam",cmd:"updateInfoInSuperTeam"},"21_13":{service:"superTeam",cmd:"getSuperTeamMembers",response:[{type:"long",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_11":{service:"superTeam",cmd:"getMySuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_14":{service:"superTeam",cmd:"getSuperTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"21_113":{service:"superTeam",cmd:"syncSuperTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_111":{service:"superTeam",cmd:"syncMySuperTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"superTeamMember"},{type:"long",name:"timetag"}]},"21_109":{service:"superTeam",cmd:"syncSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_101":{service:"superTeam",cmd:"syncCreateSuperTeam",response:[{type:"Property",name:"team"}]},"21_102":{service:"superTeam",cmd:"syncSendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_110":{service:"superTeam",cmd:"syncUpdateSuperTeamMember",response:[{type:"Property",name:"teamMember",entity:"superTeamMember"}]},"8_1":{service:"team",cmd:"createTeam",response:[{type:"Property",name:"team"},{type:"StrArray",name:"abortedAccidList"}]},"8_2":{service:"team",cmd:"sendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_3":{service:"team",cmd:"teamMsg",response:[{type:"Property",name:"msg"}]},"8_4":{service:"team",cmd:"teamMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_5":{service:"team",cmd:"addTeamMembers",response:[{type:"long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},"8_6":{service:"team",cmd:"removeTeamMembers"},"8_7":{service:"team",cmd:"updateTeam",response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},"8_8":{service:"team",cmd:"leaveTeam"},"8_9":{service:"team",cmd:"getTeam",response:[{type:"Property",name:"team"}]},"8_10":{service:"team",cmd:"getTeams",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"Number",name:"timetag"}]},"8_11":{service:"team",cmd:"getTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_12":{service:"team",cmd:"dismissTeam"},"8_13":{service:"team",cmd:"applyTeam",response:[{type:"Property",name:"team"}]},"8_14":{service:"team",cmd:"passTeamApply"},"8_15":{service:"team",cmd:"rejectTeamApply"},"8_16":{service:"team",cmd:"addTeamManagers"},"8_17":{service:"team",cmd:"removeTeamManagers"},"8_18":{service:"team",cmd:"transferTeam"},"8_19":{service:"team",cmd:"updateInfoInTeam"},"8_20":{service:"team",cmd:"updateNickInTeam"},"8_21":{service:"team",cmd:"acceptTeamInvite",response:[{type:"Property",name:"team"}]},"8_22":{service:"team",cmd:"rejectTeamInvite"},"8_23":{service:"team",cmd:"getTeamHistoryMsgs",response:[{
type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_24":{service:"team",cmd:"searchTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_25":{service:"team",cmd:"updateMuteStateInTeam"},"8_26":{service:"team",cmd:"getMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_27":{service:"team",cmd:"getMutedTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_28":{service:"team",cmd:"sendTeamMsgReceipt",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_29":{service:"team",cmd:"getTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_30":{service:"team",cmd:"getTeamMsgReadAccounts",response:[{type:"String",name:"idClient"},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},"8_31":{service:"team",cmd:"notifyTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_32":{service:"team",cmd:"muteTeamAll",response:[]},"8_33":{service:"team",cmd:"getTeamMemberInvitorAccid",response:[{type:"object",name:"accountsMap"}]},"8_126":{service:"team",cmd:"syncMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_109":{service:"team",cmd:"syncTeams",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",entity:"team"}]},"8_111":{service:"team",cmd:"syncTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_101":{service:"team",cmd:"syncCreateTeam",response:[{type:"Property",name:"team"}]},"8_102":{service:"team",cmd:"syncSendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_119":{service:"team",cmd:"syncUpdateTeamMember",response:[{type:"Property",name:"teamMember"}]},"12_1":{service:"friend",cmd:"friendRequest"},"12_101":{service:"friend",cmd:"syncFriendRequest",response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},"12_2":{service:"friend",cmd:"deleteFriend"},"12_102":{service:"friend",cmd:"syncDeleteFriend",response:[{type:"String",name:"account"}]},"12_3":{service:"friend",cmd:"updateFriend"},"12_103":{service:"friend",cmd:"syncUpdateFriend",response:[{type:"Property",name:"friend"}]},"12_4":{service:"friend",cmd:"getFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_5":{service:"friend",cmd:"syncFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_6":{service:"friend",cmd:"syncFriendUsers",response:[{type:"PropertyArray",name:"users",entity:"user"},{type:"Number",name:"timetag"}]},"13_1":{service:"chatroom",cmd:"getChatroomAddress",response:[{type:"StrArray",name:"address"}]},"14_1":{service:"eventService",cmd:"publishEvent",response:[{type:"Property",name:"msgEvent"}]},"14_2":{service:"eventService",cmd:"pushEvent",response:[{type:"Property",name:"msgEvent"}]},"14_3":{service:"eventService",cmd:"subscribeEvent",response:[{type:"StrArray",name:"accounts"}]},"14_4":{service:"eventService",cmd:"unSubscribeEventsByAccounts",response:[{type:"StrArray",name:"accounts"}]},"14_5":{service:"eventService",cmd:"unSubscribeEventsByType"},"14_6":{service:"eventService",cmd:"querySubscribeEventsByAccounts",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_7":{service:"eventService",cmd:"querySubscribeEventsByType",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_9":{service:"eventService",cmd:"pushEvents",response:[{type:"PropertyArray",name:"msgEvents",entity:"msgEvent"}]},"101_1":{service:"filter",cmd:"sendFilterMsg",response:[{type:"Property",name:"msg"}]},"101_2":{service:"filter",cmd:"filterMsg",response:[{type:"Property",name:"msg"}]},"101_3":{service:"filter",cmd:"filterSysMsg",response:[{type:"Property",name:"sysMsg"}]},"101_7":{service:"filter",cmd:"sendFilterCustomSysMsg"}});e.exports={idMap:i,cmdConfig:o,packetConfig:a}},"./src/im/protocol/map/serializeMapChatroom.js":function(e,t,r){"use strict";e.exports={imLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24},login:{appKey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23,session:26,isAnonymous:38},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,yidunEnable:10,antiSpamContent:11,skipHistory:12,body:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17}}},"./src/im/protocol/map/serializeMapIM.js":function(e,t,r){"use strict";e.exports={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24},login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,connectionId:102,ip:103,time:109,customTag:38},aosPushInfo:{pushType:110,hasTokenPreviously:111},sync:{myInfo:1,offlineMsgs:2,teams:3,netcallMsgs:6,roamingMsgs:7,relations:9,friends:11,sessions:12,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,deleteMsg:17,sessionAck:18,robots:19,broadcastMsgs:20,avSignal:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,filterMsgs:100},donnop:{open:1},superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13},team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13,invitorAccid:14},msg:{scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resend:13,userUpdateTime:14,custom:15,pushPayload:16,pushContent:17,apnsAccounts:18,
apnsContent:19,apnsForcePush:20,yidunEnable:21,antiSpamContent:22,antiSpamBusinessId:23,clientAntiSpam:24,antiSpamUsingYidun:25,needMsgReceipt:26,isHistoryable:100,isRoamingable:101,isSyncable:102,isMuted:104,cc:105,isInBlackList:106,isPushable:107,isOfflinable:108,isUnreadable:109,needPushNick:110,isReplyMsg:111,tempTeamMemberCount:112},msgReceipt:{to:1,from:2,time:7,idClient:11},teamMsgReceipt:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},sysMsg:{time:0,type:1,to:2,from:3,ps:4,attach:5,idServer:6,sendToOnlineUsersOnly:7,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,yidunEnable:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,cc:105,isPushable:107,isUnreadable:109,needPushNick:110},broadcastMsg:{broadcastId:1,fromAccid:2,fromUid:3,timestamp:4,body:5},friend:{account:4,flag:5,beflag:6,source:7,alias:8,bits:9,custom:10,createTime:11,updateTime:12,serverex:13},user:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,custom:10,createTime:12,updateTime:13},specialRelation:{account:0,isMuted:1,isBlacked:2,createTime:3,updateTime:4},msgType:{text:0,picture:1,audio:2,video:3,location:4,notification:5,file:6,netcall_audio:7,netcall_vedio:8,datatunnel_new:9,tips:10,robot:11,custom:100},msgEvent:{type:1,value:2,idClient:3,custom:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverCustom:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105},clearMsgsParams:{account:1,delRoam:2},delFriendParams:{delAlias:1}}},"./src/im/protocol/map/unserializeMapChatroom.js":function(e,t,r){"use strict";e.exports={imLogin:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",112:"isReactNative",1000:"token"},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",8:"appLogin",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom",26:"session",38:"isAnonymous",_21_safe:"_chatroomAvatar_safe"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",16:"queuelevel",100:"creator",101:"onlineMemberNum",102:"mute"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",10:"yidunEnable",11:"antiSpamContent",12:"skipHistory",13:"body",14:"antiSpamBusinessId",15:"clientAntiSpam",16:"antiSpamUsingYidun",20:"time",21:"from",22:"chatroomId",23:"fromClientType",25:"highPriority",_8_safe:"_fromAvatar_safe"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime",16:"tempMuted",17:"tempMuteDuration",_6_safe:"_avatar_safe"}}},"./src/im/protocol/map/unserializeMapIM.js":function(e,t,r){"use strict";e.exports={nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time"},login:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",112:"isReactNative",1000:"token"},loginRes:{17:"lastLoginDeviceId",38:"customTag",102:"connectionId",103:"ip",104:"port",106:"country",111:"hasXMPush"},loginPort:{3:"type",4:"os",5:"mac",13:"deviceId",19:"account",32:"deviceInfo",38:"customTag",102:"connectionId",103:"ip",109:"time"},aosPushInfo:{110:"pushType",111:"hasTokenPreviously"},sync:{1:"myInfo",2:"offlineMsgs",3:"teams",6:"netcallMsgs",7:"roamingMsgs",9:"relations",11:"friends",12:"sessions",13:"friendUsers",14:"msgReceipts",15:"myTeamMembers",16:"donnop",17:"deleteMsg",18:"sessionAck",19:"robots",20:"broadcastMsgs",21:"avSignal",22:"superTeams",23:"myInfoInSuperTeams",24:"superTeamRoamingMsgs",100:"filterMsgs"},donnop:{1:"open"},superTeam:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},superTeamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute"},team:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},teamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute",14:"invitorAccid"},msg:{0:"scene",1:"to",2:"from",4:"fromClientType",5:"fromDeviceId",6:"fromNick",7:"time",8:"type",9:"body",10:"attach",11:"idClient",12:"idServer",13:"resend",14:"userUpdateTime",15:"custom",16:"pushPayload",17:"pushContent",18:"apnsAccounts",19:"apnsContent",20:"apnsForcePush",21:"yidunEnable",22:"antiSpamContent",23:"antiSpamBusinessId",24:"clientAntiSpam",25:"antiSpamUsingYidun",26:"needMsgReceipt",100:"isHistoryable",101:"isRoamingable",102:"isSyncable",104:"isMuted",105:"cc",106:"isInBlackList",107:"isPushable",108:"isOfflinable",109:"isUnreadable",110:"needPushNick",111:"isReplyMsg",112:"tempTeamMemberCount"},msgReceipt:{1:"to",2:"from",7:"time",11:"idClient"},teamMsgReceipt:{0:"teamId",1:"idServer",100:"read",101:"unread",102:"idClient",103:"account"},sysMsg:{0:"time",1:"type",2:"to",3:"from",4:"ps",5:"attach",6:"idServer",7:"sendToOnlineUsersOnly",8:"apnsText",9:"pushPayload",10:"deletedIdClient",11:"deletedIdServer",12:"yidunEnable",13:"antiSpamContent",14:"deletedMsgTime",15:"deletedMsgFromNick",16:"opeAccount",105:"cc",107:"isPushable",109:"isUnreadable",110:"needPushNick"},broadcastMsg:{1:"broadcastId",2:"fromAccid",3:"fromUid",4:"timestamp",5:"body"},friend:{4:"account",5:"flag",6:"beflag",7:"source",8:"alias",9:"bits",10:"custom",11:"createTime",12:"updateTime",13:"serverex"},user:{1:"account",3:"nick",4:"avatar",5:"sign",6:"gender",7:"email",8:"birth",9:"tel",10:"custom",12:"createTime",13:"updateTime",_4_safe:"_avatar_safe"},specialRelation:{0:"account",1:"isMuted",2:"isBlacked",3:"createTime",4:"updateTime"},msgType:{0:"text",1:"picture",2:"audio",3:"video",4:"location",5:"notification",6:"file",7:"netcall_audio",8:"netcall_vedio",
9:"datatunnel_new",10:"tips",11:"robot",100:"custom"},msgEvent:{1:"type",2:"value",3:"idClient",4:"custom",5:"validTime",6:"broadcastType",7:"sync",8:"validTimeType",9:"durable",10:"time",11:"idServer",12:"clientType",13:"serverConfig",14:"serverCustom",101:"appid",103:"account",104:"enableMultiClient",106:"consid"},msgEventSubscribe:{1:"type",2:"subscribeTime",3:"sync",102:"to",104:"from",105:"time"},clearMsgsParams:{1:"account",2:"delRoam"},delFriendParams:{1:"delAlias"}}},"./src/im/protocol/parser/index.js":function(e,t,r){"use strict";function n(){}function s(e){this.mixin(e)}var i=r("./src/util/url.js");var o=r("./src/util/index.js");var a=r("./src/im/model/nimerror.js");var c=r("./src/im/protocol/map/configIM.js");var u=r("./src/im/protocol/map/serializeMapIM.js");var l=r("./src/im/protocol/map/unserializeMapIM.js");var m=r("./src/im/protocol/map/configChatroom.js");var d=r("./src/im/protocol/map/serializeMapChatroom.js");var f=r("./src/im/protocol/map/unserializeMapChatroom.js");s.prototype=Object.create(n.prototype,{protocol:{value:null,writable:!0,enumerable:!0,configurable:!0}});s.prototype.setProtocol=function(e){this.protocol=e};s.prototype.mixin=function(e){var t=this;this.configMap=this.configMap||{};["idMap","cmdConfig","packetConfig"].forEach(function(r){t.configMap[r]=o.merge({},t.configMap[r],e.configMap&&e.configMap[r])});["serializeMap","unserializeMap"].forEach(function(r){t[r]=o.merge({},t[r],e[r])})};s.prototype.createCmd=function(){var e=1;return function(t,r){var n=this;var s=this.configMap.cmdConfig[t];var i="heartbeat"===t?0:e++;if(i>32767){i=1;e=2}t={SID:s.sid,CID:s.cid,SER:i};if(s.params){t.Q=[];s.params.forEach(function(e){var s=e.type;var i=e.name;var a=e.entity;var c=r[i];if(!o.undef(c)){switch(s){case"PropertyArray":s="ArrayMable";c=c.map(function(e){return{t:"Property",v:n.serialize(e,a)}});break;case"Property":c=n.serialize(c,i);break;case"bool":c=c?"true":"false"}t.Q.push({t:s,v:c})}})}return t}}();s.prototype.parseResponse=function(e){var t=this;return new Promise(function(r,n){var s=JSON.parse(e);var i={raw:s,rawStr:e,error:a.genError(s.code)};var c=t.configMap.packetConfig[s.sid+"_"+s.cid];if(c){var u=s.r;var l="notify"===c.service&&!c.cmd;i.isNotify=l;if(l){var m=s.r[1].headerPacket;c=t.configMap.packetConfig[m.sid+"_"+m.cid];u=s.r[1].body;if(!c){i.notFound={sid:m.sid,cid:m.cid};r(i);return}}i.service=c.service;i.cmd=c.cmd;if(i.error){var d=s.sid+"_"+s.cid;if(l)d=m.sid+"_"+m.cid;i.error.cmd=i.cmd;i.error.callFunc="protocol::parseResponse: "+d;if(416===i.error.code){var f=u[0];if(f)i.frequencyControlDuration=1e3*f}}var p=!1;if(i.error&&c.trivialErrorCodes)p=c.trivialErrorCodes.indexOf(i.error.code)!==-1;var g=[];if((!i.error||p)&&c.response){i.content={};var v=function y(e,t,r,n){if(e&&"msg"===n||"sysMsg"===n){var s=r.content[n];if(o.isObject(s)&&!s.idServer){s.idServer=""+t.r[0];if(s.type&&"8"===s.type&&s.deletedIdClient)s.idServer=s.deletedIdClient}}};c.response.forEach(function(e,r){var n=u[r];if(!o.undef(n)){var a=e.type;var c=e.name;var m=e.entity||c;switch(a){case"Property":g.push(t.unserialize(n,m).then(function(e,t,r,n,s){r.content[n]=s;v(e,t,r,n)}.bind(this,l,s,i,c)));break;case"PropertyArray":i.content[c]=[];n.forEach(function(e){g.push(t.unserialize(e,m).then(function(e,t,r){e.content[t].push(r)}.bind(this,i,c)))});break;case"KVArray":i.content[c]=n;v(l,s,i,c);break;case"long":case"Long":case"byte":case"Byte":case"Number":i.content[c]=+n;break;default:i.content[c]=n;v(l,s,i,c)}}})}Promise.all(g).then(function(){r(i)})}else{i.notFound={sid:s.sid,cid:s.cid};r(i)}})};s.prototype.serialize=function(e,t){var r=this.serializeMap[t];var n={};for(var s in r)if(e.hasOwnProperty(s))n[r[s]]=e[s];return n};s.prototype.matchNosSafeUrl=function(e){if(!o.isString(e)||!~e.indexOf("_im_url=1"))return!1;var t=(0,i.urlQuery2Object)(e);if(t&&t["_im_url"]&&1==t["_im_url"])return!0;else return!1};s.prototype.getOneNosOriginUrl=function(e,t,r){var n=this;return new Promise(function(s,i){n.protocol.getNosOriginUrlReqNum++;n.protocol.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e}},function(e,i,o){n.protocol.getNosOriginUrlReqNum--;if(e)console.warn("error: get nos originUrl failed",e);else{t["_"+r+"_safe"]=t[r];t[r]=o.nosFileUrlTag&&o.nosFileUrlTag.originUrl}s()})})};s.prototype.checkObjSafeUrl=function(e,t,r){var n=this;for(var s in e)if(e.hasOwnProperty(s)){var i=e[s];if(o.isString(i)){if(this.matchNosSafeUrl(i)){var a=this.getOneNosOriginUrl(i,e,s);t.push(a);r.push(a)}}else if(o.isObject(i))this.checkObjSafeUrl(i,t,r);else if(o.isArray(i))i.forEach(function(e){if(o.isObject(e))n.checkObjSafeUrl(e,t,r)})}};var p=["url","avatar","fromAvatar","chatroomAvatar"];s.prototype.unserialize=function(e,t){var r=this;return new Promise(function(n,s){var i=r.unserializeMap[t];var o={};var a=[];if(e)for(var c in i){var u=[];if(e.hasOwnProperty(c)){o[i[c]]=e[c];if(!r.protocol.keepNosSafeUrl)if("attach"===i[c]&&e[c]&&e[c].indexOf&&~e[c].indexOf("_im_url=1"))try{var l=JSON.parse(e[c]);r.checkObjSafeUrl(l,u,a);Promise.all(u).then(function(e,t){e["attach"]=JSON.stringify(t)}.bind(r,o,l))}catch(m){console.warn(m)}else if(~p.indexOf(i[c])&&e[c]&&r.matchNosSafeUrl(e[c]))a.push(r.getOneNosOriginUrl(e[c],o,i[c]))}}Promise.all(a).then(function(e){n(o)})})};s.prototype.syncUnserialize=function(e,t){var r=this;var n=r.unserializeMap[t];var s={};if(e)for(var i in n)if(e.hasOwnProperty(i))s[n[i]]=e[i];return s};var g=new s({configMap:c,serializeMap:u,unserializeMap:l});var v=new s({configMap:m,serializeMap:d,unserializeMap:f});e.exports={IM:g,Chatroom:v}},"./src/polyfill/libDb/general.js":function(e,t,r){"use strict";function n(e){this.concurrency=0;this.pendingTasks=[];this.queue=Promise.resolve();this.logger=e.logger;this.enable=!1;this.server=null;this.name=null}var s=n.prototype;s.reset=function(e){this.enable=!1};s.clear=s.destroy=s.close=s.remove=s.init=function(e){return Promise.resolve()};e.exports=n},"./src/polyfill/weixin-app.js":function(e,t,r){"use strict";r("./src/polyfill/weixin-app/auto-polyfill.js");var n=r("./src/util/config.js");n.lbsUrl=n.lbsUrl.replace("/webconf.jsp","/wxwebconf.jsp");n.defaultReportUrl=null;n.isWeixinApp=!0},"./src/polyfill/weixin-app/auto-polyfill.js":function(e,t,r){"use strict";var n=r("./src/polyfill/weixin-app/index.js").polyfill;try{n()}catch(s){}try{n(GameGlobal)}catch(s){}try{window=window||{};n(window)}catch(s){}try{localStorage=localStorage||r("./src/polyfill/weixin-app/localstorage.js")}catch(s){}try{XMLHttpRequest=XMLHttpRequest||r("./src/polyfill/weixin-app/xmlhttprequest.js")}catch(s){}try{FormData=FormData||r("./src/polyfill/weixin-app/formdata.js")}catch(s){}try{WebSocket=WebSocket||r("./src/polyfill/weixin-app/websocket.js")}catch(s){}try{navigator=navigator||r("./src/polyfill/weixin-app/navigator.js")}catch(s){}},"./src/polyfill/weixin-app/formdata.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/typeof.js");var i=n(s);var o=r("./node_modules/babel-runtime/helpers/classCallCheck.js");var a=n(o);var c=r("./node_modules/babel-runtime/helpers/createClass.js");var u=n(c);var l=function(){function e(){(0,a["default"])(this,e);this._entries=[]}(0,u["default"])(e,[{key:"append",value:function t(e,r){if("string"!=typeof e)throw new TypeError("FormData name must be a string");if("string"!=typeof r)if("object"!==("undefined"==typeof r?"undefined":(0,i["default"])(r))||"string"!=typeof r.uri)throw new TypeError("FormData value must be a string or { uri: tempFilePath }");this._entries.push([e,r])}},{key:"set",value:function r(e,t){var r=this.get(e);if(r)r[1]=t;else this.append(e,t)}},{key:"delete",value:function n(e){this._entries=this._entries.filter(function(t){return t[0]!==e})}},{key:"entries",value:function s(){return this._entries}},{key:"get",value:function o(e){return this._entries.find(function(t){return t[0]===e})}},{key:"getAll",value:function c(e){return this._entries.filter(function(t){return t[0]===e})}},{key:"has",value:function l(e){return this._entries.some(function(t){return t[0]===e})}},{key:"keys",value:function m(){return this._entries.map(function(e){return e[0]})}},{key:"values",value:function d(){return this._entries.map(function(e){return e[1]})}}]);return e}();e.exports=l},"./src/polyfill/weixin-app/index.js":function(e,t,r){"use strict";(function(t){function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/typeof.js");var i=n(s);var o=r("./src/polyfill/weixin-app/localstorage.js");var a=r("./src/polyfill/weixin-app/xmlhttprequest.js");var c=r("./src/polyfill/weixin-app/formdata.js");var u=r("./src/polyfill/weixin-app/websocket.js");var l=r("./src/polyfill/weixin-app/navigator.js");e.exports={polyfill:function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t||window;if("object"!==("undefined"==typeof e?"undefined":(0,i["default"])(e)))throw new Error("polyfill target is not an Object");var r={localStorage:o,XMLHttpRequest:a,FormData:c,WebSocket:u,Object:Object,navigator:l,location:Object.create(null)};for(var n in r)if(!e[n])e[n]=r[n];e.navigator.product="WeixinApp"},localStorage:o,XMLHttpRequest:a,FormData:c,WebSocket:u}}).call(this,r("./node_modules/webpack/buildin/global.js"))},"./src/polyfill/weixin-app/localstorage.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/classCallCheck.js");var i=n(s);var o=r("./node_modules/babel-runtime/helpers/createClass.js");var a=n(o);var c=function(){function e(){(0,i["default"])(this,e)}(0,a["default"])(e,[{key:"getItem",value:function t(e){return wx.getStorageSync(e)}},{key:"setItem",value:function r(e,t){return wx.setStorageSync(e,t)}},{key:"removeItem",value:function n(e){return this.setItem(e,"")}},{key:"clear",value:function s(){return wx.clearStorageSync()}}]);return e}();e.exports=new c},"./src/polyfill/weixin-app/navigator.js":function(e,t,r){"use strict";e.exports={}},
"./src/polyfill/weixin-app/platform.js":function(e,t,r){"use strict";e.exports={description:"weixin micro app",layout:null,manufacturer:null,name:"weixin",prerelease:null,product:null,ua:"Mozilla/5.0 AppleWebKit/537.36 (KHTML, like Gecko) Weixin/1.9.1",version:"1.9.1",os:{architecture:64,family:"Windows",version:"1.9.1"}}},"./src/polyfill/weixin-app/websocket.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var s=r("./node_modules/babel-runtime/helpers/classCallCheck.js");var i=n(s);var o=r("./node_modules/babel-runtime/helpers/createClass.js");var a=n(o);var c=r("./node_modules/object-assign/index.js");var u=0;var l=1;var m=2;var d=3;var f=function(){function e(t,r){var n=this;(0,i["default"])(this,e);if(!t)throw new TypeError("Failed to construct 'WebSocket': url required");if(r&&(!wx.canIUse||!wx.canIUse("connectSocket.object.protocols")))throw new Error("subprotocal not supported in weapp");t=t.replace(/:\d+/,"");this._url=t;this._protocal=r||"";this._readyState=u;this._socketTask=wx.connectSocket({url:t,protocals:this._protocal,fail:function s(e){console.info("wx::ws: sockets build failed ...");n.errorHandler(e)},success:function o(e){console.log("wx::ws: sockets build succeed ...")}});this._socketTask.onOpen(function(e){n._readyState=l;console.log("wx::ws: onopen ",e);n.dispatchEvent({type:"open"})});this._socketTask.onError(function(e){n.errorHandler(e)});this._socketTask.onClose(function(e){n._readyState=d;console.log("wx::ws: onclose ",e);var t=e.code,r=e.reason,s=e.wasClean;n.dispatchEvent({code:t,reason:r,wasClean:s,type:"close"});n._socketTask=null});this._socketTask.onMessage(function(e){var t=e.data,r=e.origin,s=e.ports,i=e.source;n.dispatchEvent({data:t,origin:r,ports:s,source:i,type:"message"})})}(0,a["default"])(e,[{key:"dispatchEvent",value:function t(e){var t=e.type;var r="on"+t;if("function"==typeof this[r])this[r](e)}},{key:"close",value:function r(){try{console.log("wx::ws:close WebSocket force close: readystate "+this._readyState);this._socketTask.close({code:1e3,reason:"wx::ws:user force close websocket",complete:function t(){}})}catch(e){console.warn("wx::ws:close WebSocket force error",e)}}},{key:"send",value:function n(e){if(this._readyState!==l)throw new Error("wx:ws: sendMsg when readyState="+this._readyState);if(!("string"==typeof e||e instanceof ArrayBuffer))throw new TypeError("wx:ws: sendMsg only String/ArrayBuffer supported");this._socketTask.send({data:e})}},{key:"errorHandler",value:function s(e){console.error("wx::ws: onerror ",e);this._readyState=d;this.dispatchEvent({type:"error",message:e.errMsg});if(e.errMsg&&"[object Array]"===Object.prototype.toString.call(e.errMsg)&&(e.errMsg.indexOf("断裂管道")>0||e.errMsg.indexOf("broken pipe")>0))this.dispatchEvent({code:1006,reason:e.errMsg,type:"close"});this._socketTask=null}},{key:"url",get:function o(){return this._url}},{key:"protocal",get:function c(){return this._protocal}},{key:"readyState",get:function m(){return this._readyState}}]);return e}();c(f,{CONNECTING:u,OPEN:l,CLOSING:m,CLOSED:d});e.exports=f},"./src/polyfill/weixin-app/xmlhttprequest.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){this.status=e.statusCode;this.statusText=e.statusCode;if(e.header)this._responseHeaders=Object.keys(e.header).reduce(function(t,r){t[r.toLowerCase()]=e.header[r];return t},{});var t=e.data;if("string"!=typeof t)t=JSON.stringify(t);this.responseText=this.response=t;this.readyState=y;this.dispatchEvent({type:"readystatechange"})}var i=r("./node_modules/babel-runtime/helpers/defineProperty.js");var o=n(i);var a=r("./node_modules/babel-runtime/helpers/classCallCheck.js");var c=n(a);var u=r("./node_modules/babel-runtime/helpers/createClass.js");var l=n(u);var m=r("./node_modules/object-assign/index.js");var d=r("./src/polyfill/weixin-app/formdata.js");var f=0;var p=1;var g=2;var v=3;var y=4;var h=["abort","error","load","loadstart","progress","timeout","loadend","readystatechange"];var b=["abort","error","load","loadstart","progress","timeout","loadend"];var T=function(){function e(){(0,c["default"])(this,e)}(0,l["default"])(e,[{key:"dispatchEvent",value:function t(e){var t=e.type;var r="on"+t;if("function"==typeof this[r])this[r](e)}}]);return e}();var M=function(){function e(){(0,c["default"])(this,e);this.readyState=f;this._headers={};this.upload=new T}(0,l["default"])(e,[{key:"dispatchEvent",value:function t(e){var t=e.type;var r="on"+t;if("function"==typeof this[r])this[r](e)}},{key:"abort",value:function r(){if(!this._request||this._request.abort){this.status=0;this.readyState=y;return this._request.abort()}throw new Error("该版本基础库不支持 abort request")}},{key:"getAllResponseHeaders",value:function n(){var e=this;return this._responseHeaders?Object.keys(this._responseHeaders).map(function(t){return t+": "+e._responseHeaders[t]}).join("\r\n"):""}},{key:"getResponseHeader",value:function i(e){var t=e.toLowerCase();if(this._responseHeaders&&this._responseHeaders[t])return this._responseHeaders[t];else return null}},{key:"overrideMimeType",value:function a(){throw new Error("not supported in weapp")}},{key:"open",value:function u(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;if(this.readyState!==f)throw new Error("request is already opened");if(!r)throw new Error("sync request is not supported");this._method=e;t=t.replace(/:\d+/,"");this._url=t;this.readyState=p;this.dispatchEvent({type:"readystatechange"})}},{key:"setRequestHeader",value:function g(e,t){if(this.readyState!==p)throw new Error("request is not opened");this._headers[e.toLowerCase()]=t}},{key:"send",value:function v(e){var t=this;if(this.readyState!==p)throw new Error("request is not opened");if(e instanceof d){var r=e.entries();var n=r.filter(function(e){return"string"!=typeof e[1]});if(0===n.length)throw new Error("Must specify a Blob field in FormData");if(n.length>1)console.warn("Only the first Blob will be send in Weapp");var i=r.filter(function(e){return"string"==typeof e[1]}).reduce(function(e,t){return m(e,(0,o["default"])({},t[0],t[1]))},{});this._request=wx.uploadFile({url:this._url,name:n[0][0],filePath:n[0][1].uri,formData:i,header:this._headers,success:s.bind(this),fail:function a(e){t.status=0;t.readyState=y;t.dispatchEvent({type:"readystatechange"});t.dispatchEvent({type:"error"})}});if(this._request&&this._request.onProgressUpdate)this._request.onProgressUpdate(function(e){var r=e.totalBytesSent,n=e.totalBytesExpectedToSend;t.upload.dispatchEvent({type:"progress",loaded:r,total:n})})}else this._request=wx.request({url:this._url,data:e||"",method:this._method.toUpperCase(),header:this._headers,success:s.bind(this),fail:function c(e){t.status=0;t.readyState=y;t.dispatchEvent({type:"readystatechange"});t.dispatchEvent({type:"error"})}})}}]);return e}();m(M,{UNSENT:f,OPENED:p,HEADERS_RECEIVED:g,LOADING:v,DONE:y});e.exports=M},"./src/util/ajax/ajax.js":function(e,t,r){"use strict";function n(e){var t=e.mode;var r=f;var n=d.getGlobal();if(!n.FormData&&n.document)t="iframe";if("iframe"===t)r=e.upload?p:g;return new r(e)}function s(e){var t=e.upload="multipart/form-data"===(e.headers||d.o)["Content-Type"];var r=!1;try{var s=(location.protocol+"//"+location.host).toLowerCase();var i=d.url2origin(e.url);r=s!==i}catch(o){}e.cors=r;if(!t&&!r&&!e.mode)return new f(e);else return n(e)}function i(e){var t=v[e];if(t){t.req.destroy();delete v[e]}}function o(e,t){t={data:t};var r=e.result.headers;if(r)t.headers=e.req.header(r);return t}function a(e,t,r){var n=v[e];if(n){if("onload"===t&&n.result)r=o(n,r);i(e);var s={type:t,result:r};y(s);if(!s.stopped)n[t](s.result)}}function c(e,t){a(e,"onload",t)}function u(e,t){a(e,"onerror",t)}function l(e,t){var r=d.genUrlSep(e);t=t||"";if(d.isObject(t))t=d.object2query(t);if(t)e+=r+t;return e}function m(e,t){t=t||{};var r=d.uniqueID();var n={result:t.result,onload:t.onload||d.f,onerror:t.onerror||d.f};v[r]=n;t.onload=c.bind(null,r);t.onerror=u.bind(null,r);if(t.query)e=l(e,t.query);var i=t.method||"";if((!i||/get/i.test(i))&&t.data){e=l(e,t.data);t.data=null}t.url=e;n.req=s(t);return r}var d=r("./src/util/util.js");var f=r("./src/util/ajax/proxy/xhr.js");var p=r("./src/util/ajax/proxy/upload.js");var g=r("./src/util/ajax/proxy/frame.js");var v={};var y=d.f;m.filter=function(e){if(d.isFunction(e))y=e};m.abort=function(e){var t=v[e];if(t&&t.req)t.req.abort()};e.exports=m},"./src/util/ajax/chunkUpload.js":function(e,t,r){"use strict";var n=r("./src/util/config.js");var s=n.chunkSize;var i=r("./src/util/index.js");var o=r("./src/util/ajax/ajax.js");var a=function c(e,t,r){function i(e,t,r,n,i){var l=t.offset;var m=t.offset+s;r.data=i.file.slice(l,m);r.query.offset=t.offset;r.query.complete=m>=i.fileSize;r.query.context=t.context;r.onuploading=a;r.onload=c;r.onerror=u;return o(e,r)}function a(t){var r=l.fileUoloadedSize+t.loaded;var n=Math.floor(1e4*r/l.fileSize)/100;if(parseInt(n)>=100){n=100;a=function i(){}}if(l.percentage!==n){l.percentage=n;var s={docId:e.docId,total:l.fileSize,loaded:r,percentage:n,percentageText:n+"%"};if(e.fileInput)s.fileInput=e.fileInput;if(e.blob)s.blob=e.blob;e.uploadprogress(s)}}function c(s){try{s=JSON.parse(s)}catch(a){r.onError(a);return}if(!s.errMsg&&!s.errCode)if(s.offset<l.fileSize){delete m.onaftersend;l.fileUoloadedSize=s.offset;r.sn=i(e.url,s,m,t,l)}else{var c=function d(e){r.onError(e)};var u=n.genFileUrl(e.nosToken);if("image"===e.type)o(u+"?imageInfo",{onload:function f(t){try{t=JSON.parse(t);e.uploaddone(null,{docId:s.docId,w:t.Width,h:t.Height,orientation:t.Orientation||"",type:t.Type,size:t.Size||l.fileSize})}catch(r){c(r)}},onerror:c});else if("video"===e.type||"audio"===e.type)o(u+"?vinfo",{onload:function p(t){try{t=JSON.parse(t);if(t.GetVideoInfo&&t.GetVideoInfo.VideoInfo)t=t.GetVideoInfo.VideoInfo;e.uploaddone(null,{docId:s.docId,w:t.Width,h:t.Height,dur:t.Duration,orientation:t.Rotate,audioCodec:t.AudioCodec,videoCodec:t.VideoCodec,container:t.Container,size:t.Size||l.fileSize})}catch(r){
c(r)}},onerror:c});else e.uploaddone(null,{docId:s.docId,size:l.fileSize})}else r.onError(s)}function u(e){try{if(e.result)var t=JSON.parse(e.result);else t=e;r.onError(t)}catch(n){r.onError(n)}}var l={file:e.data[t],fileSize:e.data[t].size,fileUoloadedSize:0,percentage:0};var m={query:{offset:0,complete:s>=l.fileSize,version:"1.0"},headers:{"Content-Type":"application/x-www-form-urlencoded","x-nos-token":e.nosToken.token},method:"POST",timeout:0,onaftersend:function d(){e.beginupload(r)},onuploading:a,onload:c,onerror:u};m.data=l.file.slice(0,s);return o(e.url,m)};e.exports=a},"./src/util/ajax/index.js":function(e,t,r){"use strict";var n=r("./src/util/ajax/ajax.js");var s=r("./src/util/ajax/json.js");var i=r("./src/util/ajax/upload.js");var o=r("./src/util/ajax/chunkUpload.js");n.json=s;n.upload=i;n.chunkUpload=o;e.exports=n},"./src/util/ajax/json.js":function(e,t,r){"use strict";var n=r("./src/util/util.js");var s=r("./src/util/ajax/ajax.js");var i=function(){var e=/json/i;var t=/post/i;return function(r,i){i=i||{};var o=i.data=i.data||{};var a=i.headers=i.headers||{};var c=n.checkWithDefault(a,"Accept","application/json");var u=n.checkWithDefault(a,"Content-Type","application/json");if(e.test(c))i.type="json";if(t.test(i.method)&&e.test(u))i.data=JSON.stringify(o);return s(r,i)}}();e.exports=i},"./src/util/ajax/message.js":function(e,t,r){"use strict";var n=r("./src/util/util.js");var s=n.getGlobal();var i={};var o=s.name||"_parent";var a=[];var c="MSG|";var u=[];i.addMsgListener=function(e){a.push(e)};var l=function g(e){for(var t=0,r=a.length;t<r;t++)try{a[t].call(null,e)}catch(n){}};var m=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){t=t||"";if(e.test(t))return RegExp.$1;else return"*"}}();var d=function v(){var e=unescape(s.name||"").trim();if(e&&0===e.indexOf(c)){s.name="";var t=n.string2object(e.replace(c,""),"|");var r=(t.origin||"").toLowerCase();if(!r||"*"===r||0===location.href.toLowerCase().indexOf(r))l({data:JSON.parse(t.data||"null"),source:s.frames[t.self]||t.self,origin:m(t.ref||("undefined"==typeof document?"":document.referrer))})}};var f=function(){var e;var t=function r(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1};return function(){if(u.length){e=[];for(var r=u.length-1,n;r>=0;r--){n=u[r];if(!t(e,n.w)){e.push(n.w);u.splice(r,1);n.w.name=n.d}}e=null}}}();var p=i.startTimer=function(){var e=!1;return function(){if(!e){e=!0;if(!s.postMessage){setInterval(f,100);setInterval(d,20)}}}}();i.postMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.fillUndef(t,{origin:"*",source:o});if(!s.postMessage){p();if(n.isObject(t)){var r={};r.origin=t.origin||"";r.ref=location.href;r.self=t.source;r.data=JSON.stringify(t.data);t=c+n.object2string(r,"|",!0)}u.unshift({w:e,d:escape(t)})}else{var i=t.data;if(!s.FormData)i=JSON.stringify(i);e.postMessage(i,t.origin)}};e.exports=i},"./src/util/ajax/proxy/frame.js":function(e,t,r){"use strict";function n(e){var t=this;t.init();o.call(t,e)}var s=r("./src/util/util.js");var i=r("./src/util/ajax/message.js");var o=r("./src/util/ajax/proxy/index.js");var a={};var c=o.prototype;var u=n.prototype=Object.create(c);u.init=function(){function e(e){var t=e.data;if(0===t.indexOf(r)){t=JSON.parse(t.replace(r,""));var n=t.key;var s=a[n];if(s){delete a[n];t.result=decodeURIComponent(t.result||"");s.onLoad(t)}}}function t(){if(!n){n=!0;var t=s.getGlobal();if(t.postMessage)s.on(t,"message",e);else i.addMsgListener(e)}}var r="NEJ-AJAX-DATA:";var n=!1;return function(){t()}}();u.doSend=function(){var e=this;var t=e.options;var r=s.url2origin(t.url);var n=t.proxyUrl||r+"/res/nej_proxy_frame.html";var o=a[n];if(!s.isArray(o))if(o){if(!e.aborted){var c=e.key=s.uniqueID();a[c]=e;var u=s.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},t);u.key=c;i.postMessage(o,{data:u});e.afterSend()}}else{a[n]=[e.doSend.bind(e,t)];s.createIframe({src:n,onload:function l(e){var t=a[n];a[n]=s.target(e).contentWindow;t.forEach(function(e){try{e()}catch(t){console.log("error:",t)}})}})}else o.push(e.doSend.bind(e,t))};u.abort=function(){var e=this;e.aborted=!0;delete a[e.key];c.abort.call(e)};e.exports=n},"./src/util/ajax/proxy/index.js":function(e,t,r){"use strict";function n(e){var t=this;if(e.onload)t.once("load",e.onload);if(e.onerror)t.once("error",e.onerror);if(e.onbeforesend)t.once("beforesend",e.onbeforesend);if(e.onaftersend)t.once("aftersend",e.onaftersend);e=t.options=s.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e);var r=e.headers;var n="Content-Type";if(s.notexist(r[n]))r[n]="application/x-www-form-urlencoded";t.send()}var s=r("./src/util/util.js");var i=s.f;var o=r("./node_modules/wolfy87-eventemitter/EventEmitter.js");var a=n.prototype=Object.create(o.prototype);a.send=function(){var e=this;var t=e.options;setTimeout(function(){try{try{e.emit("beforesend",t)}catch(r){console.log("error:","ignore error ajax beforesend,",r)}e.doSend()}catch(r){console.log("error:","ignore error server error,",r);e.onError("serverError","请求失败:"+r.message)}},0)};a.doSend=i;a.afterSend=function(){var e=this;setTimeout(function(){e.emit("aftersend",e.options)},0)};a.onLoad=function(e){var t=this;var r=t.options;var n=e.status;var s=e.result;if(0===(""+n).indexOf("2")){if("json"===r.type)try{s=JSON.parse(s)}catch(i){console.log("error:","ignore error parse json,",i);t.onError("parseError",s);return}t.emit("load",s)}else t.onError("serverError","服务器返回异常状态",{status:n,result:s})};a.onError=function(e,t,r){var n=s.isObject(r)?r:{};n.code=e||"error";n.message=t||"发生错误";this.emit("error",n)};a.onTimeout=function(){this.onError("timeout","请求超时")};a.abort=function(){this.onError("abort","客户端中止")};a.header=function(e){var t=this;if(!s.isArray(e))return t.getResponseHeader(e||"");var r={};e.forEach(function(e){r[e]=t.header(e)});return r};a.getResponseHeader=i;a.destroy=i;e.exports=n},"./src/util/ajax/proxy/upload.js":function(e,t,r){"use strict";function n(e){var t=this;t.init();i.call(t,e)}var s=r("./src/util/util.js");var i=r("./src/util/ajax/proxy/index.js");var o=r("./src/util/ajax/message.js");var a="NEJ-UPLOAD-RESULT:";var c={};var u=i.prototype;var l=n.prototype=Object.create(u);l.init=function(){function e(e){var t=e.data;if(0===t.indexOf(a)){t=JSON.parse(t.replace(a,""));var r=t.key;var n=c[r];if(n){delete c[r];t.result=decodeURIComponent(t.result||"");n.onLoad(t.result)}}}function t(){if(!r){r=!0;var t=s.getGlobal();if(t.postMessage)s.on(t,"message",e);else{o.addMsgListener(e);o.startTimer()}}}var r=!1;return function(){t()}}();l.doSend=function(){function e(){l.forEach(function(e,t){var r=m[t];if(r.parentNode){e.name=r.name;if(s.isFunction(e.setAttribute))e.setAttribute("form",r.getAttribute("form"));r.parentNode.replaceChild(e,r)}})}var t=this;var r=t.options;var n=t.key="zoro-ajax-upload-iframe-"+s.uniqueID();c[n]=t;var i=t.form=s.html2node('<form style="display:none;"></form>');if("undefined"==typeof document)console.log("error: document is undefined");else document.body.appendChild(i);i.target=n;i.method="POST";i.enctype="multipart/form-data";i.encoding="multipart/form-data";var o=r.url;var a=s.genUrlSep(o);i.action=o+a+"_proxy_=form";var u=r.data;var l=[];var m=[];if(u)s.getKeys(u,r.putFileAtEnd).forEach(function(e){var t=u[e];if(t.tagName&&"INPUT"===t.tagName.toUpperCase()){if("file"===t.type){var r=t;var n=r.cloneNode(!0);r.parentNode.insertBefore(n,r);var o=s.dataset(r,"name");if(o)r.name=o;i.appendChild(r);if(s.isFunction(r.setAttribute)){r.setAttribute("form","");r.removeAttribute("form")}l.push(t);m.push(n)}}else{var a=s.html2node('<input type="hidden"/>');a.name=e;a.value=t;i.appendChild(a)}});var d=t.iframe=s.createIframe({name:n,onload:function f(){if(!t.aborted){s.on(d,"load",t.checkResult.bind(t));i.submit();e();t.afterSend()}else e()}})};l.checkResult=function(){var e=this;var t;var r;try{t=e.iframe.contentWindow.document.body;r=(t.innerText||t.textContent||"").trim();if(r.indexOf(a)>=0||t.innerHTML.indexOf(a)>=0)return}catch(n){console.log("error:","ignore error if not same domain,",n);return}e.onLoad(r)};l.onLoad=function(e){var t=this;u.onLoad.call(t,{status:200,result:e});s.remove(t.form);s.remove(t.iframe);u.destroy.call(t)};l.destroy=function(){s.remove(this.iframe);s.remove(this.form)};l.abort=function(){var e=this;e.aborted=!0;delete c[e.key];u.abort.call(e)};e.exports=n},"./src/util/ajax/proxy/xhr.js":function(e,t,r){"use strict";function n(e){var t=this;if(e.onuploading)t.on("uploading",e.onuploading);i.call(t,e)}var s=r("./src/util/util.js");var i=r("./src/util/ajax/proxy/index.js");var o=i.prototype;var a=n.prototype=Object.create(o);a.doSend=function(){var e=this;var t=e.options;var r=t.headers;var n=e.xhr=new XMLHttpRequest;if("multipart/form-data"===r["Content-Type"]){delete r["Content-Type"];n.upload.onprogress=e.onProgress.bind(e);n.upload.onload=e.onProgress.bind(e);var i=t.data;t.data=new window.FormData;if(i)s.getKeys(i,t.putFileAtEnd).forEach(function(e){var r=i[e];if(r.tagName&&"INPUT"===r.tagName.toUpperCase()){if("file"===r.type)[].forEach.call(r.files,function(e){t.data.append(s.dataset(r,"name")||r.name||e.name||"file-"+s.uniqueID(),e)})}else t.data.append(e,r)})}else if(r["x-nos-token"]){n.upload.onprogress=e.onProgress.bind(e);n.upload.onload=e.onProgress.bind(e)}n.onreadystatechange=e.onStateChange.bind(e);if(0!==t.timeout)e.timer=setTimeout(e.onTimeout.bind(e),t.timeout);n.open(t.method,t.url,!t.sync);Object.keys(r).forEach(function(e){n.setRequestHeader(e,r[e])});if(t.cookie&&"withCredentials"in n)n.withCredentials=!0;n.send(t.data);e.afterSend()};a.onProgress=function(e){if(e.lengthComputable&&e.loaded<=e.total)this.emit("uploading",e)};a.onStateChange=function(){var e=this;var t=e.xhr;if(4===t.readyState)e.onLoad({status:t.status,result:t.responseText||""})};a.getResponseHeader=function(e){var t=this.xhr;return!t?"":t.getResponseHeader(e)};a.destroy=function(){var e=this;clearTimeout(e.timer);
try{e.xhr.onreadystatechange=s.f;e.xhr.abort()}catch(t){console.log("error:","ignore error ajax destroy,",t)}o.destroy.call(e)};e.exports=n},"./src/util/ajax/upload.js":function(e,t,r){"use strict";var n=r("./src/util/ajax/ajax.js");var s=function i(e,t){t.method="POST";t.headers=t.headers||{};t.headers["Content-Type"]="multipart/form-data";t.timeout=0;t.type=t.type||"json";return n(e,t)};e.exports=s},"./src/util/blob.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s={};s.fromDataURL=function i(e){var t=n.getGlobal();var r=void 0;if(e.split(",")[0].indexOf("base64")>=0)r=t.atob(e.split(",")[1]);else r=t.decodeURIComponent(e.split(",")[1]);var s=e.split(",")[0].split(":")[1].split(";")[0];var i=new Uint8Array(r.length);for(var o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return new t.Blob([i],{type:s})};e.exports=s},"./src/util/config.js":function(e,t,r){"use strict";var n="3b59f3e215043c723b24615c42a6a16554b8d9a8";var s="3b59f3e2";var i="6.8.0";var o="2.8.0.906";var a="4.8.0";var c="68";var u="1";var l=1;var m="https://imtest.netease.im/lbs/webconf.jsp";var d="roomserver-test.netease.im";var f="https://imtest.netease.im/1.gif";var p="https://roomserver-test.netease.im/v1/sdk/detect/local";var g="https://webtest.netease.im/nrtcproxy/demo/getChecksum.action";var v="https://webtest.netease.im/nrtcproxy/nrtc/getChannelInfos.action";var y=!0?5e3:void 0;var h={info:{hash:n,shortHash:s,version:i,sdkVersion:c,nrtcVersion:a,nrtcSdkVersion:u,protocolVersion:l},agentVersion:o,lbsUrl:m,roomserver:d,connectTimeout:y,xhrTimeout:y,socketTimeout:y,reconnectionDelay:1600,reconnectionDelayMax:y,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:8e3,cmdTimeout:y,defaultReportUrl:f,isWeixinApp:!1,isNodejs:!1,isRN:!1,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:p,optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",wxDefaultLinkUrl:"wlnimsc0.netease.im"};h.getDefaultLinkUrl=function(e){var t=h.optionDefaultLinkUrl||(h.isWeixinApp?h.wxDefaultLinkUrl:h.defaultLinkUrl);if(!t)return!1;var r=e?"https":"http";var n=e?"443":"80";var s=t;if(t.indexOf("http")===-1)s=r+"://"+s;if(t.indexOf(":")===-1)s=s+":"+n;return s};h.weixinNetcall=h.nrtcNetcall={checkSumUrl:g,getChannelInfoUrl:v};h.formatSocketUrl=function(e){var t=e.url,r=e.secure;var n=r?"https":"http";if(t.indexOf("http")===-1)return n+"://"+t;else return t};h.uploadUrl="https://nos.netease.com";h.chunkUploadUrl=null;h.commonMaxSize=104857600;h.chunkSize=4194304;h.chunkMaxSize=4194304e4;h.replaceUrl="https://{bucket}-nosdn.netease.im/{object}";h.downloadHost="nos.netease.com";h.downloadUrl="https://{bucket}-nosdn.netease.im/{object}";h.httpsEnabled=!1;h.threshold=0;h.genUploadUrl=function(e){return h.uploadUrl+"/"+e};h.genChunkUploadUrl=function(e){if(h.chunkUploadUrl)return h.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName;else return""};h.genDownloadUrl=function(e,t){var r=e.bucket,n=e.tag,s=e.expireSec;var i=+new Date;var o=s?"&survivalTime="+s:"";var a=h.replaceUrl+"?createTime="+i+o;a=h.genNosProtocolUrl(a);return a.replace("{bucket}",r).replace("{object}",t)};h.genFileUrl=function(e){var t=e.bucket,r=e.objectName;var n=h.genNosProtocolUrl(h.replaceUrl);return n.replace("{bucket}",t).replace("{object}",r)};h.genNosProtocolUrl=function(e){if(/^http/.test(e)){if(h.httpsEnabled&&0!==e.indexOf("https://"))e=e.replace("http","https")}else if(h.httpsEnabled)e="https://"+e;else e="http://"+e;return e};e.exports=h},"./src/util/console.js":function(e,t,r){"use strict";var n=r("./src/util/config.js");if("undefined"!=typeof window)if(!window.console&&!n.isWeixinApp)window.console={log:function s(){},info:function i(){},warn:function o(){},error:function a(){}}},"./src/util/device.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s={};s.init=function(){s.deviceId=n.guid()};s.init();s.clientTypeMap={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"};s.db={open:function i(){}};e.exports=s},"./src/util/index.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){if("object"===("undefined"==typeof e?"undefined":(0,o["default"])(e))){this.callFunc=e.callFunc||null;this.message=e.message||"UNKNOW ERROR"}else this.message=e;this.time=new Date;this.timetag=+this.time}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);var a=r("./node_modules/javascript-natural-sort/naturalSort.js");var c=r("./node_modules/deep-access/index.js");r("./src/util/console.js");var u=r("./src/util/util.js");var l=u.getGlobal();var m=/\s+/;u.deduplicate=function(e){var t=[];e.forEach(function(e){if(t.indexOf(e)===-1)t.push(e)});return t};u.capFirstLetter=function(e){if(!e)return"";e=""+e;return e.slice(0,1).toUpperCase()+e.slice(1)};u.guid=function(){var e=function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+e()+e()+e()+e()+e()+e()}}();u.extend=function(e,t,r){for(var n in t)if("undefined"==typeof e[n]||r===!0)e[n]=t[n]};u.filterObj=function(e,t){var r={};if(u.isString(t))t=t.split(m);t.forEach(function(t){if(e.hasOwnProperty(t))r[t]=e[t]});return r};u.copy=function(e,t){t=t||{};if(!e)return t;Object.keys(e).forEach(function(r){if(u.exist(e[r]))t[r]=e[r]});return t};u.copyWithNull=function(e,t){t=t||{};if(!e)return t;Object.keys(e).forEach(function(r){if(u.exist(e[r])||u.isnull(e[r]))t[r]=e[r]});return t};u.findObjIndexInArray=function(e,t){e=e||[];var r=t.keyPath||"id";var n=-1;e.some(function(e,s){if(c(e,r)===t.value){n=s;return!0}});return n};u.findObjInArray=function(e,t){var r=u.findObjIndexInArray(e,t);return r===-1?null:e[r]};u.mergeObjArray=function(){var e=[];var t=[].slice.call(arguments,0,-1);var r=arguments[arguments.length-1];if(u.isArray(r)){t.push(r);r={}}var n=r.keyPath=r.keyPath||"id";r.sortPath=r.sortPath||n;for(;!e.length&&t.length;){e=t.shift()||[];e=e.slice(0)}var s;t.forEach(function(t){if(t)t.forEach(function(t){s=u.findObjIndexInArray(e,{keyPath:n,value:c(t,n)});if(s!==-1)e[s]=u.merge({},e[s],t);else e.push(t)})});if(!r.notSort)e=u.sortObjArray(e,r);return e};u.cutObjArray=function(e){var t=e.slice(0);var r=arguments.length;var n=[].slice.call(arguments,1,r-1);var s=arguments[r-1];if(!u.isObject(s)){n.push(s);s={}}var i=s.keyPath=s.keyPath||"id";var o;n.forEach(function(e){if(!u.isArray(e))e=[e];e.forEach(function(e){if(e){s.value=c(e,i);o=u.findObjIndexInArray(t,s);if(o!==-1)t.splice(o,1)}})});return t};u.sortObjArray=function(e,t){t=t||{};var r=t.sortPath||"id";a.insensitive=!!t.insensitive;var n=!!t.desc;var s,i;var o;if(u.isFunction(t.compare))o=t.compare;else o=function l(e,t){s=c(e,r);i=c(t,r);if(n)return a(i,s);else return a(s,i)};return e.sort(o)};u.emptyFunc=function(){};u.isEmptyFunc=function(e){return e===u.emptyFunc};u.notEmptyFunc=function(e){return e!==u.emptyFunc};u.splice=function(e,t,r){return[].splice.call(e,t,r)};u.reshape2d=function(e,t){if(Array.isArray(e)){u.verifyParamType("type",t,"number","util::reshape2d");var r=e.length;if(r<=t)return[e];else{var n=Math.ceil(r/t);var s=[];for(var i=0;i<n;i++)s.push(e.slice(i*t,(i+1)*t));return s}}return e};u.flatten2d=function(e){if(Array.isArray(e)){var t=[];e.forEach(function(e){t=t.concat(e)});return t}return e};u.dropArrayDuplicates=function(e){if(Array.isArray(e)){var t={};var r=[];for(;e.length>0;){var n=e.shift();t[n]=!0}for(var s in t)if(t[s]===!0)r.push(s);return r}return e};u.onError=function(e){throw new s(e)};u.verifyParamPresent=function(e,t,r,n){r=r||"";var s=!1;switch(u.typeOf(t)){case"undefined":case"null":s=!0;break;case"string":if(""===t)s=!0;break;case"StrStrMap":case"object":if(!Object.keys(t).length)s=!0;break;case"array":if(!t.length)s=!0;else t.some(function(e){if(u.notexist(e)){s=!0;return!0}})}if(s)u.onParamAbsent(r+e,n)};u.onParamAbsent=function(e,t){u.onParamError("缺少参数 "+e+", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined",t)};u.verifyParamAbsent=function(e,t,r,n){r=r||"";if(void 0!==t)u.onParamPresent(r+e,n)};u.onParamPresent=function(e,t){u.onParamError("多余的参数 "+e,t)};u.verifyParamType=function(e,t,r,n){var s=u.typeOf(t).toLowerCase();if(!u.isArray(r))r=[r];r=r.map(function(e){return e.toLowerCase()});var i=!0;if(r.indexOf(s)===-1)i=!1;switch(s){case"number":if(isNaN(t))i=!1;break;case"string":if("numeric or numeric string"===r.join(""))if(/^[0-9]+$/.test(t))i=!0;else i=!1}if(!i)u.onParamInvalidType(e,r,"",n)};u.onParamInvalidType=function(e,t,r,n){r=r||"";if(u.isArray(t)){t=t.map(function(e){return'"'+e+'"'});t=t.join(", ")}else t='"'+t+'"';u.onParamError('参数"'+r+e+'"类型错误, 合法的类型包括: ['+t+"]",n)};u.verifyParamValid=function(e,t,r,n){if(!u.isArray(r))r=[r];if(r.indexOf(t)===-1)u.onParamInvalidValue(e,r,n)};u.onParamInvalidValue=function(e,t,r){if(!u.isArray(t))t=[t];t=t.map(function(e){return'"'+e+'"'});if(u.isArray(t))t=t.join(", ");u.onParamError("参数 "+e+"值错误, 合法的值包括: ["+JSON.stringify(t)+"]",r)};u.verifyParamMin=function(e,t,r,n){if(t<r)u.onParamError("参数"+e+"的值不能小于"+r,n)};u.verifyParamMax=function(e,t,r,n){if(t>r)u.onParamError("参数"+e+"的值不能大于"+r,n)};u.verifyArrayMax=function(e,t,r,n){if(t.length>r)u.onParamError("参数"+e+"的长度不能大于"+r,n)};u.verifyEmail=function(){var e=/^\S+@\S+$/;return function(t,r,n){if(!e.test(r))u.onParamError("参数"+t+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",n)}}();u.verifyTel=function(){var e=/^[+\-()\d]+$/;return function(t,r,n){if(!e.test(r))u.onParamError("参数"+t+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",n)}}();u.verifyBirth=function(){var e=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(t,r,n){if(!e.test(r))u.onParamError("参数"+t+'生日格式错误, 合法为"yyyy-MM-dd"',n)}}();u.onParamError=function(e,t){u.onError({message:e,callFunc:t})};u.verifyOptions=function(e,t,r,n,s){e=e||{};if(t){if(u.isString(t))t=t.split(m);if(u.isArray(t)){if("boolean"!=typeof r){s=r||null;r=!0;n=""}var i=r?u.verifyParamPresent:u.verifyParamAbsent;t.forEach(function(t){i.call(u,t,e[t],n,s)})}}return e};u.verifyParamAtLeastPresentOne=function(e,t,r){
if(t){if(u.isString(t))t=t.split(m);if(u.isArray(t)){var n=t.some(function(t){return u.exist(e[t])});if(!n)u.onParamError("以下参数["+t.join(", ")+"]至少需要传入一个",r)}}};u.verifyParamPresentJustOne=function(e,t,r){if(t){if(u.isString(t))t=t.split(m);if(u.isArray(t)){var n=t.reduce(function(t,r){if(u.exist(e[r]))t++;return t},0);if(1!==n)u.onParamError("以下参数["+t.join(", ")+"]必须且只能传入一个",r)}}};u.verifyBooleanWithDefault=function(e,t,r,n,s){if(u.undef(r))r=!0;if(m.test(t))t=t.split(m);if(u.isArray(t))t.forEach(function(t){u.verifyBooleanWithDefault(e,t,r,n,s)});else if("undefined"==typeof e[t])e[t]=r;else if(!u.isBoolean(e[t]))u.onParamInvalidType(t,"boolean",n,s)};u.verifyFileInput=function(e,t){u.verifyParamPresent("fileInput",e,"",t);if(u.isString(e)){if("undefined"==typeof document)e=void 0;else e=document.getElementById(e);if(!e)u.onParamError("找不到要上传的文件对应的input, 请检查fileInput id "+e,t)}if(!e.tagName||"input"!==e.tagName.toLowerCase()||"file"!==e.type.toLowerCase())u.onParamError("请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:"+e.tagName+", filetype:"+e.type,t);return e};u.verifyFileType=function(e,t){u.verifyParamValid("type",e,u.validFileTypes,t)};u.verifyCallback=function(e,t,r){if(m.test(t))t=t.split(m);if(u.isArray(t))t.forEach(function(t){u.verifyCallback(e,t,r)});else if(!e[t])e[t]=u.emptyFunc;else if(!u.isFunction(e[t]))u.onParamInvalidType(t,"function","",r)};u.verifyFileUploadCallback=function(e,t){u.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)};u.validFileTypes=["image","audio","video","file"];u.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg"]};u.filterFiles=function(e,t){t=t.toLowerCase();var r="file"===t;var n=[];var s;var i;var o;[].forEach.call(e,function(e){if(r)n.push(e);else{s=e.name.slice(e.name.lastIndexOf(".")+1);i=e.type.split("/");if(i[0]&&i[1]){o=i[0].toLowerCase();var a=!1;if(o===t)a=!0;else a=u.validFileExts[t].indexOf(s)!==-1;if(a)n.push(e)}else;}});return n};var d=u.supportFormData=u.notundef(l.FormData);u.getFileName=function(){return function(e){e=u.verifyFileInput(e);if(d)return e.files[0].name;else return e.value.slice(e.value.lastIndexOf("\\")+1)}}();u.getFileInfo=function(){var e={ppt:1,pptx:2,pdf:3};return function(t){t=u.verifyFileInput(t);var r={};if(!t.files)return r;var n=t.files[0];if(d){r.name=n.name;r.size=n.size;r.type=n.name.match(/\.(\w+)$/);r.type=r.type&&r.type[1].toLowerCase();r.transcodeType=e[r.type]||0}return r}}();u.sizeText=function(){var e=["B","KB","MB","GB","TB","PB","EB","ZB","BB"];return function(t){var r;var n=0;do{t=Math.floor(100*t)/100;var s=e[n];r=t+s;t/=1024;n++}while(t>1);return r}}();u.promises2cmds=function(e){return e.map(function(e){return e.cmd})};u.objs2accounts=function(e){return e.map(function(e){return e.account})};u.teams2ids=function(e){return e.map(function(e){return e.teamId})};u.objs2ids=function(e){return e.map(function(e){return e.id})};u.getMaxUpdateTime=function(e){var t=e.map(function(e){return+e.updateTime});return Math.max.apply(Math,t)};u.genCheckUniqueFunc=function(e,t){e=e||"id";t=t||1e3;return function(t){this.uniqueSet=this.uniqueSet||{};this.uniqueSet[e]=this.uniqueSet[e]||{};var r=this.uniqueSet[e];var n=t[e];if(r[n])return!1;else{r[n]=!0;return!0}}};u.fillPropertyWithDefault=function(e,t,r){if(u.undef(e[t])){e[t]=r;return!0}return!1};e.exports=u},"./src/util/logger.js":function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.merge(this,{options:e,debug:!1,api:"log",style:"color:blue;",log:i.emptyFunc,info:i.emptyFunc,warn:i.emptyFunc,error:i.emptyFunc});this.prefix=e.prefix||"";this.setDebug(e.debug)}var s=r("./src/polyfill/weixin-app/platform.js");var i=r("./src/util/index.js");var o=r("./src/util/ajax/index.js");var a=n.prototype;var c=["Chrome","Safari","Firefox"];a.setDebug=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;var t=this;t.debug=e;if(e.style)t.style=e.style;if(t.debug&&i.exist(console)){var r=console;t.debug=function(){var e=t.formatArgs(arguments);if(c.indexOf(s.name)!==-1&&i.isString(e[0])){e[0]="%c"+e[0];e.splice(1,0,t.style)}t._log("debug",e)};t.log=function(){var e=t.formatArgs(arguments);if(c.indexOf(s.name)!==-1&&i.isString(e[0])){e[0]="%c"+e[0];e.splice(1,0,t.style)}t._log("log",e)};t.info=function(){var e=t.formatArgs(arguments);if(c.indexOf(s.name)!==-1&&i.isString(e[0])){e[0]="%c"+e[0];e.splice(1,0,t.style)}t._log("info",e)};t.warn=function(){var e=t.formatArgs(arguments);if(c.indexOf(s.name)!==-1&&i.isString(e[0])){e[0]="%c"+e[0];e.splice(1,0,t.style)}t._log("warn",e)};t.error=function(){var e=t.formatArgs(arguments);if(c.indexOf(s.name)!==-1&&i.isString(e[0])){e[0]="%c"+e[0];e.splice(1,0,t.style)}t._log("error",e)};t._log=function(e,n){var s=!1;var o=t.options.logFunc;var a=null;if(o&&!s){if(o[e])a=o[e];if(i.isFunction(a)){a.apply(o,n);return}}if(r[e])try{if(r[e].apply)t.chrome(e,n);else t.ie(e,n)}catch(c){}};t.chrome=function(e,n){if(c.indexOf(s.name)!==-1)r[e].apply(r,n);else t.ie(e,n)};t.ie=function(e,t){t.forEach(function(t){r[e](JSON.stringify(t,null,4))})}}};a.formatArgs=function(e){var t=this;e=[].slice.call(e,0);var r=new Date;var n=u(r.getMonth()+1)+"-"+u(r.getDate())+" "+u(r.getHours())+":"+u(r.getMinutes())+":"+u(r.getSeconds())+":"+u(r.getMilliseconds(),3);var s="[NIM LOG "+n+" "+t.prefix.toUpperCase()+"]  ";if(i.isString(e[0]))e[0]=s+e[0];else e.splice(0,0,s);e.forEach(function(t,r){if(i.isArray(t)||i.isObject(t))e[r]=i.simpleClone(t)});return e};var u=function l(e,t){t=t||2;var r=""+e;for(;r.length<t;)r="0"+r;return r};e.exports=n},"./src/util/loggerPlugin.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){var t={debug:0,log:1,info:2,warn:3,error:4};var r=this;var n=e.url||null;r.level=t[e.level]||0;r.logCache=[];r.logNum=1;r.timeInterval=5e3;window.onerror=function(e,t,n,s,i){r.error(i)};setInterval(function(){if(r.logCache.length>0&&n)r.postLogs(n,r.logCache)},r.timeInterval)}var i=r("./node_modules/babel-runtime/helpers/typeof.js");var o=n(i);s.prototype.debug=function(){if(!(this.level>0)){console.debug.apply(this,arguments);this.cacheLogs.apply(this,["[degbug]"].concat(arguments))}};s.prototype.log=function(){if(!(this.level>1)){console.log.apply(this,arguments);this.cacheLogs.apply(this,["[log]"].concat(arguments))}};s.prototype.info=function(){if(!(this.level>2)){console.info.apply(this,arguments);this.cacheLogs.apply(this,["[info]"].concat(arguments))}};s.prototype.warn=function(){if(!(this.level>3)){console.warn.apply(this,arguments);this.cacheLogs.apply(this,["[warn]"].concat(arguments))}};s.prototype.error=function(){if(!(this.level>4)){console.error.apply(this,arguments);this.cacheLogs.apply(this,["[error]"].concat(arguments))}};s.prototype.cacheLogs=function(e,t){var r=[];for(var n=0;n<t.length;n++){var s=t[n];if("object"===("undefined"==typeof s?"undefined":(0,o["default"])(s)))r.push(JSON.stringify(s));else r.push(s)}var i=this.logNum++ +" "+e+" "+r.join("; ");this.logCache.push(i.replace("%c",""))};s.prototype.postLogs=function(e,t){var r=this;var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){console.info("LoggerPlugin::日志上报完成");r.logCache=[];r.timeInterval=5e3}else r.timeInterval+=5e3};n.open("POST",e);n.setRequestHeader("Content-Type","plain/text;charset=utf-8");n.timeout=360;n.send(t.join("\n"))};e.exports=s},"./src/util/nos.js":function(e,t,r){"use strict";var n=r("./src/util/index.js");var s={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}};var i={};i.genResponseBody=function(e){e=e||"file";return s[e]};i.parseResponse=function(e,t){if(n.notundef(e.size))e.size=+e.size;if(n.notundef(e.w))e.w=+e.w;if(n.notundef(e.h))e.h=+e.h;if(n.notundef(e.dur))e.dur=+e.dur;var r=e.orientation;if(n.notundef(r)){delete e.orientation;if(t)if("right, top"===r||"left, bottom"===r){var s=e.w;e.w=e.h;e.h=s}}return e};e.exports=i},"./src/util/support.js":function(e,t,r){"use strict";var n={};n.set=function(e,t,r){n[e]=t;if(r)r.support=t};e.exports=n},"./src/util/upload.js":function(e,t,r){"use strict";function n(e){var t=this;t.options=i.copy(e);i.verifyOptions(e,"url fileName");i.verifyParamPresentJustOne(e,"blob fileInput");i.verifyCallback(e,"beginupload uploadprogress uploaddone");if(e.fileInput)e.fileInput=i.verifyFileInput(e.fileInput);if(e.type)i.verifyFileType(e.type);if(e.timeout)i.verifyParamType("timeout",e.timeout,"number");else e.timeout=6e5;i.verifyFileUploadCallback(e);e.data={};if(e.params)i.merge(e.data,e.params);var r=e.fileName;var n=e.fileInput;if(l){if(n){var u=e.type?i.filterFiles(n.files,e.type):[].slice.call(n.files,0);if(!u||!u.length){e.uploaddone(o.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));return}e.data[r]=u[0];var m=n.files[0].size}else if(e.blob){e.data[r]=e.blob;if("file"!==e.type&&e.blob.type&&e.blob.type.indexOf(e.type)===-1){e.uploaddone(o.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));return}var m=e.blob.size}if(e.maxSize&&m>e.maxSize){e.uploaddone(o.newFileTooLargeError("上传文件大小超过"+e.maxSize+"限制"));return}if(!e.commonUpload){if(m>s.chunkMaxSize){e.uploaddone(o.newFileTooLargeError("直传文件大小超过"+s.chunkMaxSize+"限制"));return}t.sn=c(e,r,t);return}if(m>s.commonMaxSize){e.uploaddone(o.newFileTooLargeError("普通上传文件大小超过"+s.commonMaxSize+"限制"));return}}else{i.dataset(n,"name",r);e.data.input=n}var d={data:e.data,onaftersend:function f(){e.beginupload(t)},onuploading:function p(t){var r=Math.floor(1e4*t.loaded/t.total)/100;var n={docId:e.docId,total:t.total,
loaded:t.loaded,percentage:r,percentageText:r+"%"};if(e.fileInput)n.fileInput=e.fileInput;if(e.blob)n.blob=e.blob;e.uploadprogress(n)},onload:function g(r){r.docId=e.docId;if(r.Error)t.onError(r);else e.uploaddone(null,r)},onerror:function v(r){try{if(r.result)var n=JSON.parse(r.result);else n=r;t.onError(n)}catch(s){console.log("error: ignore error if could not parse obj.result",s);e.uploaddone(new o(r.message,r.code),t.options)}}};if(!l)d.mode="iframe";d.putFileAtEnd=!0;t.sn=a(e.url,d)}var s=r("./src/util/config.js");var i=r("./src/util/index.js");var o=r("./src/im/model/nimerror.js");var a=r("./src/util/ajax/index.js").upload;var c=r("./src/util/ajax/index.js").chunkUpload;var u=r("./src/util/ajax/index.js").abort;var l=i.supportFormData;n.prototype.onError=function(e){var t=this;var r=t.options;var n,s,i;e=e||{};n=e.Error||e||{};s=n.Code||n.code||"unknown";i=n.Message||n.message||"未知错误";r.uploaddone(new o(s+"("+i+")",s))};n.prototype.abort=function(){u(this.sn)};e.exports=n},"./src/util/url.js":function(e,t,r){"use strict";var n=r("./src/util/config.js");var s={genUrlSep:function i(e){e=""+e;var t=e.indexOf("?")===-1?"?imageView&":"&";return t},urlQuery2Object:function o(e){if("[object String]"!==Object.prototype.toString.call(e)||""===e)return{};var t=e.indexOf("?");if(t!==-1){var r=e.slice(t+1);var n=r.split("&");var s={};n.forEach(function(e){if(~e.indexOf("=")){var t=e.split("=");s[t[0]]=decodeURIComponent(t[1])}else s[e]=""});return s}},url2object:function a(e){if("[object String]"!==Object.prototype.toString.call(e))e="";e=e||"";var t=e.indexOf("https")>=0?"https://":"http://";var r=e.replace(t,"");if(r.indexOf("?")>=0)r=r.substring(0,r.indexOf("?"));var n=r.split("/");r=n[0];var s="";if(n.length>0)s=n.slice(1).join("/");if(e.indexOf("?")===-1)return{protocol:t,hostname:r,path:s,query:{}};else{var i=e.substr(e.indexOf("?")+1);var o=i.split("&");var a={};o.forEach(function(e){if(e.indexOf("=")>0){var t=e.split("=");a[t[0]]=decodeURIComponent(t[1])}else a[e]=""});return{protocol:t,hostname:r,path:s,query:a}}},object2url:function c(e){var t=e.protocol,r=e.hostname,n=e.path,s=e.query;t=t||"http://";r=r||"";if(n)r=r+"/"+n;s=s||{};var i=[];for(var o in s)if("imageView"!==o)i.push(o+"="+encodeURIComponent(s[o]));else;if(i.length>0)return""+t+r+"?imageView&"+i.join("&");else return""+t+r},genPrivateUrl:function u(e){var t=s.url2object(e);var r=t.hostname;var i=t.path;var o=n.downloadHost;var a=n.downloadUrl;if(r===o){var c=i.indexOf("/");if(c!==-1){var u=i.substring(0,c);var l=i.substring(c+1);return a.replace("{bucket}",u).replace("{object}",l)}}else if(r&&"[object String]"==Object.prototype.toString.call(r)&&~r.indexOf(o)){var m=t.path;var d=m.indexOf(".");if(d!==-1){var f=m.substring(0,d);var p=m;return a.replace("{bucket}",f).replace("{object}",p)}}return e}};e.exports=s},"./src/util/usePlugin.js":function(e,t,r){"use strict";function n(e){if(e.db)s.db=e.db}var s=r("./src/util/device.js");e.exports=n},"./src/util/util.js":function(e,t,r){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{"default":e}}function s(){if("undefined"!=typeof window)return window;if("undefined"!=typeof e)return e;else return{}}function i(e){var t=!1;var r="Webkit Moz ms O".split(" ");if("undefined"!=typeof document){var n=document.createElement("div");var s=null;e=e.toLowerCase();if(void 0!==n.style[e])t=!0;if(t===!1){s=e.charAt(0).toUpperCase()+e.substr(1);for(var i=0;i<r.length;i++)if(void 0!==n.style[r[i]+s]){t=!0;break}}return t}else console.log("error:fn:detectCSSFeature document is undefined")}function o(e,t){t=t||2;var r=""+e;for(;r.length<t;)r="0"+r;return r}function a(e){return""+e.getFullYear()}function c(e){return o(e.getMonth()+1)}function u(e){return o(e.getDate())}function l(e){return o(e.getHours())}function m(e){return o(e.getMinutes())}function d(e){return o(e.getSeconds())}function f(e){return o(e.getMilliseconds(),3)}function p(e){e=""+e;return new Date(e.replace(/-/g,"/").replace("T"," "))}function g(e){return Object.prototype.toString.call(e).slice(8,-1)}function v(e){return g(e).toLowerCase()}function y(e){return"string"===v(e)}function h(e){return"number"===v(e)}function b(e){return"boolean"===v(e)}function T(e){return"array"===v(e)}function M(e){return"function"===v(e)}function S(e){return"date"===v(e)}function j(e){return"regexp"===v(e)}function k(e){return"error"===v(e)}function _(e){return null===e}function I(e){return null!==e}function x(e){return"undefined"==typeof e}function P(e){return"undefined"!=typeof e}function C(e){return P(e)&&I(e)}function w(e){return x(e)||_(e)}function O(e){return C(e)&&"object"===v(e)}function A(e){return w(e)||(y(e)||T(e))&&0===e.length}function E(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1}function R(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;e=e.cloneNode(!0);e.style.display="block";e.style.opacity=0;e.style.height="auto";t.appendChild(e);var r=e.offsetHeight;t.removeChild(e);return r}function U(e){if(e.parentNode)e.parentNode.removeChild(e)}function N(e,t,r){if(C(r))e.setAttribute("data-"+t,r);else return e.getAttribute("data-"+t)}function F(e){return e.target||e.srcElement}function D(e){function t(n){if(r.src){if(!e.multi)pe(r,"load",t);e.onload(n)}}if("undefined"!=typeof document){e=e||{};var r;if(e.name)try{r=document.createElement('<iframe name="'+e.name+'"></iframe>');r.frameBorder=0}catch(n){r=document.createElement("iframe");r.name=e.name}else r=document.createElement("iframe");if(!e.visible)r.style.display="none";if(M(e.onload))de(r,"load",t);var s=e.parent;(s||document.body).appendChild(r);var i=e.src||"about:blank";setTimeout(function(){r.src=i},0);return r}}function L(e){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML=e;var r=[];var n=void 0;var s=void 0;if(t.children)for(n=0,s=t.children.length;n<s;n++)r.push(t.children[n]);else for(n=0,s=t.childNodes.length;n<s;n++){var i=t.childNodes[n];if(1===i.nodeType)r.push(i)}return r.length>1?t:r[0]}}function B(e){if("undefined"!=typeof document&&C(e))document.documentElement.scrollTop=document.body.scrollTop=e;return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};var r=arguments[2];for(var n in e)if(e.hasOwnProperty(n))t.call(r,n,e[n])}function H(e,t){q(t,function(t,r){e[t]=r})}function z(e){return y(e)&&0===e.indexOf("{")&&e.lastIndexOf("}")===e.length-1}function W(e){try{if(z(e))e=JSON.parse(e);if(O(e))q(e,function(t,r){switch(v(r)){case"string":case"object":e[t]=W(r)}})}catch(t){console.log("error:",t)}return e}function J(e){var t=[];var r=JSON.stringify(e,function(e,r){if("object"===("undefined"==typeof r?"undefined":(0,ne["default"])(r))&&null!==r){if(t.indexOf(r)!==-1)return;t.push(r)}return r});return JSON.parse(r)}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach(function(t){H(e,t)});return e}function X(e,t){q(t,function(t,r){if(x(e[t]))e[t]=r});return e}function $(e,t,r){var n=e[t]||e[t.toLowerCase()];if(w(n)){n=r;e[t]=n}return n}function G(e,t){q(e,function(r,n){if(C(t[r]))e[r]=t[r]});return e}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";var r={};e.split(t).forEach(function(e){var t=e.split("=");var n=t.shift();if(n)r[decodeURIComponent(n)]=decodeURIComponent(t.join("="))});return r}function Q(e,t,r){if(!e)return"";var n=[];q(e,function(e,t){if(!M(t)){if(S(t))t=t.getTime();else if(T(t))t=t.join(",");else if(O(t))t=JSON.stringify(t);if(r)t=encodeURIComponent(t);n.push(encodeURIComponent(e)+"="+t)}});return n.join(t||",")}function Y(e){return e.indexOf("?")<0?"?":"&"}function Z(e){return Q(e,"&",!0)}function ee(e){var t=s();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}function te(e,t){var r=Object.keys(e);if(t)r.sort(function(t,r){var n=ee(e[t]);var s=ee(e[r]);if(n===s)return 0;else return n?1:-1});return r}Object.defineProperty(t,"__esModule",{value:!0});t.url2origin=t.uniqueID=t.off=t.removeEventListener=t.on=t.addEventListener=t.format=t.regWhiteSpace=t.regBlank=t.emptyFunc=t.f=t.emptyObj=t.o=void 0;var re=r("./node_modules/babel-runtime/helpers/typeof.js");var ne=n(re);t.getGlobal=s;t.detectCSSFeature=i;t.fix=o;t.getYearStr=a;t.getMonthStr=c;t.getDayStr=u;t.getHourStr=l;t.getMinuteStr=m;t.getSecondStr=d;t.getMillisecondStr=f;t.dateFromDateTimeLocal=p;t.getClass=g;t.typeOf=v;t.isString=y;t.isNumber=h;t.isBoolean=b;t.isArray=T;t.isFunction=M;t.isDate=S;t.isRegExp=j;t.isError=k;t.isnull=_;t.notnull=I;t.undef=x;t.notundef=P;t.exist=C;t.notexist=w;t.isObject=O;t.isEmpty=A;t.containsNode=E;t.calcHeight=R;t.remove=U;t.dataset=N;t.target=F;t.createIframe=D;t.html2node=L;t.scrollTop=B;t.forOwn=q;t.mixin=H;t.isJSON=z;t.parseJSON=W;t.simpleClone=J;t.merge=V;t.fillUndef=X;t.checkWithDefault=$;t.fetch=G;t.string2object=K;t.object2string=Q;t.genUrlSep=Y;t.object2query=Z;t.isFileInput=ee;t.getKeys=te;var se=t.o={};var ie=t.emptyObj={};var oe=t.f=function ye(){};var ae=t.emptyFunc=function he(){};var ce=t.regBlank=/\s+/gi;var ue=t.regWhiteSpace=/\s+/gi;var le=t.format=function(){var e=/yyyy|MM|dd|hh|mm|ss|SSS/g;var t={yyyy:a,MM:c,dd:u,hh:l,mm:m,ss:d,SSS:f};return function(r,n){r=new Date(r);if(isNaN(+r))return"invalid date";n=n||"yyyy-MM-dd";return n.replace(e,function(e){return t[e](r)})}}();var me=t.addEventListener=function be(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r)};var de=t.on=me;var fe=t.removeEventListener=function Te(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r)};var pe=t.off=fe;var ge=t.uniqueID=function(){var e=0;return function(){
return""+e++}}();var ve=t.url2origin=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){if(e.test(t||""))return RegExp.$1.toLowerCase();else return""}}()}).call(this,r("./node_modules/webpack/buildin/global.js"))}});